(()=>{var Vr=Object.create;var it=Object.defineProperty;var zr=Object.getOwnPropertyDescriptor;var $r=Object.getOwnPropertyNames,Jt=Object.getOwnPropertySymbols,Wr=Object.getPrototypeOf,Qt=Object.prototype.hasOwnProperty,Hr=Object.prototype.propertyIsEnumerable;var Ce=Math.pow,Dt=(t,e,r)=>e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,er=(t,e)=>{for(var r in e||(e={}))Qt.call(e,r)&&Dt(t,r,e[r]);if(Jt)for(var r of Jt(e))Hr.call(e,r)&&Dt(t,r,e[r]);return t};var tr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),It=(t,e)=>{for(var r in e)it(t,r,{get:e[r],enumerable:!0})},Xr=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of $r(e))!Qt.call(t,n)&&n!==r&&it(t,n,{get:()=>e[n],enumerable:!(i=zr(e,n))||i.enumerable});return t};var Ft=(t,e,r)=>(r=t!=null?Vr(Wr(t)):{},Xr(e||!t||!t.__esModule?it(r,"default",{value:t,enumerable:!0}):r,t));var u=(t,e,r)=>Dt(t,typeof e!="symbol"?e+"":e,r);var U=(t,e,r)=>new Promise((i,n)=>{var s=c=>{try{o(r.next(c))}catch(l){n(l)}},a=c=>{try{o(r.throw(c))}catch(l){n(l)}},o=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,a);o((r=r.apply(t,e)).next())});var Nt=tr((Pt,Gt)=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof Pt!="undefined"?e():(e(),t.FileSaver={})})(Pt,function(){"use strict";function t(o,c){return typeof c=="undefined"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function e(o,c,l){var h=new XMLHttpRequest;h.open("GET",o),h.responseType="blob",h.onload=function(){a(h.response,c,l)},h.onerror=function(){console.error("could not download file")},h.send()}function r(o){var c=new XMLHttpRequest;c.open("HEAD",o,!1);try{c.send()}catch(l){}return 200<=c.status&&299>=c.status}function i(o){try{o.dispatchEvent(new MouseEvent("click"))}catch(l){var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(c)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,s=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(o,c,l){var h=n.URL||n.webkitURL,f=document.createElement("a");c=c||o.name||"download",f.download=c,f.rel="noopener",typeof o=="string"?(f.href=o,f.origin===location.origin?i(f):r(f.href)?e(o,c,l):i(f,f.target="_blank")):(f.href=h.createObjectURL(o),setTimeout(function(){h.revokeObjectURL(f.href)},4e4),setTimeout(function(){i(f)},0))}:"msSaveOrOpenBlob"in navigator?function(o,c,l){if(c=c||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(t(o,l),c);else if(r(o))e(o,c,l);else{var h=document.createElement("a");h.href=o,h.target="_blank",setTimeout(function(){i(h)})}}:function(o,c,l,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof o=="string")return e(o,c,l);var f=o.type==="application/octet-stream",m=/constructor/i.test(n.HTMLElement)||n.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||f&&m||s)&&typeof FileReader!="undefined"){var E=new FileReader;E.onloadend=function(){var A=E.result;A=p?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=A:location=A,h=null},E.readAsDataURL(o)}else{var R=n.URL||n.webkitURL,d=R.createObjectURL(o);h?h.location=d:location.href=d,h=null,setTimeout(function(){R.revokeObjectURL(d)},4e4)}});n.saveAs=a.saveAs=a,typeof Gt!="undefined"&&(Gt.exports=a)})});var Nr=tr((zt,Gr)=>{(function(t,e){typeof zt=="object"?Gr.exports=e():typeof define=="function"&&define.amd?define(e):t.Alea=e()})(zt,function(){"use strict";return t.importState=function(r){var i=new t;return i.importState(r),i},t;function t(){return function(r){var i=0,n=0,s=0,a=1;r.length==0&&(r=[+new Date]);var o=e();i=o(" "),n=o(" "),s=o(" ");for(var c=0;c<r.length;c++)i-=o(r[c]),i<0&&(i+=1),n-=o(r[c]),n<0&&(n+=1),s-=o(r[c]),s<0&&(s+=1);o=null;var l=function(){var h=2091639*i+a*23283064365386963e-26;return i=n,n=s,s=h-(a=h|0)};return l.next=l,l.uint32=function(){return l()*4294967296},l.fract53=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.version="Alea 0.9",l.args=r,l.exportState=function(){return[i,n,s,a]},l.importState=function(h){i=+h[0]||0,n=+h[1]||0,s=+h[2]||0,a=+h[3]||0},l}(Array.prototype.slice.call(arguments))}function e(){var r=4022871197,i=function(n){n=n.toString();for(var s=0;s<n.length;s++){r+=n.charCodeAt(s);var a=.02519603282416938*r;r=a>>>0,a-=r,a*=r,r=a>>>0,a-=r,r+=a*4294967296}return(r>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})});Array.prototype.remove=function(t){let e=this.indexOf(t);return e!=-1?(this.splice(e,1),!0):!1};Array.prototype.appendArray=function(t){if(t)for(let e=0;e<t.length;e++)this.push(t[e])};Array.prototype.shuffle=function(){for(let t=this.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[this[t],this[e]]=[this[e],this[t]]}};var rr=Ft(Nt());HTMLCanvasElement.prototype.screenshot=function(t="download.png"){this.toBlob(e=>rr.default.saveAs(e,t))};CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderingContext2D.prototype.line=function(t,e,r,i){this.beginPath(),this.moveTo(t,e),this.lineTo(r,i),this.stroke()};CanvasRenderingContext2D.prototype.fillTextAligned=function(t,e,r,i){let n=this.measureText(t);switch(i){case"left":this.fillText(t,e,r);break;case"center":this.fillText(t,e-n.width/2,r);break;case"right":this.fillText(t,e-n.width,r);break}};CanvasRenderingContext2D.prototype.fillCircle=function(t,e,r){this.beginPath(),this.arc(t,e,r,0,Math.PI*2),this.fill()};Math.clamp=function(t,e,r){return Math.min(Math.max(t,e),r)};Math.average=function(...t){return t.reduce((e,r)=>e+r,0)/t.length};Math.distance=function(t,e,r,i){return Math.sqrt(Math.pow(r-t,2)+Math.pow(i-e,2))};Math.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};Math.lerp=function(t,e,r){return t+(e-t)*r};Math.oscilate=function(t,e,r=0,i=1){let n=2*Math.PI*e,s=i-r,o=(Math.sin(n*t)+1)/2;return r+o*s};Math.smoothstep=function(t,e=0,r=1){return t=Math.clamp((t-e)/(r-e),0,1),t*t*(3-2*t)};Math.prettifyElapsedTime=function(t){let e=(r,i)=>r%1===0?Math.floor(r):r.toFixed(i);return t<1?"".concat(Math.floor(t*1e3),"\u03BCs"):t<1e3?"".concat(e(t,2),"ms"):t<6e4?"".concat(e(t/1e3,2),"s"):t<36e5?"".concat(e(t/6e4,2),"m"):"".concat(e(t/36e5,2),"h")};Math.prettifyUnit=function(t,e=""){return t<1e3?"".concat(t).concat(e):t<1e6?"".concat((t/1e3).toFixed(2),"k").concat(e):t<1e9?"".concat((t/1e6).toFixed(2),"M").concat(e):"".concat((t/1e9).toFixed(2),"G").concat(e)};Math.toDegrees=function(t){return t*(180/Math.PI)};Math.toRadians=function(t){return t*(Math.PI/180)};Function.oneshot=function(t){let e=!1;return()=>{e||(e=!0,t())}};Function.timeout=function(t,e){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{t(),r=!1},e))}};Function.debounce=function(t,e){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{t(),r=!1},e))}};Promise.delay=function(t){return new Promise((e,r)=>{setTimeout(e,t)})};Promise.sequential=function(t){return t.reduce((e,r)=>e.then(i=>r.then(n=>(i.push(n),i))),Promise.resolve([]))};String.prototype.toCamelCase=function(){return this.replace("--","").replace(/-./g,t=>t[1].toUpperCase()).trim()};String.prototype.insertAt=function(t,e){return this.substr(0,t)+e+this.substr(t)};window.addLoadEventListener=function(t){let e=Function.oneshot(t);window.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e),document.addEventListener("load",e),window.addEventListener("ready",e),setTimeout(e,1e3)};window.addVisibilityChangeEventListener=function(t){let e=["webkit","moz","ms",""],r=Function.debounce(()=>{t(!window.isDocumentHidden())},50);e.forEach(i=>{document.addEventListener("".concat(i,"visibilitychange"),r)}),document.onvisibilitychange=r};window.isMobile=function(){return window.matchMedia("(any-pointer: coarse)").matches};window.isDocumentHidden=function(){return["webkit","moz","ms",""].map(e=>e&&e.length>0?"".concat(e,"Hidden"):"hidden").map(e=>document[e]).reduce((e,r)=>e||r,!1)};window.getRefreshRate=function(){return new Promise((t,e)=>{let r=[60,75,100,120,144,165,240,360];setTimeout(()=>{requestAnimationFrame(i=>{requestAnimationFrame(n=>{let a=1e3/(n-i),o=r.reduce((c,l)=>Math.abs(l-a)<Math.abs(c-a)?l:c);t(o)})})},10)})};performance.getUsedMemory=function(){return new Promise((t,e)=>{"measureUserAgentSpecificMemory"in performance?this.measureUserAgentSpecificMemory().then(r=>t(r.bytes)).catch(()=>t(NaN)):"memory"in performance?t(this.memory.usedJSHeapSize):t(NaN)})};var L={RENDER_DISTANCE:256,RENDER_CHUNKS:!0,SORT_CHUNKS_BY_DISTANCE:!1,TEXTURE_ATLAS_SIZE:16,TEXTURE_ATLAS_SPRITE_SIZE:16,TEXTURE_PADDING:4,ANISOTROPIC_FILTERING:16,USE_MSAA:!0,TERRAIN_GENERATION_SEED:"myseed",TERRAIN_GENERATION_ON_MAIN_THREAD:!1,TERRAIN_GENERATION_WORKER_COUNT:1,RAYCASTING_STEP:1,RAYCASTING_MAX_DISTANCE:10,RAYCASTING_USE_DDA:!0,DISABLE_DEPTH_FOR_GIZMOS:!1,RENDER_CHUNK_BOUNDS:!1,RENDER_CHUNK_WIREFRAME:!1,FILTER_COLOR_CORRECTION_ENABLED:!0,FILTER_FXAA_ENABLED:!1,FILTER_SHARPEN_ENABLED:!1};var D=class{static logColoredText(e,r,i,...n){console[e].call(console,"%c".concat(e.toUpperCase()," %c[").concat(r,"]"),"font-weight: bold; color: ".concat(i,";"),"font-weight: bold; color: gray",...n)}static info(e,...r){this.logColoredText("info",e,"turquoise",...r)}static warn(e,...r){this.logColoredText("warn",e,"yellow",...r)}static error(e,...r){let i=r.find(n=>n instanceof Error);i&&console.trace(i),this.logColoredText("error",e,"red",...r)}static debug(e,...r){}};GL=WebGL2RenderingContext;var ir=function(){var e,r;if(L.ANISOTROPIC_FILTERING<=0)return;let t=(r=(e=this.getExtension("EXT_texture_filter_anisotropic"))!=null?e:this.getExtension("MOZ_EXT_texture_filter_anisotropic"))!=null?r:this.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(t){let i=this.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.texParameterf(GL.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L.ANISOTROPIC_FILTERING,i)),D.info("Texture","Anisotropic filtering supported, max: ".concat(i))}else D.warn("Texture","Anisotropic filtering not supported")};WebGL2RenderingContext.prototype.enableAnisotropicFiltering=ir;WebGLRenderingContext.prototype.enableAnisotropicFiltering=ir;var nr=function(){return this instanceof WebGL2RenderingContext?this.getParameter(WebGL2RenderingContext.MAX_SAMPLES):0};Object.defineProperty(WebGL2RenderingContext.prototype,"maxSamplesForMSAA",{get:nr});Object.defineProperty(WebGLRenderingContext.prototype,"maxSamplesForMSAA",{get:nr});var Ot=24,sr={width:808,height:808},ar=60,_t=1,nt=!0,X=16,De=64,Ve=.1,kt=5,Bt=2,oe=15,ie=12,ze="'Pixelify sans', 'Ubuntu Mono', sans-serif",ve=110;var N=class t{constructor(e,r=void 0){u(this,"x");u(this,"y");this.x=e,r===void 0?this.y=e:this.y=r}dot(e){return this.x*e.x+this.y*e.y}add(e){return new t(this.x+e.x,this.y+e.y)}subtract(e){return new t(this.x-e.x,this.y-e.y)}multiply(e){return new t(this.x*e,this.y*e)}divide(e){return new t(this.x/e,this.y/e)}normalize(){let e=this.length;return new t(this.x/e,this.y/e)}clone(){return new t(this.x,this.y)}static distanceSquared(e,r){return Ce(e.x-r.x,2)+Ce(e.y-r.y,2)}static distance(e,r){return Math.sqrt(this.distanceSquared(e,r))}static random(e){return new t(Math.random()*2-1,Math.random()*2-1).normalize().multiply(e)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static get zero(){return new t(0,0)}toString(){return"{ ".concat(this.x,", ").concat(this.y," }")}};var at=class at{constructor(e){this.workerName=e;u(this,"worker");this.worker=new Worker("".concat(window.location.href,"scripts/jobs/").concat(e,".worker.js")),this.worker.onmessage=this.onMessage.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.onmessageerror=this.onMessageError.bind(this)}postMessage(e){this.worker.postMessage(e)}onMessageReceived(e){}onMessage(e){at.VERBOSE&&D.debug("WorkerBinding-".concat(this.workerName),"Received message",e.data),this.onMessageReceived(e.data)}onError(e){D.error("WorkerBinding-".concat(this.workerName),"Worker error",e.message)}onMessageError(e){D.error("WorkerBinding-".concat(this.workerName),"Worker message error",e.data)}};u(at,"VERBOSE",!1);var st=at;var V=1e-6,J=typeof Float32Array!="undefined"?Float32Array:Array,we=Math.random;var Ds=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var P={};It(P,{add:()=>Di,adjoint:()=>ei,clone:()=>Yr,copy:()=>Zr,create:()=>jr,determinant:()=>ti,equals:()=>Gi,exactEquals:()=>Pi,frob:()=>Ci,fromQuat:()=>xi,fromQuat2:()=>mi,fromRotation:()=>hi,fromRotationTranslation:()=>lr,fromRotationTranslationScale:()=>vi,fromRotationTranslationScaleOrigin:()=>bi,fromScaling:()=>li,fromTranslation:()=>ci,fromValues:()=>Kr,fromXRotation:()=>fi,fromYRotation:()=>pi,fromZRotation:()=>ui,frustum:()=>yi,getRotation:()=>gi,getScaling:()=>hr,getTranslation:()=>di,identity:()=>or,invert:()=>Qr,lookAt:()=>Si,mul:()=>Ni,multiply:()=>cr,multiplyScalar:()=>Ii,multiplyScalarAndAdd:()=>Fi,ortho:()=>Mi,orthoNO:()=>pr,orthoZO:()=>Ai,perspective:()=>Ei,perspectiveFromFieldOfView:()=>Ri,perspectiveNO:()=>fr,perspectiveZO:()=>wi,rotate:()=>ni,rotateX:()=>si,rotateY:()=>ai,rotateZ:()=>oi,scale:()=>ii,set:()=>qr,str:()=>Li,sub:()=>Ui,subtract:()=>ur,targetTo:()=>Ti,translate:()=>ri,transpose:()=>Jr});function jr(){var t=new J(16);return J!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Yr(t){var e=new J(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Zr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Kr(t,e,r,i,n,s,a,o,c,l,h,f,m,p,E,R){var d=new J(16);return d[0]=t,d[1]=e,d[2]=r,d[3]=i,d[4]=n,d[5]=s,d[6]=a,d[7]=o,d[8]=c,d[9]=l,d[10]=h,d[11]=f,d[12]=m,d[13]=p,d[14]=E,d[15]=R,d}function qr(t,e,r,i,n,s,a,o,c,l,h,f,m,p,E,R,d){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=l,t[9]=h,t[10]=f,t[11]=m,t[12]=p,t[13]=E,t[14]=R,t[15]=d,t}function or(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Jr(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],s=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Qr(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],c=e[6],l=e[7],h=e[8],f=e[9],m=e[10],p=e[11],E=e[12],R=e[13],d=e[14],A=e[15],x=r*o-i*a,T=r*c-n*a,y=r*l-s*a,w=i*c-n*o,v=i*l-s*o,b=n*l-s*c,M=h*R-f*E,g=h*d-m*E,S=h*A-p*E,F=f*d-m*R,B=f*A-p*R,$=m*A-p*d,_=x*$-T*B+y*F+w*S-v*g+b*M;return _?(_=1/_,t[0]=(o*$-c*B+l*F)*_,t[1]=(n*B-i*$-s*F)*_,t[2]=(R*b-d*v+A*w)*_,t[3]=(m*v-f*b-p*w)*_,t[4]=(c*S-a*$-l*g)*_,t[5]=(r*$-n*S+s*g)*_,t[6]=(d*y-E*b-A*T)*_,t[7]=(h*b-m*y+p*T)*_,t[8]=(a*B-o*S+l*M)*_,t[9]=(i*S-r*B-s*M)*_,t[10]=(E*v-R*y+A*x)*_,t[11]=(f*y-h*v-p*x)*_,t[12]=(o*g-a*F-c*M)*_,t[13]=(r*F-i*g+n*M)*_,t[14]=(R*T-E*w-d*x)*_,t[15]=(h*w-f*T+m*x)*_,t):null}function ei(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],c=e[6],l=e[7],h=e[8],f=e[9],m=e[10],p=e[11],E=e[12],R=e[13],d=e[14],A=e[15];return t[0]=o*(m*A-p*d)-f*(c*A-l*d)+R*(c*p-l*m),t[1]=-(i*(m*A-p*d)-f*(n*A-s*d)+R*(n*p-s*m)),t[2]=i*(c*A-l*d)-o*(n*A-s*d)+R*(n*l-s*c),t[3]=-(i*(c*p-l*m)-o*(n*p-s*m)+f*(n*l-s*c)),t[4]=-(a*(m*A-p*d)-h*(c*A-l*d)+E*(c*p-l*m)),t[5]=r*(m*A-p*d)-h*(n*A-s*d)+E*(n*p-s*m),t[6]=-(r*(c*A-l*d)-a*(n*A-s*d)+E*(n*l-s*c)),t[7]=r*(c*p-l*m)-a*(n*p-s*m)+h*(n*l-s*c),t[8]=a*(f*A-p*R)-h*(o*A-l*R)+E*(o*p-l*f),t[9]=-(r*(f*A-p*R)-h*(i*A-s*R)+E*(i*p-s*f)),t[10]=r*(o*A-l*R)-a*(i*A-s*R)+E*(i*l-s*o),t[11]=-(r*(o*p-l*f)-a*(i*p-s*f)+h*(i*l-s*o)),t[12]=-(a*(f*d-m*R)-h*(o*d-c*R)+E*(o*m-c*f)),t[13]=r*(f*d-m*R)-h*(i*d-n*R)+E*(i*m-n*f),t[14]=-(r*(o*d-c*R)-a*(i*d-n*R)+E*(i*c-n*o)),t[15]=r*(o*m-c*f)-a*(i*m-n*f)+h*(i*c-n*o),t}function ti(t){var e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],o=t[6],c=t[7],l=t[8],h=t[9],f=t[10],m=t[11],p=t[12],E=t[13],R=t[14],d=t[15],A=e*a-r*s,x=e*o-i*s,T=e*c-n*s,y=r*o-i*a,w=r*c-n*a,v=i*c-n*o,b=l*E-h*p,M=l*R-f*p,g=l*d-m*p,S=h*R-f*E,F=h*d-m*E,B=f*d-m*R;return A*B-x*F+T*S+y*g-w*M+v*b}function cr(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],f=e[8],m=e[9],p=e[10],E=e[11],R=e[12],d=e[13],A=e[14],x=e[15],T=r[0],y=r[1],w=r[2],v=r[3];return t[0]=T*i+y*o+w*f+v*R,t[1]=T*n+y*c+w*m+v*d,t[2]=T*s+y*l+w*p+v*A,t[3]=T*a+y*h+w*E+v*x,T=r[4],y=r[5],w=r[6],v=r[7],t[4]=T*i+y*o+w*f+v*R,t[5]=T*n+y*c+w*m+v*d,t[6]=T*s+y*l+w*p+v*A,t[7]=T*a+y*h+w*E+v*x,T=r[8],y=r[9],w=r[10],v=r[11],t[8]=T*i+y*o+w*f+v*R,t[9]=T*n+y*c+w*m+v*d,t[10]=T*s+y*l+w*p+v*A,t[11]=T*a+y*h+w*E+v*x,T=r[12],y=r[13],w=r[14],v=r[15],t[12]=T*i+y*o+w*f+v*R,t[13]=T*n+y*c+w*m+v*d,t[14]=T*s+y*l+w*p+v*A,t[15]=T*a+y*h+w*E+v*x,t}function ri(t,e,r){var i=r[0],n=r[1],s=r[2],a,o,c,l,h,f,m,p,E,R,d,A;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15]):(a=e[0],o=e[1],c=e[2],l=e[3],h=e[4],f=e[5],m=e[6],p=e[7],E=e[8],R=e[9],d=e[10],A=e[11],t[0]=a,t[1]=o,t[2]=c,t[3]=l,t[4]=h,t[5]=f,t[6]=m,t[7]=p,t[8]=E,t[9]=R,t[10]=d,t[11]=A,t[12]=a*i+h*n+E*s+e[12],t[13]=o*i+f*n+R*s+e[13],t[14]=c*i+m*n+d*s+e[14],t[15]=l*i+p*n+A*s+e[15]),t}function ii(t,e,r){var i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ni(t,e,r,i){var n=i[0],s=i[1],a=i[2],o=Math.hypot(n,s,a),c,l,h,f,m,p,E,R,d,A,x,T,y,w,v,b,M,g,S,F,B,$,_,q;return o<V?null:(o=1/o,n*=o,s*=o,a*=o,c=Math.sin(r),l=Math.cos(r),h=1-l,f=e[0],m=e[1],p=e[2],E=e[3],R=e[4],d=e[5],A=e[6],x=e[7],T=e[8],y=e[9],w=e[10],v=e[11],b=n*n*h+l,M=s*n*h+a*c,g=a*n*h-s*c,S=n*s*h-a*c,F=s*s*h+l,B=a*s*h+n*c,$=n*a*h+s*c,_=s*a*h-n*c,q=a*a*h+l,t[0]=f*b+R*M+T*g,t[1]=m*b+d*M+y*g,t[2]=p*b+A*M+w*g,t[3]=E*b+x*M+v*g,t[4]=f*S+R*F+T*B,t[5]=m*S+d*F+y*B,t[6]=p*S+A*F+w*B,t[7]=E*S+x*F+v*B,t[8]=f*$+R*_+T*q,t[9]=m*$+d*_+y*q,t[10]=p*$+A*_+w*q,t[11]=E*$+x*_+v*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function si(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[4],a=e[5],o=e[6],c=e[7],l=e[8],h=e[9],f=e[10],m=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+l*i,t[5]=a*n+h*i,t[6]=o*n+f*i,t[7]=c*n+m*i,t[8]=l*n-s*i,t[9]=h*n-a*i,t[10]=f*n-o*i,t[11]=m*n-c*i,t}function ai(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],c=e[3],l=e[8],h=e[9],f=e[10],m=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-l*i,t[1]=a*n-h*i,t[2]=o*n-f*i,t[3]=c*n-m*i,t[8]=s*i+l*n,t[9]=a*i+h*n,t[10]=o*i+f*n,t[11]=c*i+m*n,t}function oi(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],c=e[3],l=e[4],h=e[5],f=e[6],m=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+l*i,t[1]=a*n+h*i,t[2]=o*n+f*i,t[3]=c*n+m*i,t[4]=l*n-s*i,t[5]=h*n-a*i,t[6]=f*n-o*i,t[7]=m*n-c*i,t}function ci(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function li(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hi(t,e,r){var i=r[0],n=r[1],s=r[2],a=Math.hypot(i,n,s),o,c,l;return a<V?null:(a=1/a,i*=a,n*=a,s*=a,o=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=i*i*l+c,t[1]=n*i*l+s*o,t[2]=s*i*l-n*o,t[3]=0,t[4]=i*n*l-s*o,t[5]=n*n*l+c,t[6]=s*n*l+i*o,t[7]=0,t[8]=i*s*l+n*o,t[9]=n*s*l-i*o,t[10]=s*s*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function fi(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pi(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ui(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lr(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3],o=i+i,c=n+n,l=s+s,h=i*o,f=i*c,m=i*l,p=n*c,E=n*l,R=s*l,d=a*o,A=a*c,x=a*l;return t[0]=1-(p+R),t[1]=f+x,t[2]=m-A,t[3]=0,t[4]=f-x,t[5]=1-(h+R),t[6]=E+d,t[7]=0,t[8]=m+A,t[9]=E-d,t[10]=1-(h+p),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function mi(t,e){var r=new J(3),i=-e[0],n=-e[1],s=-e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],f=i*i+n*n+s*s+a*a;return f>0?(r[0]=(o*a+h*i+c*s-l*n)*2/f,r[1]=(c*a+h*n+l*i-o*s)*2/f,r[2]=(l*a+h*s+o*n-c*i)*2/f):(r[0]=(o*a+h*i+c*s-l*n)*2,r[1]=(c*a+h*n+l*i-o*s)*2,r[2]=(l*a+h*s+o*n-c*i)*2),lr(t,e,r),t}function di(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function hr(t,e){var r=e[0],i=e[1],n=e[2],s=e[4],a=e[5],o=e[6],c=e[8],l=e[9],h=e[10];return t[0]=Math.hypot(r,i,n),t[1]=Math.hypot(s,a,o),t[2]=Math.hypot(c,l,h),t}function gi(t,e){var r=new J(3);hr(r,e);var i=1/r[0],n=1/r[1],s=1/r[2],a=e[0]*i,o=e[1]*n,c=e[2]*s,l=e[4]*i,h=e[5]*n,f=e[6]*s,m=e[8]*i,p=e[9]*n,E=e[10]*s,R=a+h+E,d=0;return R>0?(d=Math.sqrt(R+1)*2,t[3]=.25*d,t[0]=(f-p)/d,t[1]=(m-c)/d,t[2]=(o-l)/d):a>h&&a>E?(d=Math.sqrt(1+a-h-E)*2,t[3]=(f-p)/d,t[0]=.25*d,t[1]=(o+l)/d,t[2]=(m+c)/d):h>E?(d=Math.sqrt(1+h-a-E)*2,t[3]=(m-c)/d,t[0]=(o+l)/d,t[1]=.25*d,t[2]=(f+p)/d):(d=Math.sqrt(1+E-a-h)*2,t[3]=(o-l)/d,t[0]=(m+c)/d,t[1]=(f+p)/d,t[2]=.25*d),t}function vi(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=e[3],c=n+n,l=s+s,h=a+a,f=n*c,m=n*l,p=n*h,E=s*l,R=s*h,d=a*h,A=o*c,x=o*l,T=o*h,y=i[0],w=i[1],v=i[2];return t[0]=(1-(E+d))*y,t[1]=(m+T)*y,t[2]=(p-x)*y,t[3]=0,t[4]=(m-T)*w,t[5]=(1-(f+d))*w,t[6]=(R+A)*w,t[7]=0,t[8]=(p+x)*v,t[9]=(R-A)*v,t[10]=(1-(f+E))*v,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function bi(t,e,r,i,n){var s=e[0],a=e[1],o=e[2],c=e[3],l=s+s,h=a+a,f=o+o,m=s*l,p=s*h,E=s*f,R=a*h,d=a*f,A=o*f,x=c*l,T=c*h,y=c*f,w=i[0],v=i[1],b=i[2],M=n[0],g=n[1],S=n[2],F=(1-(R+A))*w,B=(p+y)*w,$=(E-T)*w,_=(p-y)*v,q=(1-(m+A))*v,Te=(d+x)*v,Le=(E+T)*b,tt=(d-x)*b,rt=(1-(m+R))*b;return t[0]=F,t[1]=B,t[2]=$,t[3]=0,t[4]=_,t[5]=q,t[6]=Te,t[7]=0,t[8]=Le,t[9]=tt,t[10]=rt,t[11]=0,t[12]=r[0]+M-(F*M+_*g+Le*S),t[13]=r[1]+g-(B*M+q*g+tt*S),t[14]=r[2]+S-($*M+Te*g+rt*S),t[15]=1,t}function xi(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,o=i+i,c=n+n,l=r*a,h=i*a,f=i*o,m=n*a,p=n*o,E=n*c,R=s*a,d=s*o,A=s*c;return t[0]=1-f-E,t[1]=h+A,t[2]=m-d,t[3]=0,t[4]=h-A,t[5]=1-l-E,t[6]=p+R,t[7]=0,t[8]=m+d,t[9]=p-R,t[10]=1-l-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yi(t,e,r,i,n,s,a){var o=1/(r-e),c=1/(n-i),l=1/(s-a);return t[0]=s*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(n+i)*c,t[10]=(a+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*l,t[15]=0,t}function fr(t,e,r,i,n){var s=1/Math.tan(e/2),a;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(a=1/(i-n),t[10]=(n+i)*a,t[14]=2*n*i*a):(t[10]=-1,t[14]=-2*i),t}var Ei=fr;function wi(t,e,r,i,n){var s=1/Math.tan(e/2),a;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(a=1/(i-n),t[10]=n*a,t[14]=n*i*a):(t[10]=-1,t[14]=-i),t}function Ri(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),l=2/(n+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((a-o)*c*.5),t[9]=(n-s)*l*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function pr(t,e,r,i,n,s,a){var o=1/(e-r),c=1/(i-n),l=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*c,t[14]=(a+s)*l,t[15]=1,t}var Mi=pr;function Ai(t,e,r,i,n,s,a){var o=1/(e-r),c=1/(i-n),l=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*c,t[14]=s*l,t[15]=1,t}function Si(t,e,r,i){var n,s,a,o,c,l,h,f,m,p,E=e[0],R=e[1],d=e[2],A=i[0],x=i[1],T=i[2],y=r[0],w=r[1],v=r[2];return Math.abs(E-y)<V&&Math.abs(R-w)<V&&Math.abs(d-v)<V?or(t):(h=E-y,f=R-w,m=d-v,p=1/Math.hypot(h,f,m),h*=p,f*=p,m*=p,n=x*m-T*f,s=T*h-A*m,a=A*f-x*h,p=Math.hypot(n,s,a),p?(p=1/p,n*=p,s*=p,a*=p):(n=0,s=0,a=0),o=f*a-m*s,c=m*n-h*a,l=h*s-f*n,p=Math.hypot(o,c,l),p?(p=1/p,o*=p,c*=p,l*=p):(o=0,c=0,l=0),t[0]=n,t[1]=o,t[2]=h,t[3]=0,t[4]=s,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=l,t[10]=m,t[11]=0,t[12]=-(n*E+s*R+a*d),t[13]=-(o*E+c*R+l*d),t[14]=-(h*E+f*R+m*d),t[15]=1,t)}function Ti(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=i[0],c=i[1],l=i[2],h=n-r[0],f=s-r[1],m=a-r[2],p=h*h+f*f+m*m;p>0&&(p=1/Math.sqrt(p),h*=p,f*=p,m*=p);var E=c*m-l*f,R=l*h-o*m,d=o*f-c*h;return p=E*E+R*R+d*d,p>0&&(p=1/Math.sqrt(p),E*=p,R*=p,d*=p),t[0]=E,t[1]=R,t[2]=d,t[3]=0,t[4]=f*d-m*R,t[5]=m*E-h*d,t[6]=h*R-f*E,t[7]=0,t[8]=h,t[9]=f,t[10]=m,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t}function Li(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ci(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Di(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function ur(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Ii(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Fi(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function Pi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Gi(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8],f=t[9],m=t[10],p=t[11],E=t[12],R=t[13],d=t[14],A=t[15],x=e[0],T=e[1],y=e[2],w=e[3],v=e[4],b=e[5],M=e[6],g=e[7],S=e[8],F=e[9],B=e[10],$=e[11],_=e[12],q=e[13],Te=e[14],Le=e[15];return Math.abs(r-x)<=V*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-T)<=V*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(n-y)<=V*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-w)<=V*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-v)<=V*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-b)<=V*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(c-M)<=V*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(l-g)<=V*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(h-S)<=V*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(f-F)<=V*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(m-B)<=V*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(p-$)<=V*Math.max(1,Math.abs(p),Math.abs($))&&Math.abs(E-_)<=V*Math.max(1,Math.abs(E),Math.abs(_))&&Math.abs(R-q)<=V*Math.max(1,Math.abs(R),Math.abs(q))&&Math.abs(d-Te)<=V*Math.max(1,Math.abs(d),Math.abs(Te))&&Math.abs(A-Le)<=V*Math.max(1,Math.abs(A),Math.abs(Le))}var Ni=cr,Ui=ur;var O={};It(O,{add:()=>Vi,angle:()=>hn,bezier:()=>tn,ceil:()=>zi,clone:()=>Oi,copy:()=>ki,create:()=>mr,cross:()=>Ji,dist:()=>bn,distance:()=>xr,div:()=>vn,divide:()=>br,dot:()=>wr,equals:()=>mn,exactEquals:()=>un,floor:()=>$i,forEach:()=>wn,fromValues:()=>_i,hermite:()=>en,inverse:()=>Ki,len:()=>yn,length:()=>dr,lerp:()=>Qi,max:()=>Hi,min:()=>Wi,mul:()=>gn,multiply:()=>vr,negate:()=>Zi,normalize:()=>qi,random:()=>rn,rotateX:()=>on,rotateY:()=>cn,rotateZ:()=>ln,round:()=>Xi,scale:()=>ji,scaleAndAdd:()=>Yi,set:()=>Bi,sqrDist:()=>xn,sqrLen:()=>En,squaredDistance:()=>yr,squaredLength:()=>Er,str:()=>pn,sub:()=>dn,subtract:()=>gr,transformMat3:()=>sn,transformMat4:()=>nn,transformQuat:()=>an,zero:()=>fn});function mr(){var t=new J(3);return J!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Oi(t){var e=new J(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function dr(t){var e=t[0],r=t[1],i=t[2];return Math.hypot(e,r,i)}function _i(t,e,r){var i=new J(3);return i[0]=t,i[1]=e,i[2]=r,i}function ki(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Bi(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function Vi(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function gr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function vr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function br(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function zi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function $i(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Wi(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Hi(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Xi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ji(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Yi(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function xr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.hypot(r,i,n)}function yr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function Er(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Zi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Ki(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function qi(t,e){var r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function wr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ji(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],c=r[2];return t[0]=n*c-s*o,t[1]=s*a-i*c,t[2]=i*o-n*a,t}function Qi(t,e,r,i){var n=e[0],s=e[1],a=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t}function en(t,e,r,i,n,s){var a=s*s,o=a*(2*s-3)+1,c=a*(s-2)+s,l=a*(s-1),h=a*(3-2*s);return t[0]=e[0]*o+r[0]*c+i[0]*l+n[0]*h,t[1]=e[1]*o+r[1]*c+i[1]*l+n[1]*h,t[2]=e[2]*o+r[2]*c+i[2]*l+n[2]*h,t}function tn(t,e,r,i,n,s){var a=1-s,o=a*a,c=s*s,l=o*a,h=3*s*o,f=3*c*a,m=c*s;return t[0]=e[0]*l+r[0]*h+i[0]*f+n[0]*m,t[1]=e[1]*l+r[1]*h+i[1]*f+n[1]*m,t[2]=e[2]*l+r[2]*h+i[2]*f+n[2]*m,t}function rn(t,e){e=e||1;var r=we()*2*Math.PI,i=we()*2-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function nn(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,t}function sn(t,e,r){var i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function an(t,e,r){var i=r[0],n=r[1],s=r[2],a=r[3],o=e[0],c=e[1],l=e[2],h=n*l-s*c,f=s*o-i*l,m=i*c-n*o,p=n*m-s*f,E=s*h-i*m,R=i*f-n*h,d=a*2;return h*=d,f*=d,m*=d,p*=2,E*=2,R*=2,t[0]=o+h+p,t[1]=c+f+E,t[2]=l+m+R,t}function on(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function cn(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function ln(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function hn(t,e){var r=t[0],i=t[1],n=t[2],s=e[0],a=e[1],o=e[2],c=Math.sqrt(r*r+i*i+n*n),l=Math.sqrt(s*s+a*a+o*o),h=c*l,f=h&&wr(t,e)/h;return Math.acos(Math.min(Math.max(f,-1),1))}function fn(t){return t[0]=0,t[1]=0,t[2]=0,t}function pn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function un(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function mn(t,e){var r=t[0],i=t[1],n=t[2],s=e[0],a=e[1],o=e[2];return Math.abs(r-s)<=V*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=V*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=V*Math.max(1,Math.abs(n),Math.abs(o))}var dn=gr,gn=vr,vn=br,bn=xr,xn=yr,yn=dr,En=Er,wn=function(){var t=mr();return function(e,r,i,n,s,a){var o,c;for(r||(r=3),i||(i=0),n?c=Math.min(n*r+i,e.length):c=e.length,o=i;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}();var z={};It(z,{add:()=>Tn,ceil:()=>Ln,clone:()=>Rn,copy:()=>An,create:()=>Rr,cross:()=>kn,dist:()=>qn,distance:()=>Tr,div:()=>Kn,divide:()=>Sr,dot:()=>_n,equals:()=>jn,exactEquals:()=>Xn,floor:()=>Cn,forEach:()=>ts,fromValues:()=>Mn,inverse:()=>Un,len:()=>Qn,length:()=>Cr,lerp:()=>Bn,max:()=>In,min:()=>Dn,mul:()=>Zn,multiply:()=>Ar,negate:()=>Nn,normalize:()=>On,random:()=>Vn,round:()=>Fn,scale:()=>Pn,scaleAndAdd:()=>Gn,set:()=>Sn,sqrDist:()=>Jn,sqrLen:()=>es,squaredDistance:()=>Lr,squaredLength:()=>Dr,str:()=>Hn,sub:()=>Yn,subtract:()=>Mr,transformMat4:()=>zn,transformQuat:()=>$n,zero:()=>Wn});function Rr(){var t=new J(4);return J!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Rn(t){var e=new J(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Mn(t,e,r,i){var n=new J(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function An(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Sn(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function Tn(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Mr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Ar(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Sr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Ln(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Cn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Dn(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function In(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Fn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Pn(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Gn(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function Tr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.hypot(r,i,n,s)}function Lr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function Cr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.hypot(e,r,i,n)}function Dr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Nn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Un(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function On(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=s*a,t}function _n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function kn(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],c=r[1]*i[3]-r[3]*i[1],l=r[2]*i[3]-r[3]*i[2],h=e[0],f=e[1],m=e[2],p=e[3];return t[0]=f*l-m*c+p*o,t[1]=-(h*l)+m*a-p*s,t[2]=h*c-f*a+p*n,t[3]=-(h*o)+f*s-m*n,t}function Bn(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t[3]=o+i*(r[3]-o),t}function Vn(t,e){e=e||1;var r,i,n,s,a,o;do r=we()*2-1,i=we()*2-1,a=r*r+i*i;while(a>=1);do n=we()*2-1,s=we()*2-1,o=n*n+s*s;while(o>=1);var c=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*i,t[2]=e*n*c,t[3]=e*s*c,t}function zn(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,t}function $n(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],c=r[2],l=r[3],h=l*i+o*s-c*n,f=l*n+c*i-a*s,m=l*s+a*n-o*i,p=-a*i-o*n-c*s;return t[0]=h*l+p*-a+f*-c-m*-o,t[1]=f*l+p*-o+m*-a-h*-c,t[2]=m*l+p*-c+h*-o-f*-a,t[3]=e[3],t}function Wn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Hn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Xn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function jn(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],a=e[0],o=e[1],c=e[2],l=e[3];return Math.abs(r-a)<=V*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=V*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-c)<=V*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-l)<=V*Math.max(1,Math.abs(s),Math.abs(l))}var Yn=Mr,Zn=Ar,Kn=Sr,qn=Tr,Jn=Lr,Qn=Cr,es=Dr,ts=function(){var t=Rr();return function(e,r,i,n,s,a){var o,c;for(r||(r=4),i||(i=0),n?c=Math.min(n*r+i,e.length):c=e.length,o=i;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}();var Q=class t{constructor(e,r=void 0,i=void 0){u(this,"x");u(this,"y");u(this,"z");this.x=e,r===void 0?this.y=e:this.y=r,i===void 0?this.z=e:this.z=i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}add(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)}subtract(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)}multiply(e){return new t(this.x*e,this.y*e,this.z*e)}divide(e){if(e===0)throw new Error("Cannot divide by zero.");return new t(this.x/e,this.y/e,this.z/e)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let e=this.length;return new t(this.x/e,this.y/e,this.z/e)}clone(){return new t(this.x,this.y,this.z)}toArray(){return[this.x,this.y,this.z]}toMatrixVec3(){return O.fromValues(this.x,this.y,this.z)}static distance(e,r){return Math.sqrt(Ce(e.x-r.x,2)+Ce(e.y-r.y,2)+Ce(e.z-r.z,2))}static random(e){return new t(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize().multiply(e)}static get zero(){return new t(0,0,0)}static get up(){return new t(0,1,0)}static get down(){return new t(0,-1,0)}static get left(){return new t(-1,0,0)}static get right(){return new t(1,0,0)}static get forward(){return new t(0,0,1)}static get back(){return new t(0,0,-1)}toString(){return"{ ".concat(this.x,", ").concat(this.y,", ").concat(this.z," }")}};var Ne=class{constructor(e,r,i=null){this.localPosition=e;this.voxels=r;this.mesh=i}get globalPosition(){return O.fromValues(this.localPosition.x*X,0,this.localPosition.y*X)}get globalCenterPosition(){return O.fromValues(this.localPosition.x*X+X/2,0,this.localPosition.y*X+X/2)}getVoxelAt(e,r,i){return this.voxels.get(e,r,i)}getVoxelAtGlobalPosition(e,r,i){if(e instanceof Q)return this.getVoxelAtGlobalPosition(e.x,e.y,e.z);if(r===void 0||i===void 0)throw new Error("Invalid arguments");let n=this.globalPosition,s=e-n[0],a=i-n[2];return this.voxels.get(s,r,a)}render(e,r,i){var n;(n=this.mesh)==null||n.render(e,this.globalPosition,r,i)}};var $e=class{static load(e){return U(this,null,function*(){try{if(this.cache.has(e))return D.debug("FileUtils","Loading file from cache: ".concat(e)),this.cache.get(e);D.debug("FileUtils","Loading file: ".concat(e));let r=yield fetch("".concat(window.location.href).concat(e));if(!r.ok)throw new Error("Failed to load file: ".concat(e));let i=yield r.text();return this.cache.set(e,i),i}catch(r){throw D.error("FileUtils","Failed to load file: ".concat(e),r),r}})}};u($e,"cache",new Map);var Re=class Re{constructor(e,r){this.gl=e;this.name=r;u(this,"program",null);u(this,"buffers",{});u(this,"attributes",{});u(this,"uniforms",{})}preprocessShader(e){let r=e.indexOf("#version");return r=e.indexOf("\n",r)+1,Re.SPLIT&&(e=e.insertAt(r,"\n#define SPLIT\n")),e}loadShader(e,r){return U(this,null,function*(){if(D.info("Shader-".concat(this.name),"Loading shader: ".concat(r,"...")),Re.cache.has(r))return D.debug("Shader-".concat(this.name),"Shader cached!"),Re.cache.get(r);let i=this.preprocessShader(yield $e.load("shaders/".concat(r,".glsl"))),n=this.gl.createShader(e);if(!n)throw new Error("Could not create shader");if(D.debug("Shader-".concat(this.name),"Compiling shader: ".concat(r,"...")),this.gl.shaderSource(n,i),this.gl.compileShader(n),!this.gl.getShaderParameter(n,GL.COMPILE_STATUS)){let s=this.gl.getShaderInfoLog(n);throw this.gl.deleteShader(n),new Error("Could not compile '".concat(r,"' for shader '").concat(this.name,"': ").concat(s))}return Re.cache.set(r,n),n})}setup(e){return U(this,null,function*(){yield this.setupProgram(e.source.vertex,e.source.fragment),this.setupAttributes(e),this.setupUniforms(e.uniforms),this.setupBuffers(e.buffers)})}setupProgram(e,r){return U(this,null,function*(){D.info("Shader-".concat(this.name),"Loading shader...");let i=yield this.loadShader(GL.VERTEX_SHADER,e),n=yield this.loadShader(GL.FRAGMENT_SHADER,r);D.debug("Shader-".concat(this.name),"Linking shader program...");let s=this.gl.createProgram();if(!s)throw new Error("Could not create shader program for shader '".concat(this.name,"'"));if(this.gl.attachShader(s,i),this.gl.attachShader(s,n),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,GL.LINK_STATUS)){let a=this.gl.getProgramInfoLog(s);throw this.gl.deleteProgram(s),new Error("Could not link shader program for shader '".concat(this.name,"': ").concat(a))}this.program=s})}setupAttributes(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let r=[];e.attributes&&r.push(...e.attributes),Object.values(e.buffers).map(i=>typeof i=="object"?i.attribute:null).filter(i=>i).forEach(i=>r.push(i)),this.attributes={};for(let i of r){if(this.attributes.hasOwnProperty(i))continue;let n=this.gl.getAttribLocation(this.program,i);if(n===-1)throw new Error("Could not find attribute '".concat(i,"' on shader '").concat(this.name,"'"));this.attributes[i]=n}}setupUniforms(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let r=this.gl.getProgramParameter(this.program,GL.ACTIVE_UNIFORMS);if(!r)throw new Error("Could not get active uniforms for shader '".concat(this.name,"'"));this.uniforms={};for(let i=0;i<r;i++){let n=this.gl.getActiveUniform(this.program,i);if(!n)throw new Error("Could not get active uniform '".concat(i,"' on shader '").concat(this.name,"'"));let s=this.gl.getUniformLocation(this.program,n.name);if(!s)throw new Error("Could not get location of uniform '".concat(n.name,"' on shader '").concat(this.name,"'"));if(!e.includes(n.name))throw Error("Uniform '".concat(n.name,"' is not being used on shader '").concat(this.name,"'"));this.uniforms[n.name]={location:s,type:n.type}}for(let i of e)if(!this.uniforms.hasOwnProperty(i))throw new Error("Could not find uniform '".concat(i,"' on shader '").concat(this.name,"'"))}setupBuffers(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));this.buffers={};for(let r in e){if(!e.hasOwnProperty(r))continue;let i=e[r],n=this.gl.createBuffer();if(!n)throw new Error("Could not create buffer");let s=GL.ARRAY_BUFFER,a=GL.STATIC_DRAW,o=null,c=r,l=null;if(typeof i=="object"){let h=i;h.attribute&&(c=h.attribute),h.target&&(s=h.target),h.usage&&(a=h.usage),h.data&&(i=h.data)}if(i instanceof Float32Array||i instanceof Uint16Array||i instanceof Uint8Array||i instanceof Int16Array||i instanceof Int8Array||i instanceof Uint32Array||i instanceof Int32Array?l=i:typeof i=="function"&&(o=i),this.gl.bindBuffer(s,n),l&&(o||(o=l.constructor),this.gl.bufferData(s,l,a)),!o)throw new Error("Could not determine buffer data type for buffer '".concat(r,"' on shader '").concat(this.name,"'"));this.buffers[r]={buffer:n,type:o,attribute:c,target:s,usage:a}}}bindBuffer(e,r=null){let i=this.buffers[e];if(!i)throw new Error("Could not find buffer '".concat(e,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(i.target,i.buffer),r&&this.gl.bufferData(i.target,r,i.usage)}setUniform(e,r){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let i=this.uniforms[e];if(!i)throw new Error("Could not find uniform '".concat(e,"' on shader '").concat(this.name,"'"));switch(i.type){case GL.FLOAT:this.gl.uniform1f(i.location,r);break;case GL.FLOAT_VEC2:this.gl.uniform2fv(i.location,r);break;case GL.FLOAT_VEC3:this.gl.uniform3fv(i.location,r);break;case GL.FLOAT_VEC4:this.gl.uniform4fv(i.location,r);break;case GL.FLOAT_MAT4:this.gl.uniformMatrix4fv(i.location,!1,r);break;case GL.SAMPLER_2D:this.gl.uniform1i(i.location,r);break;default:throw new Error("Uniform type '".concat(i.type,"' not supported"))}}extractAttributeInfo(e,r){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let i=this.gl.getActiveAttrib(this.program,r);if(!i)throw new Error("Could not get attribute info for '".concat(e,"' on shader '").concat(this.name,"'"));let n={[GL.FLOAT]:1,[GL.FLOAT_VEC2]:2,[GL.FLOAT_VEC3]:3,[GL.FLOAT_VEC4]:4}[i.type];return{type:{[GL.FLOAT]:GL.FLOAT,[GL.FLOAT_VEC2]:GL.FLOAT,[GL.FLOAT_VEC3]:GL.FLOAT,[GL.FLOAT_VEC4]:GL.FLOAT}[i.type],size:n}}bind(){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));for(let e in this.attributes){if(!this.attributes.hasOwnProperty(e))continue;let r=this.attributes[e],i=Object.values(this.buffers).find(a=>a.attribute===e);if(!i)throw new Error("Could not find buffer '".concat(e,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(i.target,i.buffer);let{type:n,size:s}=this.extractAttributeInfo(e,r);this.gl.vertexAttribPointer(r,s,n,!1,0,0),this.gl.enableVertexAttribArray(r)}this.gl.useProgram(this.program)}};u(Re,"SPLIT",!1),u(Re,"cache",new Map);var fe=Re;var Ue=class{static applyPadding(e){let r=e.height/L.TEXTURE_ATLAS_SIZE,i=e.width/L.TEXTURE_ATLAS_SIZE,n=L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING*2,s=L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING*2,a=document.createElement("canvas");a.width=n*i,a.height=s*r;let o=a.getContext("2d");if(!o)throw new Error("Could not get 2D context");o.imageSmoothingEnabled=!1;for(let c=0;c<r;c++)for(let l=0;l<i;l++){let h=l*L.TEXTURE_ATLAS_SPRITE_SIZE,f=c*L.TEXTURE_ATLAS_SPRITE_SIZE;o.drawImage(e,h,f,L.TEXTURE_ATLAS_SPRITE_SIZE,1,l*n,c*s,L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING*2,L.TEXTURE_PADDING),o.drawImage(e,h,f+L.TEXTURE_ATLAS_SPRITE_SIZE-1,L.TEXTURE_ATLAS_SPRITE_SIZE,1,l*n,c*s+L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING,L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING*2,L.TEXTURE_PADDING),o.drawImage(e,h,f,1,L.TEXTURE_ATLAS_SPRITE_SIZE,l*n,c*s,L.TEXTURE_PADDING,L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING*2),o.drawImage(e,h+L.TEXTURE_ATLAS_SPRITE_SIZE-1,f,1,L.TEXTURE_ATLAS_SPRITE_SIZE,l*n+L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING,c*s,L.TEXTURE_PADDING,L.TEXTURE_ATLAS_SPRITE_SIZE+L.TEXTURE_PADDING*2),o.drawImage(e,h,f,L.TEXTURE_ATLAS_SPRITE_SIZE,L.TEXTURE_ATLAS_SPRITE_SIZE,l*n+L.TEXTURE_PADDING,c*s+L.TEXTURE_PADDING,L.TEXTURE_ATLAS_SPRITE_SIZE,L.TEXTURE_ATLAS_SPRITE_SIZE)}return a}static load(e,r=null){return new Promise((i,n)=>{if(this.cache.has(e)){let a=this.cache.get(e);if(a===void 0)throw new Error("Unexpected undefined value in cache");return i(a)}let s=new Image;s.src="".concat(window.location.href,"assets/images/").concat(e,".png"),s.crossOrigin="anonymous",s.style.display="none",s.id="image-".concat(e),r&&(s.width=r.width,s.height=r.height),s.onerror=a=>{D.error("ImageUtils","Failed to load image: ".concat(e),a.toString()),n(a)},s.onload=()=>{this.cache.set(e,s),i(s)}})}static get(e){if(!this.cache.has(e))return null;let r=this.cache.get(e);if(r===void 0)throw new Error("Unexpected undefined value in cache");return r}};u(Ue,"cache",new Map);var Ie=class Ie{constructor(e){this.gl=e;u(this,"texture",null)}static loadTerrain(e){return U(this,null,function*(){Ie.terrain||(Ie.terrain=new Ie(e),yield Ie.terrain.load("terrain",!0,!0))})}load(e,r=!0,i=!1){return U(this,null,function*(){let n=yield Ue.load(e);i&&(n=Ue.applyPadding(n));let s=this.gl.createTexture();if(!s)throw new Error("Could not create texture for '".concat(e,"'"));this.texture=s,this.gl.bindTexture(GL.TEXTURE_2D,s),this.gl.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,GL.RGBA,GL.UNSIGNED_BYTE,n),r?(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.NEAREST),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.NEAREST)):(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR)),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE),this.gl.enableAnisotropicFiltering()})}bind(){this.gl.activeTexture(GL.TEXTURE0),this.gl.bindTexture(GL.TEXTURE_2D,this.texture)}};u(Ie,"terrain");var Me=Ie;var ot=class ot{constructor(e,r,i,n){this.vertices=e;this.uvs=r;this.normals=i;this.indices=n}get vertexCount(){return this.vertices.length/3}get triangleCount(){return this.indices.length/3}get shader(){return ot.shader}render(e,r,i,n){this.shader.bind(),Me.terrain.bind();let s=P.create();P.translate(s,s,r),P.multiply(s,n,s),this.shader.setUniform("u_modelView",s),this.shader.setUniform("u_projection",i),this.shader.setUniform("u_texture",0),this.shader.bindBuffer("vertex",this.vertices),this.shader.bindBuffer("uv",this.uvs),this.shader.bindBuffer("index",this.indices),this.shader.bindBuffer("normal",this.normals),e.drawElements(GL.TRIANGLES,this.indices.length,GL.UNSIGNED_SHORT,0)}static setup(e){return U(this,null,function*(){this.shader=new fe(e,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:Float32Array,attribute:"a_position"},uv:{data:Float32Array,attribute:"a_texcoord"},normal:{data:Float32Array,attribute:"a_normal"},index:{data:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}};u(ot,"shader");var Ae=ot;var Se=class t{constructor(e){u(this,"data");e?this.data=e:this.data=new Uint8Array(this.width*this.height*this.depth)}get width(){return X}get depth(){return X}get height(){return De}get(e,r,i){return e instanceof Q?this.get(e.x,e.y,e.z):e<0||e>=this.width||r<0||r>=this.height||i<0||i>=this.depth?null:this.data[e+r*this.width+i*this.width*this.height]}set(e,r,i,n){if(e instanceof Q)return this.set(e.x,e.y,e.z,r);if(e<0||e>=this.width||r<0||r>=this.height||i<0||i>=this.depth)return null;this.data[e+r*this.width+i*this.width*this.height]=n}static pack(e){return e.data}static unpack(e){return new t(e)}};var ct=class extends st{constructor(){super("terrain")}generateChunkTerrain(e,r){this.postMessage({type:"terrain",data:{x:e,z:r}})}generateChunkMesh(e,r,i,n,s=0){let a=Se.pack(i.voxels),o=n.map(c=>c?{voxels:Se.pack(c.voxels),x:c.localPosition.x,z:c.localPosition.y}:null);this.postMessage({type:"mesh",data:{chunk:{x:e,z:r,voxels:a},neighbors:o,depth:s}})}generateBatch(e){for(let r of e)this.generateChunkTerrain(r.x,r.y)}onMessageReceived(e){switch(e.type){case"terrain":{let r=e.data,i=new Ne(new N(r.x,r.z),Se.unpack(r.voxels),null);ne.loadChunkTerrain(i);break}case"mesh":{let r=e.data;Object.setPrototypeOf(r.mesh,Ae.prototype),ne.loadChunkMesh(r.x,r.z,r.mesh,r.depth);break}default:D.error("TerrainGeneratorBinding","Unknown message type",e.type);break}}};var Fe=(a=>(a[a.Up=0]="Up",a[a.Down=1]="Down",a[a.West=2]="West",a[a.East=3]="East",a[a.North=4]="North",a[a.South=5]="South",a))(Fe||{});(e=>{function t(r){switch(r){case 0:return Q.up;case 1:return Q.down;case 2:return Q.left;case 3:return Q.right;case 4:return Q.forward;case 5:return Q.back}}e.toVector=t})(Fe||(Fe={}));function Pe(t,e){return(e+1)*16+t}var ce=(o=>(o[o.Dirt=Pe(2,0)]="Dirt",o[o.Grass=Pe(0,0)]="Grass",o[o.GrassSide=Pe(3,0)]="GrassSide",o[o.DiamondOre=Pe(2,3)]="DiamondOre",o[o.Stone=Pe(1,0)]="Stone",o[o.Sand=Pe(2,1)]="Sand",o[o.Snow=Pe(2,4)]="Snow",o))(ce||{});(e=>{function t(r){let i=L.TEXTURE_ATLAS_SIZE,n=L.TEXTURE_ATLAS_SPRITE_SIZE,s=L.TEXTURE_PADDING,a=Math.floor(r/i),o=r%i,c=0,l=0;s>0&&(c=s/(i*n),l=s/(i*n));let h=o/i+c,f=(i-a)/i+l,m=(o+1)/i-c,p=(i-a+1)/i-l;return[h,f,m,f,m,p,h,p].map(E=>Math.clamp(E,0,1))}e.toUV=t})(ce||(ce={}));var Ge=(a=>(a[a.Air=0]="Air",a[a.Dirt=1]="Dirt",a[a.Grass=2]="Grass",a[a.Sand=3]="Sand",a[a.Stone=4]="Stone",a[a.Snow=5]="Snow",a))(Ge||{});(e=>{function t(r,i){let n;switch(r){case 1:n=ce.Dirt;break;case 2:switch(i){case 0:n=ce.Grass;break;case 1:n=ce.Dirt;break;default:n=ce.GrassSide;break}break;case 3:n=ce.Sand;break;case 4:n=ce.Stone;break;case 5:n=ce.Snow;break}return ce.toUV(n)}e.toUV=t})(Ge||(Ge={}));var rs=.5*(Math.sqrt(3)-1),We=(3-Math.sqrt(3))/6,Sa=1/3,Ta=1/6,La=(Math.sqrt(5)-1)/4,Ca=(5-Math.sqrt(5))/20,Ir=t=>Math.floor(t)|0,Fr=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Pr(t=Math.random){let e=is(t),r=new Float64Array(e).map(n=>Fr[n%12*2]),i=new Float64Array(e).map(n=>Fr[n%12*2+1]);return function(s,a){let o=0,c=0,l=0,h=(s+a)*rs,f=Ir(s+h),m=Ir(a+h),p=(f+m)*We,E=f-p,R=m-p,d=s-E,A=a-R,x,T;d>A?(x=1,T=0):(x=0,T=1);let y=d-x+We,w=A-T+We,v=d-1+2*We,b=A-1+2*We,M=f&255,g=m&255,S=.5-d*d-A*A;if(S>=0){let $=M+e[g],_=r[$],q=i[$];S*=S,o=S*S*(_*d+q*A)}let F=.5-y*y-w*w;if(F>=0){let $=M+x+e[g+T],_=r[$],q=i[$];F*=F,c=F*F*(_*y+q*w)}let B=.5-v*v-b*b;if(B>=0){let $=M+1+e[g+1],_=r[$],q=i[$];B*=B,l=B*B*(_*v+q*b)}return 70*(o+c+l)}}function is(t){let r=new Uint8Array(512);for(let i=0;i<512/2;i++)r[i]=i;for(let i=0;i<512/2-1;i++){let n=i+~~(t()*(256-i)),s=r[i];r[i]=r[n],r[n]=s}for(let i=256;i<512;i++)r[i]=r[i-256];return r}var Ur=Ft(Nr());var be=class{constructor(e,r,i,n,s){this.scale=i;this.min=n;this.max=s;u(this,"generators");this.generators=[];for(let a=0;a<r;a++)this.generators.push(Pr((0,Ur.default)(L.TERRAIN_GENERATION_SEED+e+a)))}get(e,r){let i=0,n=1,s=1,a=0;for(let o of this.generators)i+=o(e/this.scale*s,r/this.scale*s)*n,a+=n,n/=2,s*=2;return i=(i/a+1)/2,i*(this.max-this.min)+this.min}};var lt;(c=>{let t={0:new be("altitude-plains",4,100,0,1),1:new be("altitude-desert",4,100,0,1),3:new be("altitude-mountains",4,100,0,1),2:new be("altitude-snow",4,100,0,1)},e=new be("moisture",1,500,0,100),r=new be("temperature",1,1e3,20,50);function i(l,h){let f=e.get(l,h),m=r.get(l,h);return m<25?2:f>80&&m>25?3:m>30&&f<40?1:0}function n(l,h,f){let m=t[f].get(l,h),p=0,E=0;switch(f){case 1:p=4,E=7;break;case 3:p=4,E=32;break;case 2:p=4,E=15;break;case 0:p=4,E=12;break;default:throw new Error("Unknown biome: ".concat(f))}return m*(E-p)+p}function s(l,h,f,m,p){let E=n(l,h,f),R=n(l,h,m);return p=Math.max(0,Math.min(1,p)),p=Math.floor(p*10)/10,E*p+R*(1-p)}function a(l,h,f,m,p){if(h===0||h<3&&Math.random()<=.9)return 4;if(h>m)return 0;switch(p){case 0:return h>=m-1?2:1;case 1:return 3;case 3:return h>m*.9?5:h<m/2?4:1;case 2:return 5}}function o(l){let h=new Se;for(let f=0;f<X;f++)for(let m=0;m<X;m++){let p=f+Math.ceil(l.x*X),E=m+Math.ceil(l.y*X),R=i(p,E),d=n(p,E,R);for(let A=0;A<=d;A++){let x=a(f,A,m,d,R);h.set(f,A,m,x)}}return new Ne(l,h)}c.generateChunkVoxels=o})(lt||(lt={}));var ht=class{constructor(e,r,i,n,s,a){this.gl=e;this.position=r;this.vertices=i;this.uvs=n;this.normals=s;this.indices=a;u(this,"shader")}setup(){return U(this,null,function*(){this.shader=new fe(this.gl,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:this.vertices,attribute:"a_position"},uv:{data:this.uvs,attribute:"a_texcoord"},normal:{data:this.normals,attribute:"a_normal"},index:{data:this.indices,target:GL.ELEMENT_ARRAY_BUFFER}}})})}render(e,r){this.shader.bind(),Me.terrain.bind();let i=P.create();P.translate(i,i,this.position.toMatrixVec3()),P.multiply(i,r,i),this.shader.setUniform("u_modelView",i),this.shader.setUniform("u_projection",e),this.shader.setUniform("u_texture",0),this.shader.bindBuffer("index",this.indices),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0)}};var G=class G extends ht{constructor(r,i,n,s){let a=[n,n,i,s,n,n].map(G.getUV).flat();super(r,G.vertices,new Float32Array(a),G.normals,G.indices);this.topFace=i;this.sideFace=n;this.bottomFace=s}};u(G,"frontFaceVertices",[-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]),u(G,"backFaceVertices",[.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5]),u(G,"topFaceVertices",[-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5]),u(G,"bottomFaceVertices",[-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5]),u(G,"rightFaceVertices",[.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5]),u(G,"leftFaceVertices",[-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5]),u(G,"vertices",new Float32Array([...G.frontFaceVertices,...G.backFaceVertices,...G.topFaceVertices,...G.bottomFaceVertices,...G.rightFaceVertices,...G.leftFaceVertices])),u(G,"frontFaceIndices",[0,1,2,0,2,3]),u(G,"backFaceIndices",[4,5,6,4,6,7]),u(G,"topFaceIndices",[8,9,10,8,10,11]),u(G,"bottomFaceIndices",[12,13,14,12,14,15]),u(G,"rightFaceIndices",[16,17,18,16,18,19]),u(G,"leftFaceIndices",[20,21,22,20,22,23]),u(G,"indices",new Uint16Array([...G.frontFaceIndices,...G.backFaceIndices,...G.topFaceIndices,...G.bottomFaceIndices,...G.rightFaceIndices,...G.leftFaceIndices])),u(G,"frontFaceNormals",[0,0,1,0,0,1,0,0,1,0,0,1]),u(G,"backFaceNormals",[0,0,-1,0,0,-1,0,0,-1,0,0,-1]),u(G,"topFaceNormals",[0,1,0,0,1,0,0,1,0,0,1,0]),u(G,"bottomFaceNormals",[0,-1,0,0,-1,0,0,-1,0,0,-1,0]),u(G,"rightFaceNormals",[1,0,0,1,0,0,1,0,0,1,0,0]),u(G,"leftFaceNormals",[-1,0,0,-1,0,0,-1,0,0,-1,0,0]),u(G,"normals",new Float32Array([...G.frontFaceNormals,...G.backFaceNormals,...G.topFaceNormals,...G.bottomFaceNormals,...G.rightFaceNormals,...G.leftFaceNormals]));var K=G;var ns=[0,1,2,0,2,3],ft=class{constructor(){u(this,"vertices",[]);u(this,"normals",[]);u(this,"uvs",[]);u(this,"indices",[])}addQuad(e,r,i,n){this.normals.push(...i),this.uvs.push(...n);let s=this.vertices.length/3;this.indices.push(...ns.map(a=>a+s)),this.vertices.push(...r.map((a,o)=>a+e[o%3]))}build(e){return new Ae(new Float32Array(this.vertices),new Float32Array(this.uvs),new Float32Array(this.normals),new Uint16Array(this.indices))}};var pt=class{constructor(e,r,i,n,s,a){this.position=e;this.chunk=r;this.westNeighbor=i;this.eastNeighbor=n;this.northNeighbor=s;this.southNeighbor=a;u(this,"builder",new ft)}generateMesh(){for(let e=0;e<X;e++)for(let r=0;r<De;r++)for(let i=0;i<X;i++){let n=this.chunk.getVoxelAt(e,r,i);if(!n)continue;let s=new Q(e,r,i);this.addFace(s,4,n),this.addFace(s,5,n),r<De&&this.addFace(s,0,n),r>0&&this.addFace(s,1,n),this.addFace(s,3,n),this.addFace(s,2,n)}this.chunk.mesh=this.builder.build(this.position)}decodeFace(e){switch(e){case 0:return{vertices:K.topFaceVertices,normals:K.topFaceNormals};case 1:return{vertices:K.bottomFaceVertices,normals:K.bottomFaceNormals};case 2:return{vertices:K.leftFaceVertices,normals:K.leftFaceNormals};case 3:return{vertices:K.rightFaceVertices,normals:K.rightFaceNormals};case 4:return{vertices:K.frontFaceVertices,normals:K.frontFaceNormals};case 5:return{vertices:K.backFaceVertices,normals:K.backFaceNormals};default:throw new Error("Invalid direction")}}addFace(e,r,i){if(this.isFaceObstructed(e,r))return;let{vertices:s,normals:a}=this.decodeFace(r),o=Ge.toUV(i,r);this.builder.addQuad(e.toArray(),s,a,o)}getNeighbor(e){switch(e){case 3:return this.eastNeighbor;case 2:return this.westNeighbor;case 4:return this.northNeighbor;case 5:return this.southNeighbor;default:return null}}isFaceObstructed(e,r){let i=e.add(Fe.toVector(r));if(this.chunk.getVoxelAt(i))return!0;let s=this.getNeighbor(r);if(!s)return r!==0&&r!==1;let a=new Q(this.position.x*X,0,this.position.y*X).add(i);return!!s.getVoxelAtGlobalPosition(a)}};var se=class{};u(se,"vertices",new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,1,0])),u(se,"indices",new Uint16Array([0,1,2,0,2,3])),u(se,"textureCoordinates",new Float32Array([0,0,0,1,1,1,1,0]));var Xe=class{constructor(e,r,i){this.name=e;this.vertices=r;this.indices=i;u(this,"shader")}setup(e){return U(this,null,function*(){var r,i;this.shader=new fe(e,"gizmo-"+this.name),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:(r=this.vertices)!=null?r:Float32Array,attribute:"a_position"},index:{data:(i=this.indices)!=null?i:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}bind(e,r,i,n,s){this.shader.bind(),this.shader.setUniform("u_color",r),this.shader.setUniform("u_model",i),this.shader.setUniform("u_view",n),this.shader.setUniform("u_projection",s),this.shader.bindBuffer("index")}},xe=class xe{constructor(e,r,i,n,s){this.position=e;this.size=r;this.rotation=i;this.color=n;this.fill=s;u(this,"modelMatrix",P.create());u(this,"vertices");P.translate(this.modelMatrix,this.modelMatrix,this.position),P.scale(this.modelMatrix,this.modelMatrix,this.size),P.rotateX(this.modelMatrix,this.modelMatrix,this.rotation[0]),P.rotateY(this.modelMatrix,this.modelMatrix,this.rotation[1]),P.rotateZ(this.modelMatrix,this.modelMatrix,this.rotation[2]),this.fill||(this.vertices=new Float32Array(xe.outlineVertices))}static setup(e){return U(this,null,function*(){this.mesh=new Xe("box",K.vertices,K.indices),yield this.mesh.setup(e)})}render(e,r,i){xe.mesh.bind(e,this.color,this.modelMatrix,i,r),this.fill?(xe.mesh.shader.bindBuffer("vertex",K.vertices),e.drawElements(GL.TRIANGLES,xe.mesh.indices.length,GL.UNSIGNED_SHORT,0)):(xe.mesh.shader.bindBuffer("vertex",this.vertices),e.drawArrays(this.fill?GL.TRIANGLES:GL.LINE_LOOP,0,this.vertices.length/3))}};u(xe,"outlineVertices",new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5])),u(xe,"mesh");var ut=xe,He=class He{constructor(e,r,i,n){this.position=e;this.size=r;this.color=i;this.fill=n;u(this,"modelMatrix",P.create());P.translate(this.modelMatrix,this.modelMatrix,this.position),P.scale(this.modelMatrix,this.modelMatrix,this.size)}static setup(e){return U(this,null,function*(){this.mesh=new Xe("quad",se.vertices,se.indices),yield this.mesh.setup(e)})}render(e,r,i){He.mesh.bind(e,this.color,this.modelMatrix,i,r),e.drawElements(this.fill?GL.TRIANGLES:GL.LINE_LOOP,He.mesh.indices.length,GL.UNSIGNED_SHORT,0)}};u(He,"mesh");var mt=He,bt=class bt{constructor(e,r,i){this.color=r;this.fill=i;u(this,"modelMatrix",P.create());u(this,"vertices");u(this,"indices");let n=e.getViewMatrix(),s=e.getProjectionMatrix(),a=P.multiply(P.create(),s,n),o=P.invert(P.create(),a),l=[z.fromValues(-1,-1,-1,1),z.fromValues(1,-1,-1,1),z.fromValues(1,1,-1,1),z.fromValues(-1,1,-1,1),z.fromValues(-1,-1,1,1),z.fromValues(1,-1,1,1),z.fromValues(1,1,1,1),z.fromValues(-1,1,1,1)].map(h=>{let f=z.transformMat4(z.create(),h,o);return z.scale(f,f,1/f[3]),f});this.vertices=new Float32Array([...l[0],...l[1],...l[2],...l[3],...l[4],...l[5],...l[6],...l[7]]),this.indices=new Uint16Array([0,1,2,2,3,0,4,5,6,6,7,4,0,1,5,5,4,0,2,3,7,7,6,2,0,3,7,7,4,0,1,2,6,6,5,1])}static setup(e){return U(this,null,function*(){this.shader=new fe(e,"gizmo-"+this.name),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:Float32Array,attribute:"a_position"},index:{data:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}render(e,r,i){let n=bt.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),n.bindBuffer("index",this.indices),e.drawElements(this.fill?GL.TRIANGLES:GL.LINE_LOOP,this.indices.length,GL.UNSIGNED_SHORT,0)}};u(bt,"shader");var dt=bt,xt=class xt{constructor(e,r,i){this.start=e;this.end=r;this.color=i;u(this,"modelMatrix",P.create());u(this,"vertices");this.vertices=new Float32Array([...this.start,...this.end])}static setup(e){return U(this,null,function*(){this.shader=new fe(e,"gizmo-line"),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:Float32Array,attribute:"a_position"}}})})}render(e,r,i){let n=xt.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),e.drawArrays(GL.LINES,0,this.vertices.length/3)}};u(xt,"shader");var gt=xt,yt=class yt{constructor(e,r,i,n,s){this.position=e;this.radius=r;this.color=i;this.fill=s;u(this,"modelMatrix",P.create());u(this,"vertices");P.translate(this.modelMatrix,this.modelMatrix,this.position);let a=[];for(let o=0;o<=n;o++){let c=o/n*Math.PI;for(let l=0;l<=n;l++){let h=l/n*2*Math.PI,f=this.radius*Math.sin(c)*Math.cos(h),m=this.radius*Math.sin(c)*Math.sin(h),p=this.radius*Math.cos(c);a.push(f,m,p)}}this.vertices=new Float32Array(a)}static setup(e){return U(this,null,function*(){this.mesh=new Xe("sphere"),yield this.mesh.setup(e)})}render(e,r,i){let n=yt.mesh.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),e.drawArrays(this.fill?GL.TRIANGLES:GL.LINE_STRIP,0,this.vertices.length/3)}};u(yt,"mesh");var vt=yt,le=class{static setup(e){return U(this,null,function*(){})}static render(e,r,i){}static clear(){}static box(e,r,i,n,s=!1){}static quad(e,r,i,n=!1){}static frustum(e,r,i=!1){}static line(e,r,i){}static sphere(e,r,i,n=32,s=!1){}};u(le,"list",[]);var ne;(A=>{let t=Array.from({length:L.TERRAIN_GENERATION_WORKER_COUNT},()=>new ct),e=0,r={},i={};A.loadedChunkCount=0,A.chunks={},A.activeChunks=[];function o(x=!1){return t[e++%t.length]}function c(x,T){return"".concat(x,"|").concat(T)}function l(x){if(L.TERRAIN_GENERATION_ON_MAIN_THREAD)for(let T of x){let y=lt.generateChunkVoxels(T);new pt(T,y,null,null,null,null).generateMesh(),A.loadChunkTerrain(y),A.loadChunkMesh(T.x,T.y,y.mesh)}else for(let T=0;T<x.length;T++){let y=x[T];o().generateChunkTerrain(y.x,y.y)}}function h(x){for(let T of A.activeChunks)x.includes(T)||(delete A.chunks[c(T.localPosition.x,T.localPosition.y)],A.loadedChunkCount--)}function f(){for(let x in A.chunks)delete A.chunks[x];A.activeChunks=[],A.loadedChunkCount=0;for(let x in r)delete r[x];for(let x in i)delete i[x]}A.reloadChunks=f;function m(x){let T=L.RENDER_DISTANCE/2,y=[],w=[];for(let v=x.x-T;v<x.x+T;v++)for(let b=x.y-T;b<x.y+T;b++){let M=new N(v,b),g=N.distanceSquared(x,M);if(g<T){let S=c(v,b);A.chunks.hasOwnProperty(S)?y.push(A.chunks[S]):r.hasOwnProperty(S)||(r[S]=M,w.push({position:M,distance:g}))}}w.sort((v,b)=>v.distance-b.distance),h(y),l(w.map(v=>v.position)),A.activeChunks=y}A.updateActiveChunks=m;function p(x){let T=c(x.x,x.y);return A.chunks[T]}A.getChunk=p;function E(x){return[p(new N(x.x,x.y-1)),p(new N(x.x+1,x.y)),p(new N(x.x,x.y+1)),p(new N(x.x-1,x.y))]}A.getNeighboringChunks=E;function R(x){let T=c(x.localPosition.x,x.localPosition.y);A.chunks[T]=x,delete r[T],L.TERRAIN_GENERATION_ON_MAIN_THREAD||o(!0).generateChunkMesh(x.localPosition.x,x.localPosition.y,x,E(x.localPosition))}A.loadChunkTerrain=R;function d(x,T,y,w=0){Oe.notifyChunkUpdate();let v=c(x,T);if(delete i[v],A.chunks.hasOwnProperty(v)){if(w<1){let M=E(new N(x,T));for(let g of M)if(g){let S=c(g.localPosition.x,g.localPosition.y);i.hasOwnProperty(S)||(i[S]=A.chunks[v],o(!0).generateChunkMesh(g.localPosition.x,g.localPosition.y,g,E(g.localPosition),w+1))}}A.chunks[v].mesh=y,A.loadedChunkCount++;let b=A.chunks[v].globalCenterPosition;b[1]=14,le.sphere(b,1,z.fromValues(1,1,1,1))}}A.loadChunkMesh=d})(ne||(ne={}));var ye=class{static decode(e,r=!1){if(e.startsWith("rgba")){let[i,n,s,a]=e.slice(5,-1).split(",").map(o=>parseFloat(o));return{r:i,g:n,b:s,a}}else if(e.startsWith("rgb")){let[i,n,s]=e.slice(4,-1).split(",").map(a=>parseInt(a));return{r:i,g:n,b:s,a:1}}else{let i=e;i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=parseInt(i.slice(0,2),16),s=parseInt(i.slice(2,4),16),a=parseInt(i.slice(4,6),16);return r?{r:n/255,g:s/255,b:a/255,a:1}:{r:n,g:s,b:a,a:1}}}static mix(e,r,i){let n=this.decode(e),s=this.decode(r),a=Math.floor(n.r+(s.r-n.r)*i),o=Math.floor(n.g+(s.g-n.g)*i),c=Math.floor(n.b+(s.b-n.b)*i),l=n.a+(s.a-n.a)*i;return"rgba(".concat(a,",").concat(o,",").concat(c,",").concat(Math.clamp(Math.abs(l),0,1),")")}static alpha(e,r){let i=e;if(i.startsWith("rgba")){let s=i.slice(5,-1).split(",");return s[3]="".concat(r),"rgba(".concat(s.join(","),")")}i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=Math.round(r*255).toString(16).padStart(2,"0");return"#".concat(i).concat(n)}static interpolate(e,r,i){if(e.startsWith("rgba")){let x=e.slice(5,-1).split(",").map(M=>parseInt(M)),T=r.slice(5,-1).split(",").map(M=>parseInt(M)),y=Math.round(x[0]+(T[0]-x[0])*i),w=Math.round(x[1]+(T[1]-x[1])*i),v=Math.round(x[2]+(T[2]-x[2])*i),b=x[3]+(T[3]-x[3])*i;return"rgba(".concat(y,",").concat(w,",").concat(v,",").concat(b,")")}let n="0x".concat(e.trim().slice(1)),s="0x".concat(r.trim().slice(1));n.length<5&&(n=n.replace(/./g,"$&$&")),s.length<5&&(s=s.replace(/./g,"$&$&"));let a=parseInt(n,16),o=parseInt(s,16),c=a>>16,l=a>>8&255,h=a&255,f=o>>16,m=o>>8&255,p=o&255,E=Math.round(c+(f-c)*i),R=Math.round(l+(m-l)*i),d=Math.round(h+(p-h)*i);return"#".concat((16777216+(E<<16)+(R<<8)+d).toString(16).slice(1))}static isColorLight(e){let r="0x".concat(e.trim().slice(1));r.length<5&&(r=r.replace(/./g,"$&$&"));let i=parseInt(r,16),n=i>>16,s=i>>8&255,a=i&255;return Math.sqrt(.299*(n*n)+.587*(s*s)+.114*(a*a))>127.5}};var pe=class pe{static get isDark(){return window.matchMedia("(prefers-color-scheme: dark)").matches}static setup(){return U(this,null,function*(){pe.loadVariables(),pe.observeChanges()})}static loadVariables(){let e=["--background","--foreground","--secondary","--container-background","--container-border","--container-shadow"];D.info("Theme","Setting up theme, loading ".concat(e.length," variables...")),console.groupCollapsed("Loading theme variables");let r=getComputedStyle(document.body);for(let i of e){let n=r.getPropertyValue(i),s=i.toString().toCamelCase();pe[s]=n,console.log("%c".concat(s),"color: ".concat(ye.isColorLight(n)?"#212121":"#eee","; background-color: ").concat(n))}console.groupEnd()}static observeChanges(){let e=window.matchMedia("(prefers-color-scheme: dark)");e.addEventListener("change",()=>{D.info("Theme","Changed theme to ".concat(e.matches?"dark":"light")),pe.loadVariables()})}};u(pe,"background"),u(pe,"foreground"),u(pe,"secondary"),u(pe,"containerBackground"),u(pe,"containerBorder"),u(pe,"containerShadow");var re=pe;var Oe;(os=>{let n=ie*1.25,s=250,a=60,o=0,c=0,l=0,h=0,f=0,m=0,p=[],E=1,R=1e3/a,d=0,A=0,x=0,T=0,y=0,w=0,v=0,b=0;function M(){return U(this,null,function*(){try{a=yield window.getRefreshRate(),D.info("Analytics","Target FPS: ".concat(a))}catch(I){D.warn("Analytics","Failed to get refresh rate, defaulting to 60 FPS")}})}os.setup=M;function g(I){var Y,W,H,me;A++,x+=(W=(Y=I.mesh)==null?void 0:Y.vertexCount)!=null?W:0,T+=(me=(H=I.mesh)==null?void 0:H.triangleCount)!=null?me:0}os.notifyChunkVisible=g;function S(){v++}os.notifyChunkUpdate=S;function F(){y++}os.notifyRaycast=F;function B(I=performance.now()){o=I,A=0,x=0,T=0,y=0}os.startFrame=B;function $(I){c+=I,c>=1&&(c-=1,f=l,l=0,m=h,h=0,b=v,v=0,performance.getUsedMemory().then(Y=>d=Y)),E=Math.lerp(E,R,I*4)}os.update=$;function _(){h++}os.endUpdate=_;function q(){let I=performance.now()-o;l++,p.push(I),p.length>s&&p.shift()}os.endFrame=q;function Te(){let I=1e3/a,Y=0,W=0,H=0;for(let ae of p)ae>Y&&(Y=ae),W+=ae,H=ae;let me=W/p.length;R=Y;let te=p.slice().sort((ae,he)=>ae-he),de=Math.floor(te.length*.01),ge=de>=0&&de<te.length?Math.round(1e3/te[de]):0;return{average:me,max:Y,last:H,reference:I,fps1Low:ge}}function Le(I,Y,W){function H(me){let te=me.split(/([a-zA-Z 0-9\%]+:)/g),de=0;for(let ge=0;ge<te.length;ge++){let ae=te[ge];if(ae.length<=0)continue;let he=ae.includes(":");I.fillStyle=he?re.secondary:re.foreground,I.font="".concat(he?"bold":"normal"," ").concat(ie,"px ").concat(ze),I.fillText(ae,W.x+de,W.y),de+=I.measureText(ae).width}W.y+=n}W.x=25,W.y=25,I.font="bold ".concat(ie,"px ").concat(ze),I.textBaseline="top",I.fillStyle=re.secondary,I.textAlign="center",I.fillText("- Analytics -",W.x+230/2,W.y),W.y+=n+15/2,I.fillStyle=re.foreground,I.textAlign="left",H("FPS: ".concat(f," real / ").concat(Math.floor(1e3/Y.max)," max est.")),H("Average: ".concat(Math.prettifyElapsedTime(Y.average)," | Max: ").concat(Math.prettifyElapsedTime(Y.max))),H("1% Low: ".concat(Y.fps1Low," | Last: ").concat(Math.prettifyElapsedTime(Y.last))),H("UPS: ".concat(m)),H("Chunks: ".concat(A,"/").concat(Math.prettifyUnit(ne.activeChunks.length)," | ").concat(Math.prettifyUnit(ne.loadedChunkCount)," loaded")),H("Chunk updates: ".concat(b)),H("Vertices: ".concat(Math.prettifyUnit(x))),H("Triangles: ".concat(Math.prettifyUnit(T))),H("Ray casts: ".concat(Math.prettifyUnit(w))),isNaN(d)||H("Memory usage: ".concat(Math.prettifyUnit(d,"B"))),W.y+=n}function tt(I,Y,W){if(p.length<2)return;let H=50,me=240+15*2,te=10,de=me/(s-1);I.save(),I.beginPath(),I.roundRect(te,W.y,me,H,[0,0,10,10]),I.clip();let ge=I.createLinearGradient(te,W.y,te,W.y+H);ge.addColorStop(.25,"#ef5777"),ge.addColorStop(1,"#f53b57"),I.fillStyle=ge,I.strokeStyle=re.containerBorder,I.beginPath(),I.moveTo(te,W.y+H);let ae=Math.max(E,0);for(let he=0;he<p.length;he++){let _r=p[he]/ae*H,kr=te+he*de,Br=W.y+H-_r;I.lineTo(kr,Br)}if(I.lineTo(te+(p.length-1)*de,W.y+H),I.closePath(),I.fill(),I.stroke(),I.restore(),E>Y.reference){let he=Y.reference/E*H;I.strokeStyle="#05c46b",I.lineWidth=1.5,I.beginPath(),I.moveTo(te,W.y+H-he),I.lineTo(te+me,W.y+H-he),I.stroke()}W.y+=H}function rt(I,Y){I.fillStyle=re.containerBackground,I.strokeStyle=re.containerBorder,I.lineWidth=1,I.save(),I.beginPath(),I.shadowColor=re.containerShadow,I.shadowBlur=25,I.roundRect(10,10,240+15*2,Y.y-10,10),I.fill(),I.stroke(),I.restore()}function as(I){I.save();let Y=Te(),W=N.zero;Le(I,Y,W),tt(I,Y,W),I.globalCompositeOperation="destination-over",rt(I,W),I.restore()}os.render=as})(Oe||(Oe={}));var je=(a=>(a[a.LeftStickX=0]="LeftStickX",a[a.LeftStickY=1]="LeftStickY",a[a.RightStickX=2]="RightStickX",a[a.RightStickY=3]="RightStickY",a[a.LeftTrigger=4]="LeftTrigger",a[a.RightTrigger=5]="RightTrigger",a))(je||{});var Ye=(w=>(w[w.A=0]="A",w[w.B=1]="B",w[w.X=2]="X",w[w.Y=3]="Y",w[w.LB=4]="LB",w[w.RB=5]="RB",w[w.LT=6]="LT",w[w.RT=7]="RT",w[w.Back=8]="Back",w[w.Start=9]="Start",w[w.Home=16]="Home",w[w.LS=10]="LS",w[w.RS=11]="RS",w[w.Up=12]="Up",w[w.Down=13]="Down",w[w.Left=14]="Left",w[w.Right=15]="Right",w[w.UNUSED_1=17]="UNUSED_1",w[w.UNUSED_2=18]="UNUSED_2",w[w.UNUSED_3=19]="UNUSED_3",w[w.UNUSED_4=20]="UNUSED_4",w))(Ye||{});var $t=class{constructor(e,r,i){this.rect=e;this.color=r;this.thickness=i}render(e){e.strokeStyle=this.color,e.lineWidth=this.thickness,e.strokeRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},Wt=class{constructor(e,r){this.rect=e;this.color=r}render(e){e.fillStyle=this.color,e.fillRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},Ht=class{constructor(e,r,i,n){this.start=e;this.end=r;this.color=i;this.thickness=n}render(e){e.strokeStyle=this.color,e.lineWidth=this.thickness,e.beginPath(),e.moveTo(this.start.x,this.start.y),e.lineTo(this.end.x,this.end.y),e.stroke()}},Xt=class{constructor(e,r,i,n){this.center=e;this.radius=r;this.color=i;this.fill=n}render(e){this.fill?e.fillStyle=this.color:e.strokeStyle=this.color,e.lineWidth=1,e.beginPath(),e.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),this.fill?e.fill():e.stroke()}},jt=class{constructor(e,r,i,n){this.text=e;this.position=r;this.color=i;this.alignment=n}render(e){e.save(),e.fillStyle=this.color,e.font="12px Arial",e.textAlign=this.alignment,e.fillText(this.text,this.position.x,this.position.y),e.restore()}},Yt=class{constructor(e,r,i){this.origin=e;this.vector=r;this.color=i;u(this,"ARROWHEAD_LENGTH",10);u(this,"ARROWHEAD_ANGLE",Math.PI/6);u(this,"MIN_LENGTH",1);u(this,"MAX_LENGTH",100)}render(e){let r=this.vector.length;if(r<this.MIN_LENGTH)return;r>this.MAX_LENGTH&&(this.vector=this.vector.normalize().multiply(this.MAX_LENGTH),r=this.MAX_LENGTH);let i=(r-this.MIN_LENGTH)/(this.MAX_LENGTH-this.MIN_LENGTH),n=ye.alpha(this.color,i);e.fillStyle=n,e.strokeStyle=n,e.lineWidth=1.5,e.lineCap="round",e.beginPath(),e.moveTo(this.origin.x,this.origin.y),e.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),e.stroke();let s=10,a=Math.PI/6,o=Math.atan2(this.vector.y,this.vector.x);e.beginPath(),e.moveTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),e.lineTo(this.origin.x+this.vector.x-s*Math.cos(o-a),this.origin.y+this.vector.y-s*Math.sin(o-a)),e.lineTo(this.origin.x+this.vector.x-s*Math.cos(o+a),this.origin.y+this.vector.y-s*Math.sin(o+a)),e.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),e.fill()}},C=class C{constructor(e,r,i){this.position=e;this.buttons=r;this.axes=i;this.position=this.position.subtract(new N(C.width/2,C.height/2))}getColor(e){return this.buttons[e].active?C.activeColor:C.buttonColor}getTextColor(e){return this.buttons[e].active?C.textColor:C.color}renderAnalogStick(e,r,i,n,s){let a=C.outerRadius;e.fillStyle=C.color,e.fillCircle(r.x,r.y,a),e.fillStyle=this.getColor(i),e.fillCircle(r.x+this.axes[n]*a,r.y+this.axes[s]*a,C.innerRadius)}renderDpad(e,r){let i=C.buttonSize;e.fillStyle=C.color,e.fillCircle(r.x+i,r.y+i/2,i*2),e.fillStyle=this.getColor(14),e.beginPath(),e.roundRect(r.x-i/2,r.y,i,i,[i/4,0,0,i/4]),e.fill(),e.fillStyle=this.getColor(15),e.beginPath(),e.roundRect(r.x+i*1.5,r.y,i,i,[0,i/4,i/4,0]),e.fill(),e.fillStyle=this.getColor(12),e.beginPath(),e.roundRect(r.x+i/2,r.y-i,i,i,[i/4,i/4,0,0]),e.fill(),e.fillStyle=this.getColor(13),e.beginPath(),e.roundRect(r.x+i/2,r.y+i,i,i,[0,0,i/4,i/4]),e.fill(),e.fillStyle=C.buttonColor,e.fillRect(r.x+i/2,r.y,i,i)}renderButtons(e,r){let i=C.buttonSize*1.25;e.font="".concat(i/2,"px Arial"),e.fillStyle=C.color,e.fillCircle(r.x-i,r.y+i/2,i*1.75),e.fillStyle=this.getColor(3),e.fillCircle(r.x-i,r.y-i/2,i/2),e.fillStyle=this.getTextColor(3),e.fillTextAligned("Y",r.x-i,r.y-i*.75,"center"),e.fillStyle=this.getColor(2),e.fillCircle(r.x-i*2,r.y+i/2,i/2),e.fillStyle=this.getTextColor(2),e.fillTextAligned("X",r.x-i*2,r.y+i*.25,"center"),e.fillStyle=this.getColor(0),e.fillCircle(r.x-i,r.y+i*1.5,i/2),e.fillStyle=this.getTextColor(0),e.fillTextAligned("A",r.x-i,r.y+i*1.25,"center"),e.fillStyle=this.getColor(1),e.fillCircle(r.x,r.y+i/2,i/2),e.fillStyle=this.getTextColor(1),e.fillTextAligned("B",r.x,r.y+i*.25,"center")}renderBumpersAndTriggers(e,r,i,n){var o;let s=C.buttonSize;e.fillStyle=this.getColor(i),e.beginPath(),e.roundRect(r.x,r.y-s/1.5,s*3,s/1.5,[s/4,s/4,0,0]),e.fill();let a=Math.abs((o=this.buttons[n].value)!=null?o:0);e.fillStyle=ye.mix(C.color,C.activeColor,a),a=1-a*.75,e.beginPath(),e.roundRect(r.x+s/1.5,r.y-2.5-s/2-s*a,s*1.5,s*1*a,[s/4,s/4,0,0]),e.fill()}renderExtraButtons(e,r){let i=C.buttonSize;e.fillStyle=this.getColor(8),e.fillCircle(r.x-i*2,r.y-i/2,i/2),e.fillStyle=this.getColor(16),e.fillCircle(r.x,r.y,i/2),e.fillStyle=this.getColor(9),e.fillCircle(r.x+i*2,r.y-i/2,i/2)}renderBackground(e){e.fillStyle=C.color,e.beginPath(),e.roundRect(this.position.x,this.position.y,C.width,C.height-C.outerRadius/2.5,[C.outerRadius,C.outerRadius,0]),e.save();let r=C.outerRadius*3,i=C.outerRadius*4,n=this.position.x,s=this.position.y+C.height-C.outerRadius*3;e.roundRect(n,s,r,i,[C.outerRadius*2,0,C.outerRadius*8,C.outerRadius*8]),e.restore(),e.save(),n=this.position.x+C.width-r,s=this.position.y+C.height-C.outerRadius*3,e.roundRect(n,s,r,i,[0,C.outerRadius*2,C.outerRadius*8,C.outerRadius*8]),e.restore(),e.fill()}render(e){this.renderBackground(e),this.renderAnalogStick(e,new N(this.position.x+C.width/3,this.position.y+C.height-C.outerRadius-C.buttonSize),10,0,1),this.renderAnalogStick(e,new N(this.position.x+C.width-C.width/3,this.position.y+C.height-C.outerRadius-C.buttonSize),11,2,3),this.renderDpad(e,new N(this.position.x+C.buttonSize*2,this.position.y+C.buttonSize*2.5)),this.renderButtons(e,new N(this.position.x+C.width-C.buttonSize*2,this.position.y+C.buttonSize*2.5)),this.renderBumpersAndTriggers(e,new N(this.position.x+C.outerRadius,this.position.y),4,6),this.renderBumpersAndTriggers(e,new N(this.position.x+C.width-C.outerRadius-C.buttonSize*3,this.position.y),5,7),this.renderExtraButtons(e,new N(this.position.x+C.width/2,this.position.y+C.height/2-C.buttonSize*2))}};u(C,"scale",1),u(C,"width",200*C.scale),u(C,"height",100*C.scale),u(C,"color","rgba(52, 73, 94, 0.5)"),u(C,"buttonColor","rgba(255, 255, 255, 0.5)"),u(C,"activeColor","rgba(52, 152, 219, 0.85)"),u(C,"textColor","rgba(255, 255, 255, 0.75)"),u(C,"outerRadius",20*C.scale),u(C,"innerRadius",10*C.scale),u(C,"buttonSize",10*C.scale);var Zt=C,ee=class{static render(e){}static clear(){}static rect(e,r="#fff"){}static outline(e,r="#fff",i=1){}static line(e,r,i="#fff",n=1){}static circle(e,r,i="#fff",n=!0){}static text(e,r,i="#fff",n="left"){}static arrow(e,r,i="#fff"){}static gamepad(e,r,i){}};u(ee,"list",[]);var Ee=class{static set(e){this.current!==e&&(this.current=e,this.isDirty=!0)}static apply(e=document.body){this.isDirty&&(this.isDirty=!1,e.style.cursor=this.current)}static reset(){this.current="default",this.isDirty=!0}};u(Ee,"current","default"),u(Ee,"isDirty",!1);var Et=class{static setup(){return U(this,null,function*(){let e="".concat(ie,"pt ").concat(ze);document.fonts.check(e)||(yield document.fonts.load(e))})}};var wt=class{setup(){return Promise.resolve()}update(e){}render(e){}};var _e=class t{constructor(e,r,i,n){this.x=e;this.y=r;this.width=i;this.height=n}translate(e){return new t(this.x+e.x,this.y+e.y,this.width,this.height)}contains(e,r=void 0){if(e instanceof N&&r===void 0)return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y;if(e instanceof t&&r===void 0)return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height;if(typeof e=="number"&&typeof r=="number")return e>=this.x&&e<=this.x+this.width&&r>=this.y&&r<=this.y+this.height;throw new Error("Invalid arguments")}intersects(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}intersection(e){let r=Math.max(this.x,e.x),i=Math.max(this.y,e.y),n=Math.min(this.x+this.width,e.x+e.width)-r,s=Math.min(this.y+this.height,e.y+e.height)-i;return new t(r,i,n,s)}get size(){return new N(this.width,this.height)}get position(){return new N(this.x,this.y)}set position(e){this.x=e.x,this.y=e.y}get center(){return new N(this.x+this.width/2,this.y+this.height/2)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}clone(){return new t(this.x,this.y,this.width,this.height)}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}toString(){return"{ x: ".concat(this.x,", y: ").concat(this.y,", width: ").concat(this.width,", height: ").concat(this.height," }")}};var ke=(x=>(x.W="KeyW",x.A="KeyA",x.S="KeyS",x.D="KeyD",x.R="KeyR",x.C="KeyC",x.V="KeyV",x.Shift="ShiftLeft",x.Ctrl="ControlLeft",x.Enter="Enter",x.ArrowUp="ArrowUp",x.ArrowDown="ArrowDown",x.ArrowLeft="ArrowLeft",x.ArrowRight="ArrowRight",x.Space="Space",x.Escape="Escape",x.Quote="Backquote",x.Backspace="Backspace",x))(ke||{});var Z;(v=>{let e={},r={};v.connectedGamepad=null;let n=!0,s=-1;function a(...b){return b.some(M=>{var g;return((g=e[M])==null?void 0:g.active)===!0})}v.isButtonDown=a;function o(...b){return b.some(M=>{var g;return((g=e[M])==null?void 0:g.active)===!0})}v.isButtonUp=o;function c(...b){return b.some(M=>{var g;return((g=e[M])==null?void 0:g.justPressed)===!0})}v.isButtonJustPressed=c;function l(...b){return b.some(M=>{var g;return((g=e[M])==null?void 0:g.justReleased)===!0})}v.isButtonJustReleased=l;function h(...b){return b.some(M=>{var g;return((g=e[M])==null?void 0:g.longPress)===!0})}v.isButtonLongPressed=h;function f(...b){return b.some(M=>{var g;return((g=e[M])==null?void 0:g.shortPress)===!0})}v.isButtonShortPressed=f;function m(b){return r[b]}v.getAxis=m;function p(b){v.connectedGamepad=b.gamepad,n&&(n=!1,j.isDirty=!0)}function E(b){v.connectedGamepad=null}function R(){let b=navigator.getGamepads().find(M=>M);b&&(v.connectedGamepad=b,n&&(n=!1,j.isDirty=!0),clearInterval(s))}function d(){s=setInterval(R.bind(this),500)}function A(){let b=navigator.getGamepads().find(g=>{var S;return g&&g.id===((S=v.connectedGamepad)==null?void 0:S.id)});b?v.connectedGamepad=b:(v.connectedGamepad=null,d())}function x(){for(let b=0;b<v.connectedGamepad.buttons.length;b++){let M=v.connectedGamepad.buttons[b],g=e[b];if(g.value=M.value,Math.abs(g.value)<Ve?g.value=0:1-Math.abs(g.value)<Ve&&(g.value=Math.sign(g.value)),g.value=Math.pow(g.value,Bt)*Math.sign(g.value),M.pressed!==g.active)if(j.isDirty=!0,M.pressed)g.active=!0,g.lastChange=Date.now(),g.justPressed=!0,g.justReleased=!1,g.lastTrigger=Date.now(),g.longPress=!1,g.shortPress=!1;else{g.active=!1,g.lastChange=Date.now(),g.justPressed=!1,g.justReleased=!0;let S=g.lastChange-g.lastTrigger;g.longPress=S>=ve,g.shortPress=!g.longPress}else g.justReleased=!1,g.justPressed=!1,g.shortPress=!1,g.longPress=g.active&&Date.now()-g.lastChange>=ve}}function T(){let b=[[0,1],[2,3]];for(let M of b){let g=new N(v.connectedGamepad.axes[M[0]],v.connectedGamepad.axes[M[1]]),S=Math.pow(g.length,Bt),F=Math.max(0,S-Ve)/(1-Ve);g=g.divide(S).multiply(F),(r[M[0]]!==g.x||r[M[1]]!==g.y)&&(j.isDirty=!0,r[M[0]]=g.x,r[M[1]]=g.y)}}function y(){if("getGamepads"in navigator){"ongamepadconnected"in window?(window.addEventListener("gamepadconnected",p.bind(this)),window.addEventListener("gamepaddisconnected",E.bind(this))):d();for(let b of Object.values(je))r[b]=0;for(let b of Object.values(Ye))e[b]={active:!1,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!1,justReleased:!1,longPress:!1,shortPress:!1,value:0}}}v.setup=y;function w(){ee.gamepad(new N(window.innerWidth-125,window.innerHeight-100),e,r),v.connectedGamepad&&("ongamepadconnected"in window||A(),x(),T())}v.update=w})(Z||(Z={}));var k;(w=>{let e={},r,i=null;function n(){return i!==null}w.isCaptured=n;function s(v,b,M){r.value=v,r.setSelectionRange(b,M)}w.setInput=s;function a(){r.value="",r.focus()}w.clearInput=a;function o(){n()&&r.focus()}w.focus=o;function c(v){i=v,r.focus()}w.startCapture=c;function l(){i=null,r.blur(),r.value=""}w.releaseCapture=l;function h(...v){return v.some(b=>{var M;return(M=e[b])==null?void 0:M.active})}w.isKeyDown=h;function f(...v){return v.some(b=>{var M;return!((M=e[b])!=null&&M.active)})}w.isKeyUp=f;function m(...v){return v.some(b=>{var M;return(M=e[b])==null?void 0:M.justPressed})}w.isKeyJustPressed=m;function p(...v){return v.some(b=>{var M;return(M=e[b])==null?void 0:M.justReleased})}w.isKeyJustReleased=p;function E(...v){return v.some(b=>{var M;return(M=e[b])==null?void 0:M.longPress})}w.isKeyLongPressed=E;function R(...v){return v.some(b=>{var M;return(M=e[b])==null?void 0:M.shortPress})}w.isKeyShortPressed=R;function d(v){let b=r.value,M=r.selectionStart,g=r.selectionEnd;i==null||i.call(this,b,M,g)}function A(v){n()&&d(),!v.repeat&&Object.values(ke).includes(v.code)&&(e[v.code]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},j.isDirty=!0)}function x(v){if(n()&&d(),v.repeat||!Object.values(ke).includes(v.code))return;let b=e[v.code];if(!b)return;b.active=!1,b.lastChange=Date.now(),b.justPressed=!1,b.justReleased=!0;let M=b.lastChange-b.lastTrigger;b.longPress=M>=ve,b.shortPress=!b.longPress,j.isDirty=!0}function T(){r=document.createElement("input"),r.type="text",r.style.position="absolute",r.style.left="0px",r.style.top="300px",r.style.width="200px",r.style.height="20px",r.style.zIndex="-1",r.style.pointerEvents="none",document.body.appendChild(r),r.addEventListener("input",d.bind(this)),window.addEventListener("keydown",A.bind(this)),window.addEventListener("keyup",x.bind(this))}w.setup=T;function y(){for(let v in e){if(!e.hasOwnProperty(v))continue;let b=e[v];b.justReleased=!1,b.justPressed=!1,b.shortPress=!1,b.longPress=b.active&&Date.now()-b.lastChange>=ve}}w.update=y})(k||(k={}));var Be=(i=>(i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i))(Be||{});var ue;(M=>{M.position=N.zero,M.delta=N.zero,M.buttons={},M.mouseWheelDelta=0;let o=0,c=-1;function l(...g){return g.some(S=>{var F;return(F=M.buttons[S])==null?void 0:F.active})}M.isMouseButtonDown=l;function h(...g){return g.some(S=>!M.buttons[S])}M.isMouseButtonUp=h;function f(...g){return g.some(S=>{var F;return(F=M.buttons[S])==null?void 0:F.justPressed})}M.isMouseButtonJustPressed=f;function m(...g){return g.some(S=>{var F;return(F=M.buttons[S])==null?void 0:F.justReleased})}M.isMouseButtonJustReleased=m;function p(...g){return g.some(S=>{var F;return(F=M.buttons[S])==null?void 0:F.longPress})}M.isMouseButtonLongPressed=p;function E(...g){return g.some(S=>{var F;return(F=M.buttons[S])==null?void 0:F.shortPress})}M.isMouseButtonShortPressed=E;function R(g){var S,F,B,$;k.focus(),document.pointerLockElement&&(M.delta.x=g.movementX,M.delta.y=g.movementY,M.position.x=g.clientX-((F=(S=g.target)==null?void 0:S.offsetLeft)!=null?F:0),M.position.y=g.clientY-(($=(B=g.target)==null?void 0:B.offsetTop)!=null?$:0))}function d(g){k.focus(),Object.values(Be).includes(g.button)&&(M.buttons[g.button]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},w(),j.isDirty=!0)}function A(g){if(k.focus(),!Object.values(Be).includes(g.button))return;let S=M.buttons[g.button];if(!S)return;S.active=!1,S.lastChange=Date.now(),S.justPressed=!1,S.justReleased=!0;let F=S.lastChange-S.lastTrigger;S.longPress=F>=ve,S.shortPress=!S.longPress,j.isDirty=!0}function x(g,S){Object.values(Be).includes(S.button)&&(document.pointerLockElement||g.setPointerCapture(S.pointerId),d(S))}function T(g,S){Object.values(Be).includes(S.button)&&(document.pointerLockElement||g.releasePointerCapture(S.pointerId),A(S))}function y(g){k.focus(),M.mouseWheelDelta=g.deltaY}function w(){if(document.pointerLockElement)return;if(Date.now()-o<1e3){c<0&&(D.debug("Input","Scheduling another pointer lock attempt"),c=setTimeout(w.bind(this),1e3));return}c>=0&&(clearTimeout(c),c=-1);let g={unadjustedMovement:!0};try{o=Date.now();let S=document.body.requestPointerLock(g);S?S.then(()=>{D.debug("Input","Pointer lock acquired (async)")}).catch(F=>D.error("Input","Failed to acquire pointer lock",F)):D.debug("Input","Pointer lock acquired")}catch(S){D.error("Input","Failed to acquire pointer lock",S)}}function v(){M.position.x=window.innerWidth/2,M.position.y=window.innerHeight/2,document.body.addEventListener("click",R.bind(this)),document.body.addEventListener("mousemove",R.bind(this)),document.body.addEventListener("mousedown",d.bind(this)),document.body.addEventListener("mouseup",A.bind(this)),document.body.addEventListener("wheel",y.bind(this)),document.body.oncontextmenu=g=>(g.preventDefault(),g.stopPropagation(),!1)}M.setup=v;function b(){for(let g in M.buttons){if(!M.buttons.hasOwnProperty(g))continue;let S=M.buttons[g];S.justReleased=!1,S.justPressed=!1,S.shortPress=!1,S.longPress=S.active&&Date.now()-S.lastChange>=ve}M.delta.x=0,M.delta.y=0,M.mouseWheelDelta=0}M.update=b})(ue||(ue={}));var j;(E=>{E.isDirty=!1;function e(){if(k.isCaptured())return 0;let R=0;return(k.isKeyDown("KeyA","ArrowLeft")||Z.isButtonDown(14))&&(R-=1),(k.isKeyDown("KeyD","ArrowRight")||Z.isButtonDown(15))&&(R+=1),Z.connectedGamepad&&(R=Z.getAxis(0)),R}E.getMovementHorizontal=e;function r(){if(k.isCaptured())return 0;let R=0;return(k.isKeyDown("KeyW","ArrowUp")||Z.isButtonDown(12))&&(R-=1),(k.isKeyDown("KeyS","ArrowDown")||Z.isButtonDown(13))&&(R+=1),Z.connectedGamepad&&(R=Z.getAxis(1)),R}E.getMovementVertical=r;function i(){return k.isCaptured()?0:ue.delta.x!==0?ue.delta.x:Z.connectedGamepad?Z.getAxis(2)*kt:0}E.getLookHorizontal=i;function n(){return k.isCaptured()?0:ue.delta.y!==0?ue.delta.y:Z.connectedGamepad?Z.getAxis(3)*kt:0}E.getLookVertical=n;function s(){return k.isCaptured()?!1:k.isKeyDown("Space","ArrowUp")||Z.isButtonDown(0,12)}E.isJumping=s;function a(){return k.isCaptured()?!1:k.isKeyDown("ShiftLeft")||Z.isButtonDown(13,1)}E.isCrouching=a;function o(){return k.isCaptured()?!1:k.isKeyJustReleased("KeyR")}E.isRecording=o;function c(){return k.isCaptured()?!1:k.isKeyJustReleased("KeyC")}E.isSwitchingCameras=c;function l(){return k.isCaptured()?!1:k.isKeyDown("ControlLeft")||Z.isButtonDown(7)}E.isRunning=l;function h(){return k.isKeyJustPressed("Backquote")}E.isTogglingTerminal=h;function f(){var R;navigator.vibrate&&navigator.vibrate(200),(R=Z.connectedGamepad)!=null&&R.vibrationActuator&&Z.connectedGamepad.vibrationActuator.playEffect("dual-rumble",{duration:100,strongMagnitude:.5,weakMagnitude:.25})}E.vibrate=f;function m(){k.setup(),Z.setup(),ue.setup()}E.setup=m;function p(){E.isDirty=!1,k.update(),Z.update(),ue.update()}E.update=p})(j||(j={}));var Rt=class extends wt{constructor(r){super();this.main=r}get width(){return this.main.screen.width}get height(){return this.main.screen.height}get camera(){return this.main.camera}invalidate(){this.main.invalidate()}setup(){return U(this,null,function*(){D.debug("StatePlay","Setting up..."),Ee.set("none"),this.updateActiveChunks()})}updateActiveChunks(){ne.updateActiveChunks(this.main.playerCamera.tiledPosition)}updateCameraRotation(r){this.camera.pitch-=j.getLookVertical()*r*20,this.camera.pitch=Math.clamp(this.camera.pitch,-89,89),this.camera.yaw-=j.getLookHorizontal()*r*20}updateCameraMovement(r){let i=5*(j.isRunning()?20:1),n=j.getMovementVertical(),s=j.getMovementHorizontal();if(this.updateActiveChunks(),n!==0){let a=this.camera.forward;this.camera.position[0]-=a[0]*r*i*n,this.camera.position[1]-=a[1]*r*i*n,this.camera.position[2]-=a[2]*r*i*n}if(s!==0){let a=this.camera.right;this.camera.position[0]-=a[0]*r*i*s,this.camera.position[1]-=a[1]*r*i*s,this.camera.position[2]-=a[2]*r*i*s}j.isCrouching()&&(this.camera.position[1]-=r*i),j.isJumping()&&(this.camera.position[1]+=r*i)}updateControls(r){this.camera.update(r),this.updateCameraRotation(r),this.updateCameraMovement(r)}update(r){return U(this,null,function*(){this.invalidate(),this.updateControls(r),this.main.useDebugCamera&&ee.outline(new _e(10,10,this.width-10*2,this.height-10*2),"#ff0000",10),ee.text("Position",new N(this.width/2,this.height-80),"gray","center"),ee.text("{ ".concat(this.camera.position[0].toFixed(2),", ").concat(this.camera.position[1].toFixed(2),", ").concat(this.camera.position[2].toFixed(2)," }"),new N(this.width/2,this.height-60),"white","center"),ee.text("Rotation",new N(this.width/2,this.height-40),"gray","center"),ee.text("{ ".concat(this.camera.pitch.toFixed(2),", ").concat(this.camera.yaw.toFixed(2),", ").concat(this.camera.roll.toFixed(2)," }"),new N(this.width/2,this.height-20),"white","center")})}render(r){}};var Mt=class{constructor(e=void 0){u(this,"element",document.createElement("canvas"));u(this,"context");u(this,"virtualWidth",0);u(this,"virtualHeight",0);u(this,"drawRatio",1);u(this,"overrideRatio");e&&(this.element.id=e);let r=this.element.getContext("2d");if(!r)throw new Error("Could not get context of canvas");this.context=r,this.context.imageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.filter="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxmaWx0ZXIgaWQ9ImZpbHRlciIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVGdW5jUiB0eXBlPSJpZGVudGl0eSIvPjxmZUZ1bmNHIHR5cGU9ImlkZW50aXR5Ii8+PGZlRnVuY0IgdHlwZT0iaWRlbnRpdHkiLz48ZmVGdW5jQSB0eXBlPSJkaXNjcmV0ZSIgdGFibGVWYWx1ZXM9IjAgMSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj48L2ZpbHRlcj48L3N2Zz4=#filter)",this.element.oncontextmenu=()=>!1}get backingStoreRatio(){return this.overrideRatio||this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1}get devicePixelRation(){return this.overrideRatio||window.devicePixelRatio||1}getDrawRatio(e,r){return r/e}setSize(e,r){this.drawRatio=this.getDrawRatio(this.backingStoreRatio,this.devicePixelRation),this.backingStoreRatio!==this.devicePixelRation?(this.element.width=e*this.drawRatio,this.element.height=r*this.drawRatio):(this.element.width=e,this.element.height=r),this.element.style.width="".concat(e,"px"),this.element.style.minWidth="".concat(e,"px"),this.element.style.height="".concat(r,"px"),this.element.style.minHeight="".concat(r,"px"),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=e,this.virtualHeight=r}clear(){this.context.clearRect(0,0,this.element.width,this.element.height)}drawTo(e,r,i){i.save(),i.scale(1/this.drawRatio,1/this.drawRatio),i.drawImage(this.element,e,r),i.restore()}attachToElement(e){e.appendChild(this.element)}get width(){return this.virtualWidth||this.element.width}get height(){return this.virtualHeight||this.element.height}get bounds(){return new _e(0,0,this.width,this.height)}get size(){return{width:this.width,height:this.height}}};var At=class{constructor(e){this.main=e;u(this,"canvas",new Mt("gui-canvas"));u(this,"isDirty",!0)}get element(){return this.canvas.element}get context(){return this.canvas.context}invalidate(){this.isDirty=!0}setup(){this.canvas.attachToElement(document.body)}setSize(e){this.canvas.setSize(e.width,e.height)}clear(){this.canvas.clear()}render(){this.isDirty&&(this.clear(),this.isDirty=!1)}};var Ze=class{constructor(e){this.gl=e;u(this,"frameBuffer");u(this,"colorTexture");u(this,"colorRenderBuffer");u(this,"colorFrameBuffer");u(this,"depthBuffer")}verifyFrameBuffer(){let e=this.gl.checkFramebufferStatus(GL.FRAMEBUFFER);if(e!==this.gl.FRAMEBUFFER_COMPLETE)throw new Error("Frame buffer is incomplete: ".concat(e))}setupFrameBuffer(){D.debug("FrameBuffer","Setting up frame buffer...");let e=this.gl.createFramebuffer();if(!e)throw new Error("Could not create frame buffer");this.frameBuffer=e,this.gl.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffer),this.setupColorRenderBuffer(),this.setupDepthBuffer(),this.verifyFrameBuffer()}setupDepthBuffer(){D.debug("FrameBuffer","Setting up depth buffer...");let e=this.gl.createRenderbuffer();if(!e)throw new Error("Could not create depth buffer");this.depthBuffer=e,this.gl.bindRenderbuffer(GL.RENDERBUFFER,this.depthBuffer),L.USE_MSAA&&this.gl.maxSamplesForMSAA>0&&this.gl instanceof WebGL2RenderingContext?this.gl.renderbufferStorageMultisample(GL.RENDERBUFFER,this.gl.maxSamplesForMSAA,WebGL2RenderingContext.DEPTH_COMPONENT24,this.gl.canvas.width,this.gl.canvas.height):this.gl.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_COMPONENT16,this.gl.canvas.width,this.gl.canvas.height),this.gl.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_ATTACHMENT,GL.RENDERBUFFER,this.depthBuffer)}setupColorRenderBuffer(){D.debug("FrameBuffer","Setting up color render buffer...");let e=this.gl.createRenderbuffer();if(!e)throw new Error("Could not create color buffer");this.colorRenderBuffer=e,this.gl.bindRenderbuffer(GL.RENDERBUFFER,this.colorRenderBuffer),L.USE_MSAA&&this.gl.maxSamplesForMSAA>0&&this.gl instanceof WebGL2RenderingContext?this.gl.renderbufferStorageMultisample(GL.RENDERBUFFER,this.gl.maxSamplesForMSAA,GL.RGBA8,this.gl.canvas.width,this.gl.canvas.height):this.gl.renderbufferStorage(GL.RENDERBUFFER,GL.RGBA8,this.gl.canvas.width,this.gl.canvas.height),this.gl.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.RENDERBUFFER,this.colorRenderBuffer)}setupColorFrameBuffer(){D.debug("FrameBuffer","Setting up color frame buffer...");let e=this.gl.createFramebuffer();if(!e)throw new Error("Could not create color frame buffer");this.colorFrameBuffer=e,this.gl.bindFramebuffer(GL.FRAMEBUFFER,this.colorFrameBuffer),this.setupColorTexture(),this.verifyFrameBuffer()}setupColorTexture(){D.debug("FrameBuffer","Setting up color texture...");let e=this.gl.createTexture();if(!e)throw new Error("Could not create texture");this.colorTexture=e,this.gl.bindTexture(GL.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,this.gl.canvas.width,this.gl.canvas.height,0,GL.RGBA,GL.UNSIGNED_BYTE,null),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE),this.gl.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,this.colorTexture,0)}resize(){D.debug("FrameBuffer","Resizing frame buffer..."),this.setupFrameBuffer(),this.setupColorFrameBuffer(),this.gl.bindFramebuffer(GL.FRAMEBUFFER,null)}bind(){this.gl.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffer)}blit(e=!1){this.gl instanceof WebGL2RenderingContext&&(this.gl.bindFramebuffer(WebGL2RenderingContext.READ_FRAMEBUFFER,this.frameBuffer),e?this.gl.bindFramebuffer(WebGL2RenderingContext.DRAW_FRAMEBUFFER,null):this.gl.bindFramebuffer(WebGL2RenderingContext.DRAW_FRAMEBUFFER,this.colorFrameBuffer),this.gl.blitFramebuffer(0,0,this.gl.canvas.width,this.gl.canvas.height,0,0,this.gl.canvas.width,this.gl.canvas.height,GL.COLOR_BUFFER_BIT,GL.NEAREST),this.gl.bindFramebuffer(WebGL2RenderingContext.READ_FRAMEBUFFER,null),this.gl.bindFramebuffer(WebGL2RenderingContext.DRAW_FRAMEBUFFER,null))}unbind(){this.gl.bindFramebuffer(GL.FRAMEBUFFER,null)}bindTexture(){this.gl.activeTexture(GL.TEXTURE0),this.gl.bindTexture(GL.TEXTURE_2D,this.colorTexture)}};var St=class{constructor(e){this.gl=e;u(this,"frameBuffer0");u(this,"frameBuffer1");u(this,"filters",[]);u(this,"pingPong",!1);this.frameBuffer0=new Ze(this.gl),this.frameBuffer1=new Ze(this.gl)}get primary(){return this.pingPong?this.frameBuffer1:this.frameBuffer0}get secondary(){return this.pingPong?this.frameBuffer0:this.frameBuffer1}addFilter(e){return U(this,null,function*(){let r=new fe(this.gl,"filter-".concat(e));yield r.setup({source:{vertex:"vertex-passthrough",fragment:"filters/".concat(e)},uniforms:["u_texture","u_depth"],buffers:{vertex:{data:se.vertices,attribute:"a_position"},uv:{data:se.textureCoordinates,attribute:"a_texcoord"},index:{data:se.indices,target:GL.ELEMENT_ARRAY_BUFFER}}}),r.bind(),r.setUniform("u_texture",0),r.bindBuffer("index",se.indices),this.filters.push(r)})}swap(){this.pingPong=!this.pingPong}bind(){this.filters.length>0&&this.primary.bind()}unbind(){this.filters.length>0&&this.primary.unbind()}resize(){this.frameBuffer0.resize(),this.frameBuffer1.resize()}bindTexture(){this.primary.bindTexture()}commit(){for(let e=0;e<this.filters.length;e++){let r=this.filters[e],i=e===this.filters.length-1;i||this.secondary.bind(),this.primary.bindTexture(),r.bind(),this.gl.drawElements(GL.TRIANGLES,se.indices.length,GL.UNSIGNED_SHORT,0),i||(this.secondary.blit(!1),this.secondary.unbind(),this.swap())}this.primary.blit(!0)}};var Tt=class{constructor(e){this.main=e;u(this,"canvas");u(this,"gl");u(this,"isDirty",!1);u(this,"frameBuffer")}invalidate(){this.isDirty=!0}setSize(e){var i;D.info("WebGLRenderer","Setting size...");let r=(i=window.devicePixelRatio)!=null?i:1;this.canvas.width=e.width*r,this.canvas.height=e.height*r,this.canvas.style.width="".concat(e.width,"px"),this.canvas.style.height="".concat(e.height,"px"),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.frameBuffer&&this.frameBuffer.resize()}setupCanvas(){var n,s;D.debug("WebGLRenderer","Creating canvas..."),this.canvas=document.createElement("canvas"),this.canvas.id="webgl-canvas";let e=L.USE_MSAA;L.USE_MSAA&&(L.FILTER_COLOR_CORRECTION_ENABLED||L.FILTER_FXAA_ENABLED||L.FILTER_SHARPEN_ENABLED)&&(D.warn("WebGLRenderer","Disabling native MSAA in favor of multisample render buffer for post-processing effects."),e=!1);let r={antialias:e,depth:!1,preserveDrawingBuffer:!0},i=(s=(n=this.canvas.getContext("webgl2",r))!=null?n:this.canvas.getContext("webgl",r))!=null?s:this.canvas.getContext("experimental-webgl",r);if(!i)throw new Error("Could not get WebGL context");this.gl=i,document.body.appendChild(this.canvas),this.gl.enable(GL.DEPTH_TEST),this.gl.depthFunc(GL.LEQUAL),this.gl.clearDepth(1),this.gl.enable(GL.CULL_FACE),this.gl.cullFace(GL.BACK),L.USE_MSAA&&(this.gl instanceof WebGL2RenderingContext?this.gl.maxSamplesForMSAA<=0?D.warn("FrameBuffer","MSAA is not supported on this device"):D.info("FrameBuffer","MSAA is supported with maximum of ".concat(this.gl.maxSamplesForMSAA," samples")):D.warn("FrameBuffer","MSAA is only supported on WebGL2"))}setupTextures(){return U(this,null,function*(){D.debug("WebGLRenderer","Setting up textures..."),yield Me.loadTerrain(this.gl)})}setupMesh(){return U(this,null,function*(){yield Ae.setup(this.gl)})}setup(){return U(this,null,function*(){D.info("WebGLRenderer","Setting up..."),this.setupCanvas(),this.frameBuffer=new St(this.gl),yield this.setupMesh(),yield this.setupTextures(),yield le.setup(this.gl),L.FILTER_FXAA_ENABLED&&(yield this.frameBuffer.addFilter("fxaa")),L.FILTER_SHARPEN_ENABLED&&(yield this.frameBuffer.addFilter("sharpen")),L.FILTER_COLOR_CORRECTION_ENABLED&&(yield this.frameBuffer.addFilter("color-correction"))})}clear(e){this.gl.clearColor(e.r,e.g,e.b,1),this.gl.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT)}drawScene(){let e=ye.decode(re.background,!0);this.clear(e);let r=this.main.camera.getProjectionMatrix(),i=this.main.camera.getViewMatrix(),n=ne.activeChunks.filter(s=>s&&s.mesh&&this.main.playerCamera.isChunkInsideFrustum(s));if(L.SORT_CHUNKS_BY_DISTANCE){let s=n.map(a=>O.distance(a.globalCenterPosition,this.main.playerCamera.position));n=n.sort((a,o)=>{let c=s[n.indexOf(a)];return s[n.indexOf(o)]-c})}for(let s of n)Oe.notifyChunkVisible(s),L.RENDER_CHUNKS&&s.render(this.gl,r,i);this.renderDebugOverlay(),L.DISABLE_DEPTH_FOR_GIZMOS&&this.gl.disable(GL.DEPTH_TEST),le.render(this.gl,r,i),le.clear(),L.DISABLE_DEPTH_FOR_GIZMOS&&this.gl.enable(GL.DEPTH_TEST)}renderDebugOverlay(){let e=P.create(),r=this.main.useDebugCamera?this.main.playerCamera:this.main.debugCamera,i=r.near,n=r.forward,s=r.up,a=r.position,o=r.getViewMatrix();P.invert(o,o);let c=O.create();O.set(c,Math.toRadians(r.pitch),Math.toRadians(r.yaw),Math.toRadians(r.roll));let l=P.create();P.rotate(l,l,r.pitch,[1,0,0]),P.rotate(l,l,r.yaw,[0,1,0]),P.rotate(l,l,r.roll,[0,0,1]),le.box(a,O.fromValues(.5,.5,.5),c,this.main.useDebugCamera?z.fromValues(1,0,0,1):z.fromValues(0,0,1,1),!1)}render(){this.isDirty&&(this.isDirty=!1,this.frameBuffer.bind(),this.drawScene(),this.frameBuffer.unbind(),this.frameBuffer.commit())}};var Ke=class{constructor(){u(this,"position",O.create());u(this,"currentPitch",0);u(this,"currentYaw",0);u(this,"currentRoll",0);u(this,"pitch",0);u(this,"yaw",0);u(this,"roll",0);u(this,"fov",Math.toRadians(45));u(this,"near",.1);u(this,"far",1e3)}get aspectRatio(){return window.innerWidth/window.innerHeight}get tiledPosition(){return new N(Math.floor((this.position[0]+X/2)/X),Math.floor((this.position[2]+X/2)/X))}get forward(){let e=O.create(),r=Math.toRadians(this.yaw),i=Math.toRadians(this.pitch),n=Math.cos(i);return e[0]=-Math.sin(r)*n,e[1]=Math.sin(i),e[2]=-Math.cos(r)*n,e}get right(){let e=O.fromValues(0,1,0),r=this.forward,i=O.create();return O.cross(i,e,r),O.normalize(i,i),i}get up(){let e=this.right,r=this.forward,i=O.create();return O.cross(i,r,e),O.normalize(i,i),i}lookAt(e){let r=O.create();O.subtract(r,e,this.position),O.normalize(r,r),this.pitch=Math.toDegrees(Math.asin(r[1])),this.yaw=Math.toDegrees(Math.atan2(-r[0],-r[2]))}normalizePlane(e){let r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return e[0]/=r,e[1]/=r,e[2]/=r,e}getFrustumPlanes(){let e=this.getViewMatrix(),r=this.getProjectionMatrix(),i=P.multiply(P.create(),r,e);return[z.fromValues(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),z.fromValues(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),z.fromValues(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),z.fromValues(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),z.fromValues(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),z.fromValues(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])].map(s=>z.normalize(z.create(),s))}isBoxInFrustum(e,r){let i=this.getFrustumPlanes(),n=O.scale(O.create(),r,.5),s=O.subtract(O.create(),e,n),a=O.add(O.create(),e,n);for(let o of i){let c=O.fromValues(o[0],o[1],o[2]),l=O.fromValues(c[0]>0?a[0]:s[0],c[1]>0?a[1]:s[1],c[2]>0?a[2]:s[2]);if(O.dot(c,l)+o[3]<0)return!1}return!0}isSphereInsideFrustum(e,r){let i=this.getFrustumPlanes();for(let n of i)if(O.dot(O.fromValues(n[0],n[1],n[2]),e)+n[3]<-r)return!1;return!0}isChunkInsideFrustum(e){let r=e.globalCenterPosition,i=0,n=O.fromValues(X,De,X);n[0]+=i,n[1]+=i,n[2]+=i,r[0]-=i/2,r[1]-=i/2,r[2]-=i/2;let s=this.isBoxInFrustum(r,n);return L.RENDER_CHUNK_BOUNDS&&(le.box(e.globalCenterPosition,n,O.fromValues(0,0,0),s?z.fromValues(0,1,0,1):z.fromValues(1,0,0,1),!1),le.box(e.globalCenterPosition,O.fromValues(1,1,1),O.fromValues(0,0,0),z.fromValues(0,0,1,1),!0)),s}update(e){this.currentPitch=Math.lerp(this.currentPitch,this.pitch,e*20),this.currentYaw=Math.lerp(this.currentYaw,this.yaw,e*20),this.currentRoll=Math.lerp(this.currentRoll,this.roll,e*20)}getViewMatrix(){let e=P.create();return P.translate(e,e,this.position),P.rotate(e,e,Math.toRadians(this.currentYaw),[0,1,0]),P.rotate(e,e,Math.toRadians(this.currentPitch),[1,0,0]),P.rotate(e,e,Math.toRadians(this.currentRoll),[0,0,1]),P.invert(e,e),e}getProjectionMatrix(){let e=P.create();return P.perspective(e,this.fov,this.aspectRatio,this.near,this.far),e}};var Or=Ft(Nt());var qe=new Worker("".concat(window.location.href,"scripts/jobs/gif.worker.js"));qe.onerror=t=>D.error("GIFUtils","Worker error",t.message);qe.onmessageerror=t=>D.error("GIFUtils","Worker message error",t.data);qe.onmessage=t=>{D.info("GIFUtils","Received message",t.data),Or.default.saveAs(t.data,"recording.zip")};var Lt=new OffscreenCanvas(1,1),Kt=Lt.getContext("2d");if(!Kt)throw new Error("Could not get context of canvas");var Je=class{static addFrame(e,r){Lt.width=e.width,Lt.height=e.height,Kt.drawImage(e,0,0),r.drawTo(0,0,Kt);let i=Lt.transferToImageBitmap();qe.postMessage({key:"add",value:i},[i])}static generate(e){return U(this,null,function*(){qe.postMessage({key:"zip"})})}};var Ct;(n=>{function t(s,a){return new Function("with(this) { return eval('"+s+"')}").call(a)}function e(s,a){let o=Math.max(s.length,a.length);return 1-(o-s.split("").reduce((l,h,f)=>l+(h===a[f]?1:0),0))/o}function r(s){return er({SETTINGS:L,set(a,o){if(a=a.toUpperCase(),L.hasOwnProperty(a)){L[a]=o;return}else{let c=Object.keys(L).map(l=>({similarity:e(a,l),key:l})).sort((l,h)=>h.similarity-l.similarity).map(l=>l.key).slice(0,3);throw new Error("Invalid setting: ".concat(a,".\nDid you mean: ").concat(c,"?"))}},reloadChunks:ne.reloadChunks.bind(this)},s)}function i(s,a={}){return new Promise((o,c)=>{try{D.debug("Interpreter","Evaluating: ".concat(s));let l=r(a),h=t(s,l);o(h)}catch(l){D.error("Interpreter",l),c(l.message)}})}n.evaluate=i})(Ct||(Ct={}));var Qe;(T=>{let t;(S=>(S.Green="rgb(172,205,112)",S.Yellow="rgb(229,196,148)",S.Blue="rgb(154, 158, 200)",S.White="rgb(189, 194, 237)",S.Gray="rgb(98, 105, 147)",S.Red="rgb(191, 97, 106)"))(t||(t={}));let e=ie*1.5,r=e*20,i=1e3,n=[],s=0,a="",o=0,c=0,l=-r,h=-r,f=!1;function m(){return{print:y=>{p(y)},clear:()=>{n.length=0}}}function p(y,w="white"){y!==void 0&&(typeof y=="object"?JSON.stringify(y,null,2).split("\n").forEach(b=>p(b,"rgb(154, 158, 200)")):y.toString().split("\n").forEach(b=>{b.length>0&&(n.push({text:b,color:w}),n.length>i&&n.shift(),s=n.length)}))}function E(y,w,v){if(k.isKeyDown("Enter")&&y.trim().length>0)k.clearInput(),p(":> ".concat(y),"rgb(98, 105, 147)"),Ct.evaluate(y,m()).then(b=>p(b,"rgb(172,205,112)")).catch(b=>p(b,"rgb(191, 97, 106)")),a="",o=0,c=0;else if(k.isKeyDown("Escape"))k.clearInput(),R(!1);else if(k.isKeyDown("ArrowUp")){let b=n.findLast(M=>M.text.startsWith(":> "));b&&(a=b.text.slice(3),o=a.length,c=o,k.setInput(a,o,c))}else a=y,o=w,c=v}function R(y){y?(h=0,k.startCapture(E.bind(this)),f=!0):(h=-r,k.releaseCapture(),f=!1)}function d(){return f}T.isVisible=d;function A(y){j.isTogglingTerminal()&&!f&&R(!0),f&&(s+=ue.mouseWheelDelta*.1,s=Math.clamp(s,0,n.length)),l=Math.lerp(l,h,10*y)}T.update=A;function x(y){if(Math.floor(l)<=-r)return;let w=1-Math.min(1,Math.abs(l)/r);y.save(),y.translate(0,l),y.fillStyle="rgba(22, 24, 31, ".concat(.75*w,")"),y.shadowBlur=20,y.shadowOffsetX=0,y.shadowOffsetY=2,y.shadowColor="rgba(0, 0, 0, ".concat(.25*w,")"),y.beginPath(),y.roundRect(0,0,y.canvas.width,r,[0,0,15,15]),y.fill();let v=oe;y.fillStyle="rgb(172,205,112)",y.font="".concat(ie,"px monospace"),y.textBaseline="top",y.textAlign="left",y.fillTextAligned("- Debug terminal -",y.canvas.width/2,v,"center"),v+=e;let b=Math.floor((r-v-oe-e)/e),M=Math.floor(Math.max(Math.min(s,n.length-b),0)),g=Math.min(n.length,M+b);for(let F=M;F<g;F++){let B=n[F];y.fillStyle=B.color,y.fillText(B.text,oe,v),v+=e}if(n.length>b){let F=Math.max(20,i/n.length*(r-v-oe)),B=Math.lerp(oe,r-oe-F,s/n.length);y.fillStyle="rgba(255, 255, 255, 0.15)",y.beginPath(),y.roundRect(y.canvas.width-oe,B,oe/2,F,10),y.fill()}v=r-oe-e,y.fillStyle="rgb(189, 194, 237)",y.fillText(">",oe,v),y.fillText(a,oe+ie,v);let S=oe+ie+y.measureText(a.slice(0,o)).width;c>o?(y.fillStyle="rgba(255, 255, 255, 0.5)",y.fillRect(S,v,y.measureText(a.slice(o,c)).width,ie)):Date.now()/1e3%.5>.25&&y.fillRect(S,v-ie*.15,2.5,ie),y.restore()}T.render=x})(Qe||(Qe={}));var et=!1,qt=class{constructor(){u(this,"screen",{width:0,height:0});u(this,"gui",new At(this));u(this,"gl",new Tt(this));u(this,"playerCamera",new Ke);u(this,"debugCamera",new Ke);u(this,"useDebugCamera",!1);u(this,"isRecording",!1);u(this,"handleAnimationFrameRequest",-1);u(this,"lastFrameTime",performance.now());u(this,"globalTimer",0);u(this,"state");D.info("Main","Starting up..."),this.state=new Rt(this),this.attachHooks()}get camera(){return this.useDebugCamera?this.debugCamera:this.playerCamera}attachHooks(){D.info("Main","Attaching hooks..."),window.addLoadEventListener(this.onLoad.bind(this)),window.addVisibilityChangeEventListener(this.onVisibilityChange.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}onLoad(){return U(this,null,function*(){try{D.debug("Main","Window loaded"),et||(yield this.gl.setup()),this.gui.setup(),this.onResize();let e=[re.setup(),Et.setup(),j.setup()];yield Promise.all(e),yield this.state.setup(),this.requestNextFrame()}catch(e){D.error("Main","Failed to load modules",e),alert("Failed to load modules. Please refresh the page.".concat(e))}})}onVisibilityChange(e){D.info("Main","Window visibility changed to ".concat(e?"visible":"hidden")),e?(this.handleAnimationFrameRequest>=0&&(nt?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest)),this.invalidate(),this.lastFrameTime=performance.now(),setTimeout(this.requestNextFrame.bind(this),0)):this.handleAnimationFrameRequest&&(nt?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest),this.handleAnimationFrameRequest=-1)}onResize(){D.debug("Main","Window resized"),this.screen={width:window.innerWidth,height:window.innerHeight},this.gui.setSize(this.screen),et||this.gl.setSize(this.screen),this.invalidate()}setState(e){this.state=e,this.state.setup(),Ee.apply(this.gui.element),this.invalidate()}invalidate(){this.gui.invalidate(),et||this.gl.invalidate()}requestNextFrame(){this.isRecording?(this.handleAnimationFrameRequest!==-1&&clearTimeout(this.handleAnimationFrameRequest),this.handleAnimationFrameRequest=setTimeout(()=>this.loop(performance.now()),1e3/Ot)):nt?this.handleAnimationFrameRequest=requestAnimationFrame(this.loop.bind(this)):this.handleAnimationFrameRequest===-1&&(this.handleAnimationFrameRequest=setInterval(()=>this.loop(performance.now()),1e3/ar))}updateRecording(e){this.isRecording&&(ee.circle(new N(this.screen.width-30,30),10,"red",!0),ee.circle(new N(this.screen.width-30,30),15,"red",!1)),j.isRecording()&&(this.isRecording?this.onStopRecording():this.onStartRecording())}onStartRecording(){D.info("Main","Recording started"),this.isRecording=!0,this.screen=sr,this.gui.setSize(this.screen),et||this.gl.setSize(this.screen),this.invalidate()}onStopRecording(){D.info("Main","Recording stopped"),this.isRecording=!1,Je.generate("recording"),this.onResize()}update(e){let r=(e-this.lastFrameTime)/1e3;this.lastFrameTime=e,Qe.update(r),this.updateRecording(r),this.isRecording&&(r=1/Ot);let i=!1,n=r/_t;for(let s=0;s<_t;s++)this.state.update(n),i||(i=!0,j.update());this.globalTimer+=r}loop(e){this.update(e),Ee.apply(this.gui.element),this.gui.render(),this.state.render(this.gui.context),et||this.gl.render(),ee.render(this.gui.context),ee.clear(),Qe.render(this.gui.context),this.isRecording&&Je.addFrame(this.gl.canvas,this.gui.canvas),this.requestNextFrame()}};new qt;})();
