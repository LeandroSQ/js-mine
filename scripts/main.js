(()=>{var Vr=Object.create;var rt=Object.defineProperty;var Br=Object.getOwnPropertyDescriptor;var zr=Object.getOwnPropertyNames,Jt=Object.getOwnPropertySymbols,$r=Object.getPrototypeOf,Qt=Object.prototype.hasOwnProperty,Wr=Object.prototype.propertyIsEnumerable;var Ce=Math.pow,It=(t,e,r)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,er=(t,e)=>{for(var r in e||(e={}))Qt.call(e,r)&&It(t,r,e[r]);if(Jt)for(var r of Jt(e))Wr.call(e,r)&&It(t,r,e[r]);return t};var tr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Dt=(t,e)=>{for(var r in e)rt(t,r,{get:e[r],enumerable:!0})},Hr=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of zr(e))!Qt.call(t,n)&&n!==r&&rt(t,n,{get:()=>e[n],enumerable:!(i=Br(e,n))||i.enumerable});return t};var Pt=(t,e,r)=>(r=t!=null?Vr($r(t)):{},Hr(e||!t||!t.__esModule?rt(r,"default",{value:t,enumerable:!0}):r,t));var u=(t,e,r)=>It(t,typeof e!="symbol"?e+"":e,r);var O=(t,e,r)=>new Promise((i,n)=>{var s=c=>{try{o(r.next(c))}catch(l){n(l)}},a=c=>{try{o(r.throw(c))}catch(l){n(l)}},o=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,a);o((r=r.apply(t,e)).next())});var Nt=tr((Gt,Ft)=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof Gt!="undefined"?e():(e(),t.FileSaver={})})(Gt,function(){"use strict";function t(o,c){return typeof c=="undefined"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function e(o,c,l){var h=new XMLHttpRequest;h.open("GET",o),h.responseType="blob",h.onload=function(){a(h.response,c,l)},h.onerror=function(){console.error("could not download file")},h.send()}function r(o){var c=new XMLHttpRequest;c.open("HEAD",o,!1);try{c.send()}catch(l){}return 200<=c.status&&299>=c.status}function i(o){try{o.dispatchEvent(new MouseEvent("click"))}catch(l){var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(c)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,s=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(o,c,l){var h=n.URL||n.webkitURL,p=document.createElement("a");c=c||o.name||"download",p.download=c,p.rel="noopener",typeof o=="string"?(p.href=o,p.origin===location.origin?i(p):r(p.href)?e(o,c,l):i(p,p.target="_blank")):(p.href=h.createObjectURL(o),setTimeout(function(){h.revokeObjectURL(p.href)},4e4),setTimeout(function(){i(p)},0))}:"msSaveOrOpenBlob"in navigator?function(o,c,l){if(c=c||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(t(o,l),c);else if(r(o))e(o,c,l);else{var h=document.createElement("a");h.href=o,h.target="_blank",setTimeout(function(){i(h)})}}:function(o,c,l,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof o=="string")return e(o,c,l);var p=o.type==="application/octet-stream",d=/constructor/i.test(n.HTMLElement)||n.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||p&&d||s)&&typeof FileReader!="undefined"){var E=new FileReader;E.onloadend=function(){var T=E.result;T=f?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=T:location=T,h=null},E.readAsDataURL(o)}else{var M=n.URL||n.webkitURL,m=M.createObjectURL(o);h?h.location=m:location.href=m,h=null,setTimeout(function(){M.revokeObjectURL(m)},4e4)}});n.saveAs=a.saveAs=a,typeof Ft!="undefined"&&(Ft.exports=a)})});var Fr=tr((zt,Gr)=>{(function(t,e){typeof zt=="object"?Gr.exports=e():typeof define=="function"&&define.amd?define(e):t.Alea=e()})(zt,function(){"use strict";return t.importState=function(r){var i=new t;return i.importState(r),i},t;function t(){return function(r){var i=0,n=0,s=0,a=1;r.length==0&&(r=[+new Date]);var o=e();i=o(" "),n=o(" "),s=o(" ");for(var c=0;c<r.length;c++)i-=o(r[c]),i<0&&(i+=1),n-=o(r[c]),n<0&&(n+=1),s-=o(r[c]),s<0&&(s+=1);o=null;var l=function(){var h=2091639*i+a*23283064365386963e-26;return i=n,n=s,s=h-(a=h|0)};return l.next=l,l.uint32=function(){return l()*4294967296},l.fract53=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.version="Alea 0.9",l.args=r,l.exportState=function(){return[i,n,s,a]},l.importState=function(h){i=+h[0]||0,n=+h[1]||0,s=+h[2]||0,a=+h[3]||0},l}(Array.prototype.slice.call(arguments))}function e(){var r=4022871197,i=function(n){n=n.toString();for(var s=0;s<n.length;s++){r+=n.charCodeAt(s);var a=.02519603282416938*r;r=a>>>0,a-=r,a*=r,r=a>>>0,a-=r,r+=a*4294967296}return(r>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})});Array.prototype.remove=function(t){let e=this.indexOf(t);return e!=-1?(this.splice(e,1),!0):!1};Array.prototype.appendArray=function(t){if(t)for(let e=0;e<t.length;e++)this.push(t[e])};Array.prototype.shuffle=function(){for(let t=this.length-1;t>0;t--){let e=Math.floor(Math.random()*(t+1));[this[t],this[e]]=[this[e],this[t]]}};var rr=Pt(Nt());HTMLCanvasElement.prototype.screenshot=function(t="download.png"){this.toBlob(e=>rr.default.saveAs(e,t))};CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderingContext2D.prototype.line=function(t,e,r,i){this.beginPath(),this.moveTo(t,e),this.lineTo(r,i),this.stroke()};CanvasRenderingContext2D.prototype.fillTextAligned=function(t,e,r,i){let n=this.measureText(t);switch(i){case"left":this.fillText(t,e,r);break;case"center":this.fillText(t,e-n.width/2,r);break;case"right":this.fillText(t,e-n.width,r);break}};CanvasRenderingContext2D.prototype.fillCircle=function(t,e,r){this.beginPath(),this.arc(t,e,r,0,Math.PI*2),this.fill()};Math.clamp=function(t,e,r){return Math.min(Math.max(t,e),r)};Math.average=function(...t){return t.reduce((e,r)=>e+r,0)/t.length};Math.distance=function(t,e,r,i){return Math.sqrt(Math.pow(r-t,2)+Math.pow(i-e,2))};Math.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};Math.lerp=function(t,e,r){return t+(e-t)*r};Math.oscilate=function(t,e,r=0,i=1){let n=2*Math.PI*e,s=i-r,o=(Math.sin(n*t)+1)/2;return r+o*s};Math.smoothstep=function(t,e=0,r=1){return t=Math.clamp((t-e)/(r-e),0,1),t*t*(3-2*t)};Math.prettifyElapsedTime=function(t){let e=(r,i)=>r%1===0?Math.floor(r):r.toFixed(i);return t<1?"".concat(Math.floor(t*1e3),"\u03BCs"):t<1e3?"".concat(e(t,2),"ms"):t<6e4?"".concat(e(t/1e3,2),"s"):t<36e5?"".concat(e(t/6e4,2),"m"):"".concat(e(t/36e5,2),"h")};Math.prettifyUnit=function(t,e=""){return t<1e3?"".concat(t).concat(e):t<1e6?"".concat((t/1e3).toFixed(2),"k").concat(e):t<1e9?"".concat((t/1e6).toFixed(2),"M").concat(e):"".concat((t/1e9).toFixed(2),"G").concat(e)};Math.toDegrees=function(t){return t*(180/Math.PI)};Math.toRadians=function(t){return t*(Math.PI/180)};Function.oneshot=function(t){let e=!1;return()=>{e||(e=!0,t())}};Function.timeout=function(t,e){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{t(),r=!1},e))}};Function.debounce=function(t,e){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{t(),r=!1},e))}};Promise.delay=function(t){return new Promise((e,r)=>{setTimeout(e,t)})};Promise.sequential=function(t){return t.reduce((e,r)=>e.then(i=>r.then(n=>(i.push(n),i))),Promise.resolve([]))};String.prototype.toCamelCase=function(){return this.replace("--","").replace(/-./g,t=>t[1].toUpperCase()).trim()};String.prototype.insertAt=function(t,e){return this.substr(0,t)+e+this.substr(t)};window.addLoadEventListener=function(t){let e=Function.oneshot(t);window.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e),document.addEventListener("load",e),window.addEventListener("ready",e),setTimeout(e,1e3)};window.addVisibilityChangeEventListener=function(t){let e=["webkit","moz","ms",""],r=Function.debounce(()=>{t(!window.isDocumentHidden())},50);e.forEach(i=>{document.addEventListener("".concat(i,"visibilitychange"),r)}),document.onvisibilitychange=r};window.isMobile=function(){return window.matchMedia("(any-pointer: coarse)").matches};window.isDocumentHidden=function(){return["webkit","moz","ms",""].map(e=>e&&e.length>0?"".concat(e,"Hidden"):"hidden").map(e=>document[e]).reduce((e,r)=>e||r,!1)};window.getRefreshRate=function(){return new Promise((t,e)=>{let r=[60,75,100,120,144,165,240,360];setTimeout(()=>{requestAnimationFrame(i=>{requestAnimationFrame(n=>{let a=1e3/(n-i),o=r.reduce((c,l)=>Math.abs(l-a)<Math.abs(c-a)?l:c);t(o)})})},10)})};performance.getUsedMemory=function(){return new Promise((t,e)=>{"measureUserAgentSpecificMemory"in performance?this.measureUserAgentSpecificMemory().then(r=>t(r.bytes)).catch(()=>t(NaN)):"memory"in performance?t(this.memory.usedJSHeapSize):t(NaN)})};var I={RENDER_DISTANCE:256,RENDER_CHUNKS:!0,SORT_CHUNKS_BY_DISTANCE:!1,TEXTURE_ATLAS_SIZE:16,TEXTURE_ATLAS_SPRITE_SIZE:16,TEXTURE_PADDING:4,ANSIOTROPIC_FILTERING:0,MSAA_SAMPLES:0,TERRAIN_GENERATION_SEED:"myseed",TERRAIN_GENERATION_ON_MAIN_THREAD:!1,TERRAIN_GENERATION_WORKER_COUNT:1,RAYCASTING_STEP:1,RAYCASTING_MAX_DISTANCE:10,RAYCASTING_USE_DDA:!0,DISABLE_DEPTH_FOR_GIZMOS:!1,RENDER_CHUNK_BOUNDS:!1,RENDER_CHUNK_WIREFRAME:!1};var D=class{static logColoredText(e,r,i,...n){console[e].call(console,"%c".concat(e.toUpperCase()," %c[").concat(r,"]"),"font-weight: bold; color: ".concat(i,";"),"font-weight: bold; color: gray",...n)}static info(e,...r){this.logColoredText("info",e,"turquoise",...r)}static warn(e,...r){this.logColoredText("warn",e,"yellow",...r)}static error(e,...r){let i=r.find(n=>n instanceof Error);i&&console.trace(i),this.logColoredText("error",e,"red",...r)}static debug(e,...r){}};GL=WebGL2RenderingContext;var ir=function(){if(I.ANSIOTROPIC_FILTERING<=0)return;let t=this.getExtension("EXT_texture_filter_anisotropic")||this.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(t){let e=this.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.texParameterf(GL.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(I.ANSIOTROPIC_FILTERING,e)),D.info("Texture","Anisotropic filtering supported, max: ".concat(e))}else D.warn("Texture","Anisotropic filtering not supported")};WebGL2RenderingContext.prototype.enableAnisotropicFiltering=ir;WebGLRenderingContext.prototype.enableAnisotropicFiltering=ir;var Ot=24,nr={width:808,height:808},sr=60,kt=1,it=!0,X=16,Ie=64,Ve=.1,_t=5,Vt=2,ce=15,ie=12,Be="'Pixelify sans', 'Ubuntu Mono', sans-serif",be=110;var F=class t{constructor(e,r=void 0){u(this,"x");u(this,"y");this.x=e,r===void 0?this.y=e:this.y=r}dot(e){return this.x*e.x+this.y*e.y}add(e){return new t(this.x+e.x,this.y+e.y)}subtract(e){return new t(this.x-e.x,this.y-e.y)}multiply(e){return new t(this.x*e,this.y*e)}divide(e){return new t(this.x/e,this.y/e)}normalize(){let e=this.length;return new t(this.x/e,this.y/e)}clone(){return new t(this.x,this.y)}static distanceSquared(e,r){return Ce(e.x-r.x,2)+Ce(e.y-r.y,2)}static distance(e,r){return Math.sqrt(this.distanceSquared(e,r))}static random(e){return new t(Math.random()*2-1,Math.random()*2-1).normalize().multiply(e)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static get zero(){return new t(0,0)}toString(){return"{ ".concat(this.x,", ").concat(this.y," }")}};var st=class st{constructor(e){this.workerName=e;u(this,"worker");this.worker=new Worker("".concat(window.location.href,"scripts/jobs/").concat(e,".worker.js")),this.worker.onmessage=this.onMessage.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.onmessageerror=this.onMessageError.bind(this)}postMessage(e){this.worker.postMessage(e)}onMessageReceived(e){}onMessage(e){st.VERBOSE&&D.debug("WorkerBinding-".concat(this.workerName),"Received message",e.data),this.onMessageReceived(e.data)}onError(e){D.error("WorkerBinding-".concat(this.workerName),"Worker error",e.message)}onMessageError(e){D.error("WorkerBinding-".concat(this.workerName),"Worker message error",e.data)}};u(st,"VERBOSE",!1);var nt=st;var z=1e-6,J=typeof Float32Array!="undefined"?Float32Array:Array,Me=Math.random;var Cs=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var U={};Dt(U,{add:()=>Ci,adjoint:()=>Qr,clone:()=>jr,copy:()=>Yr,create:()=>Xr,determinant:()=>ei,equals:()=>Gi,exactEquals:()=>Pi,frob:()=>Li,fromQuat:()=>bi,fromQuat2:()=>ui,fromRotation:()=>li,fromRotationTranslation:()=>cr,fromRotationTranslationScale:()=>gi,fromRotationTranslationScaleOrigin:()=>vi,fromScaling:()=>ci,fromTranslation:()=>oi,fromValues:()=>Zr,fromXRotation:()=>hi,fromYRotation:()=>pi,fromZRotation:()=>fi,frustum:()=>yi,getRotation:()=>mi,getScaling:()=>lr,getTranslation:()=>di,identity:()=>ar,invert:()=>Jr,lookAt:()=>Ti,mul:()=>Fi,multiply:()=>or,multiplyScalar:()=>Ii,multiplyScalarAndAdd:()=>Di,ortho:()=>Mi,orthoNO:()=>pr,orthoZO:()=>Ri,perspective:()=>xi,perspectiveFromFieldOfView:()=>wi,perspectiveNO:()=>hr,perspectiveZO:()=>Ei,rotate:()=>ii,rotateX:()=>ni,rotateY:()=>si,rotateZ:()=>ai,scale:()=>ri,set:()=>Kr,str:()=>Ai,sub:()=>Ni,subtract:()=>fr,targetTo:()=>Si,translate:()=>ti,transpose:()=>qr});function Xr(){var t=new J(16);return J!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function jr(t){var e=new J(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Yr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Zr(t,e,r,i,n,s,a,o,c,l,h,p,d,f,E,M){var m=new J(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=o,m[8]=c,m[9]=l,m[10]=h,m[11]=p,m[12]=d,m[13]=f,m[14]=E,m[15]=M,m}function Kr(t,e,r,i,n,s,a,o,c,l,h,p,d,f,E,M,m){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=l,t[9]=h,t[10]=p,t[11]=d,t[12]=f,t[13]=E,t[14]=M,t[15]=m,t}function ar(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qr(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],s=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Jr(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],c=e[6],l=e[7],h=e[8],p=e[9],d=e[10],f=e[11],E=e[12],M=e[13],m=e[14],T=e[15],y=r*o-i*a,A=r*c-n*a,x=r*l-s*a,w=i*c-n*o,v=i*l-s*o,b=n*l-s*c,R=h*M-p*E,g=h*m-d*E,S=h*T-f*E,P=p*m-d*M,V=p*T-f*M,$=d*T-f*m,k=y*$-A*V+x*P+w*S-v*g+b*R;return k?(k=1/k,t[0]=(o*$-c*V+l*P)*k,t[1]=(n*V-i*$-s*P)*k,t[2]=(M*b-m*v+T*w)*k,t[3]=(d*v-p*b-f*w)*k,t[4]=(c*S-a*$-l*g)*k,t[5]=(r*$-n*S+s*g)*k,t[6]=(m*x-E*b-T*A)*k,t[7]=(h*b-d*x+f*A)*k,t[8]=(a*V-o*S+l*R)*k,t[9]=(i*S-r*V-s*R)*k,t[10]=(E*v-M*x+T*y)*k,t[11]=(p*x-h*v-f*y)*k,t[12]=(o*g-a*P-c*R)*k,t[13]=(r*P-i*g+n*R)*k,t[14]=(M*A-E*w-m*y)*k,t[15]=(h*w-p*A+d*y)*k,t):null}function Qr(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],c=e[6],l=e[7],h=e[8],p=e[9],d=e[10],f=e[11],E=e[12],M=e[13],m=e[14],T=e[15];return t[0]=o*(d*T-f*m)-p*(c*T-l*m)+M*(c*f-l*d),t[1]=-(i*(d*T-f*m)-p*(n*T-s*m)+M*(n*f-s*d)),t[2]=i*(c*T-l*m)-o*(n*T-s*m)+M*(n*l-s*c),t[3]=-(i*(c*f-l*d)-o*(n*f-s*d)+p*(n*l-s*c)),t[4]=-(a*(d*T-f*m)-h*(c*T-l*m)+E*(c*f-l*d)),t[5]=r*(d*T-f*m)-h*(n*T-s*m)+E*(n*f-s*d),t[6]=-(r*(c*T-l*m)-a*(n*T-s*m)+E*(n*l-s*c)),t[7]=r*(c*f-l*d)-a*(n*f-s*d)+h*(n*l-s*c),t[8]=a*(p*T-f*M)-h*(o*T-l*M)+E*(o*f-l*p),t[9]=-(r*(p*T-f*M)-h*(i*T-s*M)+E*(i*f-s*p)),t[10]=r*(o*T-l*M)-a*(i*T-s*M)+E*(i*l-s*o),t[11]=-(r*(o*f-l*p)-a*(i*f-s*p)+h*(i*l-s*o)),t[12]=-(a*(p*m-d*M)-h*(o*m-c*M)+E*(o*d-c*p)),t[13]=r*(p*m-d*M)-h*(i*m-n*M)+E*(i*d-n*p),t[14]=-(r*(o*m-c*M)-a*(i*m-n*M)+E*(i*c-n*o)),t[15]=r*(o*d-c*p)-a*(i*d-n*p)+h*(i*c-n*o),t}function ei(t){var e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],o=t[6],c=t[7],l=t[8],h=t[9],p=t[10],d=t[11],f=t[12],E=t[13],M=t[14],m=t[15],T=e*a-r*s,y=e*o-i*s,A=e*c-n*s,x=r*o-i*a,w=r*c-n*a,v=i*c-n*o,b=l*E-h*f,R=l*M-p*f,g=l*m-d*f,S=h*M-p*E,P=h*m-d*E,V=p*m-d*M;return T*V-y*P+A*S+x*g-w*R+v*b}function or(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],p=e[8],d=e[9],f=e[10],E=e[11],M=e[12],m=e[13],T=e[14],y=e[15],A=r[0],x=r[1],w=r[2],v=r[3];return t[0]=A*i+x*o+w*p+v*M,t[1]=A*n+x*c+w*d+v*m,t[2]=A*s+x*l+w*f+v*T,t[3]=A*a+x*h+w*E+v*y,A=r[4],x=r[5],w=r[6],v=r[7],t[4]=A*i+x*o+w*p+v*M,t[5]=A*n+x*c+w*d+v*m,t[6]=A*s+x*l+w*f+v*T,t[7]=A*a+x*h+w*E+v*y,A=r[8],x=r[9],w=r[10],v=r[11],t[8]=A*i+x*o+w*p+v*M,t[9]=A*n+x*c+w*d+v*m,t[10]=A*s+x*l+w*f+v*T,t[11]=A*a+x*h+w*E+v*y,A=r[12],x=r[13],w=r[14],v=r[15],t[12]=A*i+x*o+w*p+v*M,t[13]=A*n+x*c+w*d+v*m,t[14]=A*s+x*l+w*f+v*T,t[15]=A*a+x*h+w*E+v*y,t}function ti(t,e,r){var i=r[0],n=r[1],s=r[2],a,o,c,l,h,p,d,f,E,M,m,T;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15]):(a=e[0],o=e[1],c=e[2],l=e[3],h=e[4],p=e[5],d=e[6],f=e[7],E=e[8],M=e[9],m=e[10],T=e[11],t[0]=a,t[1]=o,t[2]=c,t[3]=l,t[4]=h,t[5]=p,t[6]=d,t[7]=f,t[8]=E,t[9]=M,t[10]=m,t[11]=T,t[12]=a*i+h*n+E*s+e[12],t[13]=o*i+p*n+M*s+e[13],t[14]=c*i+d*n+m*s+e[14],t[15]=l*i+f*n+T*s+e[15]),t}function ri(t,e,r){var i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ii(t,e,r,i){var n=i[0],s=i[1],a=i[2],o=Math.hypot(n,s,a),c,l,h,p,d,f,E,M,m,T,y,A,x,w,v,b,R,g,S,P,V,$,k,q;return o<z?null:(o=1/o,n*=o,s*=o,a*=o,c=Math.sin(r),l=Math.cos(r),h=1-l,p=e[0],d=e[1],f=e[2],E=e[3],M=e[4],m=e[5],T=e[6],y=e[7],A=e[8],x=e[9],w=e[10],v=e[11],b=n*n*h+l,R=s*n*h+a*c,g=a*n*h-s*c,S=n*s*h-a*c,P=s*s*h+l,V=a*s*h+n*c,$=n*a*h+s*c,k=s*a*h-n*c,q=a*a*h+l,t[0]=p*b+M*R+A*g,t[1]=d*b+m*R+x*g,t[2]=f*b+T*R+w*g,t[3]=E*b+y*R+v*g,t[4]=p*S+M*P+A*V,t[5]=d*S+m*P+x*V,t[6]=f*S+T*P+w*V,t[7]=E*S+y*P+v*V,t[8]=p*$+M*k+A*q,t[9]=d*$+m*k+x*q,t[10]=f*$+T*k+w*q,t[11]=E*$+y*k+v*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ni(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[4],a=e[5],o=e[6],c=e[7],l=e[8],h=e[9],p=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+l*i,t[5]=a*n+h*i,t[6]=o*n+p*i,t[7]=c*n+d*i,t[8]=l*n-s*i,t[9]=h*n-a*i,t[10]=p*n-o*i,t[11]=d*n-c*i,t}function si(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],c=e[3],l=e[8],h=e[9],p=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-l*i,t[1]=a*n-h*i,t[2]=o*n-p*i,t[3]=c*n-d*i,t[8]=s*i+l*n,t[9]=a*i+h*n,t[10]=o*i+p*n,t[11]=c*i+d*n,t}function ai(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],c=e[3],l=e[4],h=e[5],p=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+l*i,t[1]=a*n+h*i,t[2]=o*n+p*i,t[3]=c*n+d*i,t[4]=l*n-s*i,t[5]=h*n-a*i,t[6]=p*n-o*i,t[7]=d*n-c*i,t}function oi(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ci(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function li(t,e,r){var i=r[0],n=r[1],s=r[2],a=Math.hypot(i,n,s),o,c,l;return a<z?null:(a=1/a,i*=a,n*=a,s*=a,o=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=i*i*l+c,t[1]=n*i*l+s*o,t[2]=s*i*l-n*o,t[3]=0,t[4]=i*n*l-s*o,t[5]=n*n*l+c,t[6]=s*n*l+i*o,t[7]=0,t[8]=i*s*l+n*o,t[9]=n*s*l-i*o,t[10]=s*s*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function hi(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pi(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fi(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cr(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3],o=i+i,c=n+n,l=s+s,h=i*o,p=i*c,d=i*l,f=n*c,E=n*l,M=s*l,m=a*o,T=a*c,y=a*l;return t[0]=1-(f+M),t[1]=p+y,t[2]=d-T,t[3]=0,t[4]=p-y,t[5]=1-(h+M),t[6]=E+m,t[7]=0,t[8]=d+T,t[9]=E-m,t[10]=1-(h+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function ui(t,e){var r=new J(3),i=-e[0],n=-e[1],s=-e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],p=i*i+n*n+s*s+a*a;return p>0?(r[0]=(o*a+h*i+c*s-l*n)*2/p,r[1]=(c*a+h*n+l*i-o*s)*2/p,r[2]=(l*a+h*s+o*n-c*i)*2/p):(r[0]=(o*a+h*i+c*s-l*n)*2,r[1]=(c*a+h*n+l*i-o*s)*2,r[2]=(l*a+h*s+o*n-c*i)*2),cr(t,e,r),t}function di(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function lr(t,e){var r=e[0],i=e[1],n=e[2],s=e[4],a=e[5],o=e[6],c=e[8],l=e[9],h=e[10];return t[0]=Math.hypot(r,i,n),t[1]=Math.hypot(s,a,o),t[2]=Math.hypot(c,l,h),t}function mi(t,e){var r=new J(3);lr(r,e);var i=1/r[0],n=1/r[1],s=1/r[2],a=e[0]*i,o=e[1]*n,c=e[2]*s,l=e[4]*i,h=e[5]*n,p=e[6]*s,d=e[8]*i,f=e[9]*n,E=e[10]*s,M=a+h+E,m=0;return M>0?(m=Math.sqrt(M+1)*2,t[3]=.25*m,t[0]=(p-f)/m,t[1]=(d-c)/m,t[2]=(o-l)/m):a>h&&a>E?(m=Math.sqrt(1+a-h-E)*2,t[3]=(p-f)/m,t[0]=.25*m,t[1]=(o+l)/m,t[2]=(d+c)/m):h>E?(m=Math.sqrt(1+h-a-E)*2,t[3]=(d-c)/m,t[0]=(o+l)/m,t[1]=.25*m,t[2]=(p+f)/m):(m=Math.sqrt(1+E-a-h)*2,t[3]=(o-l)/m,t[0]=(d+c)/m,t[1]=(p+f)/m,t[2]=.25*m),t}function gi(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=e[3],c=n+n,l=s+s,h=a+a,p=n*c,d=n*l,f=n*h,E=s*l,M=s*h,m=a*h,T=o*c,y=o*l,A=o*h,x=i[0],w=i[1],v=i[2];return t[0]=(1-(E+m))*x,t[1]=(d+A)*x,t[2]=(f-y)*x,t[3]=0,t[4]=(d-A)*w,t[5]=(1-(p+m))*w,t[6]=(M+T)*w,t[7]=0,t[8]=(f+y)*v,t[9]=(M-T)*v,t[10]=(1-(p+E))*v,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function vi(t,e,r,i,n){var s=e[0],a=e[1],o=e[2],c=e[3],l=s+s,h=a+a,p=o+o,d=s*l,f=s*h,E=s*p,M=a*h,m=a*p,T=o*p,y=c*l,A=c*h,x=c*p,w=i[0],v=i[1],b=i[2],R=n[0],g=n[1],S=n[2],P=(1-(M+T))*w,V=(f+x)*w,$=(E-A)*w,k=(f-x)*v,q=(1-(d+T))*v,Ae=(m+y)*v,Le=(E+A)*b,et=(m-y)*b,tt=(1-(d+M))*b;return t[0]=P,t[1]=V,t[2]=$,t[3]=0,t[4]=k,t[5]=q,t[6]=Ae,t[7]=0,t[8]=Le,t[9]=et,t[10]=tt,t[11]=0,t[12]=r[0]+R-(P*R+k*g+Le*S),t[13]=r[1]+g-(V*R+q*g+et*S),t[14]=r[2]+S-($*R+Ae*g+tt*S),t[15]=1,t}function bi(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,o=i+i,c=n+n,l=r*a,h=i*a,p=i*o,d=n*a,f=n*o,E=n*c,M=s*a,m=s*o,T=s*c;return t[0]=1-p-E,t[1]=h+T,t[2]=d-m,t[3]=0,t[4]=h-T,t[5]=1-l-E,t[6]=f+M,t[7]=0,t[8]=d+m,t[9]=f-M,t[10]=1-l-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yi(t,e,r,i,n,s,a){var o=1/(r-e),c=1/(n-i),l=1/(s-a);return t[0]=s*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(n+i)*c,t[10]=(a+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*l,t[15]=0,t}function hr(t,e,r,i,n){var s=1/Math.tan(e/2),a;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(a=1/(i-n),t[10]=(n+i)*a,t[14]=2*n*i*a):(t[10]=-1,t[14]=-2*i),t}var xi=hr;function Ei(t,e,r,i,n){var s=1/Math.tan(e/2),a;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(a=1/(i-n),t[10]=n*a,t[14]=n*i*a):(t[10]=-1,t[14]=-i),t}function wi(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),l=2/(n+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((a-o)*c*.5),t[9]=(n-s)*l*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function pr(t,e,r,i,n,s,a){var o=1/(e-r),c=1/(i-n),l=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*c,t[14]=(a+s)*l,t[15]=1,t}var Mi=pr;function Ri(t,e,r,i,n,s,a){var o=1/(e-r),c=1/(i-n),l=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*c,t[14]=s*l,t[15]=1,t}function Ti(t,e,r,i){var n,s,a,o,c,l,h,p,d,f,E=e[0],M=e[1],m=e[2],T=i[0],y=i[1],A=i[2],x=r[0],w=r[1],v=r[2];return Math.abs(E-x)<z&&Math.abs(M-w)<z&&Math.abs(m-v)<z?ar(t):(h=E-x,p=M-w,d=m-v,f=1/Math.hypot(h,p,d),h*=f,p*=f,d*=f,n=y*d-A*p,s=A*h-T*d,a=T*p-y*h,f=Math.hypot(n,s,a),f?(f=1/f,n*=f,s*=f,a*=f):(n=0,s=0,a=0),o=p*a-d*s,c=d*n-h*a,l=h*s-p*n,f=Math.hypot(o,c,l),f?(f=1/f,o*=f,c*=f,l*=f):(o=0,c=0,l=0),t[0]=n,t[1]=o,t[2]=h,t[3]=0,t[4]=s,t[5]=c,t[6]=p,t[7]=0,t[8]=a,t[9]=l,t[10]=d,t[11]=0,t[12]=-(n*E+s*M+a*m),t[13]=-(o*E+c*M+l*m),t[14]=-(h*E+p*M+d*m),t[15]=1,t)}function Si(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=i[0],c=i[1],l=i[2],h=n-r[0],p=s-r[1],d=a-r[2],f=h*h+p*p+d*d;f>0&&(f=1/Math.sqrt(f),h*=f,p*=f,d*=f);var E=c*d-l*p,M=l*h-o*d,m=o*p-c*h;return f=E*E+M*M+m*m,f>0&&(f=1/Math.sqrt(f),E*=f,M*=f,m*=f),t[0]=E,t[1]=M,t[2]=m,t[3]=0,t[4]=p*m-d*M,t[5]=d*E-h*m,t[6]=h*M-p*E,t[7]=0,t[8]=h,t[9]=p,t[10]=d,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t}function Ai(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Li(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ci(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function fr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Ii(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Di(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function Pi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Gi(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8],p=t[9],d=t[10],f=t[11],E=t[12],M=t[13],m=t[14],T=t[15],y=e[0],A=e[1],x=e[2],w=e[3],v=e[4],b=e[5],R=e[6],g=e[7],S=e[8],P=e[9],V=e[10],$=e[11],k=e[12],q=e[13],Ae=e[14],Le=e[15];return Math.abs(r-y)<=z*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-A)<=z*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(n-x)<=z*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-w)<=z*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-v)<=z*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-b)<=z*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(c-R)<=z*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(l-g)<=z*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(h-S)<=z*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(p-P)<=z*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(d-V)<=z*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(f-$)<=z*Math.max(1,Math.abs(f),Math.abs($))&&Math.abs(E-k)<=z*Math.max(1,Math.abs(E),Math.abs(k))&&Math.abs(M-q)<=z*Math.max(1,Math.abs(M),Math.abs(q))&&Math.abs(m-Ae)<=z*Math.max(1,Math.abs(m),Math.abs(Ae))&&Math.abs(T-Le)<=z*Math.max(1,Math.abs(T),Math.abs(Le))}var Fi=or,Ni=fr;var N={};Dt(N,{add:()=>Vi,angle:()=>ln,bezier:()=>en,ceil:()=>Bi,clone:()=>Ui,copy:()=>ki,create:()=>ur,cross:()=>qi,dist:()=>vn,distance:()=>br,div:()=>gn,divide:()=>vr,dot:()=>Er,equals:()=>un,exactEquals:()=>fn,floor:()=>zi,forEach:()=>En,fromValues:()=>Oi,hermite:()=>Qi,inverse:()=>Zi,len:()=>yn,length:()=>dr,lerp:()=>Ji,max:()=>Wi,min:()=>$i,mul:()=>mn,multiply:()=>gr,negate:()=>Yi,normalize:()=>Ki,random:()=>tn,rotateX:()=>an,rotateY:()=>on,rotateZ:()=>cn,round:()=>Hi,scale:()=>Xi,scaleAndAdd:()=>ji,set:()=>_i,sqrDist:()=>bn,sqrLen:()=>xn,squaredDistance:()=>yr,squaredLength:()=>xr,str:()=>pn,sub:()=>dn,subtract:()=>mr,transformMat3:()=>nn,transformMat4:()=>rn,transformQuat:()=>sn,zero:()=>hn});function ur(){var t=new J(3);return J!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ui(t){var e=new J(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function dr(t){var e=t[0],r=t[1],i=t[2];return Math.hypot(e,r,i)}function Oi(t,e,r){var i=new J(3);return i[0]=t,i[1]=e,i[2]=r,i}function ki(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function _i(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function Vi(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function mr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function gr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function vr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Bi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function zi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function $i(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Wi(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Hi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Xi(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function ji(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function br(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.hypot(r,i,n)}function yr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function xr(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Yi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Zi(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ki(t,e){var r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Er(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function qi(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],c=r[2];return t[0]=n*c-s*o,t[1]=s*a-i*c,t[2]=i*o-n*a,t}function Ji(t,e,r,i){var n=e[0],s=e[1],a=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t}function Qi(t,e,r,i,n,s){var a=s*s,o=a*(2*s-3)+1,c=a*(s-2)+s,l=a*(s-1),h=a*(3-2*s);return t[0]=e[0]*o+r[0]*c+i[0]*l+n[0]*h,t[1]=e[1]*o+r[1]*c+i[1]*l+n[1]*h,t[2]=e[2]*o+r[2]*c+i[2]*l+n[2]*h,t}function en(t,e,r,i,n,s){var a=1-s,o=a*a,c=s*s,l=o*a,h=3*s*o,p=3*c*a,d=c*s;return t[0]=e[0]*l+r[0]*h+i[0]*p+n[0]*d,t[1]=e[1]*l+r[1]*h+i[1]*p+n[1]*d,t[2]=e[2]*l+r[2]*h+i[2]*p+n[2]*d,t}function tn(t,e){e=e||1;var r=Me()*2*Math.PI,i=Me()*2-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function rn(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,t}function nn(t,e,r){var i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function sn(t,e,r){var i=r[0],n=r[1],s=r[2],a=r[3],o=e[0],c=e[1],l=e[2],h=n*l-s*c,p=s*o-i*l,d=i*c-n*o,f=n*d-s*p,E=s*h-i*d,M=i*p-n*h,m=a*2;return h*=m,p*=m,d*=m,f*=2,E*=2,M*=2,t[0]=o+h+f,t[1]=c+p+E,t[2]=l+d+M,t}function an(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function on(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function cn(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function ln(t,e){var r=t[0],i=t[1],n=t[2],s=e[0],a=e[1],o=e[2],c=Math.sqrt(r*r+i*i+n*n),l=Math.sqrt(s*s+a*a+o*o),h=c*l,p=h&&Er(t,e)/h;return Math.acos(Math.min(Math.max(p,-1),1))}function hn(t){return t[0]=0,t[1]=0,t[2]=0,t}function pn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function fn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function un(t,e){var r=t[0],i=t[1],n=t[2],s=e[0],a=e[1],o=e[2];return Math.abs(r-s)<=z*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=z*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=z*Math.max(1,Math.abs(n),Math.abs(o))}var dn=mr,mn=gr,gn=vr,vn=br,bn=yr,yn=dr,xn=xr,En=function(){var t=ur();return function(e,r,i,n,s,a){var o,c;for(r||(r=3),i||(i=0),n?c=Math.min(n*r+i,e.length):c=e.length,o=i;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}();var B={};Dt(B,{add:()=>Sn,ceil:()=>An,clone:()=>wn,copy:()=>Rn,create:()=>wr,cross:()=>kn,dist:()=>Kn,distance:()=>Sr,div:()=>Zn,divide:()=>Tr,dot:()=>On,equals:()=>Xn,exactEquals:()=>Hn,floor:()=>Ln,forEach:()=>es,fromValues:()=>Mn,inverse:()=>Nn,len:()=>Jn,length:()=>Lr,lerp:()=>_n,max:()=>In,min:()=>Cn,mul:()=>Yn,multiply:()=>Rr,negate:()=>Fn,normalize:()=>Un,random:()=>Vn,round:()=>Dn,scale:()=>Pn,scaleAndAdd:()=>Gn,set:()=>Tn,sqrDist:()=>qn,sqrLen:()=>Qn,squaredDistance:()=>Ar,squaredLength:()=>Cr,str:()=>Wn,sub:()=>jn,subtract:()=>Mr,transformMat4:()=>Bn,transformQuat:()=>zn,zero:()=>$n});function wr(){var t=new J(4);return J!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function wn(t){var e=new J(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Mn(t,e,r,i){var n=new J(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Rn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Tn(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function Sn(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Mr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Rr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Tr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function An(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Ln(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Cn(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function In(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Dn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Pn(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Gn(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function Sr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.hypot(r,i,n,s)}function Ar(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function Lr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.hypot(e,r,i,n)}function Cr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Fn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Nn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Un(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=s*a,t}function On(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function kn(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],c=r[1]*i[3]-r[3]*i[1],l=r[2]*i[3]-r[3]*i[2],h=e[0],p=e[1],d=e[2],f=e[3];return t[0]=p*l-d*c+f*o,t[1]=-(h*l)+d*a-f*s,t[2]=h*c-p*a+f*n,t[3]=-(h*o)+p*s-d*n,t}function _n(t,e,r,i){var n=e[0],s=e[1],a=e[2],o=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t[3]=o+i*(r[3]-o),t}function Vn(t,e){e=e||1;var r,i,n,s,a,o;do r=Me()*2-1,i=Me()*2-1,a=r*r+i*i;while(a>=1);do n=Me()*2-1,s=Me()*2-1,o=n*n+s*s;while(o>=1);var c=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*i,t[2]=e*n*c,t[3]=e*s*c,t}function Bn(t,e,r){var i=e[0],n=e[1],s=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,t}function zn(t,e,r){var i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],c=r[2],l=r[3],h=l*i+o*s-c*n,p=l*n+c*i-a*s,d=l*s+a*n-o*i,f=-a*i-o*n-c*s;return t[0]=h*l+f*-a+p*-c-d*-o,t[1]=p*l+f*-o+d*-a-h*-c,t[2]=d*l+f*-c+h*-o-p*-a,t[3]=e[3],t}function $n(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Wn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Hn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Xn(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],a=e[0],o=e[1],c=e[2],l=e[3];return Math.abs(r-a)<=z*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=z*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-c)<=z*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-l)<=z*Math.max(1,Math.abs(s),Math.abs(l))}var jn=Mr,Yn=Rr,Zn=Tr,Kn=Sr,qn=Ar,Jn=Lr,Qn=Cr,es=function(){var t=wr();return function(e,r,i,n,s,a){var o,c;for(r||(r=4),i||(i=0),n?c=Math.min(n*r+i,e.length):c=e.length,o=i;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}();var Q=class t{constructor(e,r=void 0,i=void 0){u(this,"x");u(this,"y");u(this,"z");this.x=e,r===void 0?this.y=e:this.y=r,i===void 0?this.z=e:this.z=i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}add(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)}subtract(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)}multiply(e){return new t(this.x*e,this.y*e,this.z*e)}divide(e){if(e===0)throw new Error("Cannot divide by zero.");return new t(this.x/e,this.y/e,this.z/e)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let e=this.length;return new t(this.x/e,this.y/e,this.z/e)}clone(){return new t(this.x,this.y,this.z)}toArray(){return[this.x,this.y,this.z]}toMatrixVec3(){return N.fromValues(this.x,this.y,this.z)}static distance(e,r){return Math.sqrt(Ce(e.x-r.x,2)+Ce(e.y-r.y,2)+Ce(e.z-r.z,2))}static random(e){return new t(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize().multiply(e)}static get zero(){return new t(0,0,0)}static get up(){return new t(0,1,0)}static get down(){return new t(0,-1,0)}static get left(){return new t(-1,0,0)}static get right(){return new t(1,0,0)}static get forward(){return new t(0,0,1)}static get back(){return new t(0,0,-1)}toString(){return"{ ".concat(this.x,", ").concat(this.y,", ").concat(this.z," }")}};var Ne=class{constructor(e,r,i=null){this.localPosition=e;this.voxels=r;this.mesh=i}get globalPosition(){return N.fromValues(this.localPosition.x*X,0,this.localPosition.y*X)}get globalCenterPosition(){return N.fromValues(this.localPosition.x*X+X/2,0,this.localPosition.y*X+X/2)}getVoxelAt(e,r,i){return this.voxels.get(e,r,i)}getVoxelAtGlobalPosition(e,r,i){if(e instanceof Q)return this.getVoxelAtGlobalPosition(e.x,e.y,e.z);if(r===void 0||i===void 0)throw new Error("Invalid arguments");let n=this.globalPosition,s=e-n[0],a=i-n[2];return this.voxels.get(s,r,a)}render(e,r,i){var n;(n=this.mesh)==null||n.render(e,this.globalPosition,r,i)}};var ze=class{static load(e){return O(this,null,function*(){try{if(this.cache.has(e))return D.debug("FileUtils","Loading file from cache: ".concat(e)),this.cache.get(e);D.debug("FileUtils","Loading file: ".concat(e));let r=yield fetch("".concat(window.location.href).concat(e));if(!r.ok)throw new Error("Failed to load file: ".concat(e));let i=yield r.text();return this.cache.set(e,i),i}catch(r){throw D.error("FileUtils","Failed to load file: ".concat(e),r),r}})}};u(ze,"cache",new Map);var Re=class Re{constructor(e,r){this.gl=e;this.name=r;u(this,"program",null);u(this,"buffers",{});u(this,"attributes",{});u(this,"uniforms",{})}preprocessShader(e){let r=e.indexOf("#version");return r=e.indexOf("\n",r)+1,Re.SPLIT&&(e=e.insertAt(r,"\n#define SPLIT\n")),e}loadShader(e,r){return O(this,null,function*(){if(D.info("Shader-".concat(this.name),"Loading shader: ".concat(r,"...")),Re.cache.has(r))return D.debug("Shader-".concat(this.name),"Shader cached!"),Re.cache.get(r);let i=this.preprocessShader(yield ze.load("shaders/".concat(r,".glsl"))),n=this.gl.createShader(e);if(!n)throw new Error("Could not create shader");if(D.debug("Shader-".concat(this.name),"Compiling shader: ".concat(r,"...")),this.gl.shaderSource(n,i),this.gl.compileShader(n),!this.gl.getShaderParameter(n,GL.COMPILE_STATUS)){let s=this.gl.getShaderInfoLog(n);throw this.gl.deleteShader(n),new Error("Could not compile '".concat(r,"' for shader '").concat(this.name,"': ").concat(s))}return Re.cache.set(r,n),n})}setup(e){return O(this,null,function*(){yield this.setupProgram(e.source.vertex,e.source.fragment),this.setupAttributes(e),this.setupUniforms(e.uniforms),this.setupBuffers(e.buffers)})}setupProgram(e,r){return O(this,null,function*(){D.info("Shader-".concat(this.name),"Loading shader...");let i=yield this.loadShader(GL.VERTEX_SHADER,e),n=yield this.loadShader(GL.FRAGMENT_SHADER,r);D.debug("Shader-".concat(this.name),"Linking shader program...");let s=this.gl.createProgram();if(!s)throw new Error("Could not create shader program for shader '".concat(this.name,"'"));if(this.gl.attachShader(s,i),this.gl.attachShader(s,n),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,GL.LINK_STATUS)){let a=this.gl.getProgramInfoLog(s);throw this.gl.deleteProgram(s),new Error("Could not link shader program for shader '".concat(this.name,"': ").concat(a))}this.program=s})}setupAttributes(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let r=[];e.attributes&&r.push(...e.attributes),Object.values(e.buffers).map(i=>typeof i=="object"?i.attribute:null).filter(i=>i).forEach(i=>r.push(i)),this.attributes={};for(let i of r){if(this.attributes.hasOwnProperty(i))continue;let n=this.gl.getAttribLocation(this.program,i);if(n===-1)throw new Error("Could not find attribute '".concat(i,"' on shader '").concat(this.name,"'"));this.attributes[i]=n}}setupUniforms(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let r=this.gl.getProgramParameter(this.program,GL.ACTIVE_UNIFORMS);if(!r)throw new Error("Could not get active uniforms for shader '".concat(this.name,"'"));this.uniforms={};for(let i=0;i<r;i++){let n=this.gl.getActiveUniform(this.program,i);if(!n)throw new Error("Could not get active uniform '".concat(i,"' on shader '").concat(this.name,"'"));let s=this.gl.getUniformLocation(this.program,n.name);if(!s)throw new Error("Could not get location of uniform '".concat(n.name,"' on shader '").concat(this.name,"'"));if(!e.includes(n.name))throw Error("Uniform '".concat(n.name,"' is not being used on shader '").concat(this.name,"'"));this.uniforms[n.name]={location:s,type:n.type}}for(let i of e)if(!this.uniforms.hasOwnProperty(i))throw new Error("Could not find uniform '".concat(i,"' on shader '").concat(this.name,"'"))}setupBuffers(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));this.buffers={};for(let r in e){if(!e.hasOwnProperty(r))continue;let i=e[r],n=this.gl.createBuffer();if(!n)throw new Error("Could not create buffer");let s=GL.ARRAY_BUFFER,a=GL.STATIC_DRAW,o=null,c=r,l=null;if(typeof i=="object"){let h=i;h.attribute&&(c=h.attribute),h.target&&(s=h.target),h.usage&&(a=h.usage),h.data&&(i=h.data)}if(i instanceof Float32Array||i instanceof Uint16Array||i instanceof Uint8Array||i instanceof Int16Array||i instanceof Int8Array||i instanceof Uint32Array||i instanceof Int32Array?l=i:typeof i=="function"&&(o=i),this.gl.bindBuffer(s,n),l&&(o||(o=l.constructor),this.gl.bufferData(s,l,a)),!o)throw new Error("Could not determine buffer data type for buffer '".concat(r,"' on shader '").concat(this.name,"'"));this.buffers[r]={buffer:n,type:o,attribute:c,target:s,usage:a}}}bindBuffer(e,r=null){let i=this.buffers[e];if(!i)throw new Error("Could not find buffer '".concat(e,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(i.target,i.buffer),r&&this.gl.bufferData(i.target,r,i.usage)}setUniform(e,r){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let i=this.uniforms[e];if(!i)throw new Error("Could not find uniform '".concat(e,"' on shader '").concat(this.name,"'"));switch(i.type){case GL.FLOAT:this.gl.uniform1f(i.location,r);break;case GL.FLOAT_VEC2:this.gl.uniform2fv(i.location,r);break;case GL.FLOAT_VEC3:this.gl.uniform3fv(i.location,r);break;case GL.FLOAT_VEC4:this.gl.uniform4fv(i.location,r);break;case GL.FLOAT_MAT4:this.gl.uniformMatrix4fv(i.location,!1,r);break;case GL.SAMPLER_2D:this.gl.uniform1i(i.location,r);break;default:throw new Error("Uniform type '".concat(i.type,"' not supported"))}}extractAttributeInfo(e,r){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let i=this.gl.getActiveAttrib(this.program,r);if(!i)throw new Error("Could not get attribute info for '".concat(e,"' on shader '").concat(this.name,"'"));let n={[GL.FLOAT]:1,[GL.FLOAT_VEC2]:2,[GL.FLOAT_VEC3]:3,[GL.FLOAT_VEC4]:4}[i.type];return{type:{[GL.FLOAT]:GL.FLOAT,[GL.FLOAT_VEC2]:GL.FLOAT,[GL.FLOAT_VEC3]:GL.FLOAT,[GL.FLOAT_VEC4]:GL.FLOAT}[i.type],size:n}}bind(){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));for(let e in this.attributes){if(!this.attributes.hasOwnProperty(e))continue;let r=this.attributes[e],i=Object.values(this.buffers).find(a=>a.attribute===e);if(!i)throw new Error("Could not find buffer '".concat(e,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(i.target,i.buffer);let{type:n,size:s}=this.extractAttributeInfo(e,r);this.gl.vertexAttribPointer(r,s,n,!1,0,0),this.gl.enableVertexAttribArray(r)}this.gl.useProgram(this.program)}};u(Re,"SPLIT",!1),u(Re,"cache",new Map);var pe=Re;var Ue=class{static applyPadding(e){let r=e.height/I.TEXTURE_ATLAS_SIZE,i=e.width/I.TEXTURE_ATLAS_SIZE,n=I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING*2,s=I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING*2,a=document.createElement("canvas");a.width=n*i,a.height=s*r;let o=a.getContext("2d");if(!o)throw new Error("Could not get 2D context");o.imageSmoothingEnabled=!1;for(let c=0;c<r;c++)for(let l=0;l<i;l++){let h=l*I.TEXTURE_ATLAS_SPRITE_SIZE,p=c*I.TEXTURE_ATLAS_SPRITE_SIZE;o.drawImage(e,h,p,I.TEXTURE_ATLAS_SPRITE_SIZE,1,l*n,c*s,I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING*2,I.TEXTURE_PADDING),o.drawImage(e,h,p+I.TEXTURE_ATLAS_SPRITE_SIZE-1,I.TEXTURE_ATLAS_SPRITE_SIZE,1,l*n,c*s+I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING,I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING*2,I.TEXTURE_PADDING),o.drawImage(e,h,p,1,I.TEXTURE_ATLAS_SPRITE_SIZE,l*n,c*s,I.TEXTURE_PADDING,I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING*2),o.drawImage(e,h+I.TEXTURE_ATLAS_SPRITE_SIZE-1,p,1,I.TEXTURE_ATLAS_SPRITE_SIZE,l*n+I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING,c*s,I.TEXTURE_PADDING,I.TEXTURE_ATLAS_SPRITE_SIZE+I.TEXTURE_PADDING*2),o.drawImage(e,h,p,I.TEXTURE_ATLAS_SPRITE_SIZE,I.TEXTURE_ATLAS_SPRITE_SIZE,l*n+I.TEXTURE_PADDING,c*s+I.TEXTURE_PADDING,I.TEXTURE_ATLAS_SPRITE_SIZE,I.TEXTURE_ATLAS_SPRITE_SIZE)}return a}static load(e,r=null){return new Promise((i,n)=>{if(this.cache.has(e)){let a=this.cache.get(e);if(a===void 0)throw new Error("Unexpected undefined value in cache");return i(a)}let s=new Image;s.src="".concat(window.location.href,"assets/images/").concat(e,".png"),s.crossOrigin="anonymous",s.style.display="none",s.id="image-".concat(e),r&&(s.width=r.width,s.height=r.height),s.onerror=a=>{D.error("ImageUtils","Failed to load image: ".concat(e),a.toString()),n(a)},s.onload=()=>{this.cache.set(e,s),i(s)}})}static get(e){if(!this.cache.has(e))return null;let r=this.cache.get(e);if(r===void 0)throw new Error("Unexpected undefined value in cache");return r}};u(Ue,"cache",new Map);var De=class De{constructor(e){this.gl=e;u(this,"texture",null)}static loadTerrain(e){return O(this,null,function*(){De.terrain||(De.terrain=new De(e),yield De.terrain.load("terrain",!0,!0))})}load(e,r=!0,i=!1){return O(this,null,function*(){let n=yield Ue.load(e);i&&(n=Ue.applyPadding(n));let s=this.gl.createTexture();if(!s)throw new Error("Could not create texture for '".concat(e,"'"));this.texture=s,this.gl.bindTexture(GL.TEXTURE_2D,s),this.gl.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,GL.RGBA,GL.UNSIGNED_BYTE,n),r?(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.NEAREST),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.NEAREST)):(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR)),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE)})}bind(){this.gl.activeTexture(GL.TEXTURE0),this.gl.bindTexture(GL.TEXTURE_2D,this.texture)}};u(De,"terrain");var me=De;var at=class at{constructor(e,r,i,n){this.vertices=e;this.uvs=r;this.normals=i;this.indices=n}get vertexCount(){return this.vertices.length/3}get triangleCount(){return this.indices.length/3}get shader(){return at.shader}render(e,r,i,n){this.shader.bind(),me.terrain.bind();let s=U.create();U.translate(s,s,r),U.multiply(s,n,s),this.shader.setUniform("u_modelView",s),this.shader.setUniform("u_projection",i),this.shader.setUniform("u_texture",0),this.shader.bindBuffer("vertex",this.vertices),this.shader.bindBuffer("uv",this.uvs),this.shader.bindBuffer("index",this.indices),this.shader.bindBuffer("normal",this.normals),e.drawElements(GL.TRIANGLES,this.indices.length,GL.UNSIGNED_SHORT,0)}static setup(e){return O(this,null,function*(){me.terrain||(me.terrain=new me(e),yield me.terrain.load("terrain")),this.shader=new pe(e,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:Float32Array,attribute:"a_position"},uv:{data:Float32Array,attribute:"a_texcoord"},normal:{data:Float32Array,attribute:"a_normal"},index:{data:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}};u(at,"shader");var Te=at;var Se=class t{constructor(e){u(this,"data");e?this.data=e:this.data=new Uint8Array(this.width*this.height*this.depth)}get width(){return X}get depth(){return X}get height(){return Ie}get(e,r,i){return e instanceof Q?this.get(e.x,e.y,e.z):e<0||e>=this.width||r<0||r>=this.height||i<0||i>=this.depth?null:this.data[e+r*this.width+i*this.width*this.height]}set(e,r,i,n){if(e instanceof Q)return this.set(e.x,e.y,e.z,r);if(e<0||e>=this.width||r<0||r>=this.height||i<0||i>=this.depth)return null;this.data[e+r*this.width+i*this.width*this.height]=n}static pack(e){return e.data}static unpack(e){return new t(e)}};var ot=class extends nt{constructor(){super("terrain")}generateChunkTerrain(e,r){this.postMessage({type:"terrain",data:{x:e,z:r}})}generateChunkMesh(e,r,i,n,s=0){let a=Se.pack(i.voxels),o=n.map(c=>c?{voxels:Se.pack(c.voxels),x:c.localPosition.x,z:c.localPosition.y}:null);this.postMessage({type:"mesh",data:{chunk:{x:e,z:r,voxels:a},neighbors:o,depth:s}})}generateBatch(e){for(let r of e)this.generateChunkTerrain(r.x,r.y)}onMessageReceived(e){switch(e.type){case"terrain":{let r=e.data,i=new Ne(new F(r.x,r.z),Se.unpack(r.voxels),null);ne.loadChunkTerrain(i);break}case"mesh":{let r=e.data;Object.setPrototypeOf(r.mesh,Te.prototype),ne.loadChunkMesh(r.x,r.z,r.mesh,r.depth);break}default:D.error("TerrainGeneratorBinding","Unknown message type",e.type);break}}};var Pe=(a=>(a[a.Up=0]="Up",a[a.Down=1]="Down",a[a.West=2]="West",a[a.East=3]="East",a[a.North=4]="North",a[a.South=5]="South",a))(Pe||{});(e=>{function t(r){switch(r){case 0:return Q.up;case 1:return Q.down;case 2:return Q.left;case 3:return Q.right;case 4:return Q.forward;case 5:return Q.back}}e.toVector=t})(Pe||(Pe={}));function Ge(t,e){return(e+1)*16+t}var le=(o=>(o[o.Dirt=Ge(2,0)]="Dirt",o[o.Grass=Ge(0,0)]="Grass",o[o.GrassSide=Ge(3,0)]="GrassSide",o[o.DiamondOre=Ge(2,3)]="DiamondOre",o[o.Stone=Ge(1,0)]="Stone",o[o.Sand=Ge(2,1)]="Sand",o[o.Snow=Ge(2,4)]="Snow",o))(le||{});(e=>{function t(r){let i=I.TEXTURE_ATLAS_SIZE,n=I.TEXTURE_ATLAS_SPRITE_SIZE,s=I.TEXTURE_PADDING,a=Math.floor(r/i),o=r%i,c=0,l=0;s>0&&(c=s/(i*n),l=s/(i*n));let h=o/i+c,p=(i-a)/i+l,d=(o+1)/i-c,f=(i-a+1)/i-l;return[h,p,d,p,d,f,h,f].map(E=>Math.clamp(E,0,1))}e.toUV=t})(le||(le={}));var Fe=(a=>(a[a.Air=0]="Air",a[a.Dirt=1]="Dirt",a[a.Grass=2]="Grass",a[a.Sand=3]="Sand",a[a.Stone=4]="Stone",a[a.Snow=5]="Snow",a))(Fe||{});(e=>{function t(r,i){let n;switch(r){case 1:n=le.Dirt;break;case 2:switch(i){case 0:n=le.Grass;break;case 1:n=le.Dirt;break;default:n=le.GrassSide;break}break;case 3:n=le.Sand;break;case 4:n=le.Stone;break;case 5:n=le.Snow;break}return le.toUV(n)}e.toUV=t})(Fe||(Fe={}));var ts=.5*(Math.sqrt(3)-1),$e=(3-Math.sqrt(3))/6,Ta=1/3,Sa=1/6,Aa=(Math.sqrt(5)-1)/4,La=(5-Math.sqrt(5))/20,Ir=t=>Math.floor(t)|0,Dr=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Pr(t=Math.random){let e=rs(t),r=new Float64Array(e).map(n=>Dr[n%12*2]),i=new Float64Array(e).map(n=>Dr[n%12*2+1]);return function(s,a){let o=0,c=0,l=0,h=(s+a)*ts,p=Ir(s+h),d=Ir(a+h),f=(p+d)*$e,E=p-f,M=d-f,m=s-E,T=a-M,y,A;m>T?(y=1,A=0):(y=0,A=1);let x=m-y+$e,w=T-A+$e,v=m-1+2*$e,b=T-1+2*$e,R=p&255,g=d&255,S=.5-m*m-T*T;if(S>=0){let $=R+e[g],k=r[$],q=i[$];S*=S,o=S*S*(k*m+q*T)}let P=.5-x*x-w*w;if(P>=0){let $=R+y+e[g+A],k=r[$],q=i[$];P*=P,c=P*P*(k*x+q*w)}let V=.5-v*v-b*b;if(V>=0){let $=R+1+e[g+1],k=r[$],q=i[$];V*=V,l=V*V*(k*v+q*b)}return 70*(o+c+l)}}function rs(t){let r=new Uint8Array(512);for(let i=0;i<512/2;i++)r[i]=i;for(let i=0;i<512/2-1;i++){let n=i+~~(t()*(256-i)),s=r[i];r[i]=r[n],r[n]=s}for(let i=256;i<512;i++)r[i]=r[i-256];return r}var Nr=Pt(Fr());var ye=class{constructor(e,r,i,n,s){this.scale=i;this.min=n;this.max=s;u(this,"generators");this.generators=[];for(let a=0;a<r;a++)this.generators.push(Pr((0,Nr.default)(I.TERRAIN_GENERATION_SEED+e+a)))}get(e,r){let i=0,n=1,s=1,a=0;for(let o of this.generators)i+=o(e/this.scale*s,r/this.scale*s)*n,a+=n,n/=2,s*=2;return i=(i/a+1)/2,i*(this.max-this.min)+this.min}};var ct;(c=>{let t={0:new ye("altitude-plains",4,100,0,1),1:new ye("altitude-desert",4,100,0,1),3:new ye("altitude-mountains",4,100,0,1),2:new ye("altitude-snow",4,100,0,1)},e=new ye("moisture",1,500,0,100),r=new ye("temperature",1,1e3,20,50);function i(l,h){let p=e.get(l,h),d=r.get(l,h);return d<25?2:p>80&&d>25?3:d>30&&p<40?1:0}function n(l,h,p){let d=t[p].get(l,h),f=0,E=0;switch(p){case 1:f=4,E=7;break;case 3:f=4,E=32;break;case 2:f=4,E=15;break;case 0:f=4,E=12;break;default:throw new Error("Unknown biome: ".concat(p))}return d*(E-f)+f}function s(l,h,p,d,f){let E=n(l,h,p),M=n(l,h,d);return f=Math.max(0,Math.min(1,f)),f=Math.floor(f*10)/10,E*f+M*(1-f)}function a(l,h,p,d,f){if(h===0||h<3&&Math.random()<=.9)return 4;if(h>d)return 0;switch(f){case 0:return h>=d-1?2:1;case 1:return 3;case 3:return h>d*.9?5:h<d/2?4:1;case 2:return 5}}function o(l){let h=new Se;for(let p=0;p<X;p++)for(let d=0;d<X;d++){let f=p+Math.ceil(l.x*X),E=d+Math.ceil(l.y*X),M=i(f,E),m=n(f,E,M);for(let T=0;T<=m;T++){let y=a(p,T,d,m,M);h.set(p,T,d,y)}}return new Ne(l,h)}c.generateChunkVoxels=o})(ct||(ct={}));var lt=class{constructor(e,r,i,n,s,a){this.gl=e;this.position=r;this.vertices=i;this.uvs=n;this.normals=s;this.indices=a;u(this,"shader")}setup(){return O(this,null,function*(){this.shader=new pe(this.gl,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:this.vertices,attribute:"a_position"},uv:{data:this.uvs,attribute:"a_texcoord"},normal:{data:this.normals,attribute:"a_normal"},index:{data:this.indices,target:GL.ELEMENT_ARRAY_BUFFER}}})})}render(e,r){this.shader.bind(),me.terrain.bind();let i=U.create();U.translate(i,i,this.position.toMatrixVec3()),U.multiply(i,r,i),this.shader.setUniform("u_modelView",i),this.shader.setUniform("u_projection",e),this.shader.setUniform("u_texture",0),this.shader.bindBuffer("index",this.indices),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0)}};var G=class G extends lt{constructor(r,i,n,s){let a=[n,n,i,s,n,n].map(G.getUV).flat();super(r,G.vertices,new Float32Array(a),G.normals,G.indices);this.topFace=i;this.sideFace=n;this.bottomFace=s}};u(G,"frontFaceVertices",[-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]),u(G,"backFaceVertices",[.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5]),u(G,"topFaceVertices",[-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5]),u(G,"bottomFaceVertices",[-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5]),u(G,"rightFaceVertices",[.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5]),u(G,"leftFaceVertices",[-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5]),u(G,"vertices",new Float32Array([...G.frontFaceVertices,...G.backFaceVertices,...G.topFaceVertices,...G.bottomFaceVertices,...G.rightFaceVertices,...G.leftFaceVertices])),u(G,"frontFaceIndices",[0,1,2,0,2,3]),u(G,"backFaceIndices",[4,5,6,4,6,7]),u(G,"topFaceIndices",[8,9,10,8,10,11]),u(G,"bottomFaceIndices",[12,13,14,12,14,15]),u(G,"rightFaceIndices",[16,17,18,16,18,19]),u(G,"leftFaceIndices",[20,21,22,20,22,23]),u(G,"indices",new Uint16Array([...G.frontFaceIndices,...G.backFaceIndices,...G.topFaceIndices,...G.bottomFaceIndices,...G.rightFaceIndices,...G.leftFaceIndices])),u(G,"frontFaceNormals",[0,0,1,0,0,1,0,0,1,0,0,1]),u(G,"backFaceNormals",[0,0,-1,0,0,-1,0,0,-1,0,0,-1]),u(G,"topFaceNormals",[0,1,0,0,1,0,0,1,0,0,1,0]),u(G,"bottomFaceNormals",[0,-1,0,0,-1,0,0,-1,0,0,-1,0]),u(G,"rightFaceNormals",[1,0,0,1,0,0,1,0,0,1,0,0]),u(G,"leftFaceNormals",[-1,0,0,-1,0,0,-1,0,0,-1,0,0]),u(G,"normals",new Float32Array([...G.frontFaceNormals,...G.backFaceNormals,...G.topFaceNormals,...G.bottomFaceNormals,...G.rightFaceNormals,...G.leftFaceNormals]));var K=G;var is=[0,1,2,0,2,3],ht=class{constructor(){u(this,"vertices",[]);u(this,"normals",[]);u(this,"uvs",[]);u(this,"indices",[])}addQuad(e,r,i,n){this.normals.push(...i),this.uvs.push(...n);let s=this.vertices.length/3;this.indices.push(...is.map(a=>a+s)),this.vertices.push(...r.map((a,o)=>a+e[o%3]))}build(e){return new Te(new Float32Array(this.vertices),new Float32Array(this.uvs),new Float32Array(this.normals),new Uint16Array(this.indices))}};var pt=class{constructor(e,r,i,n,s,a){this.position=e;this.chunk=r;this.westNeighbor=i;this.eastNeighbor=n;this.northNeighbor=s;this.southNeighbor=a;u(this,"builder",new ht)}generateMesh(){for(let e=0;e<X;e++)for(let r=0;r<Ie;r++)for(let i=0;i<X;i++){let n=this.chunk.getVoxelAt(e,r,i);if(!n)continue;let s=new Q(e,r,i);r<Ie&&this.addFace(s,0,n),r>0&&this.addFace(s,1,n),this.addFace(s,2,n),this.addFace(s,3,n),this.addFace(s,4,n),this.addFace(s,5,n)}this.chunk.mesh=this.builder.build(this.position)}decodeFace(e){switch(e){case 0:return{vertices:K.topFaceVertices,normals:K.topFaceNormals};case 1:return{vertices:K.bottomFaceVertices,normals:K.bottomFaceNormals};case 2:return{vertices:K.leftFaceVertices,normals:K.leftFaceNormals};case 3:return{vertices:K.rightFaceVertices,normals:K.rightFaceNormals};case 4:return{vertices:K.frontFaceVertices,normals:K.frontFaceNormals};case 5:return{vertices:K.backFaceVertices,normals:K.backFaceNormals};default:throw new Error("Invalid direction")}}addFace(e,r,i){if(this.isFaceObstructed(e,r))return;let{vertices:s,normals:a}=this.decodeFace(r),o=Fe.toUV(i,r);this.builder.addQuad(e.toArray(),s,a,o)}getNeighbor(e){switch(e){case 3:return this.eastNeighbor;case 2:return this.westNeighbor;case 4:return this.northNeighbor;case 5:return this.southNeighbor;default:return null}}isFaceObstructed(e,r){let i=e.add(Pe.toVector(r));if(this.chunk.getVoxelAt(i))return!0;let s=this.getNeighbor(r);if(!s)return!1;let a=new Q(this.position.x*X,0,this.position.y*X).add(i);return!!s.getVoxelAtGlobalPosition(a)}};var se=class{};u(se,"vertices",new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,1,0])),u(se,"indices",new Uint16Array([0,1,2,0,2,3])),u(se,"textureCoordinates",new Float32Array([0,0,0,1,1,1,1,0]));var He=class{constructor(e,r,i){this.name=e;this.vertices=r;this.indices=i;u(this,"shader")}setup(e){return O(this,null,function*(){var r,i;this.shader=new pe(e,"gizmo-"+this.name),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:(r=this.vertices)!=null?r:Float32Array,attribute:"a_position"},index:{data:(i=this.indices)!=null?i:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}bind(e,r,i,n,s){this.shader.bind(),this.shader.setUniform("u_color",r),this.shader.setUniform("u_model",i),this.shader.setUniform("u_view",n),this.shader.setUniform("u_projection",s),this.shader.bindBuffer("index")}},xe=class xe{constructor(e,r,i,n,s){this.position=e;this.size=r;this.rotation=i;this.color=n;this.fill=s;u(this,"modelMatrix",U.create());u(this,"vertices");U.translate(this.modelMatrix,this.modelMatrix,this.position),U.scale(this.modelMatrix,this.modelMatrix,this.size),U.rotateX(this.modelMatrix,this.modelMatrix,this.rotation[0]),U.rotateY(this.modelMatrix,this.modelMatrix,this.rotation[1]),U.rotateZ(this.modelMatrix,this.modelMatrix,this.rotation[2]),this.fill||(this.vertices=new Float32Array(xe.outlineVertices))}static setup(e){return O(this,null,function*(){this.mesh=new He("box",K.vertices,K.indices),yield this.mesh.setup(e)})}render(e,r,i){xe.mesh.bind(e,this.color,this.modelMatrix,i,r),this.fill?(xe.mesh.shader.bindBuffer("vertex",K.vertices),e.drawElements(GL.TRIANGLES,xe.mesh.indices.length,GL.UNSIGNED_SHORT,0)):(xe.mesh.shader.bindBuffer("vertex",this.vertices),e.drawArrays(this.fill?GL.TRIANGLES:GL.LINE_LOOP,0,this.vertices.length/3))}};u(xe,"outlineVertices",new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5])),u(xe,"mesh");var ft=xe,We=class We{constructor(e,r,i,n){this.position=e;this.size=r;this.color=i;this.fill=n;u(this,"modelMatrix",U.create());U.translate(this.modelMatrix,this.modelMatrix,this.position),U.scale(this.modelMatrix,this.modelMatrix,this.size)}static setup(e){return O(this,null,function*(){this.mesh=new He("quad",se.vertices,se.indices),yield this.mesh.setup(e)})}render(e,r,i){We.mesh.bind(e,this.color,this.modelMatrix,i,r),e.drawElements(this.fill?GL.TRIANGLES:GL.LINE_LOOP,We.mesh.indices.length,GL.UNSIGNED_SHORT,0)}};u(We,"mesh");var ut=We,vt=class vt{constructor(e,r,i){this.color=r;this.fill=i;u(this,"modelMatrix",U.create());u(this,"vertices");u(this,"indices");let n=e.getViewMatrix(),s=e.getProjectionMatrix(),a=U.multiply(U.create(),s,n),o=U.invert(U.create(),a),l=[B.fromValues(-1,-1,-1,1),B.fromValues(1,-1,-1,1),B.fromValues(1,1,-1,1),B.fromValues(-1,1,-1,1),B.fromValues(-1,-1,1,1),B.fromValues(1,-1,1,1),B.fromValues(1,1,1,1),B.fromValues(-1,1,1,1)].map(h=>{let p=B.transformMat4(B.create(),h,o);return B.scale(p,p,1/p[3]),p});this.vertices=new Float32Array([...l[0],...l[1],...l[2],...l[3],...l[4],...l[5],...l[6],...l[7]]),this.indices=new Uint16Array([0,1,2,2,3,0,4,5,6,6,7,4,0,1,5,5,4,0,2,3,7,7,6,2,0,3,7,7,4,0,1,2,6,6,5,1])}static setup(e){return O(this,null,function*(){this.shader=new pe(e,"gizmo-"+this.name),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:Float32Array,attribute:"a_position"},index:{data:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}render(e,r,i){let n=vt.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),n.bindBuffer("index",this.indices),e.drawElements(this.fill?GL.TRIANGLES:GL.LINE_LOOP,this.indices.length,GL.UNSIGNED_SHORT,0)}};u(vt,"shader");var dt=vt,bt=class bt{constructor(e,r,i){this.start=e;this.end=r;this.color=i;u(this,"modelMatrix",U.create());u(this,"vertices");this.vertices=new Float32Array([...this.start,...this.end])}static setup(e){return O(this,null,function*(){this.shader=new pe(e,"gizmo-line"),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:Float32Array,attribute:"a_position"}}})})}render(e,r,i){let n=bt.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),e.drawArrays(GL.LINES,0,this.vertices.length/3)}};u(bt,"shader");var mt=bt,yt=class yt{constructor(e,r,i,n,s){this.position=e;this.radius=r;this.color=i;this.fill=s;u(this,"modelMatrix",U.create());u(this,"vertices");U.translate(this.modelMatrix,this.modelMatrix,this.position);let a=[];for(let o=0;o<=n;o++){let c=o/n*Math.PI;for(let l=0;l<=n;l++){let h=l/n*2*Math.PI,p=this.radius*Math.sin(c)*Math.cos(h),d=this.radius*Math.sin(c)*Math.sin(h),f=this.radius*Math.cos(c);a.push(p,d,f)}}this.vertices=new Float32Array(a)}static setup(e){return O(this,null,function*(){this.mesh=new He("sphere"),yield this.mesh.setup(e)})}render(e,r,i){let n=yt.mesh.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),e.drawArrays(this.fill?GL.TRIANGLES:GL.LINE_STRIP,0,this.vertices.length/3)}};u(yt,"mesh");var gt=yt,ae=class{static setup(e){return O(this,null,function*(){})}static render(e,r,i){}static clear(){}static box(e,r,i,n,s=!1){}static quad(e,r,i,n=!1){}static frustum(e,r,i=!1){}static line(e,r,i){}static sphere(e,r,i,n=32,s=!1){}};u(ae,"list",[]);var ne;(T=>{let t=Array.from({length:I.TERRAIN_GENERATION_WORKER_COUNT},()=>new ot),e=0,r={},i={};T.loadedChunkCount=0,T.chunks={},T.activeChunks=[];function o(y=!1){return t[e++%t.length]}function c(y,A){return"".concat(y,"|").concat(A)}function l(y){if(I.TERRAIN_GENERATION_ON_MAIN_THREAD)for(let A of y){let x=ct.generateChunkVoxels(A);new pt(A,x,null,null,null,null).generateMesh(),T.loadChunkTerrain(x),T.loadChunkMesh(A.x,A.y,x.mesh)}else for(let A=0;A<y.length;A++){let x=y[A];o().generateChunkTerrain(x.x,x.y)}}function h(y){for(let A of T.activeChunks)y.includes(A)||(delete T.chunks[c(A.localPosition.x,A.localPosition.y)],T.loadedChunkCount--)}function p(){for(let y in T.chunks)delete T.chunks[y];T.activeChunks=[],T.loadedChunkCount=0;for(let y in r)delete r[y];for(let y in i)delete i[y]}T.reloadChunks=p;function d(y){let A=I.RENDER_DISTANCE/2,x=[],w=[];for(let v=y.x-A;v<y.x+A;v++)for(let b=y.y-A;b<y.y+A;b++){let R=new F(v,b),g=F.distanceSquared(y,R);if(g<A){let S=c(v,b);T.chunks.hasOwnProperty(S)?x.push(T.chunks[S]):r.hasOwnProperty(S)||(r[S]=R,w.push({position:R,distance:g}))}}w.sort((v,b)=>v.distance-b.distance),h(x),l(w.map(v=>v.position)),T.activeChunks=x}T.updateActiveChunks=d;function f(y){let A=c(y.x,y.y);return T.chunks[A]}T.getChunk=f;function E(y){return[f(new F(y.x,y.y-1)),f(new F(y.x+1,y.y)),f(new F(y.x,y.y+1)),f(new F(y.x-1,y.y))]}T.getNeighboringChunks=E;function M(y){let A=c(y.localPosition.x,y.localPosition.y);T.chunks[A]=y,delete r[A],I.TERRAIN_GENERATION_ON_MAIN_THREAD||o(!0).generateChunkMesh(y.localPosition.x,y.localPosition.y,y,E(y.localPosition))}T.loadChunkTerrain=M;function m(y,A,x,w=0){xt.notifyChunkUpdate();let v=c(y,A);if(delete i[v],T.chunks.hasOwnProperty(v)){if(w<1){let R=E(new F(y,A));for(let g of R)if(g){let S=c(g.localPosition.x,g.localPosition.y);i.hasOwnProperty(S)||(i[S]=T.chunks[v],o(!0).generateChunkMesh(g.localPosition.x,g.localPosition.y,g,E(g.localPosition),w+1))}}T.chunks[v].mesh=x,T.loadedChunkCount++;let b=T.chunks[v].globalCenterPosition;b[1]=14,ae.sphere(b,1,B.fromValues(1,1,1,1))}}T.loadChunkMesh=m})(ne||(ne={}));var Ee=class{static decode(e,r=!1){if(e.startsWith("rgba")){let[i,n,s,a]=e.slice(5,-1).split(",").map(o=>parseFloat(o));return{r:i,g:n,b:s,a}}else if(e.startsWith("rgb")){let[i,n,s]=e.slice(4,-1).split(",").map(a=>parseInt(a));return{r:i,g:n,b:s,a:1}}else{let i=e;i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=parseInt(i.slice(0,2),16),s=parseInt(i.slice(2,4),16),a=parseInt(i.slice(4,6),16);return r?{r:n/255,g:s/255,b:a/255,a:1}:{r:n,g:s,b:a,a:1}}}static mix(e,r,i){let n=this.decode(e),s=this.decode(r),a=Math.floor(n.r+(s.r-n.r)*i),o=Math.floor(n.g+(s.g-n.g)*i),c=Math.floor(n.b+(s.b-n.b)*i),l=n.a+(s.a-n.a)*i;return"rgba(".concat(a,",").concat(o,",").concat(c,",").concat(Math.clamp(Math.abs(l),0,1),")")}static alpha(e,r){let i=e;if(i.startsWith("rgba")){let s=i.slice(5,-1).split(",");return s[3]="".concat(r),"rgba(".concat(s.join(","),")")}i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=Math.round(r*255).toString(16).padStart(2,"0");return"#".concat(i).concat(n)}static interpolate(e,r,i){if(e.startsWith("rgba")){let y=e.slice(5,-1).split(",").map(R=>parseInt(R)),A=r.slice(5,-1).split(",").map(R=>parseInt(R)),x=Math.round(y[0]+(A[0]-y[0])*i),w=Math.round(y[1]+(A[1]-y[1])*i),v=Math.round(y[2]+(A[2]-y[2])*i),b=y[3]+(A[3]-y[3])*i;return"rgba(".concat(x,",").concat(w,",").concat(v,",").concat(b,")")}let n="0x".concat(e.trim().slice(1)),s="0x".concat(r.trim().slice(1));n.length<5&&(n=n.replace(/./g,"$&$&")),s.length<5&&(s=s.replace(/./g,"$&$&"));let a=parseInt(n,16),o=parseInt(s,16),c=a>>16,l=a>>8&255,h=a&255,p=o>>16,d=o>>8&255,f=o&255,E=Math.round(c+(p-c)*i),M=Math.round(l+(d-l)*i),m=Math.round(h+(f-h)*i);return"#".concat((16777216+(E<<16)+(M<<8)+m).toString(16).slice(1))}static isColorLight(e){let r="0x".concat(e.trim().slice(1));r.length<5&&(r=r.replace(/./g,"$&$&"));let i=parseInt(r,16),n=i>>16,s=i>>8&255,a=i&255;return Math.sqrt(.299*(n*n)+.587*(s*s)+.114*(a*a))>127.5}};var fe=class fe{static get isDark(){return window.matchMedia("(prefers-color-scheme: dark)").matches}static setup(){return O(this,null,function*(){fe.loadVariables(),fe.observeChanges()})}static loadVariables(){let e=["--background","--foreground","--secondary","--container-background","--container-border","--container-shadow"];D.info("Theme","Setting up theme, loading ".concat(e.length," variables...")),console.groupCollapsed("Loading theme variables");let r=getComputedStyle(document.body);for(let i of e){let n=r.getPropertyValue(i),s=i.toString().toCamelCase();fe[s]=n,console.log("%c".concat(s),"color: ".concat(Ee.isColorLight(n)?"#212121":"#eee","; background-color: ").concat(n))}console.groupEnd()}static observeChanges(){let e=window.matchMedia("(prefers-color-scheme: dark)");e.addEventListener("change",()=>{D.info("Theme","Changed theme to ".concat(e.matches?"dark":"light")),fe.loadVariables()})}};u(fe,"background"),u(fe,"foreground"),u(fe,"secondary"),u(fe,"containerBackground"),u(fe,"containerBorder"),u(fe,"containerShadow");var re=fe;var xt;(as=>{let n=ie*1.25,s=250,a=60,o=0,c=0,l=0,h=0,p=0,d=0,f=[],E=1,M=1e3/a,m=0,T=0,y=0,A=0,x=0,w=0,v=0,b=0;function R(){return O(this,null,function*(){try{a=yield window.getRefreshRate(),D.info("Analytics","Target FPS: ".concat(a))}catch(C){D.warn("Analytics","Failed to get refresh rate, defaulting to 60 FPS")}})}as.setup=R;function g(C){var Y,W,H,de;T++,y+=(W=(Y=C.mesh)==null?void 0:Y.vertexCount)!=null?W:0,A+=(de=(H=C.mesh)==null?void 0:H.triangleCount)!=null?de:0}as.notifyChunkVisible=g;function S(){v++}as.notifyChunkUpdate=S;function P(){x++}as.notifyRaycast=P;function V(C=performance.now()){o=C,T=0,y=0,A=0,x=0}as.startFrame=V;function $(C){c+=C,c>=1&&(c-=1,p=l,l=0,d=h,h=0,b=v,v=0,performance.getUsedMemory().then(Y=>m=Y)),E=Math.lerp(E,M,C*4)}as.update=$;function k(){h++}as.endUpdate=k;function q(){let C=performance.now()-o;l++,f.push(C),f.length>s&&f.shift()}as.endFrame=q;function Ae(){let C=1e3/a,Y=0,W=0,H=0;for(let oe of f)oe>Y&&(Y=oe),W+=oe,H=oe;let de=W/f.length;M=Y;let te=f.slice().sort((oe,he)=>oe-he),ge=Math.floor(te.length*.01),ve=ge>=0&&ge<te.length?Math.round(1e3/te[ge]):0;return{average:de,max:Y,last:H,reference:C,fps1Low:ve}}function Le(C,Y,W){function H(de){let te=de.split(/([a-zA-Z 0-9\%]+:)/g),ge=0;for(let ve=0;ve<te.length;ve++){let oe=te[ve];if(oe.length<=0)continue;let he=oe.includes(":");C.fillStyle=he?re.secondary:re.foreground,C.font="".concat(he?"bold":"normal"," ").concat(ie,"px ").concat(Be),C.fillText(oe,W.x+ge,W.y),ge+=C.measureText(oe).width}W.y+=n}W.x=25,W.y=25,C.font="bold ".concat(ie,"px ").concat(Be),C.textBaseline="top",C.fillStyle=re.secondary,C.textAlign="center",C.fillText("- Analytics -",W.x+230/2,W.y),W.y+=n+15/2,C.fillStyle=re.foreground,C.textAlign="left",H("FPS: ".concat(p," real / ").concat(Math.floor(1e3/Y.max)," max est.")),H("Average: ".concat(Math.prettifyElapsedTime(Y.average)," | Max: ").concat(Math.prettifyElapsedTime(Y.max))),H("1% Low: ".concat(Y.fps1Low," | Last: ").concat(Math.prettifyElapsedTime(Y.last))),H("UPS: ".concat(d)),H("Chunks: ".concat(T,"/").concat(Math.prettifyUnit(ne.activeChunks.length)," | ").concat(Math.prettifyUnit(ne.loadedChunkCount)," loaded")),H("Chunk updates: ".concat(b)),H("Vertices: ".concat(Math.prettifyUnit(y))),H("Triangles: ".concat(Math.prettifyUnit(A))),H("Ray casts: ".concat(Math.prettifyUnit(w))),isNaN(m)||H("Memory usage: ".concat(Math.prettifyUnit(m,"B"))),W.y+=n}function et(C,Y,W){if(f.length<2)return;let H=50,de=240+15*2,te=10,ge=de/(s-1);C.save(),C.beginPath(),C.roundRect(te,W.y,de,H,[0,0,10,10]),C.clip();let ve=C.createLinearGradient(te,W.y,te,W.y+H);ve.addColorStop(.25,"#ef5777"),ve.addColorStop(1,"#f53b57"),C.fillStyle=ve,C.strokeStyle=re.containerBorder,C.beginPath(),C.moveTo(te,W.y+H);let oe=Math.max(E,0);for(let he=0;he<f.length;he++){let Or=f[he]/oe*H,kr=te+he*ge,_r=W.y+H-Or;C.lineTo(kr,_r)}if(C.lineTo(te+(f.length-1)*ge,W.y+H),C.closePath(),C.fill(),C.stroke(),C.restore(),E>Y.reference){let he=Y.reference/E*H;C.strokeStyle="#05c46b",C.lineWidth=1.5,C.beginPath(),C.moveTo(te,W.y+H-he),C.lineTo(te+de,W.y+H-he),C.stroke()}W.y+=H}function tt(C,Y){C.fillStyle=re.containerBackground,C.strokeStyle=re.containerBorder,C.lineWidth=1,C.save(),C.beginPath(),C.shadowColor=re.containerShadow,C.shadowBlur=25,C.roundRect(10,10,240+15*2,Y.y-10,10),C.fill(),C.stroke(),C.restore()}function ss(C){C.save();let Y=Ae(),W=F.zero;Le(C,Y,W),et(C,Y,W),C.globalCompositeOperation="destination-over",tt(C,W),C.restore()}as.render=ss})(xt||(xt={}));var Xe=(a=>(a[a.LeftStickX=0]="LeftStickX",a[a.LeftStickY=1]="LeftStickY",a[a.RightStickX=2]="RightStickX",a[a.RightStickY=3]="RightStickY",a[a.LeftTrigger=4]="LeftTrigger",a[a.RightTrigger=5]="RightTrigger",a))(Xe||{});var je=(w=>(w[w.A=0]="A",w[w.B=1]="B",w[w.X=2]="X",w[w.Y=3]="Y",w[w.LB=4]="LB",w[w.RB=5]="RB",w[w.LT=6]="LT",w[w.RT=7]="RT",w[w.Back=8]="Back",w[w.Start=9]="Start",w[w.Home=16]="Home",w[w.LS=10]="LS",w[w.RS=11]="RS",w[w.Up=12]="Up",w[w.Down=13]="Down",w[w.Left=14]="Left",w[w.Right=15]="Right",w[w.UNUSED_1=17]="UNUSED_1",w[w.UNUSED_2=18]="UNUSED_2",w[w.UNUSED_3=19]="UNUSED_3",w[w.UNUSED_4=20]="UNUSED_4",w))(je||{});var $t=class{constructor(e,r,i){this.rect=e;this.color=r;this.thickness=i}render(e){e.strokeStyle=this.color,e.lineWidth=this.thickness,e.strokeRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},Wt=class{constructor(e,r){this.rect=e;this.color=r}render(e){e.fillStyle=this.color,e.fillRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},Ht=class{constructor(e,r,i,n){this.start=e;this.end=r;this.color=i;this.thickness=n}render(e){e.strokeStyle=this.color,e.lineWidth=this.thickness,e.beginPath(),e.moveTo(this.start.x,this.start.y),e.lineTo(this.end.x,this.end.y),e.stroke()}},Xt=class{constructor(e,r,i,n){this.center=e;this.radius=r;this.color=i;this.fill=n}render(e){this.fill?e.fillStyle=this.color:e.strokeStyle=this.color,e.lineWidth=1,e.beginPath(),e.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),this.fill?e.fill():e.stroke()}},jt=class{constructor(e,r,i,n){this.text=e;this.position=r;this.color=i;this.alignment=n}render(e){e.save(),e.fillStyle=this.color,e.font="12px Arial",e.textAlign=this.alignment,e.fillText(this.text,this.position.x,this.position.y),e.restore()}},Yt=class{constructor(e,r,i){this.origin=e;this.vector=r;this.color=i;u(this,"ARROWHEAD_LENGTH",10);u(this,"ARROWHEAD_ANGLE",Math.PI/6);u(this,"MIN_LENGTH",1);u(this,"MAX_LENGTH",100)}render(e){let r=this.vector.length;if(r<this.MIN_LENGTH)return;r>this.MAX_LENGTH&&(this.vector=this.vector.normalize().multiply(this.MAX_LENGTH),r=this.MAX_LENGTH);let i=(r-this.MIN_LENGTH)/(this.MAX_LENGTH-this.MIN_LENGTH),n=Ee.alpha(this.color,i);e.fillStyle=n,e.strokeStyle=n,e.lineWidth=1.5,e.lineCap="round",e.beginPath(),e.moveTo(this.origin.x,this.origin.y),e.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),e.stroke();let s=10,a=Math.PI/6,o=Math.atan2(this.vector.y,this.vector.x);e.beginPath(),e.moveTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),e.lineTo(this.origin.x+this.vector.x-s*Math.cos(o-a),this.origin.y+this.vector.y-s*Math.sin(o-a)),e.lineTo(this.origin.x+this.vector.x-s*Math.cos(o+a),this.origin.y+this.vector.y-s*Math.sin(o+a)),e.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),e.fill()}},L=class L{constructor(e,r,i){this.position=e;this.buttons=r;this.axes=i;this.position=this.position.subtract(new F(L.width/2,L.height/2))}getColor(e){return this.buttons[e].active?L.activeColor:L.buttonColor}getTextColor(e){return this.buttons[e].active?L.textColor:L.color}renderAnalogStick(e,r,i,n,s){let a=L.outerRadius;e.fillStyle=L.color,e.fillCircle(r.x,r.y,a),e.fillStyle=this.getColor(i),e.fillCircle(r.x+this.axes[n]*a,r.y+this.axes[s]*a,L.innerRadius)}renderDpad(e,r){let i=L.buttonSize;e.fillStyle=L.color,e.fillCircle(r.x+i,r.y+i/2,i*2),e.fillStyle=this.getColor(14),e.beginPath(),e.roundRect(r.x-i/2,r.y,i,i,[i/4,0,0,i/4]),e.fill(),e.fillStyle=this.getColor(15),e.beginPath(),e.roundRect(r.x+i*1.5,r.y,i,i,[0,i/4,i/4,0]),e.fill(),e.fillStyle=this.getColor(12),e.beginPath(),e.roundRect(r.x+i/2,r.y-i,i,i,[i/4,i/4,0,0]),e.fill(),e.fillStyle=this.getColor(13),e.beginPath(),e.roundRect(r.x+i/2,r.y+i,i,i,[0,0,i/4,i/4]),e.fill(),e.fillStyle=L.buttonColor,e.fillRect(r.x+i/2,r.y,i,i)}renderButtons(e,r){let i=L.buttonSize*1.25;e.font="".concat(i/2,"px Arial"),e.fillStyle=L.color,e.fillCircle(r.x-i,r.y+i/2,i*1.75),e.fillStyle=this.getColor(3),e.fillCircle(r.x-i,r.y-i/2,i/2),e.fillStyle=this.getTextColor(3),e.fillTextAligned("Y",r.x-i,r.y-i*.75,"center"),e.fillStyle=this.getColor(2),e.fillCircle(r.x-i*2,r.y+i/2,i/2),e.fillStyle=this.getTextColor(2),e.fillTextAligned("X",r.x-i*2,r.y+i*.25,"center"),e.fillStyle=this.getColor(0),e.fillCircle(r.x-i,r.y+i*1.5,i/2),e.fillStyle=this.getTextColor(0),e.fillTextAligned("A",r.x-i,r.y+i*1.25,"center"),e.fillStyle=this.getColor(1),e.fillCircle(r.x,r.y+i/2,i/2),e.fillStyle=this.getTextColor(1),e.fillTextAligned("B",r.x,r.y+i*.25,"center")}renderBumpersAndTriggers(e,r,i,n){var o;let s=L.buttonSize;e.fillStyle=this.getColor(i),e.beginPath(),e.roundRect(r.x,r.y-s/1.5,s*3,s/1.5,[s/4,s/4,0,0]),e.fill();let a=Math.abs((o=this.buttons[n].value)!=null?o:0);e.fillStyle=Ee.mix(L.color,L.activeColor,a),a=1-a*.75,e.beginPath(),e.roundRect(r.x+s/1.5,r.y-2.5-s/2-s*a,s*1.5,s*1*a,[s/4,s/4,0,0]),e.fill()}renderExtraButtons(e,r){let i=L.buttonSize;e.fillStyle=this.getColor(8),e.fillCircle(r.x-i*2,r.y-i/2,i/2),e.fillStyle=this.getColor(16),e.fillCircle(r.x,r.y,i/2),e.fillStyle=this.getColor(9),e.fillCircle(r.x+i*2,r.y-i/2,i/2)}renderBackground(e){e.fillStyle=L.color,e.beginPath(),e.roundRect(this.position.x,this.position.y,L.width,L.height-L.outerRadius/2.5,[L.outerRadius,L.outerRadius,0]),e.save();let r=L.outerRadius*3,i=L.outerRadius*4,n=this.position.x,s=this.position.y+L.height-L.outerRadius*3;e.roundRect(n,s,r,i,[L.outerRadius*2,0,L.outerRadius*8,L.outerRadius*8]),e.restore(),e.save(),n=this.position.x+L.width-r,s=this.position.y+L.height-L.outerRadius*3,e.roundRect(n,s,r,i,[0,L.outerRadius*2,L.outerRadius*8,L.outerRadius*8]),e.restore(),e.fill()}render(e){this.renderBackground(e),this.renderAnalogStick(e,new F(this.position.x+L.width/3,this.position.y+L.height-L.outerRadius-L.buttonSize),10,0,1),this.renderAnalogStick(e,new F(this.position.x+L.width-L.width/3,this.position.y+L.height-L.outerRadius-L.buttonSize),11,2,3),this.renderDpad(e,new F(this.position.x+L.buttonSize*2,this.position.y+L.buttonSize*2.5)),this.renderButtons(e,new F(this.position.x+L.width-L.buttonSize*2,this.position.y+L.buttonSize*2.5)),this.renderBumpersAndTriggers(e,new F(this.position.x+L.outerRadius,this.position.y),4,6),this.renderBumpersAndTriggers(e,new F(this.position.x+L.width-L.outerRadius-L.buttonSize*3,this.position.y),5,7),this.renderExtraButtons(e,new F(this.position.x+L.width/2,this.position.y+L.height/2-L.buttonSize*2))}};u(L,"scale",1),u(L,"width",200*L.scale),u(L,"height",100*L.scale),u(L,"color","rgba(52, 73, 94, 0.5)"),u(L,"buttonColor","rgba(255, 255, 255, 0.5)"),u(L,"activeColor","rgba(52, 152, 219, 0.85)"),u(L,"textColor","rgba(255, 255, 255, 0.75)"),u(L,"outerRadius",20*L.scale),u(L,"innerRadius",10*L.scale),u(L,"buttonSize",10*L.scale);var Zt=L,ee=class{static render(e){}static clear(){}static rect(e,r="#fff"){}static outline(e,r="#fff",i=1){}static line(e,r,i="#fff",n=1){}static circle(e,r,i="#fff",n=!0){}static text(e,r,i="#fff",n="left"){}static arrow(e,r,i="#fff"){}static gamepad(e,r,i){}};u(ee,"list",[]);var we=class{static set(e){this.current!==e&&(this.current=e,this.isDirty=!0)}static apply(e=document.body){this.isDirty&&(this.isDirty=!1,e.style.cursor=this.current)}static reset(){this.current="default",this.isDirty=!0}};u(we,"current","default"),u(we,"isDirty",!1);var Et=class{static setup(){return O(this,null,function*(){let e="".concat(ie,"pt ").concat(Be);document.fonts.check(e)||(yield document.fonts.load(e))})}};var wt=class{setup(){return Promise.resolve()}update(e){}render(e){}};var Oe=class t{constructor(e,r,i,n){this.x=e;this.y=r;this.width=i;this.height=n}translate(e){return new t(this.x+e.x,this.y+e.y,this.width,this.height)}contains(e,r=void 0){if(e instanceof F&&r===void 0)return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y;if(e instanceof t&&r===void 0)return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height;if(typeof e=="number"&&typeof r=="number")return e>=this.x&&e<=this.x+this.width&&r>=this.y&&r<=this.y+this.height;throw new Error("Invalid arguments")}intersects(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}intersection(e){let r=Math.max(this.x,e.x),i=Math.max(this.y,e.y),n=Math.min(this.x+this.width,e.x+e.width)-r,s=Math.min(this.y+this.height,e.y+e.height)-i;return new t(r,i,n,s)}get size(){return new F(this.width,this.height)}get position(){return new F(this.x,this.y)}set position(e){this.x=e.x,this.y=e.y}get center(){return new F(this.x+this.width/2,this.y+this.height/2)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}clone(){return new t(this.x,this.y,this.width,this.height)}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}toString(){return"{ x: ".concat(this.x,", y: ").concat(this.y,", width: ").concat(this.width,", height: ").concat(this.height," }")}};var ke=(y=>(y.W="KeyW",y.A="KeyA",y.S="KeyS",y.D="KeyD",y.R="KeyR",y.C="KeyC",y.V="KeyV",y.Shift="ShiftLeft",y.Ctrl="ControlLeft",y.Enter="Enter",y.ArrowUp="ArrowUp",y.ArrowDown="ArrowDown",y.ArrowLeft="ArrowLeft",y.ArrowRight="ArrowRight",y.Space="Space",y.Escape="Escape",y.Quote="Backquote",y.Backspace="Backspace",y))(ke||{});var Z;(v=>{let e={},r={};v.connectedGamepad=null;let n=!0,s=-1;function a(...b){return b.some(R=>{var g;return((g=e[R])==null?void 0:g.active)===!0})}v.isButtonDown=a;function o(...b){return b.some(R=>{var g;return((g=e[R])==null?void 0:g.active)===!0})}v.isButtonUp=o;function c(...b){return b.some(R=>{var g;return((g=e[R])==null?void 0:g.justPressed)===!0})}v.isButtonJustPressed=c;function l(...b){return b.some(R=>{var g;return((g=e[R])==null?void 0:g.justReleased)===!0})}v.isButtonJustReleased=l;function h(...b){return b.some(R=>{var g;return((g=e[R])==null?void 0:g.longPress)===!0})}v.isButtonLongPressed=h;function p(...b){return b.some(R=>{var g;return((g=e[R])==null?void 0:g.shortPress)===!0})}v.isButtonShortPressed=p;function d(b){return r[b]}v.getAxis=d;function f(b){v.connectedGamepad=b.gamepad,n&&(n=!1,j.isDirty=!0)}function E(b){v.connectedGamepad=null}function M(){let b=navigator.getGamepads().find(R=>R);b&&(v.connectedGamepad=b,n&&(n=!1,j.isDirty=!0),clearInterval(s))}function m(){s=setInterval(M.bind(this),500)}function T(){let b=navigator.getGamepads().find(g=>{var S;return g&&g.id===((S=v.connectedGamepad)==null?void 0:S.id)});b?v.connectedGamepad=b:(v.connectedGamepad=null,m())}function y(){for(let b=0;b<v.connectedGamepad.buttons.length;b++){let R=v.connectedGamepad.buttons[b],g=e[b];if(g.value=R.value,Math.abs(g.value)<Ve?g.value=0:1-Math.abs(g.value)<Ve&&(g.value=Math.sign(g.value)),g.value=Math.pow(g.value,Vt)*Math.sign(g.value),R.pressed!==g.active)if(j.isDirty=!0,R.pressed)g.active=!0,g.lastChange=Date.now(),g.justPressed=!0,g.justReleased=!1,g.lastTrigger=Date.now(),g.longPress=!1,g.shortPress=!1;else{g.active=!1,g.lastChange=Date.now(),g.justPressed=!1,g.justReleased=!0;let S=g.lastChange-g.lastTrigger;g.longPress=S>=be,g.shortPress=!g.longPress}else g.justReleased=!1,g.justPressed=!1,g.shortPress=!1,g.longPress=g.active&&Date.now()-g.lastChange>=be}}function A(){let b=[[0,1],[2,3]];for(let R of b){let g=new F(v.connectedGamepad.axes[R[0]],v.connectedGamepad.axes[R[1]]),S=Math.pow(g.length,Vt),P=Math.max(0,S-Ve)/(1-Ve);g=g.divide(S).multiply(P),(r[R[0]]!==g.x||r[R[1]]!==g.y)&&(j.isDirty=!0,r[R[0]]=g.x,r[R[1]]=g.y)}}function x(){if("getGamepads"in navigator){"ongamepadconnected"in window?(window.addEventListener("gamepadconnected",f.bind(this)),window.addEventListener("gamepaddisconnected",E.bind(this))):m();for(let b of Object.values(Xe))r[b]=0;for(let b of Object.values(je))e[b]={active:!1,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!1,justReleased:!1,longPress:!1,shortPress:!1,value:0}}}v.setup=x;function w(){ee.gamepad(new F(window.innerWidth-125,window.innerHeight-100),e,r),v.connectedGamepad&&("ongamepadconnected"in window||T(),y(),A())}v.update=w})(Z||(Z={}));var _;(w=>{let e={},r,i=null;function n(){return i!==null}w.isCaptured=n;function s(v,b,R){r.value=v,r.setSelectionRange(b,R)}w.setInput=s;function a(){r.value="",r.focus()}w.clearInput=a;function o(){n()&&r.focus()}w.focus=o;function c(v){i=v,r.focus()}w.startCapture=c;function l(){i=null,r.blur(),r.value=""}w.releaseCapture=l;function h(...v){return v.some(b=>{var R;return(R=e[b])==null?void 0:R.active})}w.isKeyDown=h;function p(...v){return v.some(b=>{var R;return!((R=e[b])!=null&&R.active)})}w.isKeyUp=p;function d(...v){return v.some(b=>{var R;return(R=e[b])==null?void 0:R.justPressed})}w.isKeyJustPressed=d;function f(...v){return v.some(b=>{var R;return(R=e[b])==null?void 0:R.justReleased})}w.isKeyJustReleased=f;function E(...v){return v.some(b=>{var R;return(R=e[b])==null?void 0:R.longPress})}w.isKeyLongPressed=E;function M(...v){return v.some(b=>{var R;return(R=e[b])==null?void 0:R.shortPress})}w.isKeyShortPressed=M;function m(v){let b=r.value,R=r.selectionStart,g=r.selectionEnd;i==null||i.call(this,b,R,g)}function T(v){n()&&m(),!v.repeat&&Object.values(ke).includes(v.code)&&(e[v.code]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},j.isDirty=!0)}function y(v){if(n()&&m(),v.repeat||!Object.values(ke).includes(v.code))return;let b=e[v.code];if(!b)return;b.active=!1,b.lastChange=Date.now(),b.justPressed=!1,b.justReleased=!0;let R=b.lastChange-b.lastTrigger;b.longPress=R>=be,b.shortPress=!b.longPress,j.isDirty=!0}function A(){r=document.createElement("input"),r.type="text",r.style.position="absolute",r.style.left="0px",r.style.top="300px",r.style.width="200px",r.style.height="20px",r.style.zIndex="-1",r.style.pointerEvents="none",document.body.appendChild(r),r.addEventListener("input",m.bind(this)),window.addEventListener("keydown",T.bind(this)),window.addEventListener("keyup",y.bind(this))}w.setup=A;function x(){for(let v in e){if(!e.hasOwnProperty(v))continue;let b=e[v];b.justReleased=!1,b.justPressed=!1,b.shortPress=!1,b.longPress=b.active&&Date.now()-b.lastChange>=be}}w.update=x})(_||(_={}));var _e=(i=>(i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i))(_e||{});var ue;(R=>{R.position=F.zero,R.delta=F.zero,R.buttons={},R.mouseWheelDelta=0;let o=0,c=-1;function l(...g){return g.some(S=>{var P;return(P=R.buttons[S])==null?void 0:P.active})}R.isMouseButtonDown=l;function h(...g){return g.some(S=>!R.buttons[S])}R.isMouseButtonUp=h;function p(...g){return g.some(S=>{var P;return(P=R.buttons[S])==null?void 0:P.justPressed})}R.isMouseButtonJustPressed=p;function d(...g){return g.some(S=>{var P;return(P=R.buttons[S])==null?void 0:P.justReleased})}R.isMouseButtonJustReleased=d;function f(...g){return g.some(S=>{var P;return(P=R.buttons[S])==null?void 0:P.longPress})}R.isMouseButtonLongPressed=f;function E(...g){return g.some(S=>{var P;return(P=R.buttons[S])==null?void 0:P.shortPress})}R.isMouseButtonShortPressed=E;function M(g){var S,P,V,$;_.focus(),document.pointerLockElement&&(R.delta.x=g.movementX,R.delta.y=g.movementY,R.position.x=g.clientX-((P=(S=g.target)==null?void 0:S.offsetLeft)!=null?P:0),R.position.y=g.clientY-(($=(V=g.target)==null?void 0:V.offsetTop)!=null?$:0))}function m(g){_.focus(),Object.values(_e).includes(g.button)&&(R.buttons[g.button]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},w(),j.isDirty=!0)}function T(g){if(_.focus(),!Object.values(_e).includes(g.button))return;let S=R.buttons[g.button];if(!S)return;S.active=!1,S.lastChange=Date.now(),S.justPressed=!1,S.justReleased=!0;let P=S.lastChange-S.lastTrigger;S.longPress=P>=be,S.shortPress=!S.longPress,j.isDirty=!0}function y(g,S){Object.values(_e).includes(S.button)&&(document.pointerLockElement||g.setPointerCapture(S.pointerId),m(S))}function A(g,S){Object.values(_e).includes(S.button)&&(document.pointerLockElement||g.releasePointerCapture(S.pointerId),T(S))}function x(g){_.focus(),R.mouseWheelDelta=g.deltaY}function w(){if(document.pointerLockElement)return;if(Date.now()-o<1e3){c<0&&(D.debug("Input","Scheduling another pointer lock attempt"),c=setTimeout(w.bind(this),1e3));return}c>=0&&(clearTimeout(c),c=-1);let g={unadjustedMovement:!0};try{o=Date.now();let S=document.body.requestPointerLock(g);S?S.then(()=>{D.debug("Input","Pointer lock acquired (async)")}).catch(P=>D.error("Input","Failed to acquire pointer lock",P)):D.debug("Input","Pointer lock acquired")}catch(S){D.error("Input","Failed to acquire pointer lock",S)}}function v(){R.position.x=window.innerWidth/2,R.position.y=window.innerHeight/2,document.body.addEventListener("click",M.bind(this)),document.body.addEventListener("mousemove",M.bind(this)),document.body.addEventListener("mousedown",m.bind(this)),document.body.addEventListener("mouseup",T.bind(this)),document.body.addEventListener("wheel",x.bind(this)),document.body.oncontextmenu=g=>(g.preventDefault(),g.stopPropagation(),!1)}R.setup=v;function b(){for(let g in R.buttons){if(!R.buttons.hasOwnProperty(g))continue;let S=R.buttons[g];S.justReleased=!1,S.justPressed=!1,S.shortPress=!1,S.longPress=S.active&&Date.now()-S.lastChange>=be}R.delta.x=0,R.delta.y=0,R.mouseWheelDelta=0}R.update=b})(ue||(ue={}));var j;(E=>{E.isDirty=!1;function e(){if(_.isCaptured())return 0;let M=0;return(_.isKeyDown("KeyA","ArrowLeft")||Z.isButtonDown(14))&&(M-=1),(_.isKeyDown("KeyD","ArrowRight")||Z.isButtonDown(15))&&(M+=1),Z.connectedGamepad&&(M=Z.getAxis(0)),M}E.getMovementHorizontal=e;function r(){if(_.isCaptured())return 0;let M=0;return(_.isKeyDown("KeyW","ArrowUp")||Z.isButtonDown(12))&&(M-=1),(_.isKeyDown("KeyS","ArrowDown")||Z.isButtonDown(13))&&(M+=1),Z.connectedGamepad&&(M=Z.getAxis(1)),M}E.getMovementVertical=r;function i(){return _.isCaptured()?0:ue.delta.x!==0?ue.delta.x:Z.connectedGamepad?Z.getAxis(2)*_t:0}E.getLookHorizontal=i;function n(){return _.isCaptured()?0:ue.delta.y!==0?ue.delta.y:Z.connectedGamepad?Z.getAxis(3)*_t:0}E.getLookVertical=n;function s(){return _.isCaptured()?!1:_.isKeyDown("Space","ArrowUp")||Z.isButtonDown(0,12)}E.isJumping=s;function a(){return _.isCaptured()?!1:_.isKeyDown("ShiftLeft")||Z.isButtonDown(13,1)}E.isCrouching=a;function o(){return _.isCaptured()?!1:_.isKeyJustReleased("KeyR")}E.isRecording=o;function c(){return _.isCaptured()?!1:_.isKeyJustReleased("KeyC")}E.isSwitchingCameras=c;function l(){return _.isCaptured()?!1:_.isKeyDown("ControlLeft")||Z.isButtonDown(7)}E.isRunning=l;function h(){return _.isKeyJustPressed("Backquote")}E.isTogglingTerminal=h;function p(){var M;navigator.vibrate&&navigator.vibrate(200),(M=Z.connectedGamepad)!=null&&M.vibrationActuator&&Z.connectedGamepad.vibrationActuator.playEffect("dual-rumble",{duration:100,strongMagnitude:.5,weakMagnitude:.25})}E.vibrate=p;function d(){_.setup(),Z.setup(),ue.setup()}E.setup=d;function f(){E.isDirty=!1,_.update(),Z.update(),ue.update()}E.update=f})(j||(j={}));var Mt=class extends wt{constructor(r){super();this.main=r}get width(){return this.main.screen.width}get height(){return this.main.screen.height}get camera(){return this.main.camera}invalidate(){this.main.invalidate()}setup(){return O(this,null,function*(){D.debug("StatePlay","Setting up..."),we.set("none"),this.updateActiveChunks()})}updateActiveChunks(){ne.updateActiveChunks(this.main.playerCamera.tiledPosition)}updateCameraRotation(r){this.camera.pitch-=j.getLookVertical()*r*20,this.camera.pitch=Math.clamp(this.camera.pitch,-89,89),this.camera.yaw+=j.getLookHorizontal()*r*20}updateCameraMovement(r){let i=5*(j.isRunning()?20:1),n=j.getMovementVertical(),s=j.getMovementHorizontal();if(this.updateActiveChunks(),n!==0){let a=this.camera.forward;this.camera.position[0]-=a[0]*r*i*n,this.camera.position[1]-=a[1]*r*i*n,this.camera.position[2]-=a[2]*r*i*n}if(s!==0){let a=this.camera.right;this.camera.position[0]+=a[0]*r*i*s,this.camera.position[1]+=a[1]*r*i*s,this.camera.position[2]+=a[2]*r*i*s}j.isCrouching()&&(this.camera.position[1]-=r*i),j.isJumping()&&(this.camera.position[1]+=r*i)}updateControls(r){this.camera.update(r),this.updateCameraRotation(r),this.updateCameraMovement(r)}update(r){return O(this,null,function*(){this.invalidate(),this.updateControls(r),this.main.useDebugCamera&&ee.outline(new Oe(10,10,this.width-10*2,this.height-10*2),"#ff0000",10),ee.text("Position",new F(this.width/2,this.height-80),"gray","center"),ee.text("{ ".concat(this.camera.position[0].toFixed(2),", ").concat(this.camera.position[1].toFixed(2),", ").concat(this.camera.position[2].toFixed(2)," }"),new F(this.width/2,this.height-60),"white","center"),ee.text("Rotation",new F(this.width/2,this.height-40),"gray","center"),ee.text("{ ".concat(this.camera.pitch.toFixed(2),", ").concat(this.camera.yaw.toFixed(2),", ").concat(this.camera.roll.toFixed(2)," }"),new F(this.width/2,this.height-20),"white","center")})}render(r){}};var Rt=class{constructor(e=void 0){u(this,"element",document.createElement("canvas"));u(this,"context");u(this,"virtualWidth",0);u(this,"virtualHeight",0);u(this,"drawRatio",1);u(this,"overrideRatio");e&&(this.element.id=e);let r=this.element.getContext("2d");if(!r)throw new Error("Could not get context of canvas");this.context=r,this.context.imageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.filter="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxmaWx0ZXIgaWQ9ImZpbHRlciIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVGdW5jUiB0eXBlPSJpZGVudGl0eSIvPjxmZUZ1bmNHIHR5cGU9ImlkZW50aXR5Ii8+PGZlRnVuY0IgdHlwZT0iaWRlbnRpdHkiLz48ZmVGdW5jQSB0eXBlPSJkaXNjcmV0ZSIgdGFibGVWYWx1ZXM9IjAgMSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj48L2ZpbHRlcj48L3N2Zz4=#filter)",this.element.oncontextmenu=()=>!1}get backingStoreRatio(){return this.overrideRatio||this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1}get devicePixelRation(){return this.overrideRatio||window.devicePixelRatio||1}getDrawRatio(e,r){return r/e}setSize(e,r){this.drawRatio=this.getDrawRatio(this.backingStoreRatio,this.devicePixelRation),this.backingStoreRatio!==this.devicePixelRation?(this.element.width=e*this.drawRatio,this.element.height=r*this.drawRatio):(this.element.width=e,this.element.height=r),this.element.style.width="".concat(e,"px"),this.element.style.minWidth="".concat(e,"px"),this.element.style.height="".concat(r,"px"),this.element.style.minHeight="".concat(r,"px"),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=e,this.virtualHeight=r}clear(){this.context.clearRect(0,0,this.element.width,this.element.height)}drawTo(e,r,i){i.save(),i.scale(1/this.drawRatio,1/this.drawRatio),i.drawImage(this.element,e,r),i.restore()}attachToElement(e){e.appendChild(this.element)}get width(){return this.virtualWidth||this.element.width}get height(){return this.virtualHeight||this.element.height}get bounds(){return new Oe(0,0,this.width,this.height)}get size(){return{width:this.width,height:this.height}}};var Tt=class{constructor(e){this.main=e;u(this,"canvas",new Rt("gui-canvas"));u(this,"isDirty",!0)}get element(){return this.canvas.element}get context(){return this.canvas.context}invalidate(){this.isDirty=!0}setup(){this.canvas.attachToElement(document.body)}setSize(e){this.canvas.setSize(e.width,e.height)}clear(){this.canvas.clear()}render(){this.isDirty&&(this.clear(),this.isDirty=!1)}};var Ye=class{constructor(e){this.gl=e;u(this,"colorBuffer");u(this,"depthBuffer");u(this,"frameBuffer");this.setup()}setup(){D.debug("FrameBuffer","Setting up frame buffer...");let e=this.gl.createFramebuffer();if(!e)throw new Error("Could not create frame buffer");this.frameBuffer=e,this.setupColorTexture(),this.setupDepthBuffer();let r=this.gl.checkFramebufferStatus(GL.FRAMEBUFFER);if(r!==this.gl.FRAMEBUFFER_COMPLETE)throw new Error("Frame buffer is incomplete: ".concat(r))}setupDepthBuffer(){let e=this.gl.createRenderbuffer();if(!e)throw new Error("Could not create depth buffer");this.depthBuffer=e,this.gl.bindRenderbuffer(GL.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_COMPONENT16,this.gl.canvas.width,this.gl.canvas.height),this.bind(),this.gl.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_ATTACHMENT,GL.RENDERBUFFER,this.depthBuffer),this.unbind()}setupColorTexture(){let e=this.gl.createTexture();if(!e)throw new Error("Could not create texture");this.colorBuffer=e,this.gl.bindTexture(GL.TEXTURE_2D,this.colorBuffer),this.gl.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,this.gl.canvas.width,this.gl.canvas.height,0,GL.RGBA,GL.UNSIGNED_BYTE,null),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE),this.bind(),this.gl.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,this.colorBuffer,0),this.unbind()}resize(){D.debug("FrameBuffer","Resizing frame buffer..."),this.setupColorTexture(),this.setupDepthBuffer()}bind(){this.gl.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffer)}unbind(){this.gl.bindFramebuffer(GL.FRAMEBUFFER,null)}bindTexture(){this.gl.activeTexture(GL.TEXTURE0),this.gl.bindTexture(GL.TEXTURE_2D,this.colorBuffer)}};var St=class{constructor(e){this.gl=e;u(this,"frameBuffer0");u(this,"frameBuffer1");u(this,"filters",[]);u(this,"pingPong",!1);this.frameBuffer0=new Ye(this.gl),this.frameBuffer1=new Ye(this.gl)}get primary(){return this.pingPong?this.frameBuffer1:this.frameBuffer0}get secondary(){return this.pingPong?this.frameBuffer0:this.frameBuffer1}addFilter(e){return O(this,null,function*(){let r=this.filters.length%2===0,i=new pe(this.gl,"filter-".concat(e));yield i.setup({source:{vertex:"vertex-passthrough",fragment:"filter-".concat(e)},uniforms:["u_texture"],buffers:{vertex:{data:se.vertices.map(n=>r?-n:n),attribute:"a_position"},uv:{data:se.textureCoordinates,attribute:"a_texcoord"},index:{data:se.indices,target:GL.ELEMENT_ARRAY_BUFFER}}}),i.bind(),i.setUniform("u_texture",0),i.bindBuffer("index",se.indices),this.filters.push(i)})}swap(){this.pingPong=!this.pingPong}bind(){this.primary.bind()}unbind(){this.primary.unbind()}resize(){this.frameBuffer0.resize(),this.frameBuffer1.resize()}bindTexture(){this.primary.bindTexture()}commit(){for(let e=0;e<this.filters.length;e++){let r=this.filters[e],i=e===this.filters.length-1;i||this.secondary.bind(),r.bind(),this.primary.bindTexture(),this.gl.drawElements(GL.TRIANGLES,se.indices.length,GL.UNSIGNED_SHORT,0),i||(this.secondary.unbind(),this.swap())}}};var At=class{constructor(e){this.main=e;u(this,"canvas");u(this,"gl");u(this,"isDirty",!1);u(this,"frameBuffer")}invalidate(){this.isDirty=!0}setSize(e){var i;D.info("WebGLRenderer","Setting size...");let r=(i=window.devicePixelRatio)!=null?i:1;this.canvas.width=e.width*r,this.canvas.height=e.height*r,this.canvas.style.width="".concat(e.width,"px"),this.canvas.style.height="".concat(e.height,"px"),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.frameBuffer&&this.frameBuffer.resize()}setupCanvas(){var i,n;D.debug("WebGLRenderer","Creating canvas..."),this.canvas=document.createElement("canvas"),this.canvas.id="webgl-canvas";let e={antialias:!0,depth:!0,preserveDrawingBuffer:!0},r=(n=(i=this.canvas.getContext("webgl2",e))!=null?i:this.canvas.getContext("webgl",e))!=null?n:this.canvas.getContext("experimental-webgl",e);if(!r)throw new Error("Could not get WebGL context");this.gl=r,document.body.appendChild(this.canvas),this.gl.enable(GL.DEPTH_TEST),this.gl.cullFace(GL.BACK),this.gl.enable(GL.CULL_FACE),this.gl.depthFunc(GL.LEQUAL),this.gl.clearDepth(1)}setupTextures(){return O(this,null,function*(){D.debug("WebGLRenderer","Setting up textures..."),this.gl.pixelStorei(GL.UNPACK_FLIP_Y_WEBGL,!0)})}setupMesh(){return O(this,null,function*(){yield Te.setup(this.gl)})}setup(){return O(this,null,function*(){D.info("WebGLRenderer","Setting up..."),this.setupCanvas(),this.frameBuffer=new St(this.gl),yield this.setupMesh(),yield this.setupTextures(),yield ae.setup(this.gl),yield this.frameBuffer.addFilter("gamma")})}clear(e){this.gl.clearColor(e.r,e.g,e.b,1),this.gl.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT)}drawScene(){let e=Ee.decode(re.background,!0);this.clear(e);let r=this.main.camera.getProjectionMatrix(),i=this.main.camera.getViewMatrix(),n=ne.activeChunks.filter(s=>s&&s.mesh&&this.main.playerCamera.isChunkInsideFrustum(s));if(I.SORT_CHUNKS_BY_DISTANCE){let s=n.map(a=>N.distance(a.globalCenterPosition,this.main.playerCamera.position));n=n.sort((a,o)=>{let c=s[n.indexOf(a)];return s[n.indexOf(o)]-c})}for(let s of n)this.main.analytics.notifyChunkVisible(s),I.RENDER_CHUNKS&&s.render(this.gl,r,i);this.renderDebugOverlay(),I.DISABLE_DEPTH_FOR_GIZMOS&&this.gl.disable(GL.DEPTH_TEST),ae.render(this.gl,r,i),ae.clear(),I.DISABLE_DEPTH_FOR_GIZMOS&&this.gl.enable(GL.DEPTH_TEST)}renderDebugOverlay(){let e=U.create(),r=this.main.useDebugCamera?this.main.playerCamera:this.main.debugCamera,i=r.near,n=r.forward,s=r.up,a=r.position,o=r.getViewMatrix();U.invert(o,o),ae.box(a,N.fromValues(.5,.5,.5),N.fromValues(Math.toRadians(r.pitch),Math.toRadians(r.yaw),Math.toRadians(r.roll)),this.main.useDebugCamera?B.fromValues(1,0,0,1):B.fromValues(0,0,1,1),!0);let c=N.create();N.scaleAndAdd(c,a,n,i),N.scaleAndAdd(c,c,s,i/2),U.lookAt(e,a,c,s);let l=N.create();N.scaleAndAdd(l,a,n,100),ae.line(a,l,B.fromValues(1,1,1,1))}render(){this.isDirty&&(this.isDirty=!1,this.frameBuffer.bind(),this.drawScene(),this.frameBuffer.unbind(),this.frameBuffer.commit())}};var Ze=class{constructor(){u(this,"position",N.create());u(this,"currentPitch",0);u(this,"currentYaw",0);u(this,"currentRoll",0);u(this,"pitch",0);u(this,"yaw",0);u(this,"roll",0);u(this,"fov",Math.toRadians(45));u(this,"near",.1);u(this,"far",1e3)}get aspectRatio(){return window.innerWidth/window.innerHeight}get tiledPosition(){return new F(Math.floor((this.position[0]+X/2)/X),Math.floor((this.position[2]+X/2)/X))}get forward(){let e=N.create(),r=Math.toRadians(this.yaw),i=Math.toRadians(this.pitch),n=Math.cos(i);return e[0]=-Math.sin(r)*n,e[1]=Math.sin(i),e[2]=-Math.cos(r)*n,e}get right(){let e=N.fromValues(0,1,0),r=this.forward,i=N.create();return N.cross(i,e,r),N.normalize(i,i),i}get up(){let e=this.right,r=this.forward,i=N.create();return N.cross(i,r,e),N.normalize(i,i),i}lookAt(e){let r=N.create();N.subtract(r,e,this.position),N.normalize(r,r),this.pitch=Math.toDegrees(Math.asin(r[1])),this.yaw=Math.toDegrees(Math.atan2(-r[0],-r[2]))}normalizePlane(e){let r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return e[0]/=r,e[1]/=r,e[2]/=r,e}getFrustumPlanes(){let e=this.getViewMatrix(),r=this.getProjectionMatrix(),i=U.multiply(U.create(),r,e);return[B.fromValues(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),B.fromValues(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),B.fromValues(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),B.fromValues(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),B.fromValues(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),B.fromValues(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])].map(s=>B.normalize(B.create(),s))}isBoxInFrustum(e,r){let i=this.getFrustumPlanes(),n=N.scale(N.create(),r,.5),s=N.subtract(N.create(),e,n),a=N.add(N.create(),e,n);for(let o of i){let c=N.fromValues(o[0],o[1],o[2]),l=N.fromValues(c[0]>0?a[0]:s[0],c[1]>0?a[1]:s[1],c[2]>0?a[2]:s[2]);if(N.dot(c,l)+o[3]<0)return!1}return!0}isSphereInsideFrustum(e,r){let i=this.getFrustumPlanes();for(let n of i)if(N.dot(N.fromValues(n[0],n[1],n[2]),e)+n[3]<-r)return!1;return!0}isChunkInsideFrustum(e){let r=e.globalCenterPosition,i=0,n=N.fromValues(X,Ie,X);n[0]+=i,n[1]+=i,n[2]+=i,r[0]-=i/2,r[1]-=i/2,r[2]-=i/2;let s=this.isBoxInFrustum(r,n);return I.RENDER_CHUNK_BOUNDS&&(ae.box(e.globalCenterPosition,n,N.fromValues(0,0,0),s?B.fromValues(0,1,0,1):B.fromValues(1,0,0,1),!1),ae.box(e.globalCenterPosition,N.fromValues(1,1,1),N.fromValues(0,0,0),B.fromValues(0,0,1,1),!0)),s}update(e){this.currentPitch=Math.lerp(this.currentPitch,this.pitch,e*20),this.currentYaw=Math.lerp(this.currentYaw,this.yaw,e*20),this.currentRoll=Math.lerp(this.currentRoll,this.roll,e*20)}getViewMatrix(){let e=U.create();return U.translate(e,e,this.position),U.rotate(e,e,Math.toRadians(this.currentYaw),[0,1,0]),U.rotate(e,e,Math.toRadians(this.currentPitch),[1,0,0]),U.rotate(e,e,Math.toRadians(this.currentRoll),[0,0,1]),U.invert(e,e),e}getProjectionMatrix(){let e=U.create();return U.perspective(e,this.fov,this.aspectRatio,this.near,this.far),e}};var Ur=Pt(Nt());var Ke=new Worker("".concat(window.location.href,"scripts/jobs/gif.worker.js"));Ke.onerror=t=>D.error("GIFUtils","Worker error",t.message);Ke.onmessageerror=t=>D.error("GIFUtils","Worker message error",t.data);Ke.onmessage=t=>{D.info("GIFUtils","Received message",t.data),Ur.default.saveAs(t.data,"recording.zip")};var Lt=new OffscreenCanvas(1,1),Kt=Lt.getContext("2d");if(!Kt)throw new Error("Could not get context of canvas");var qe=class{static addFrame(e,r){Lt.width=e.width,Lt.height=e.height,Kt.drawImage(e,0,0),r.drawTo(0,0,Kt);let i=Lt.transferToImageBitmap();Ke.postMessage({key:"add",value:i},[i])}static generate(e){return O(this,null,function*(){Ke.postMessage({key:"zip"})})}};var Ct;(n=>{function t(s,a){return new Function("with(this) { return eval('"+s+"')}").call(a)}function e(s,a){let o=Math.max(s.length,a.length);return 1-(o-s.split("").reduce((l,h,p)=>l+(h===a[p]?1:0),0))/o}function r(s){return er({SETTINGS:I,set(a,o){if(a=a.toUpperCase(),I.hasOwnProperty(a)){I[a]=o;return}else{let c=Object.keys(I).map(l=>({similarity:e(a,l),key:l})).sort((l,h)=>h.similarity-l.similarity).map(l=>l.key).slice(0,3);throw new Error("Invalid setting: ".concat(a,".\nDid you mean: ").concat(c,"?"))}},reloadChunks:ne.reloadChunks.bind(this)},s)}function i(s,a={}){return new Promise((o,c)=>{try{D.debug("Interpreter","Evaluating: ".concat(s));let l=r(a),h=t(s,l);o(h)}catch(l){D.error("Interpreter",l),c(l.message)}})}n.evaluate=i})(Ct||(Ct={}));var Je;(A=>{let t;(S=>(S.Green="rgb(172,205,112)",S.Yellow="rgb(229,196,148)",S.Blue="rgb(154, 158, 200)",S.White="rgb(189, 194, 237)",S.Gray="rgb(98, 105, 147)",S.Red="rgb(191, 97, 106)"))(t||(t={}));let e=ie*1.5,r=e*20,i=1e3,n=[],s=0,a="",o=0,c=0,l=-r,h=-r,p=!1;function d(){return{print:x=>{f(x)},clear:()=>{n.length=0}}}function f(x,w="white"){x!==void 0&&(typeof x=="object"?JSON.stringify(x,null,2).split("\n").forEach(b=>f(b,"rgb(154, 158, 200)")):x.toString().split("\n").forEach(b=>{b.length>0&&(n.push({text:b,color:w}),n.length>i&&n.shift(),s=n.length)}))}function E(x,w,v){if(_.isKeyDown("Enter")&&x.trim().length>0)_.clearInput(),f(":> ".concat(x),"rgb(98, 105, 147)"),Ct.evaluate(x,d()).then(b=>f(b,"rgb(172,205,112)")).catch(b=>f(b,"rgb(191, 97, 106)")),a="",o=0,c=0;else if(_.isKeyDown("Escape"))_.clearInput(),M(!1);else if(_.isKeyDown("ArrowUp")){let b=n.findLast(R=>R.text.startsWith(":> "));b&&(a=b.text.slice(3),o=a.length,c=o,_.setInput(a,o,c))}else a=x,o=w,c=v}function M(x){x?(h=0,_.startCapture(E.bind(this)),p=!0):(h=-r,_.releaseCapture(),p=!1)}function m(){return p}A.isVisible=m;function T(x){j.isTogglingTerminal()&&!p&&M(!0),p&&(s+=ue.mouseWheelDelta*.1,s=Math.clamp(s,0,n.length)),l=Math.lerp(l,h,10*x)}A.update=T;function y(x){if(Math.floor(l)<=-r)return;let w=1-Math.min(1,Math.abs(l)/r);x.save(),x.translate(0,l),x.fillStyle="rgba(22, 24, 31, ".concat(.75*w,")"),x.shadowBlur=20,x.shadowOffsetX=0,x.shadowOffsetY=2,x.shadowColor="rgba(0, 0, 0, ".concat(.25*w,")"),x.beginPath(),x.roundRect(0,0,x.canvas.width,r,[0,0,15,15]),x.fill();let v=ce;x.fillStyle="rgb(172,205,112)",x.font="".concat(ie,"px monospace"),x.textBaseline="top",x.textAlign="left",x.fillTextAligned("- Debug terminal -",x.canvas.width/2,v,"center"),v+=e;let b=Math.floor((r-v-ce-e)/e),R=Math.floor(Math.max(Math.min(s,n.length-b),0)),g=Math.min(n.length,R+b);for(let P=R;P<g;P++){let V=n[P];x.fillStyle=V.color,x.fillText(V.text,ce,v),v+=e}if(n.length>b){let P=Math.max(20,i/n.length*(r-v-ce)),V=Math.lerp(ce,r-ce-P,s/n.length);x.fillStyle="rgba(255, 255, 255, 0.15)",x.beginPath(),x.roundRect(x.canvas.width-ce,V,ce/2,P,10),x.fill()}v=r-ce-e,x.fillStyle="rgb(189, 194, 237)",x.fillText(">",ce,v),x.fillText(a,ce+ie,v);let S=ce+ie+x.measureText(a.slice(0,o)).width;c>o?(x.fillStyle="rgba(255, 255, 255, 0.5)",x.fillRect(S,v,x.measureText(a.slice(o,c)).width,ie)):Date.now()/1e3%.5>.25&&x.fillRect(S,v-ie*.15,2.5,ie),x.restore()}A.render=y})(Je||(Je={}));var Qe=!1,qt=class{constructor(){u(this,"screen",{width:0,height:0});u(this,"gui",new Tt(this));u(this,"gl",new At(this));u(this,"playerCamera",new Ze);u(this,"debugCamera",new Ze);u(this,"useDebugCamera",!1);u(this,"isRecording",!1);u(this,"handleAnimationFrameRequest",-1);u(this,"lastFrameTime",performance.now());u(this,"globalTimer",0);u(this,"state");D.info("Main","Starting up..."),this.state=new Mt(this),this.attachHooks()}get camera(){return this.useDebugCamera?this.debugCamera:this.playerCamera}attachHooks(){D.info("Main","Attaching hooks..."),window.addLoadEventListener(this.onLoad.bind(this)),window.addVisibilityChangeEventListener(this.onVisibilityChange.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}onLoad(){return O(this,null,function*(){try{D.debug("Main","Window loaded"),Qe||(yield this.gl.setup()),this.gui.setup(),this.onResize();let e=[re.setup(),Et.setup(),j.setup()];yield Promise.all(e),yield this.state.setup(),this.requestNextFrame()}catch(e){D.error("Main","Failed to load modules",e),alert("Failed to load modules. Please refresh the page.".concat(e))}})}onVisibilityChange(e){D.info("Main","Window visibility changed to ".concat(e?"visible":"hidden")),e?(this.handleAnimationFrameRequest>=0&&(it?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest)),this.invalidate(),this.lastFrameTime=performance.now(),setTimeout(this.requestNextFrame.bind(this),0)):this.handleAnimationFrameRequest&&(it?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest),this.handleAnimationFrameRequest=-1)}onResize(){D.debug("Main","Window resized"),this.screen={width:window.innerWidth,height:window.innerHeight},this.gui.setSize(this.screen),Qe||this.gl.setSize(this.screen),this.invalidate()}setState(e){this.state=e,this.state.setup(),we.apply(this.gui.element),this.invalidate()}invalidate(){this.gui.invalidate(),Qe||this.gl.invalidate()}requestNextFrame(){this.isRecording?(this.handleAnimationFrameRequest!==-1&&clearTimeout(this.handleAnimationFrameRequest),this.handleAnimationFrameRequest=setTimeout(()=>this.loop(performance.now()),1e3/Ot)):it?this.handleAnimationFrameRequest=requestAnimationFrame(this.loop.bind(this)):this.handleAnimationFrameRequest===-1&&(this.handleAnimationFrameRequest=setInterval(()=>this.loop(performance.now()),1e3/sr))}updateRecording(e){this.isRecording&&(ee.circle(new F(this.screen.width-30,30),10,"red",!0),ee.circle(new F(this.screen.width-30,30),15,"red",!1)),j.isRecording()&&(this.isRecording?this.onStopRecording():this.onStartRecording())}onStartRecording(){D.info("Main","Recording started"),this.isRecording=!0,this.screen=nr,this.gui.setSize(this.screen),Qe||this.gl.setSize(this.screen),this.invalidate()}onStopRecording(){D.info("Main","Recording stopped"),this.isRecording=!1,qe.generate("recording"),this.onResize()}update(e){let r=(e-this.lastFrameTime)/1e3;this.lastFrameTime=e,Je.update(r),this.updateRecording(r),this.isRecording&&(r=1/Ot);let i=!1,n=r/kt;for(let s=0;s<kt;s++)this.state.update(n),i||(i=!0,j.update());this.globalTimer+=r}loop(e){this.update(e),we.apply(this.gui.element),this.gui.render(),this.state.render(this.gui.context),Qe||this.gl.render(),ee.render(this.gui.context),ee.clear(),Je.render(this.gui.context),this.isRecording&&qe.addFrame(this.gl.canvas,this.gui.canvas),this.requestNextFrame()}};new qt;})();
