(()=>{var ur=Object.create;var Pt=Object.defineProperty;var fr=Object.getOwnPropertyDescriptor;var gr=Object.getOwnPropertyNames;var vr=Object.getPrototypeOf,br=Object.prototype.hasOwnProperty;var pt=Math.pow,xr=(e,t,r)=>t in e?Pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ce=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ie=(e,t)=>{for(var r in t)Pt(e,r,{get:t[r],enumerable:!0})},yr=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of gr(t))!br.call(e,n)&&n!==r&&Pt(e,n,{get:()=>t[n],enumerable:!(i=fr(t,n))||i.enumerable});return e};var De=(e,t,r)=>(r=e!=null?ur(vr(e)):{},yr(t||!e||!e.__esModule?Pt(r,"default",{value:e,enumerable:!0}):r,e));var p=(e,t,r)=>xr(e,typeof t!="symbol"?t+"":t,r);var C=(e,t,r)=>new Promise((i,n)=>{var s=c=>{try{o(r.next(c))}catch(h){n(h)}},a=c=>{try{o(r.throw(c))}catch(h){n(h)}},o=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,a);o((r=r.apply(e,t)).next())});var lr=Ce((le,hr)=>{(function(e,t){typeof le=="object"?hr.exports=t():typeof define=="function"&&define.amd?define(t):e.Alea=t()})(le,function(){"use strict";return e.importState=function(r){var i=new e;return i.importState(r),i},e;function e(){return function(r){var i=0,n=0,s=0,a=1;r.length==0&&(r=[+new Date]);var o=t();i=o(" "),n=o(" "),s=o(" ");for(var c=0;c<r.length;c++)i-=o(r[c]),i<0&&(i+=1),n-=o(r[c]),n<0&&(n+=1),s-=o(r[c]),s<0&&(s+=1);o=null;var h=function(){var l=2091639*i+a*23283064365386963e-26;return i=n,n=s,s=l-(a=l|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=r,h.exportState=function(){return[i,n,s,a]},h.importState=function(l){i=+l[0]||0,n=+l[1]||0,s=+l[2]||0,a=+l[3]||0},h}(Array.prototype.slice.call(arguments))}function t(){var r=4022871197,i=function(n){n=n.toString();for(var s=0;s<n.length;s++){r+=n.charCodeAt(s);var a=.02519603282416938*r;r=a>>>0,a-=r,a*=r,r=a>>>0,a-=r,r+=a*4294967296}return(r>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})});var dr=Ce((Ee,Re)=>{(function(e,t){typeof define=="function"&&define.amd?define([],t):typeof Ee!="undefined"?t():(t(),e.FileSaver={})})(Ee,function(){"use strict";function e(o,c){return typeof c=="undefined"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function t(o,c,h){var l=new XMLHttpRequest;l.open("GET",o),l.responseType="blob",l.onload=function(){a(l.response,c,h)},l.onerror=function(){console.error("could not download file")},l.send()}function r(o){var c=new XMLHttpRequest;c.open("HEAD",o,!1);try{c.send()}catch(h){}return 200<=c.status&&299>=c.status}function i(o){try{o.dispatchEvent(new MouseEvent("click"))}catch(h){var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(c)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,s=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(o,c,h){var l=n.URL||n.webkitURL,d=document.createElement("a");c=c||o.name||"download",d.download=c,d.rel="noopener",typeof o=="string"?(d.href=o,d.origin===location.origin?i(d):r(d.href)?t(o,c,h):i(d,d.target="_blank")):(d.href=l.createObjectURL(o),setTimeout(function(){l.revokeObjectURL(d.href)},4e4),setTimeout(function(){i(d)},0))}:"msSaveOrOpenBlob"in navigator?function(o,c,h){if(c=c||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(e(o,h),c);else if(r(o))t(o,c,h);else{var l=document.createElement("a");l.href=o,l.target="_blank",setTimeout(function(){i(l)})}}:function(o,c,h,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof o=="string")return t(o,c,h);var d=o.type==="application/octet-stream",u=/constructor/i.test(n.HTMLElement)||n.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||d&&u||s)&&typeof FileReader!="undefined"){var x=new FileReader;x.onloadend=function(){var v=x.result;v=f?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=v:location=v,l=null},x.readAsDataURL(o)}else{var b=n.URL||n.webkitURL,m=b.createObjectURL(o);l?l.location=m:location.href=m,l=null,setTimeout(function(){b.revokeObjectURL(m)},4e4)}});n.saveAs=a.saveAs=a,typeof Re!="undefined"&&(Re.exports=a)})});Array.prototype.remove=function(e){let t=this.indexOf(e);return t!=-1?(this.splice(t,1),!0):!1};Array.prototype.appendArray=function(e){if(e)for(let t=0;t<e.length;t++)this.push(e[t])};HTMLCanvasElement.prototype.screenshot=function(e="download.png"){let t=document.createElement("a");t.download=e,t.href=this.toDataURL("image/png;base64"),t.style.visibility="hidden",t.style.display="none",document.body.appendChild(t),setTimeout(()=>{t.click(),document.body.removeChild(t)},100)};CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderingContext2D.prototype.line=function(e,t,r,i){this.beginPath(),this.moveTo(e,t),this.lineTo(r,i),this.stroke()};CanvasRenderingContext2D.prototype.fillTextAligned=function(e,t,r,i){let n=this.measureText(e);switch(i){case"left":this.fillText(e,t,r);break;case"center":this.fillText(e,t-n.width/2,r);break;case"right":this.fillText(e,t-n.width,r);break}};CanvasRenderingContext2D.prototype.fillCircle=function(e,t,r){this.beginPath(),this.arc(e,t,r,0,Math.PI*2),this.fill()};Math.clamp=function(e,t,r){return Math.min(Math.max(e,t),r)};Math.average=function(...e){return e.reduce((t,r)=>t+r,0)/e.length};Math.distance=function(e,t,r,i){return Math.sqrt(Math.pow(r-e,2)+Math.pow(i-t,2))};Math.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};Math.lerp=function(e,t,r){return e+(t-e)*r};Math.oscilate=function(e,t,r=0,i=1){let n=2*Math.PI*t,s=i-r,o=(Math.sin(n*e)+1)/2;return r+o*s};Math.smoothstep=function(e,t=0,r=1){return e=Math.clamp((e-t)/(r-t),0,1),e*e*(3-2*e)};Math.prettifyElapsedTime=function(e){let t=(r,i)=>r%1===0?Math.floor(r):r.toFixed(i);return e<1?"".concat(Math.floor(e*1e3),"\u03BCs"):e<1e3?"".concat(t(e,2),"ms"):e<6e4?"".concat(t(e/1e3,2),"s"):e<36e5?"".concat(t(e/6e4,2),"m"):"".concat(t(e/36e5,2),"h")};Math.toDegrees=function(e){return e*(180/Math.PI)};Math.toRadians=function(e){return e*(Math.PI/180)};Function.oneshot=function(e){let t=!1;return()=>{t||(t=!0,e())}};Function.timeout=function(e,t){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{e(),r=!1},t))}};Function.debounce=function(e,t){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{e(),r=!1},t))}};Promise.delay=function(e){return new Promise((t,r)=>{setTimeout(t,e)})};Promise.sequential=function(e){return e.reduce((t,r)=>t.then(i=>r.then(n=>(i.push(n),i))),Promise.resolve([]))};String.prototype.toCamelCase=function(){return this.replace("--","").replace(/-./g,e=>e[1].toUpperCase()).trim()};String.prototype.insertAt=function(e,t){return this.substr(0,e)+t+this.substr(e)};window.addLoadEventListener=function(e){let t=Function.oneshot(e);window.addEventListener("DOMContentLoaded",t),window.addEventListener("load",t),document.addEventListener("load",t),window.addEventListener("ready",t),setTimeout(t,1e3)};window.addVisibilityChangeEventListener=function(e){let t=["webkit","moz","ms",""],r=Function.debounce(()=>{e(!window.isDocumentHidden())},50);t.forEach(i=>{document.addEventListener("".concat(i,"visibilitychange"),r)}),document.onvisibilitychange=r};window.isMobile=function(){return window.matchMedia("(any-pointer: coarse)").matches};window.isDocumentHidden=function(){return["webkit","moz","ms",""].map(t=>t&&t.length>0?"".concat(t,"Hidden"):"hidden").map(t=>document[t]).reduce((t,r)=>t||r,!1)};window.getRefreshRate=function(){return new Promise((e,t)=>{let r=[60,75,100,120,144,165,240,360];setTimeout(()=>{requestAnimationFrame(i=>{requestAnimationFrame(n=>{let a=1e3/(n-i),o=r.reduce((c,h)=>Math.abs(h-a)<Math.abs(c-a)?h:c);e(o)})})},10)})};var Y={RENDER_DISTANCE:32,RENDER_CHUNKS:!0,SORT_CHUNKS_BY_DISTANCE:!0,ANSIOTROPIC_FILTERING:0,DISABLE_DEPTH_FOR_GIZMOS:!1,RENDER_CHUNK_BOUNDS:!0};var w=class{static logColoredText(t,r,i,...n){console[t].call(console,"%c".concat(t.toUpperCase()," %c[").concat(r,"]"),"font-weight: bold; color: ".concat(i,";"),"font-weight: bold; color: gray",...n)}static info(t,...r){this.logColoredText("info",t,"turquoise",...r)}static warn(t,...r){this.logColoredText("warn",t,"yellow",...r)}static error(t,...r){let i=r.find(n=>n instanceof Error);i&&console.trace(i),this.logColoredText("error",t,"red",...r)}static debug(t,...r){}};GL=WebGL2RenderingContext;var Fe=function(){if(Y.ANSIOTROPIC_FILTERING<=0)return;let e=this.getExtension("EXT_texture_filter_anisotropic")||this.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(e){let t=this.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.texParameterf(GL.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y.ANSIOTROPIC_FILTERING,t)),w.info("Texture","Anisotropic filtering supported, max: ".concat(t))}else w.warn("Texture","Anisotropic filtering not supported")};WebGL2RenderingContext.prototype.enableAnisotropicFiltering=Fe;WebGLRenderingContext.prototype.enableAnisotropicFiltering=Fe;var P=class e{constructor(t,r=void 0){p(this,"x");p(this,"y");this.x=t,r===void 0?this.y=t:this.y=r}dot(t){return this.x*t.x+this.y*t.y}add(t){return new e(this.x+t.x,this.y+t.y)}subtract(t){return new e(this.x-t.x,this.y-t.y)}multiply(t){return new e(this.x*t,this.y*t)}divide(t){return new e(this.x/t,this.y/t)}normalize(){let t=this.length;return new e(this.x/t,this.y/t)}clone(){return new e(this.x,this.y)}static distance(t,r){return Math.sqrt(pt(t.x-r.x,2)+pt(t.y-r.y,2))}static random(t){return new e(Math.random()*2-1,Math.random()*2-1).normalize().multiply(t)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static get zero(){return new e(0,0)}toString(){return"{ ".concat(this.x,", ").concat(this.y," }")}};var rt=class e{constructor(t,r,i,n){this.x=t;this.y=r;this.width=i;this.height=n}translate(t){return new e(this.x+t.x,this.y+t.y,this.width,this.height)}contains(t,r=void 0){if(t instanceof P&&r===void 0)return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y;if(t instanceof e&&r===void 0)return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height;if(typeof t=="number"&&typeof r=="number")return t>=this.x&&t<=this.x+this.width&&r>=this.y&&r<=this.y+this.height;throw new Error("Invalid arguments")}intersects(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}intersection(t){let r=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width)-r,s=Math.min(this.y+this.height,t.y+t.height)-i;return new e(r,i,n,s)}get size(){return new P(this.width,this.height)}get position(){return new P(this.x,this.y)}set position(t){this.x=t.x,this.y=t.y}get center(){return new P(this.x+this.width/2,this.y+this.height/2)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}clone(){return new e(this.x,this.y,this.width,this.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}toString(){return"{ x: ".concat(this.x,", y: ").concat(this.y,", width: ").concat(this.width,", height: ").concat(this.height," }")}};var it=class{static decode(t,r=!1){if(t.startsWith("rgba")){let[i,n,s,a]=t.slice(5,-1).split(",").map(o=>parseFloat(o));return{r:i,g:n,b:s,a}}else if(t.startsWith("rgb")){let[i,n,s]=t.slice(4,-1).split(",").map(a=>parseInt(a));return{r:i,g:n,b:s,a:1}}else{let i=t;i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=parseInt(i.slice(0,2),16),s=parseInt(i.slice(2,4),16),a=parseInt(i.slice(4,6),16);return r?{r:n/255,g:s/255,b:a/255,a:1}:{r:n,g:s,b:a,a:1}}}static mix(t,r,i){let n=this.decode(t),s=this.decode(r),a=Math.floor(n.r+(s.r-n.r)*i),o=Math.floor(n.g+(s.g-n.g)*i),c=Math.floor(n.b+(s.b-n.b)*i),h=n.a+(s.a-n.a)*i;return"rgba(".concat(a,",").concat(o,",").concat(c,",").concat(Math.clamp(Math.abs(h),0,1),")")}static alpha(t,r){let i=t;if(i.startsWith("rgba")){let s=i.slice(5,-1).split(",");return s[3]="".concat(r),"rgba(".concat(s.join(","),")")}i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=Math.round(r*255).toString(16).padStart(2,"0");return"#".concat(i).concat(n)}static interpolate(t,r,i){if(t.startsWith("rgba")){let S=t.slice(5,-1).split(",").map(N=>parseInt(N)),M=r.slice(5,-1).split(",").map(N=>parseInt(N)),R=Math.round(S[0]+(M[0]-S[0])*i),g=Math.round(S[1]+(M[1]-S[1])*i),E=Math.round(S[2]+(M[2]-S[2])*i),U=S[3]+(M[3]-S[3])*i;return"rgba(".concat(R,",").concat(g,",").concat(E,",").concat(U,")")}let n="0x".concat(t.trim().slice(1)),s="0x".concat(r.trim().slice(1));n.length<5&&(n=n.replace(/./g,"$&$&")),s.length<5&&(s=s.replace(/./g,"$&$&"));let a=parseInt(n,16),o=parseInt(s,16),c=a>>16,h=a>>8&255,l=a&255,d=o>>16,u=o>>8&255,f=o&255,x=Math.round(c+(d-c)*i),b=Math.round(h+(u-h)*i),m=Math.round(l+(f-l)*i);return"#".concat((16777216+(x<<16)+(b<<8)+m).toString(16).slice(1))}static isColorLight(t){let r="0x".concat(t.trim().slice(1));r.length<5&&(r=r.replace(/./g,"$&$&"));let i=parseInt(r,16),n=i>>16,s=i>>8&255,a=i&255;return Math.sqrt(.299*(n*n)+.587*(s*s)+.114*(a*a))>127.5}};var Z=class Z{static get isDark(){return window.matchMedia("(prefers-color-scheme: dark)").matches}static setup(){return C(this,null,function*(){Z.loadVariables(),Z.observeChanges()})}static loadVariables(){let t=["--background","--foreground","--secondary","--container-background","--container-border","--container-shadow"];w.info("Theme","Setting up theme, loading ".concat(t.length," variables...")),console.groupCollapsed("Loading theme variables");let r=getComputedStyle(document.body);for(let i of t){let n=r.getPropertyValue(i),s=i.toString().toCamelCase();Z[s]=n,console.log("%c".concat(s),"color: ".concat(it.isColorLight(n)?"#212121":"#eee","; background-color: ").concat(n))}console.groupEnd()}static observeChanges(){let t=window.matchMedia("(prefers-color-scheme: dark)");t.addEventListener("change",()=>{w.info("Theme","Changed theme to ".concat(t.matches?"dark":"light")),Z.loadVariables()})}};p(Z,"background"),p(Z,"foreground"),p(Z,"secondary"),p(Z,"containerBackground"),p(Z,"containerBorder"),p(Z,"containerShadow");var dt=Z;var Ie=1/24,Ge={width:808,height:808},Ne=60,ne=1,Ft=!0,$=16,ct=128,xt=.1,se=5,ae=2,oe=48,ce="'Pixelify Sans', sans-serif",mt=110;var I=1e-6,W=typeof Float32Array!="undefined"?Float32Array:Array,ht=Math.random;var ss=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var T={};ie(T,{add:()=>ni,adjoint:()=>Tr,clone:()=>Mr,copy:()=>Er,create:()=>wr,determinant:()=>Cr,equals:()=>ci,exactEquals:()=>oi,frob:()=>ii,fromQuat:()=>Yr,fromQuat2:()=>$r,fromRotation:()=>Or,fromRotationTranslation:()=>Oe,fromRotationTranslationScale:()=>Wr,fromRotationTranslationScaleOrigin:()=>jr,fromScaling:()=>Ur,fromTranslation:()=>kr,fromValues:()=>Rr,fromXRotation:()=>Br,fromYRotation:()=>Vr,fromZRotation:()=>zr,frustum:()=>Xr,getRotation:()=>Hr,getScaling:()=>Be,getTranslation:()=>_r,identity:()=>ke,invert:()=>Lr,lookAt:()=>ti,mul:()=>hi,multiply:()=>Ue,multiplyScalar:()=>si,multiplyScalarAndAdd:()=>ai,ortho:()=>Qr,orthoNO:()=>ze,orthoZO:()=>Jr,perspective:()=>qr,perspectiveFromFieldOfView:()=>Zr,perspectiveNO:()=>Ve,perspectiveZO:()=>Kr,rotate:()=>Fr,rotateX:()=>Ir,rotateY:()=>Gr,rotateZ:()=>Nr,scale:()=>Pr,set:()=>Ar,str:()=>ri,sub:()=>li,subtract:()=>$e,targetTo:()=>ei,translate:()=>Dr,transpose:()=>Sr});function wr(){var e=new W(16);return W!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Mr(e){var t=new W(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Er(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Rr(e,t,r,i,n,s,a,o,c,h,l,d,u,f,x,b){var m=new W(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=o,m[8]=c,m[9]=h,m[10]=l,m[11]=d,m[12]=u,m[13]=f,m[14]=x,m[15]=b,m}function Ar(e,t,r,i,n,s,a,o,c,h,l,d,u,f,x,b,m){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=c,e[8]=h,e[9]=l,e[10]=d,e[11]=u,e[12]=f,e[13]=x,e[14]=b,e[15]=m,e}function ke(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sr(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Lr(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],c=t[6],h=t[7],l=t[8],d=t[9],u=t[10],f=t[11],x=t[12],b=t[13],m=t[14],v=t[15],S=r*o-i*a,M=r*c-n*a,R=r*h-s*a,g=i*c-n*o,E=i*h-s*o,U=n*h-s*c,N=l*b-d*x,B=l*m-u*x,k=l*v-f*x,V=d*m-u*b,z=d*v-f*b,O=u*v-f*m,D=S*O-M*z+R*V+g*k-E*B+U*N;return D?(D=1/D,e[0]=(o*O-c*z+h*V)*D,e[1]=(n*z-i*O-s*V)*D,e[2]=(b*U-m*E+v*g)*D,e[3]=(u*E-d*U-f*g)*D,e[4]=(c*k-a*O-h*B)*D,e[5]=(r*O-n*k+s*B)*D,e[6]=(m*R-x*U-v*M)*D,e[7]=(l*U-u*R+f*M)*D,e[8]=(a*z-o*k+h*N)*D,e[9]=(i*k-r*z-s*N)*D,e[10]=(x*E-b*R+v*S)*D,e[11]=(d*R-l*E-f*S)*D,e[12]=(o*B-a*V-c*N)*D,e[13]=(r*V-i*B+n*N)*D,e[14]=(b*M-x*g-m*S)*D,e[15]=(l*g-d*M+u*S)*D,e):null}function Tr(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],c=t[6],h=t[7],l=t[8],d=t[9],u=t[10],f=t[11],x=t[12],b=t[13],m=t[14],v=t[15];return e[0]=o*(u*v-f*m)-d*(c*v-h*m)+b*(c*f-h*u),e[1]=-(i*(u*v-f*m)-d*(n*v-s*m)+b*(n*f-s*u)),e[2]=i*(c*v-h*m)-o*(n*v-s*m)+b*(n*h-s*c),e[3]=-(i*(c*f-h*u)-o*(n*f-s*u)+d*(n*h-s*c)),e[4]=-(a*(u*v-f*m)-l*(c*v-h*m)+x*(c*f-h*u)),e[5]=r*(u*v-f*m)-l*(n*v-s*m)+x*(n*f-s*u),e[6]=-(r*(c*v-h*m)-a*(n*v-s*m)+x*(n*h-s*c)),e[7]=r*(c*f-h*u)-a*(n*f-s*u)+l*(n*h-s*c),e[8]=a*(d*v-f*b)-l*(o*v-h*b)+x*(o*f-h*d),e[9]=-(r*(d*v-f*b)-l*(i*v-s*b)+x*(i*f-s*d)),e[10]=r*(o*v-h*b)-a*(i*v-s*b)+x*(i*h-s*o),e[11]=-(r*(o*f-h*d)-a*(i*f-s*d)+l*(i*h-s*o)),e[12]=-(a*(d*m-u*b)-l*(o*m-c*b)+x*(o*u-c*d)),e[13]=r*(d*m-u*b)-l*(i*m-n*b)+x*(i*u-n*d),e[14]=-(r*(o*m-c*b)-a*(i*m-n*b)+x*(i*c-n*o)),e[15]=r*(o*u-c*d)-a*(i*u-n*d)+l*(i*c-n*o),e}function Cr(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],c=e[7],h=e[8],l=e[9],d=e[10],u=e[11],f=e[12],x=e[13],b=e[14],m=e[15],v=t*a-r*s,S=t*o-i*s,M=t*c-n*s,R=r*o-i*a,g=r*c-n*a,E=i*c-n*o,U=h*x-l*f,N=h*b-d*f,B=h*m-u*f,k=l*b-d*x,V=l*m-u*x,z=d*m-u*b;return v*z-S*V+M*k+R*B-g*N+E*U}function Ue(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],c=t[5],h=t[6],l=t[7],d=t[8],u=t[9],f=t[10],x=t[11],b=t[12],m=t[13],v=t[14],S=t[15],M=r[0],R=r[1],g=r[2],E=r[3];return e[0]=M*i+R*o+g*d+E*b,e[1]=M*n+R*c+g*u+E*m,e[2]=M*s+R*h+g*f+E*v,e[3]=M*a+R*l+g*x+E*S,M=r[4],R=r[5],g=r[6],E=r[7],e[4]=M*i+R*o+g*d+E*b,e[5]=M*n+R*c+g*u+E*m,e[6]=M*s+R*h+g*f+E*v,e[7]=M*a+R*l+g*x+E*S,M=r[8],R=r[9],g=r[10],E=r[11],e[8]=M*i+R*o+g*d+E*b,e[9]=M*n+R*c+g*u+E*m,e[10]=M*s+R*h+g*f+E*v,e[11]=M*a+R*l+g*x+E*S,M=r[12],R=r[13],g=r[14],E=r[15],e[12]=M*i+R*o+g*d+E*b,e[13]=M*n+R*c+g*u+E*m,e[14]=M*s+R*h+g*f+E*v,e[15]=M*a+R*l+g*x+E*S,e}function Dr(e,t,r){var i=r[0],n=r[1],s=r[2],a,o,c,h,l,d,u,f,x,b,m,v;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(a=t[0],o=t[1],c=t[2],h=t[3],l=t[4],d=t[5],u=t[6],f=t[7],x=t[8],b=t[9],m=t[10],v=t[11],e[0]=a,e[1]=o,e[2]=c,e[3]=h,e[4]=l,e[5]=d,e[6]=u,e[7]=f,e[8]=x,e[9]=b,e[10]=m,e[11]=v,e[12]=a*i+l*n+x*s+t[12],e[13]=o*i+d*n+b*s+t[13],e[14]=c*i+u*n+m*s+t[14],e[15]=h*i+f*n+v*s+t[15]),e}function Pr(e,t,r){var i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Fr(e,t,r,i){var n=i[0],s=i[1],a=i[2],o=Math.hypot(n,s,a),c,h,l,d,u,f,x,b,m,v,S,M,R,g,E,U,N,B,k,V,z,O,D,H;return o<I?null:(o=1/o,n*=o,s*=o,a*=o,c=Math.sin(r),h=Math.cos(r),l=1-h,d=t[0],u=t[1],f=t[2],x=t[3],b=t[4],m=t[5],v=t[6],S=t[7],M=t[8],R=t[9],g=t[10],E=t[11],U=n*n*l+h,N=s*n*l+a*c,B=a*n*l-s*c,k=n*s*l-a*c,V=s*s*l+h,z=a*s*l+n*c,O=n*a*l+s*c,D=s*a*l-n*c,H=a*a*l+h,e[0]=d*U+b*N+M*B,e[1]=u*U+m*N+R*B,e[2]=f*U+v*N+g*B,e[3]=x*U+S*N+E*B,e[4]=d*k+b*V+M*z,e[5]=u*k+m*V+R*z,e[6]=f*k+v*V+g*z,e[7]=x*k+S*V+E*z,e[8]=d*O+b*D+M*H,e[9]=u*O+m*D+R*H,e[10]=f*O+v*D+g*H,e[11]=x*O+S*D+E*H,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Ir(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],c=t[7],h=t[8],l=t[9],d=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+h*i,e[5]=a*n+l*i,e[6]=o*n+d*i,e[7]=c*n+u*i,e[8]=h*n-s*i,e[9]=l*n-a*i,e[10]=d*n-o*i,e[11]=u*n-c*i,e}function Gr(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],c=t[3],h=t[8],l=t[9],d=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-h*i,e[1]=a*n-l*i,e[2]=o*n-d*i,e[3]=c*n-u*i,e[8]=s*i+h*n,e[9]=a*i+l*n,e[10]=o*i+d*n,e[11]=c*i+u*n,e}function Nr(e,t,r){var i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],c=t[3],h=t[4],l=t[5],d=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+h*i,e[1]=a*n+l*i,e[2]=o*n+d*i,e[3]=c*n+u*i,e[4]=h*n-s*i,e[5]=l*n-a*i,e[6]=d*n-o*i,e[7]=u*n-c*i,e}function kr(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ur(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Or(e,t,r){var i=r[0],n=r[1],s=r[2],a=Math.hypot(i,n,s),o,c,h;return a<I?null:(a=1/a,i*=a,n*=a,s*=a,o=Math.sin(t),c=Math.cos(t),h=1-c,e[0]=i*i*h+c,e[1]=n*i*h+s*o,e[2]=s*i*h-n*o,e[3]=0,e[4]=i*n*h-s*o,e[5]=n*n*h+c,e[6]=s*n*h+i*o,e[7]=0,e[8]=i*s*h+n*o,e[9]=n*s*h-i*o,e[10]=s*s*h+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Br(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Oe(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3],o=i+i,c=n+n,h=s+s,l=i*o,d=i*c,u=i*h,f=n*c,x=n*h,b=s*h,m=a*o,v=a*c,S=a*h;return e[0]=1-(f+b),e[1]=d+S,e[2]=u-v,e[3]=0,e[4]=d-S,e[5]=1-(l+b),e[6]=x+m,e[7]=0,e[8]=u+v,e[9]=x-m,e[10]=1-(l+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function $r(e,t){var r=new W(3),i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],c=t[5],h=t[6],l=t[7],d=i*i+n*n+s*s+a*a;return d>0?(r[0]=(o*a+l*i+c*s-h*n)*2/d,r[1]=(c*a+l*n+h*i-o*s)*2/d,r[2]=(h*a+l*s+o*n-c*i)*2/d):(r[0]=(o*a+l*i+c*s-h*n)*2,r[1]=(c*a+l*n+h*i-o*s)*2,r[2]=(h*a+l*s+o*n-c*i)*2),Oe(e,t,r),e}function _r(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Be(e,t){var r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],c=t[8],h=t[9],l=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(s,a,o),e[2]=Math.hypot(c,h,l),e}function Hr(e,t){var r=new W(3);Be(r,t);var i=1/r[0],n=1/r[1],s=1/r[2],a=t[0]*i,o=t[1]*n,c=t[2]*s,h=t[4]*i,l=t[5]*n,d=t[6]*s,u=t[8]*i,f=t[9]*n,x=t[10]*s,b=a+l+x,m=0;return b>0?(m=Math.sqrt(b+1)*2,e[3]=.25*m,e[0]=(d-f)/m,e[1]=(u-c)/m,e[2]=(o-h)/m):a>l&&a>x?(m=Math.sqrt(1+a-l-x)*2,e[3]=(d-f)/m,e[0]=.25*m,e[1]=(o+h)/m,e[2]=(u+c)/m):l>x?(m=Math.sqrt(1+l-a-x)*2,e[3]=(u-c)/m,e[0]=(o+h)/m,e[1]=.25*m,e[2]=(d+f)/m):(m=Math.sqrt(1+x-a-l)*2,e[3]=(o-h)/m,e[0]=(u+c)/m,e[1]=(d+f)/m,e[2]=.25*m),e}function Wr(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=t[3],c=n+n,h=s+s,l=a+a,d=n*c,u=n*h,f=n*l,x=s*h,b=s*l,m=a*l,v=o*c,S=o*h,M=o*l,R=i[0],g=i[1],E=i[2];return e[0]=(1-(x+m))*R,e[1]=(u+M)*R,e[2]=(f-S)*R,e[3]=0,e[4]=(u-M)*g,e[5]=(1-(d+m))*g,e[6]=(b+v)*g,e[7]=0,e[8]=(f+S)*E,e[9]=(b-v)*E,e[10]=(1-(d+x))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function jr(e,t,r,i,n){var s=t[0],a=t[1],o=t[2],c=t[3],h=s+s,l=a+a,d=o+o,u=s*h,f=s*l,x=s*d,b=a*l,m=a*d,v=o*d,S=c*h,M=c*l,R=c*d,g=i[0],E=i[1],U=i[2],N=n[0],B=n[1],k=n[2],V=(1-(b+v))*g,z=(f+R)*g,O=(x-M)*g,D=(f-R)*E,H=(1-(u+v))*E,vt=(m+S)*E,bt=(x+M)*U,Le=(m-S)*U,Te=(1-(u+b))*U;return e[0]=V,e[1]=z,e[2]=O,e[3]=0,e[4]=D,e[5]=H,e[6]=vt,e[7]=0,e[8]=bt,e[9]=Le,e[10]=Te,e[11]=0,e[12]=r[0]+N-(V*N+D*B+bt*k),e[13]=r[1]+B-(z*N+H*B+Le*k),e[14]=r[2]+k-(O*N+vt*B+Te*k),e[15]=1,e}function Yr(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,c=n+n,h=r*a,l=i*a,d=i*o,u=n*a,f=n*o,x=n*c,b=s*a,m=s*o,v=s*c;return e[0]=1-d-x,e[1]=l+v,e[2]=u-m,e[3]=0,e[4]=l-v,e[5]=1-h-x,e[6]=f+b,e[7]=0,e[8]=u+m,e[9]=f-b,e[10]=1-h-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xr(e,t,r,i,n,s,a){var o=1/(r-t),c=1/(n-i),h=1/(s-a);return e[0]=s*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*c,e[10]=(a+s)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*h,e[15]=0,e}function Ve(e,t,r,i,n){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(a=1/(i-n),e[10]=(n+i)*a,e[14]=2*n*i*a):(e[10]=-1,e[14]=-2*i),e}var qr=Ve;function Kr(e,t,r,i,n){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(a=1/(i-n),e[10]=n*a,e[14]=n*i*a):(e[10]=-1,e[14]=-i),e}function Zr(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),c=2/(a+o),h=2/(n+s);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((a-o)*c*.5),e[9]=(n-s)*h*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function ze(e,t,r,i,n,s,a){var o=1/(t-r),c=1/(i-n),h=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*c,e[14]=(a+s)*h,e[15]=1,e}var Qr=ze;function Jr(e,t,r,i,n,s,a){var o=1/(t-r),c=1/(i-n),h=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*c,e[14]=s*h,e[15]=1,e}function ti(e,t,r,i){var n,s,a,o,c,h,l,d,u,f,x=t[0],b=t[1],m=t[2],v=i[0],S=i[1],M=i[2],R=r[0],g=r[1],E=r[2];return Math.abs(x-R)<I&&Math.abs(b-g)<I&&Math.abs(m-E)<I?ke(e):(l=x-R,d=b-g,u=m-E,f=1/Math.hypot(l,d,u),l*=f,d*=f,u*=f,n=S*u-M*d,s=M*l-v*u,a=v*d-S*l,f=Math.hypot(n,s,a),f?(f=1/f,n*=f,s*=f,a*=f):(n=0,s=0,a=0),o=d*a-u*s,c=u*n-l*a,h=l*s-d*n,f=Math.hypot(o,c,h),f?(f=1/f,o*=f,c*=f,h*=f):(o=0,c=0,h=0),e[0]=n,e[1]=o,e[2]=l,e[3]=0,e[4]=s,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=h,e[10]=u,e[11]=0,e[12]=-(n*x+s*b+a*m),e[13]=-(o*x+c*b+h*m),e[14]=-(l*x+d*b+u*m),e[15]=1,e)}function ei(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=i[0],c=i[1],h=i[2],l=n-r[0],d=s-r[1],u=a-r[2],f=l*l+d*d+u*u;f>0&&(f=1/Math.sqrt(f),l*=f,d*=f,u*=f);var x=c*u-h*d,b=h*l-o*u,m=o*d-c*l;return f=x*x+b*b+m*m,f>0&&(f=1/Math.sqrt(f),x*=f,b*=f,m*=f),e[0]=x,e[1]=b,e[2]=m,e[3]=0,e[4]=d*m-u*b,e[5]=u*x-l*m,e[6]=l*b-d*x,e[7]=0,e[8]=l,e[9]=d,e[10]=u,e[11]=0,e[12]=n,e[13]=s,e[14]=a,e[15]=1,e}function ri(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ii(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ni(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function $e(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function si(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function ai(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function oi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ci(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],c=e[6],h=e[7],l=e[8],d=e[9],u=e[10],f=e[11],x=e[12],b=e[13],m=e[14],v=e[15],S=t[0],M=t[1],R=t[2],g=t[3],E=t[4],U=t[5],N=t[6],B=t[7],k=t[8],V=t[9],z=t[10],O=t[11],D=t[12],H=t[13],vt=t[14],bt=t[15];return Math.abs(r-S)<=I*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(i-M)<=I*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(n-R)<=I*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(s-g)<=I*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-E)<=I*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-U)<=I*Math.max(1,Math.abs(o),Math.abs(U))&&Math.abs(c-N)<=I*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(h-B)<=I*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(l-k)<=I*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(d-V)<=I*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(u-z)<=I*Math.max(1,Math.abs(u),Math.abs(z))&&Math.abs(f-O)<=I*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(x-D)<=I*Math.max(1,Math.abs(x),Math.abs(D))&&Math.abs(b-H)<=I*Math.max(1,Math.abs(b),Math.abs(H))&&Math.abs(m-vt)<=I*Math.max(1,Math.abs(m),Math.abs(vt))&&Math.abs(v-bt)<=I*Math.max(1,Math.abs(v),Math.abs(bt))}var hi=Ue,li=$e;var A={};ie(A,{add:()=>fi,angle:()=>Ui,bezier:()=>Ci,ceil:()=>gi,clone:()=>pi,copy:()=>mi,create:()=>_e,cross:()=>Si,dist:()=>Wi,distance:()=>Xe,div:()=>Hi,divide:()=>Ye,dot:()=>Ze,equals:()=>zi,exactEquals:()=>Vi,floor:()=>vi,forEach:()=>qi,fromValues:()=>di,hermite:()=>Ti,inverse:()=>Ri,len:()=>Yi,length:()=>He,lerp:()=>Li,max:()=>xi,min:()=>bi,mul:()=>_i,multiply:()=>je,negate:()=>Ei,normalize:()=>Ai,random:()=>Di,rotateX:()=>Gi,rotateY:()=>Ni,rotateZ:()=>ki,round:()=>yi,scale:()=>wi,scaleAndAdd:()=>Mi,set:()=>ui,sqrDist:()=>ji,sqrLen:()=>Xi,squaredDistance:()=>qe,squaredLength:()=>Ke,str:()=>Bi,sub:()=>$i,subtract:()=>We,transformMat3:()=>Fi,transformMat4:()=>Pi,transformQuat:()=>Ii,zero:()=>Oi});function _e(){var e=new W(3);return W!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function pi(e){var t=new W(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function He(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function di(e,t,r){var i=new W(3);return i[0]=e,i[1]=t,i[2]=r,i}function mi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ui(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function fi(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function We(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function je(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ye(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function gi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function vi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function bi(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function xi(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function yi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function wi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Mi(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Xe(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function qe(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function Ke(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Ei(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Ri(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ai(e,t){var r=t[0],i=t[1],n=t[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function Ze(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Si(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],c=r[2];return e[0]=n*c-s*o,e[1]=s*a-i*c,e[2]=i*o-n*a,e}function Li(e,t,r,i){var n=t[0],s=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e}function Ti(e,t,r,i,n,s){var a=s*s,o=a*(2*s-3)+1,c=a*(s-2)+s,h=a*(s-1),l=a*(3-2*s);return e[0]=t[0]*o+r[0]*c+i[0]*h+n[0]*l,e[1]=t[1]*o+r[1]*c+i[1]*h+n[1]*l,e[2]=t[2]*o+r[2]*c+i[2]*h+n[2]*l,e}function Ci(e,t,r,i,n,s){var a=1-s,o=a*a,c=s*s,h=o*a,l=3*s*o,d=3*c*a,u=c*s;return e[0]=t[0]*h+r[0]*l+i[0]*d+n[0]*u,e[1]=t[1]*h+r[1]*l+i[1]*d+n[1]*u,e[2]=t[2]*h+r[2]*l+i[2]*d+n[2]*u,e}function Di(e,t){t=t||1;var r=ht()*2*Math.PI,i=ht()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function Pi(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,e}function Fi(e,t,r){var i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function Ii(e,t,r){var i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],c=t[1],h=t[2],l=n*h-s*c,d=s*o-i*h,u=i*c-n*o,f=n*u-s*d,x=s*l-i*u,b=i*d-n*l,m=a*2;return l*=m,d*=m,u*=m,f*=2,x*=2,b*=2,e[0]=o+l+f,e[1]=c+d+x,e[2]=h+u+b,e}function Gi(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Ni(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function ki(e,t,r,i){var n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Ui(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2],c=Math.sqrt(r*r+i*i+n*n),h=Math.sqrt(s*s+a*a+o*o),l=c*h,d=l&&Ze(e,t)/l;return Math.acos(Math.min(Math.max(d,-1),1))}function Oi(e){return e[0]=0,e[1]=0,e[2]=0,e}function Bi(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Vi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function zi(e,t){var r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=I*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=I*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=I*Math.max(1,Math.abs(n),Math.abs(o))}var $i=We,_i=je,Hi=Ye,Wi=Xe,ji=qe,Yi=He,Xi=Ke,qi=function(){var e=_e();return function(t,r,i,n,s,a){var o,c;for(r||(r=3),i||(i=0),n?c=Math.min(n*r+i,t.length):c=t.length,o=i;o<c;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();var G={};ie(G,{add:()=>tn,ceil:()=>en,clone:()=>Ki,copy:()=>Qi,create:()=>Qe,cross:()=>mn,dist:()=>An,distance:()=>rr,div:()=>Rn,divide:()=>er,dot:()=>dn,equals:()=>wn,exactEquals:()=>yn,floor:()=>rn,forEach:()=>Cn,fromValues:()=>Zi,inverse:()=>ln,len:()=>Ln,length:()=>nr,lerp:()=>un,max:()=>sn,min:()=>nn,mul:()=>En,multiply:()=>tr,negate:()=>hn,normalize:()=>pn,random:()=>fn,round:()=>an,scale:()=>on,scaleAndAdd:()=>cn,set:()=>Ji,sqrDist:()=>Sn,sqrLen:()=>Tn,squaredDistance:()=>ir,squaredLength:()=>sr,str:()=>xn,sub:()=>Mn,subtract:()=>Je,transformMat4:()=>gn,transformQuat:()=>vn,zero:()=>bn});function Qe(){var e=new W(4);return W!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ki(e){var t=new W(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Zi(e,t,r,i){var n=new W(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Qi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ji(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function tn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Je(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function tr(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function er(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function en(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function rn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function nn(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function sn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function an(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function on(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function cn(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function rr(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.hypot(r,i,n,s)}function ir(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function nr(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function sr(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function hn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ln(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function pn(e,t){var r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a,e}function dn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function mn(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],c=r[1]*i[3]-r[3]*i[1],h=r[2]*i[3]-r[3]*i[2],l=t[0],d=t[1],u=t[2],f=t[3];return e[0]=d*h-u*c+f*o,e[1]=-(l*h)+u*a-f*s,e[2]=l*c-d*a+f*n,e[3]=-(l*o)+d*s-u*n,e}function un(e,t,r,i){var n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function fn(e,t){t=t||1;var r,i,n,s,a,o;do r=ht()*2-1,i=ht()*2-1,a=r*r+i*i;while(a>=1);do n=ht()*2-1,s=ht()*2-1,o=n*n+s*s;while(o>=1);var c=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*c,e[3]=t*s*c,e}function gn(e,t,r){var i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function vn(e,t,r){var i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],c=r[2],h=r[3],l=h*i+o*s-c*n,d=h*n+c*i-a*s,u=h*s+a*n-o*i,f=-a*i-o*n-c*s;return e[0]=l*h+f*-a+d*-c-u*-o,e[1]=d*h+f*-o+u*-a-l*-c,e[2]=u*h+f*-c+l*-o-d*-a,e[3]=t[3],e}function bn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function xn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function yn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function wn(e,t){var r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],c=t[2],h=t[3];return Math.abs(r-a)<=I*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=I*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-c)<=I*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-h)<=I*Math.max(1,Math.abs(s),Math.abs(h))}var Mn=Je,En=tr,Rn=er,An=rr,Sn=ir,Ln=nr,Tn=sr,Cn=function(){var e=Qe();return function(t,r,i,n,s,a){var o,c;for(r||(r=4),i||(i=0),n?c=Math.min(n*r+i,t.length):c=t.length,o=i;o<c;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();var yt=class{static load(t){return C(this,null,function*(){try{if(this.cache.has(t))return w.debug("FileUtils","Loading file from cache: ".concat(t)),this.cache.get(t);w.debug("FileUtils","Loading file: ".concat(t));let r=yield fetch("".concat(window.location.href).concat(t));if(!r.ok)throw new Error("Failed to load file: ".concat(t));let i=yield r.text();return this.cache.set(t,i),i}catch(r){throw w.error("FileUtils","Failed to load file: ".concat(t),r),r}})}};p(yt,"cache",new Map);var lt=class lt{constructor(t,r){this.gl=t;this.name=r;p(this,"program",null);p(this,"buffers",{});p(this,"attributes",{});p(this,"uniforms",{})}preprocessShader(t){let r=t.indexOf("#version");return r=t.indexOf("\n",r)+1,lt.SPLIT&&(t=t.insertAt(r,"\n#define SPLIT\n")),t}loadShader(t,r){return C(this,null,function*(){if(w.info("Shader-".concat(this.name),"Loading shader: ".concat(r,"...")),lt.cache.has(r))return w.debug("Shader-".concat(this.name),"Shader cached!"),lt.cache.get(r);let i=this.preprocessShader(yield yt.load("shaders/".concat(r,".glsl"))),n=this.gl.createShader(t);if(!n)throw new Error("Could not create shader");if(w.debug("Shader-".concat(this.name),"Compiling shader: ".concat(r,"...")),this.gl.shaderSource(n,i),this.gl.compileShader(n),!this.gl.getShaderParameter(n,GL.COMPILE_STATUS)){let s=this.gl.getShaderInfoLog(n);throw this.gl.deleteShader(n),new Error("Could not compile '".concat(r,"' for shader '").concat(this.name,"': ").concat(s))}return lt.cache.set(r,n),n})}setup(t){return C(this,null,function*(){yield this.setupProgram(t.source.vertex,t.source.fragment),this.setupAttributes(t),this.setupUniforms(t.uniforms),this.setupBuffers(t.buffers)})}setupProgram(t,r){return C(this,null,function*(){w.info("Shader-".concat(this.name),"Loading shader...");let i=yield this.loadShader(GL.VERTEX_SHADER,t),n=yield this.loadShader(GL.FRAGMENT_SHADER,r);w.debug("Shader-".concat(this.name),"Linking shader program...");let s=this.gl.createProgram();if(!s)throw new Error("Could not create shader program for shader '".concat(this.name,"'"));if(this.gl.attachShader(s,i),this.gl.attachShader(s,n),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,GL.LINK_STATUS)){let a=this.gl.getProgramInfoLog(s);throw this.gl.deleteProgram(s),new Error("Could not link shader program for shader '".concat(this.name,"': ").concat(a))}this.program=s})}setupAttributes(t){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let r=[];t.attributes&&r.push(...t.attributes),Object.values(t.buffers).map(i=>typeof i=="object"?i.attribute:null).filter(i=>i).forEach(i=>r.push(i)),this.attributes={};for(let i of r){if(this.attributes.hasOwnProperty(i))continue;let n=this.gl.getAttribLocation(this.program,i);if(n===-1)throw new Error("Could not find attribute '".concat(i,"' on shader '").concat(this.name,"'"));this.attributes[i]=n}}setupUniforms(t){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let r=this.gl.getProgramParameter(this.program,GL.ACTIVE_UNIFORMS);if(!r)throw new Error("Could not get active uniforms for shader '".concat(this.name,"'"));this.uniforms={};for(let i=0;i<r;i++){let n=this.gl.getActiveUniform(this.program,i);if(!n)throw new Error("Could not get active uniform '".concat(i,"' on shader '").concat(this.name,"'"));let s=this.gl.getUniformLocation(this.program,n.name);if(!s)throw new Error("Could not get location of uniform '".concat(n.name,"' on shader '").concat(this.name,"'"));if(!t.includes(n.name))throw Error("Uniform '".concat(n.name,"' is not being used on shader '").concat(this.name,"'"));this.uniforms[n.name]={location:s,type:n.type}}for(let i of t)if(!this.uniforms.hasOwnProperty(i))throw new Error("Could not find uniform '".concat(i,"' on shader '").concat(this.name,"'"))}setupBuffers(t){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));this.buffers={};for(let r in t){if(!t.hasOwnProperty(r))continue;let i=t[r],n=this.gl.createBuffer();if(!n)throw new Error("Could not create buffer");let s=GL.ARRAY_BUFFER,a=GL.STATIC_DRAW,o=null,c=r,h=null;if(typeof i=="object"){let l=i;l.attribute&&(c=l.attribute),l.target&&(s=l.target),l.usage&&(a=l.usage),l.data&&(i=l.data)}if(i instanceof Float32Array||i instanceof Uint16Array||i instanceof Uint8Array||i instanceof Int16Array||i instanceof Int8Array||i instanceof Uint32Array||i instanceof Int32Array?h=i:typeof i=="function"&&(o=i),this.gl.bindBuffer(s,n),h&&(o||(o=h.constructor),this.gl.bufferData(s,h,a)),!o)throw new Error("Could not determine buffer data type for buffer '".concat(r,"' on shader '").concat(this.name,"'"));this.buffers[r]={buffer:n,type:o,attribute:c,target:s,usage:a}}}bindBuffer(t,r=null){let i=this.buffers[t];if(!i)throw new Error("Could not find buffer '".concat(t,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(i.target,i.buffer),r&&this.gl.bufferData(i.target,r,i.usage)}setUniform(t,r){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let i=this.uniforms[t];if(!i)throw new Error("Could not find uniform '".concat(t,"' on shader '").concat(this.name,"'"));switch(i.type){case GL.FLOAT:this.gl.uniform1f(i.location,r);break;case GL.FLOAT_VEC2:this.gl.uniform2fv(i.location,r);break;case GL.FLOAT_VEC3:this.gl.uniform3fv(i.location,r);break;case GL.FLOAT_VEC4:this.gl.uniform4fv(i.location,r);break;case GL.FLOAT_MAT4:this.gl.uniformMatrix4fv(i.location,!1,r);break;case GL.SAMPLER_2D:this.gl.uniform1i(i.location,r);break;default:throw new Error("Uniform type '".concat(i.type,"' not supported"))}}extractAttributeInfo(t,r){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let i=this.gl.getActiveAttrib(this.program,r);if(!i)throw new Error("Could not get attribute info for '".concat(t,"' on shader '").concat(this.name,"'"));let n={[GL.FLOAT]:1,[GL.FLOAT_VEC2]:2,[GL.FLOAT_VEC3]:3,[GL.FLOAT_VEC4]:4}[i.type];return{type:{[GL.FLOAT]:GL.FLOAT,[GL.FLOAT_VEC2]:GL.FLOAT,[GL.FLOAT_VEC3]:GL.FLOAT,[GL.FLOAT_VEC4]:GL.FLOAT}[i.type],size:n}}bind(){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));for(let t in this.attributes){if(!this.attributes.hasOwnProperty(t))continue;let r=this.attributes[t],i=Object.values(this.buffers).find(a=>a.attribute===t);if(!i)throw new Error("Could not find buffer '".concat(t,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(i.target,i.buffer);let{type:n,size:s}=this.extractAttributeInfo(t,r);this.gl.vertexAttribPointer(r,s,n,!1,0,0),this.gl.enableVertexAttribArray(r)}this.gl.useProgram(this.program)}};p(lt,"SPLIT",!1),p(lt,"cache",new Map);var Q=lt;var wt=class{static load(t,r=null){return new Promise((i,n)=>{if(this.cache.has(t)){let a=this.cache.get(t);if(a===void 0)throw new Error("Unexpected undefined value in cache");return i(a)}let s=new Image;s.src="".concat(window.location.href,"assets/images/").concat(t,".png"),s.crossOrigin="anonymous",s.style.display="none",s.id="image-".concat(t),r&&(s.width=r.width,s.height=r.height),s.onerror=a=>{w.error("ImageUtils","Failed to load image: ".concat(t),a.toString()),n(a)},s.onload=()=>{this.cache.set(t,s),i(s)}})}static get(t){if(!this.cache.has(t))return null;let r=this.cache.get(t);if(r===void 0)throw new Error("Unexpected undefined value in cache");return r}};p(wt,"cache",new Map);var X=class{constructor(t){this.gl=t;p(this,"texture",null)}load(t,r=!0){return C(this,null,function*(){let i=yield wt.load(t),n=this.gl.createTexture();if(!n)throw new Error("Could not create texture for '".concat(t,"'"));this.texture=n,this.gl.bindTexture(GL.TEXTURE_2D,n),this.gl.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,GL.RGBA,GL.UNSIGNED_BYTE,i),r?(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.NEAREST),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.NEAREST)):(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR)),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE),this.gl.enableAnisotropicFiltering()})}bind(){this.gl.activeTexture(GL.TEXTURE0),this.gl.bindTexture(GL.TEXTURE_2D,this.texture)}};p(X,"terrain");var It=class{constructor(t,r,i,n,s,a){this.gl=t;this.position=r;this.vertices=i;this.uvs=n;this.normals=s;this.indices=a;p(this,"shader")}setup(){return C(this,null,function*(){X.terrain||(X.terrain=new X(this.gl),yield X.terrain.load("terrain")),this.shader=new Q(this.gl,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:this.vertices,attribute:"a_position"},uv:{data:this.uvs,attribute:"a_texcoord"},normal:{data:this.normals,attribute:"a_normal"},index:{data:this.indices,target:GL.ELEMENT_ARRAY_BUFFER}}})})}render(t,r){this.shader.bind(),X.terrain.bind();let i=T.create();T.translate(i,i,this.position.toMatrixVec3()),T.multiply(i,r,i),this.shader.setUniform("u_modelView",i),this.shader.setUniform("u_projection",t),this.shader.setUniform("u_texture",0),this.shader.bindBuffer("index",this.indices),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0)}};var ut=(e,t)=>(t+1)*16+e,q=(o=>(o[o.DIRT=ut(2,0)]="DIRT",o[o.GRASS=ut(0,0)]="GRASS",o[o.GRASS_SIDE=ut(3,0)]="GRASS_SIDE",o[o.DIAMOND_ORE=ut(2,3)]="DIAMOND_ORE",o[o.STONE=ut(1,0)]="STONE",o[o.SAND=ut(2,1)]="SAND",o[o.SNOW=ut(2,4)]="SNOW",o))(q||{}),L=class L extends It{constructor(r,i,n,s){let a=[n,n,i,s,n,n].map(L.getUV).flat();super(r,L.vertices,new Float32Array(a),L.normals,L.indices);this.topFace=i;this.sideFace=n;this.bottomFace=s}static getUV(r){let s=Math.floor(r/16),a=r%16;return[a/16,(16-s)/16,(a+1)/16,(16-s)/16,(a+1)/16,(16-s+1)/16,a/16,(16-s+1)/16]}};p(L,"frontFaceVertices",[-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]),p(L,"backFaceVertices",[.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5]),p(L,"topFaceVertices",[-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5]),p(L,"bottomFaceVertices",[-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5]),p(L,"rightFaceVertices",[.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5]),p(L,"leftFaceVertices",[-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5]),p(L,"vertices",new Float32Array([...L.frontFaceVertices,...L.backFaceVertices,...L.topFaceVertices,...L.bottomFaceVertices,...L.rightFaceVertices,...L.leftFaceVertices])),p(L,"frontFaceIndices",[0,1,2,0,2,3]),p(L,"backFaceIndices",[4,5,6,4,6,7]),p(L,"topFaceIndices",[8,9,10,8,10,11]),p(L,"bottomFaceIndices",[12,13,14,12,14,15]),p(L,"rightFaceIndices",[16,17,18,16,18,19]),p(L,"leftFaceIndices",[20,21,22,20,22,23]),p(L,"indices",new Uint16Array([...L.frontFaceIndices,...L.backFaceIndices,...L.topFaceIndices,...L.bottomFaceIndices,...L.rightFaceIndices,...L.leftFaceIndices])),p(L,"frontFaceNormals",[0,0,1,0,0,1,0,0,1,0,0,1]),p(L,"backFaceNormals",[0,0,-1,0,0,-1,0,0,-1,0,0,-1]),p(L,"topFaceNormals",[0,1,0,0,1,0,0,1,0,0,1,0]),p(L,"bottomFaceNormals",[0,-1,0,0,-1,0,0,-1,0,0,-1,0]),p(L,"rightFaceNormals",[1,0,0,1,0,0,1,0,0,1,0,0]),p(L,"leftFaceNormals",[-1,0,0,-1,0,0,-1,0,0,-1,0,0]),p(L,"normals",new Float32Array([...L.frontFaceNormals,...L.backFaceNormals,...L.topFaceNormals,...L.bottomFaceNormals,...L.rightFaceNormals,...L.leftFaceNormals]));var _=L;var et=class et{constructor(t,r,i,n,s){this.position=t;this.vertices=r;this.uvs=i;this.normals=n;this.indices=s}get vertexCount(){return this.vertices.length/3}get triangleCount(){return this.indices.length/3}get globalPosition(){return A.fromValues(this.position.x*$,0,this.position.y*$)}get globalCenterPosition(){return A.fromValues(this.position.x*$+$/2,0,this.position.y*$+$/2)}render(t,r,i){et.shader.bind(),X.terrain.bind();let n=A.fromValues(Math.ceil(this.position.x*$),0,Math.ceil(this.position.y*$)),s=T.create();T.translate(s,s,n),T.multiply(s,i,s),et.shader.setUniform("u_modelView",s),et.shader.setUniform("u_projection",r),et.shader.setUniform("u_texture",0),et.shader.bindBuffer("vertex",this.vertices),et.shader.bindBuffer("uv",this.uvs),et.shader.bindBuffer("index",this.indices),et.shader.bindBuffer("normal",this.normals),t.drawElements(GL.TRIANGLES,this.indices.length,GL.UNSIGNED_SHORT,0)}static setup(t){return C(this,null,function*(){X.terrain||(X.terrain=new X(t),yield X.terrain.load("terrain")),this.shader=new Q(t,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:Float32Array,attribute:"a_position"},uv:{data:Float32Array,attribute:"a_texcoord"},normal:{data:Float32Array,attribute:"a_normal"},index:{data:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}};p(et,"shader");var ft=et;var Dn=[0,1,2,0,2,3],Gt=class{constructor(){p(this,"vertices",[]);p(this,"normals",[]);p(this,"uvs",[]);p(this,"indices",[])}addQuad(t,r,i,n){this.normals.push(...i),this.uvs.push(...n);let s=this.vertices.length/3;this.indices.push(...Dn.map(a=>a+s)),this.vertices.push(...r.map((a,o)=>a+t[o%3]))}build(t){return new ft(t,new Float32Array(this.vertices),new Float32Array(this.uvs),new Float32Array(this.normals),new Uint16Array(this.indices))}};var J=class e{constructor(t,r=void 0,i=void 0){p(this,"x");p(this,"y");p(this,"z");this.x=t,r===void 0?this.y=t:this.y=r,i===void 0?this.z=t:this.z=i}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}add(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new e(this.x*t,this.y*t,this.z*t)}divide(t){if(t===0)throw new Error("Cannot divide by zero.");return new e(this.x/t,this.y/t,this.z/t)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let t=this.length;return new e(this.x/t,this.y/t,this.z/t)}clone(){return new e(this.x,this.y,this.z)}toArray(){return[this.x,this.y,this.z]}toMatrixVec3(){return A.fromValues(this.x,this.y,this.z)}static distance(t,r){return Math.sqrt(pt(t.x-r.x,2)+pt(t.y-r.y,2)+pt(t.z-r.z,2))}static random(t){return new e(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize().multiply(t)}static get zero(){return new e(0,0,0)}toString(){return"{ ".concat(this.x,", ").concat(this.y,", ").concat(this.z," }")}};var Pn=.5*(Math.sqrt(3)-1),Mt=(3-Math.sqrt(3))/6,Vs=1/3,zs=1/6,$s=(Math.sqrt(5)-1)/4,_s=(5-Math.sqrt(5))/20,ar=e=>Math.floor(e)|0,or=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function cr(e=Math.random){let t=Fn(e),r=new Float64Array(t).map(n=>or[n%12*2]),i=new Float64Array(t).map(n=>or[n%12*2+1]);return function(s,a){let o=0,c=0,h=0,l=(s+a)*Pn,d=ar(s+l),u=ar(a+l),f=(d+u)*Mt,x=d-f,b=u-f,m=s-x,v=a-b,S,M;m>v?(S=1,M=0):(S=0,M=1);let R=m-S+Mt,g=v-M+Mt,E=m-1+2*Mt,U=v-1+2*Mt,N=d&255,B=u&255,k=.5-m*m-v*v;if(k>=0){let O=N+t[B],D=r[O],H=i[O];k*=k,o=k*k*(D*m+H*v)}let V=.5-R*R-g*g;if(V>=0){let O=N+S+t[B+M],D=r[O],H=i[O];V*=V,c=V*V*(D*R+H*g)}let z=.5-E*E-U*U;if(z>=0){let O=N+1+t[B+1],D=r[O],H=i[O];z*=z,h=z*z*(D*E+H*U)}return 70*(o+c+h)}}function Fn(e){let r=new Uint8Array(512);for(let i=0;i<512/2;i++)r[i]=i;for(let i=0;i<512/2-1;i++){let n=i+~~(e()*(256-i)),s=r[i];r[i]=r[n],r[n]=s}for(let i=256;i<512;i++)r[i]=r[i-256];return r}var pr=De(lr());var Nt=new J(0,1,0),kt=new J(0,-1,0),pe=new J(-1,0,0),de=new J(1,0,0),me=new J(0,0,1),ue=new J(0,0,-1);var fe=class{constructor(t,r,i){this.width=t;this.height=r;this.depth=i;p(this,"data");this.data=new Array(t*r*i)}get(t,r,i){return t instanceof J?this.get(t.x,t.y,t.z):t<0||t>=this.width||r<0||r>=this.height||i<0||i>=this.depth?null:this.data[t+r*this.width+i*this.width*this.height]}set(t,r,i,n){if(t instanceof J)return this.set(t.x,t.y,t.z,r);if(t<0||t>=this.width||r<0||r>=this.height||i<0||i>=this.depth)return null;this.data[t+r*this.width+i*this.width*this.height]=n}},Et=class{constructor(t,r,i,n,s){this.scale=i;this.min=n;this.max=s;p(this,"generators");this.generators=[];for(let a=0;a<r;a++)this.generators.push(cr((0,pr.default)(t+a)))}get(t,r){let i=0,n=1,s=1,a=0;for(let o of this.generators)i+=o(t/this.scale*s,r/this.scale*s)*n,a+=n,n/=2,s*=2;return i=(i/a+1)/2,i*(this.max-this.min)+this.min}},nt=class nt{static generateChunk(t){let r=new Gt,i=this.generateCubeTypes(t);for(let n=0;n<$;n++)for(let s=0;s<ct;s++)for(let a=0;a<$;a++){let o=i.get(n,s,a);if(o){let c=new J(n,s,a),h=c.toArray(),l=i.get(c.add(Nt)),d=i.get(c.add(kt)),u=i.get(c.add(pe)),f=i.get(c.add(de)),x=i.get(c.add(me)),b=i.get(c.add(ue));x||this.addFace(r,h,me,o),b||this.addFace(r,h,ue,o),l||this.addFace(r,h,Nt,o),!d&&s>0&&this.addFace(r,h,kt,o),f||this.addFace(r,h,de,o),u||this.addFace(r,h,pe,o)}}return r.build(t)}static getFace(t,r){return r===q.GRASS?t===Nt?q.GRASS:t===kt?q.DIRT:q.GRASS_SIDE:r}static addFace(t,r,i,n){let s=_.getUV(this.getFace(i,n));if(i===Nt)t.addQuad(r,_.topFaceVertices,_.topFaceNormals,s);else if(i===kt)t.addQuad(r,_.bottomFaceVertices,_.bottomFaceNormals,s);else if(i===pe)t.addQuad(r,_.leftFaceVertices,_.leftFaceNormals,s);else if(i===de)t.addQuad(r,_.rightFaceVertices,_.rightFaceNormals,s);else if(i===me)t.addQuad(r,_.frontFaceVertices,_.frontFaceNormals,s);else if(i===ue)t.addQuad(r,_.backFaceVertices,_.backFaceNormals,s);else throw new Error("Invalid direction")}static getAltitudeAt(t,r,i){let n=this.altitudeNoiseGenerator.get(t,r),s={min:ct*.11,max:ct*.5};switch(i){case 1:s.min=4,s.max=7;break;case 3:s.min=4,s.max=32;break;case 2:s.min=4,s.max=15;break;case 0:s.min=4,s.max=12;break}return n*(s.max-s.min)+s.min}static getBiomeAt(t,r){let i=this.moistureNoiseGenerator.get(t,r),n=this.temperatureNoiseGenerator.get(t,r);return i>80&&n>25?3:n>30&&i<40?1:0}static generateCubeTypes(t){let r=new fe($,ct,$),i=3,n=-1;for(let s=0;s<$;s++){for(let a=0;a<$;a++){let o=s+Math.ceil(t.x*$),c=a+Math.ceil(t.y*$),h=this.getBiomeAt(o,c),l=this.getAltitudeAt(o,c,h);if(n!==-1){let d=l;l=Math.round((n+l)/2),n=d}else n=l;for(let d=0;d<ct;d++)if(d<i)r.set(s,d,a,q.STONE);else if(d<l)switch(h){case 0:d>=l-1?r.set(s,d,a,q.GRASS):r.set(s,d,a,q.DIRT);break;case 1:r.set(s,d,a,q.SAND);break;case 3:d>l*.9?r.set(s,d,a,q.SNOW):d<l/2?r.set(s,d,a,q.STONE):r.set(s,d,a,q.DIRT);break;case 2:r.set(s,d,a,q.SNOW);break}else r.set(s,d,a,null)}n=-1}return r}};p(nt,"seed","myseed"+Math.random()),p(nt,"altitudeNoiseGenerator",new Et("".concat(nt.seed,"-altitude"),4,100,0,1)),p(nt,"moistureNoiseGenerator",new Et("".concat(nt.seed,"-moisture"),1,50,0,100)),p(nt,"temperatureNoiseGenerator",new Et("".concat(nt.seed,"-temperature"),1,100,20,50));var Ut=nt;var st=class{static hash(t,r){return"".concat(t,"|").concat(r)}static updateActiveChunks(t){let r=new rt(t.x-Y.RENDER_DISTANCE/2,t.y-Y.RENDER_DISTANCE/2,Y.RENDER_DISTANCE,Y.RENDER_DISTANCE),i=0,n=[];for(let s=r.x;s<r.x+r.width;s++)for(let a=r.y;a<r.y+r.height;a++){if(!this.chunks[this.hash(s,a)]&&(i++,i>1))continue;let o=this.getChunk(s,a);n.push(o)}this.activeChunks=n}static getChunk(t,r){let i=this.hash(t,r),n=this.chunks[i];return n||(n=Ut.generateChunk(new P(t,r)),this.chunks[i]=n),n}static setChunk(t,r,i){this.chunks[this.hash(t,r)]=i}static deleteChunk(t,r){delete this.chunks[this.hash(t,r)]}static clear(){this.chunks={}}};p(st,"chunks",{}),p(st,"activeChunks",[]);var Ot=(v=>(v.W="w",v.A="a",v.S="s",v.D="d",v.R="r",v.C="c",v.Shift="shift",v.Ctrl="ctrl",v.ArrowUp="arrowup",v.ArrowDown="arrowdown",v.ArrowLeft="arrowleft",v.ArrowRight="arrowright",v.Space=" ",v.Escape="escape",v.F12="f12",v.Apostrophe="'",v.Quote='"',v))(Ot||{});var gt=(i=>(i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i))(gt||{});var Bt=(g=>(g[g.A=0]="A",g[g.B=1]="B",g[g.X=2]="X",g[g.Y=3]="Y",g[g.LB=4]="LB",g[g.RB=5]="RB",g[g.LT=6]="LT",g[g.RT=7]="RT",g[g.Back=8]="Back",g[g.Start=9]="Start",g[g.Home=16]="Home",g[g.LS=10]="LS",g[g.RS=11]="RS",g[g.Up=12]="Up",g[g.Down=13]="Down",g[g.Left=14]="Left",g[g.Right=15]="Right",g[g.UNUSED_1=17]="UNUSED_1",g[g.UNUSED_2=18]="UNUSED_2",g[g.UNUSED_3=19]="UNUSED_3",g[g.UNUSED_4=20]="UNUSED_4",g))(Bt||{});var Vt=(a=>(a[a.LeftStickX=0]="LeftStickX",a[a.LeftStickY=1]="LeftStickY",a[a.RightStickX=2]="RightStickX",a[a.RightStickY=3]="RightStickY",a[a.LeftTrigger=4]="LeftTrigger",a[a.RightTrigger=5]="RightTrigger",a))(Vt||{});var ge=class{constructor(t,r,i){this.rect=t;this.color=r;this.thickness=i}render(t){t.strokeStyle=this.color,t.lineWidth=this.thickness,t.strokeRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},ve=class{constructor(t,r){this.rect=t;this.color=r}render(t){t.fillStyle=this.color,t.fillRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},be=class{constructor(t,r,i,n){this.start=t;this.end=r;this.color=i;this.thickness=n}render(t){t.strokeStyle=this.color,t.lineWidth=this.thickness,t.beginPath(),t.moveTo(this.start.x,this.start.y),t.lineTo(this.end.x,this.end.y),t.stroke()}},xe=class{constructor(t,r,i,n){this.center=t;this.radius=r;this.color=i;this.fill=n}render(t){this.fill?t.fillStyle=this.color:t.strokeStyle=this.color,t.lineWidth=1,t.beginPath(),t.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),this.fill?t.fill():t.stroke()}},ye=class{constructor(t,r,i,n){this.text=t;this.position=r;this.color=i;this.alignment=n}render(t){t.save(),t.fillStyle=this.color,t.font="12px Arial",t.textAlign=this.alignment,t.fillText(this.text,this.position.x,this.position.y),t.restore()}},we=class{constructor(t,r,i){this.origin=t;this.vector=r;this.color=i;p(this,"ARROWHEAD_LENGTH",10);p(this,"ARROWHEAD_ANGLE",Math.PI/6);p(this,"MIN_LENGTH",1);p(this,"MAX_LENGTH",100)}render(t){let r=this.vector.length;if(r<this.MIN_LENGTH)return;r>this.MAX_LENGTH&&(this.vector=this.vector.normalize().multiply(this.MAX_LENGTH),r=this.MAX_LENGTH);let i=(r-this.MIN_LENGTH)/(this.MAX_LENGTH-this.MIN_LENGTH),n=it.alpha(this.color,i);t.fillStyle=n,t.strokeStyle=n,t.lineWidth=1.5,t.lineCap="round",t.beginPath(),t.moveTo(this.origin.x,this.origin.y),t.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.stroke();let s=10,a=Math.PI/6,o=Math.atan2(this.vector.y,this.vector.x);t.beginPath(),t.moveTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.lineTo(this.origin.x+this.vector.x-s*Math.cos(o-a),this.origin.y+this.vector.y-s*Math.sin(o-a)),t.lineTo(this.origin.x+this.vector.x-s*Math.cos(o+a),this.origin.y+this.vector.y-s*Math.sin(o+a)),t.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.fill()}},y=class y{constructor(t,r,i){this.position=t;this.buttons=r;this.axes=i;this.position=this.position.subtract(new P(y.width/2,y.height/2))}getColor(t){return this.buttons[t].active?y.activeColor:y.buttonColor}getTextColor(t){return this.buttons[t].active?y.textColor:y.color}renderAnalogStick(t,r,i,n,s){let a=y.outerRadius;t.fillStyle=y.color,t.fillCircle(r.x,r.y,a),t.fillStyle=this.getColor(i),t.fillCircle(r.x+this.axes[n]*a,r.y+this.axes[s]*a,y.innerRadius)}renderDpad(t,r){let i=y.buttonSize;t.fillStyle=y.color,t.fillCircle(r.x+i,r.y+i/2,i*2),t.fillStyle=this.getColor(14),t.beginPath(),t.roundRect(r.x-i/2,r.y,i,i,[i/4,0,0,i/4]),t.fill(),t.fillStyle=this.getColor(15),t.beginPath(),t.roundRect(r.x+i*1.5,r.y,i,i,[0,i/4,i/4,0]),t.fill(),t.fillStyle=this.getColor(12),t.beginPath(),t.roundRect(r.x+i/2,r.y-i,i,i,[i/4,i/4,0,0]),t.fill(),t.fillStyle=this.getColor(13),t.beginPath(),t.roundRect(r.x+i/2,r.y+i,i,i,[0,0,i/4,i/4]),t.fill(),t.fillStyle=y.buttonColor,t.fillRect(r.x+i/2,r.y,i,i)}renderButtons(t,r){let i=y.buttonSize*1.25;t.font="".concat(i/2,"px Arial"),t.fillStyle=y.color,t.fillCircle(r.x-i,r.y+i/2,i*1.75),t.fillStyle=this.getColor(3),t.fillCircle(r.x-i,r.y-i/2,i/2),t.fillStyle=this.getTextColor(3),t.fillTextAligned("Y",r.x-i,r.y-i*.75,"center"),t.fillStyle=this.getColor(2),t.fillCircle(r.x-i*2,r.y+i/2,i/2),t.fillStyle=this.getTextColor(2),t.fillTextAligned("X",r.x-i*2,r.y+i*.25,"center"),t.fillStyle=this.getColor(0),t.fillCircle(r.x-i,r.y+i*1.5,i/2),t.fillStyle=this.getTextColor(0),t.fillTextAligned("A",r.x-i,r.y+i*1.25,"center"),t.fillStyle=this.getColor(1),t.fillCircle(r.x,r.y+i/2,i/2),t.fillStyle=this.getTextColor(1),t.fillTextAligned("B",r.x,r.y+i*.25,"center")}renderBumpersAndTriggers(t,r,i,n){var o;let s=y.buttonSize;t.fillStyle=this.getColor(i),t.beginPath(),t.roundRect(r.x,r.y-s/1.5,s*3,s/1.5,[s/4,s/4,0,0]),t.fill();let a=Math.abs((o=this.buttons[n].value)!=null?o:0);t.fillStyle=it.mix(y.color,y.activeColor,a),a=1-a*.75,t.beginPath(),t.roundRect(r.x+s/1.5,r.y-2.5-s/2-s*a,s*1.5,s*1*a,[s/4,s/4,0,0]),t.fill()}renderExtraButtons(t,r){let i=y.buttonSize;t.fillStyle=this.getColor(8),t.fillCircle(r.x-i*2,r.y-i/2,i/2),t.fillStyle=this.getColor(16),t.fillCircle(r.x,r.y,i/2),t.fillStyle=this.getColor(9),t.fillCircle(r.x+i*2,r.y-i/2,i/2)}renderBackground(t){t.fillStyle=y.color,t.beginPath(),t.roundRect(this.position.x,this.position.y,y.width,y.height-y.outerRadius/2.5,[y.outerRadius,y.outerRadius,0]),t.save();let r=y.outerRadius*3,i=y.outerRadius*4,n=this.position.x,s=this.position.y+y.height-y.outerRadius*3;t.roundRect(n,s,r,i,[y.outerRadius*2,0,y.outerRadius*8,y.outerRadius*8]),t.restore(),t.save(),n=this.position.x+y.width-r,s=this.position.y+y.height-y.outerRadius*3,t.roundRect(n,s,r,i,[0,y.outerRadius*2,y.outerRadius*8,y.outerRadius*8]),t.restore(),t.fill()}render(t){this.renderBackground(t),this.renderAnalogStick(t,new P(this.position.x+y.width/3,this.position.y+y.height-y.outerRadius-y.buttonSize),10,0,1),this.renderAnalogStick(t,new P(this.position.x+y.width-y.width/3,this.position.y+y.height-y.outerRadius-y.buttonSize),11,2,3),this.renderDpad(t,new P(this.position.x+y.buttonSize*2,this.position.y+y.buttonSize*2.5)),this.renderButtons(t,new P(this.position.x+y.width-y.buttonSize*2,this.position.y+y.buttonSize*2.5)),this.renderBumpersAndTriggers(t,new P(this.position.x+y.outerRadius,this.position.y),4,6),this.renderBumpersAndTriggers(t,new P(this.position.x+y.width-y.outerRadius-y.buttonSize*3,this.position.y),5,7),this.renderExtraButtons(t,new P(this.position.x+y.width/2,this.position.y+y.height/2-y.buttonSize*2))}};p(y,"scale",1),p(y,"width",200*y.scale),p(y,"height",100*y.scale),p(y,"color","rgba(52, 73, 94, 0.5)"),p(y,"buttonColor","rgba(255, 255, 255, 0.5)"),p(y,"activeColor","rgba(52, 152, 219, 0.85)"),p(y,"textColor","rgba(255, 255, 255, 0.75)"),p(y,"outerRadius",20*y.scale),p(y,"innerRadius",10*y.scale),p(y,"buttonSize",10*y.scale);var Me=y,j=class{static render(t){}static clear(){}static rect(t,r="#fff"){}static outline(t,r="#fff",i=1){}static line(t,r,i="#fff",n=1){}static circle(t,r,i="#fff",n=!0){}static text(t,r,i="#fff",n="left"){}static arrow(t,r,i="#fff"){}static gamepad(t,r,i){}};p(j,"list",[]);var F=class{static get isDirty(){return this.invalidated}static isKeyDown(...t){return t.some(r=>{var i;return(i=this.keys[r])==null?void 0:i.active})}static isKeyUp(...t){return t.some(r=>{var i;return!((i=this.keys[r])!=null&&i.active)})}static isKeyJustPressed(...t){return t.some(r=>{var i;return(i=this.keys[r])==null?void 0:i.justPressed})}static isKeyJustReleased(...t){return t.some(r=>{var i;return(i=this.keys[r])==null?void 0:i.justReleased})}static isKeyLongPressed(...t){return t.some(r=>{var i;return(i=this.keys[r])==null?void 0:i.longPress})}static isKeyShortPressed(...t){return t.some(r=>{var i;return(i=this.keys[r])==null?void 0:i.shortPress})}static onKeyDown(t){if(t.repeat)return;let r=t.key.toLowerCase();Object.values(Ot).includes(r)&&(this.VERBOSE_KEYBOARD&&w.debug("Input","Key down: ".concat(r)),this.keys[r]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},this.invalidated=!0)}static onKeyUp(t){if(t.repeat)return;let r=t.key.toLowerCase();if(this.VERBOSE_KEYBOARD&&w.debug("Input","Key up: ".concat(r)),!Object.values(Ot).includes(r))return;let i=this.keys[r];if(!i)return;i.active=!1,i.lastChange=Date.now(),i.justPressed=!1,i.justReleased=!0;let n=i.lastChange-i.lastTrigger;i.longPress=n>=mt,i.shortPress=!i.longPress,this.invalidated=!0}static updateKeyboard(){for(let t in this.keys){if(!this.keys.hasOwnProperty(t))continue;let r=this.keys[t];r.justReleased=!1,r.justPressed=!1,r.shortPress=!1,r.longPress=r.active&&Date.now()-r.lastChange>=mt}}static isMouseButtonDown(...t){return t.some(r=>{var i;return(i=this.mouseButtons[r])==null?void 0:i.active})}static isMouseButtonUp(...t){return t.some(r=>!this.mouseButtons[r]||!this.keys[r].active)}static isMouseButtonJustPressed(...t){return t.some(r=>{var i;return(i=this.mouseButtons[r])==null?void 0:i.justPressed})}static isMouseButtonJustReleased(...t){return t.some(r=>{var i;return(i=this.mouseButtons[r])==null?void 0:i.justReleased})}static isMouseButtonLongPressed(...t){return t.some(r=>{var i;return(i=this.mouseButtons[r])==null?void 0:i.longPress})}static isMouseButtonShortPressed(...t){return t.some(r=>{var i;return(i=this.mouseButtons[r])==null?void 0:i.shortPress})}static onMouseMove(t){var r,i,n,s;this.REQUIRE_LOCK_TO_MOVE&&!document.pointerLockElement||(this.VERBOSE_MOUSE&&w.debug("Input","Mouse move: ".concat(t.clientX,", ").concat(t.clientY)),this.mouseDelta.x=t.movementX,this.mouseDelta.y=t.movementY,this.mouse.x=t.clientX-((i=(r=t.target)==null?void 0:r.offsetLeft)!=null?i:0),this.mouse.y=t.clientY-((s=(n=t.target)==null?void 0:n.offsetTop)!=null?s:0))}static onMouseDown(t){Object.values(gt).includes(t.button)&&(this.VERBOSE_MOUSE&&w.debug("Input","Mouse down: ".concat(t.button)),this.mouseButtons[t.button]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},this.handlePointerLock(),this.invalidated=!0)}static onMouseUp(t){if(!Object.values(gt).includes(t.button))return;this.VERBOSE_MOUSE&&w.debug("Input","Mouse up: ".concat(t.button));let r=this.mouseButtons[t.button];if(!r)return;r.active=!1,r.lastChange=Date.now(),r.justPressed=!1,r.justReleased=!0;let i=r.lastChange-r.lastTrigger;r.longPress=i>=mt,r.shortPress=!r.longPress,this.invalidated=!0}static onPointerDown(t,r){Object.values(gt).includes(r.button)&&(document.pointerLockElement||t.setPointerCapture(r.pointerId),this.onMouseDown(r))}static onPointerUp(t,r){Object.values(gt).includes(r.button)&&(document.pointerLockElement||t.releasePointerCapture(r.pointerId),this.onMouseUp(r))}static onMouseWheel(t){this.mouseWheelDelta=t.deltaY}static handlePointerLock(){if(document.pointerLockElement)return;if(Date.now()-this.lastPointerLockTime<this.POINTER_LOCK_REQUEST_INTERVAL){this.lastPointerLockTimeoutHandle<0&&(w.debug("Input","Scheduling another pointer lock attempt"),this.lastPointerLockTimeoutHandle=setTimeout(this.handlePointerLock.bind(this),this.POINTER_LOCK_REQUEST_INTERVAL));return}this.lastPointerLockTimeoutHandle>=0&&(clearTimeout(this.lastPointerLockTimeoutHandle),this.lastPointerLockTimeoutHandle=-1);let t={unadjustedMovement:!0};try{this.lastPointerLockTime=Date.now();let r=document.body.requestPointerLock(t);r?r.then(()=>{w.debug("Input","Pointer lock acquired (async)")}).catch(i=>w.error("Input","Failed to acquire pointer lock",i)):w.debug("Input","Pointer lock acquired")}catch(r){w.error("Input","Failed to acquire pointer lock",r)}}static updateMouse(){for(let t in this.mouseButtons){if(!this.mouseButtons.hasOwnProperty(t))continue;let r=this.mouseButtons[t];r.justReleased=!1,r.justPressed=!1,r.shortPress=!1,r.longPress=r.active&&Date.now()-r.lastChange>=mt}this.mouseDelta.x=0,this.mouseDelta.y=0,this.mouseWheelDelta=0}static isGamepadButtonDown(...t){return t.some(r=>{var i;return((i=this.gamepadButtons[r])==null?void 0:i.active)===!0})}static isGamepadButtonUp(...t){return t.some(r=>{var i;return((i=this.gamepadButtons[r])==null?void 0:i.active)===!0})}static isGamepadButtonJustPressed(...t){return t.some(r=>{var i;return((i=this.gamepadButtons[r])==null?void 0:i.justPressed)===!0})}static isGamepadButtonJustReleased(...t){return t.some(r=>{var i;return((i=this.gamepadButtons[r])==null?void 0:i.justReleased)===!0})}static isGamepadButtonLongPressed(...t){return t.some(r=>{var i;return((i=this.gamepadButtons[r])==null?void 0:i.longPress)===!0})}static isGamepadButtonShortPressed(...t){return t.some(r=>{var i;return((i=this.gamepadButtons[r])==null?void 0:i.shortPress)===!0})}static onGamepadConnected(t){this.VERBOSE_GAMEPAD&&w.info("Input","Gamepad connected: ".concat(t.gamepad.id)),this.gamepad=t.gamepad,this.isFirstGamepadConnection&&(this.isFirstGamepadConnection=!1,this.invalidated=!0)}static onGamepadDisconnected(t){this.VERBOSE_GAMEPAD&&w.info("Input","Gamepad disconnected: ".concat(t.gamepad.id)),this.gamepad=null}static onGamepadPoll(){let t=navigator.getGamepads().find(r=>r);t&&(this.VERBOSE_GAMEPAD&&w.debug("Input","Gamepad found: ".concat(t.id)),this.gamepad=t,this.isFirstGamepadConnection&&(this.isFirstGamepadConnection=!1,this.invalidated=!0),clearInterval(this.gamepadPollingIntervalHandle))}static requestGamepadPoll(){this.gamepadPollingIntervalHandle=setInterval(this.onGamepadPoll.bind(this),500)}static pollForConnectedGamepad(){var r;let t=navigator.getGamepads().find(i=>{var n;return i&&i.id===((n=this.gamepad)==null?void 0:n.id)});t?this.gamepad=t:(this.VERBOSE_GAMEPAD&&w.info("Input","Gamepad disconnected: ".concat((r=this.gamepad)==null?void 0:r.id)),this.gamepad=null,this.requestGamepadPoll())}static updateGamepadButtons(){for(let t=0;t<this.gamepad.buttons.length;t++){let r=this.gamepad.buttons[t],i=this.gamepadButtons[t];if(i.value=r.value,Math.abs(i.value)<xt?i.value=0:1-Math.abs(i.value)<xt&&(i.value=Math.sign(i.value)),i.value=Math.pow(i.value,ae)*Math.sign(i.value),r.pressed!==i.active)if(this.invalidated=!0,r.pressed)i.active=!0,i.lastChange=Date.now(),i.justPressed=!0,i.justReleased=!1,i.lastTrigger=Date.now(),i.longPress=!1,i.shortPress=!1;else{i.active=!1,i.lastChange=Date.now(),i.justPressed=!1,i.justReleased=!0;let n=i.lastChange-i.lastTrigger;i.longPress=n>=mt,i.shortPress=!i.longPress}else i.justReleased=!1,i.justPressed=!1,i.shortPress=!1,i.longPress=i.active&&Date.now()-i.lastChange>=mt}}static updateGamepadAxes(){let t=[[0,1],[2,3]];for(let r of t){let i=new P(this.gamepad.axes[r[0]],this.gamepad.axes[r[1]]),n=Math.pow(i.length,ae),s=Math.max(0,n-xt)/(1-xt);i=i.divide(n).multiply(s),(this.gamepadAxes[r[0]]!==i.x||this.gamepadAxes[r[1]]!==i.y)&&(this.invalidated=!0,this.gamepadAxes[r[0]]=i.x,this.gamepadAxes[r[1]]=i.y)}}static updateGamepads(){j.gamepad(new P(window.innerWidth-125,window.innerHeight-100),this.gamepadButtons,this.gamepadAxes),this.gamepad&&("ongamepadconnected"in window||this.pollForConnectedGamepad(),this.updateGamepadButtons(),this.updateGamepadAxes())}static getMovementHorizontal(){let t=0;return(this.isKeyDown("a","arrowleft")||this.isGamepadButtonDown(14))&&(t-=1),(this.isKeyDown("d","arrowright")||this.isGamepadButtonDown(15))&&(t+=1),this.gamepad&&(t=this.gamepadAxes[0]),t}static getMovementVertical(){let t=0;return(this.isKeyDown("w","arrowup")||this.isGamepadButtonDown(12))&&(t-=1),(this.isKeyDown("s","arrowdown")||this.isGamepadButtonDown(13))&&(t+=1),this.gamepad&&(t=this.gamepadAxes[1]),t}static getLookHorizontal(){return this.mouseDelta.x!==0?this.mouseDelta.x:this.gamepad?this.gamepadAxes[2]*se:0}static getLookVertical(){return this.mouseDelta.y!==0?this.mouseDelta.y:this.gamepad?this.gamepadAxes[3]*se:0}static isJumping(){return this.isKeyDown(" ","arrowup")||this.isGamepadButtonDown(0,12)}static isCrouching(){return this.isKeyDown("shift")||this.isGamepadButtonDown(13,1)}static isRecording(){return this.isKeyJustReleased("r")}static isSwitchingCameras(){return this.isKeyJustReleased("c")}static isRunning(){return this.isKeyDown("ctrl")||this.isGamepadButtonDown(7)}static vibrate(){var t;navigator.vibrate&&navigator.vibrate(200),(t=this.gamepad)!=null&&t.vibrationActuator&&this.gamepad.vibrationActuator.playEffect("dual-rumble",{duration:100,strongMagnitude:.5,weakMagnitude:.25})}static setup(){let t=document.body;if(window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),this.mouse.x=window.innerWidth/2,this.mouse.y=window.innerHeight/2,t.addEventListener("click",this.onMouseMove.bind(this)),t.addEventListener("mousemove",this.onMouseMove.bind(this)),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("wheel",this.onMouseWheel.bind(this)),t.oncontextmenu=r=>(r.preventDefault(),r.stopPropagation(),!1),t.addEventListener("pointermove",this.onMouseMove.bind(this)),t.addEventListener("pointerdown",this.onPointerDown.bind(this,t)),t.addEventListener("pointerup",this.onPointerUp.bind(this,t)),"getGamepads"in navigator){"ongamepadconnected"in window?(window.addEventListener("gamepadconnected",this.onGamepadConnected.bind(this)),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnected.bind(this))):this.requestGamepadPoll();for(let r of Object.values(Vt))this.gamepadAxes[r]=0;for(let r of Object.values(Bt))this.gamepadButtons[r]={active:!1,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!1,justReleased:!1,longPress:!1,shortPress:!1}}}static update(){this.invalidated=!1,this.updateKeyboard(),this.updateGamepads(),this.updateMouse()}};p(F,"invalidated",!1),p(F,"VERBOSE_KEYBOARD",!1),p(F,"VERBOSE_MOUSE",!1),p(F,"VERBOSE_GAMEPAD",!1),p(F,"keys",{}),p(F,"mouse",P.zero),p(F,"mouseDelta",P.zero),p(F,"mouseButtons",{}),p(F,"mouseWheelDelta",0),p(F,"REQUIRE_LOCK_TO_MOVE",!0),p(F,"POINTER_LOCK_REQUEST_INTERVAL",1e3),p(F,"lastPointerLockTime",0),p(F,"lastPointerLockTimeoutHandle",-1),p(F,"gamepad",null),p(F,"gamepadButtons",{}),p(F,"gamepadAxes",{}),p(F,"isFirstGamepadConnection",!0),p(F,"gamepadPollingIntervalHandle",-1);var at=class{static set(t){this.current!==t&&(this.current=t,this.isDirty=!0)}static apply(t=document.body){this.isDirty&&(this.isDirty=!1,t.style.cursor=this.current)}static reset(){this.current="default",this.isDirty=!0}};p(at,"current","default"),p(at,"isDirty",!1);var zt=class{static setup(){return C(this,null,function*(){let t="".concat(oe,"pt ").concat(ce);document.fonts.check(t)||(yield document.fonts.load(t))})}};var $t=class{setup(){return Promise.resolve()}update(t){}render(t){}};var _t=class extends $t{constructor(r){super();this.main=r}get width(){return this.main.screen.width}get height(){return this.main.screen.height}get camera(){return this.main.camera}invalidate(){this.main.invalidate()}setup(){return C(this,null,function*(){w.debug("StatePlay","Setting up..."),at.set("none"),this.updateActiveChunks()})}updateActiveChunks(){st.updateActiveChunks(this.main.playerCamera.tiledPosition)}update(r){return C(this,null,function*(){this.invalidate();let i=5*(F.isRunning()?10:1),n=20;this.camera.update(r),this.camera.pitch-=F.getLookVertical()*r*n,this.camera.pitch=Math.clamp(this.camera.pitch,-89,89),this.camera.yaw+=F.getLookHorizontal()*r*n;let s=F.getMovementVertical(),a=F.getMovementHorizontal();if(this.updateActiveChunks(),s!==0){let o=this.camera.forward;this.camera.position[0]-=o[0]*r*i*s,this.camera.position[1]-=o[1]*r*i*s,this.camera.position[2]-=o[2]*r*i*s}if(a!==0){let o=this.camera.right;this.camera.position[0]+=o[0]*r*i*a,this.camera.position[1]+=o[1]*r*i*a,this.camera.position[2]+=o[2]*r*i*a}F.isCrouching()&&(this.camera.position[1]-=r*i),F.isJumping()&&(this.camera.position[1]+=r*i),this.main.useDebugCamera&&j.outline(new rt(10,10,this.width-10*2,this.height-10*2),"#ff0000",10),j.text("Position",new P(this.width/2,this.height-80),"gray","center"),j.text("{ ".concat(this.camera.position[0].toFixed(2),", ").concat(this.camera.position[1].toFixed(2),", ").concat(this.camera.position[2].toFixed(2)," }"),new P(this.width/2,this.height-60),"white","center"),j.text("Rotation",new P(this.width/2,this.height-40),"gray","center"),j.text("{ ".concat(this.camera.pitch.toFixed(2),", ").concat(this.camera.yaw.toFixed(2),", ").concat(this.camera.roll.toFixed(2)," }"),new P(this.width/2,this.height-20),"white","center")})}render(r){}};var Ht=class{constructor(t=void 0){p(this,"element",document.createElement("canvas"));p(this,"context");p(this,"virtualWidth",0);p(this,"virtualHeight",0);p(this,"drawRatio",1);p(this,"overrideRatio");t&&(this.element.id=t);let r=this.element.getContext("2d");if(!r)throw new Error("Could not get context of canvas");this.context=r,this.context.imageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.filter="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxmaWx0ZXIgaWQ9ImZpbHRlciIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVGdW5jUiB0eXBlPSJpZGVudGl0eSIvPjxmZUZ1bmNHIHR5cGU9ImlkZW50aXR5Ii8+PGZlRnVuY0IgdHlwZT0iaWRlbnRpdHkiLz48ZmVGdW5jQSB0eXBlPSJkaXNjcmV0ZSIgdGFibGVWYWx1ZXM9IjAgMSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj48L2ZpbHRlcj48L3N2Zz4=#filter)",this.element.oncontextmenu=()=>!1}get backingStoreRatio(){return this.overrideRatio||this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1}get devicePixelRation(){return this.overrideRatio||window.devicePixelRatio||1}getDrawRatio(t,r){return r/t}setSize(t,r){this.drawRatio=this.getDrawRatio(this.backingStoreRatio,this.devicePixelRation),this.backingStoreRatio!==this.devicePixelRation?(this.element.width=t*this.drawRatio,this.element.height=r*this.drawRatio,this.element.style.width="".concat(t,"px"),this.element.style.minWidth="".concat(t,"px"),this.element.style.height="".concat(r,"px"),this.element.style.minHeight="".concat(r,"px")):(this.element.width=t,this.element.height=r,this.element.style.width="",this.element.style.height=""),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=t,this.virtualHeight=r}clear(){this.context.clearRect(0,0,this.element.width,this.element.height)}drawTo(t,r,i){i.save(),i.scale(1/this.drawRatio,1/this.drawRatio),i.drawImage(this.element,t,r),i.restore()}attachToElement(t){t.appendChild(this.element)}get width(){return this.virtualWidth||this.element.width}get height(){return this.virtualHeight||this.element.height}get bounds(){return new rt(0,0,this.width,this.height)}get size(){return{width:this.width,height:this.height}}};var Wt=class{constructor(t){this.main=t;p(this,"canvas",new Ht("gui-canvas"));p(this,"isDirty",!0)}get element(){return this.canvas.element}get context(){return this.canvas.context}invalidate(){this.isDirty=!0}setup(){this.canvas.attachToElement(document.body)}setSize(t){this.canvas.setSize(t.width,t.height)}clear(){this.canvas.clear()}render(){this.isDirty&&(this.clear(),this.isDirty=!1)}};var Rt=class{constructor(t){this.gl=t;p(this,"colorBuffer");p(this,"depthBuffer");p(this,"frameBuffer");this.setup()}setup(){w.debug("FrameBuffer","Setting up frame buffer...");let t=this.gl.createFramebuffer();if(!t)throw new Error("Could not create frame buffer");this.frameBuffer=t,this.setupColorTexture(),this.setupDepthBuffer();let r=this.gl.checkFramebufferStatus(GL.FRAMEBUFFER);if(r!==this.gl.FRAMEBUFFER_COMPLETE)throw new Error("Frame buffer is incomplete: ".concat(r))}setupDepthBuffer(){let t=this.gl.createRenderbuffer();if(!t)throw new Error("Could not create depth buffer");this.depthBuffer=t,this.gl.bindRenderbuffer(GL.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_COMPONENT16,this.gl.canvas.width,this.gl.canvas.height),this.bind(),this.gl.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_ATTACHMENT,GL.RENDERBUFFER,this.depthBuffer),this.unbind()}setupColorTexture(){let t=this.gl.createTexture();if(!t)throw new Error("Could not create texture");this.colorBuffer=t,this.gl.bindTexture(GL.TEXTURE_2D,this.colorBuffer),this.gl.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,this.gl.canvas.width,this.gl.canvas.height,0,GL.RGBA,GL.UNSIGNED_BYTE,null),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE),this.bind(),this.gl.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,this.colorBuffer,0),this.unbind()}resize(){w.debug("FrameBuffer","Resizing frame buffer..."),this.setupColorTexture(),this.setupDepthBuffer()}bind(){this.gl.bindFramebuffer(GL.FRAMEBUFFER,this.frameBuffer)}unbind(){this.gl.bindFramebuffer(GL.FRAMEBUFFER,null)}bindTexture(){this.gl.activeTexture(GL.TEXTURE0),this.gl.bindTexture(GL.TEXTURE_2D,this.colorBuffer)}};var K=class{};p(K,"vertices",new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,1,0])),p(K,"indices",new Uint16Array([0,1,2,0,2,3])),p(K,"textureCoordinates",new Float32Array([0,0,0,1,1,1,1,0]));var jt=class{constructor(t){this.gl=t;p(this,"frameBuffer0");p(this,"frameBuffer1");p(this,"filters",[]);p(this,"pingPong",!1);this.frameBuffer0=new Rt(this.gl),this.frameBuffer1=new Rt(this.gl)}get primary(){return this.pingPong?this.frameBuffer1:this.frameBuffer0}get secondary(){return this.pingPong?this.frameBuffer0:this.frameBuffer1}addFilter(t){return C(this,null,function*(){let r=this.filters.length%2===0,i=new Q(this.gl,"filter-".concat(t));yield i.setup({source:{vertex:"vertex-passthrough",fragment:"filter-".concat(t)},uniforms:["u_texture"],buffers:{vertex:{data:K.vertices.map(n=>r?-n:n),attribute:"a_position"},uv:{data:K.textureCoordinates,attribute:"a_texcoord"},index:{data:K.indices,target:GL.ELEMENT_ARRAY_BUFFER}}}),i.bind(),i.setUniform("u_texture",0),i.bindBuffer("index",K.indices),this.filters.push(i)})}swap(){this.pingPong=!this.pingPong}bind(){this.primary.bind()}unbind(){this.primary.unbind()}resize(){this.frameBuffer0.resize(),this.frameBuffer1.resize()}bindTexture(){this.primary.bindTexture()}commit(){for(let t=0;t<this.filters.length;t++){let r=this.filters[t],i=t===this.filters.length-1;i||this.secondary.bind(),r.bind(),this.primary.bindTexture(),this.gl.drawElements(GL.TRIANGLES,K.indices.length,GL.UNSIGNED_SHORT,0),i||(this.secondary.unbind(),this.swap())}}};var St=class{constructor(t,r,i){this.name=t;this.vertices=r;this.indices=i;p(this,"shader")}setup(t){return C(this,null,function*(){var r,i;this.shader=new Q(t,"gizmo-"+this.name),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:(r=this.vertices)!=null?r:Float32Array,attribute:"a_position"},index:{data:(i=this.indices)!=null?i:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}bind(t,r,i,n,s){this.shader.bind(),this.shader.setUniform("u_color",r),this.shader.setUniform("u_model",i),this.shader.setUniform("u_view",n),this.shader.setUniform("u_projection",s),this.shader.bindBuffer("index")}},ot=class ot{constructor(t,r,i,n,s){this.position=t;this.size=r;this.rotation=i;this.color=n;this.fill=s;p(this,"modelMatrix",T.create());p(this,"vertices");T.translate(this.modelMatrix,this.modelMatrix,this.position),T.scale(this.modelMatrix,this.modelMatrix,this.size),T.rotateX(this.modelMatrix,this.modelMatrix,this.rotation[0]),T.rotateY(this.modelMatrix,this.modelMatrix,this.rotation[1]),T.rotateZ(this.modelMatrix,this.modelMatrix,this.rotation[2]),this.fill||(this.vertices=new Float32Array(ot.outlineVertices))}static setup(t){return C(this,null,function*(){this.mesh=new St("box",_.vertices,_.indices),yield this.mesh.setup(t)})}render(t,r,i){ot.mesh.bind(t,this.color,this.modelMatrix,i,r),this.fill?(ot.mesh.shader.bindBuffer("vertex",_.vertices),t.drawElements(GL.TRIANGLES,ot.mesh.indices.length,GL.UNSIGNED_SHORT,0)):(ot.mesh.shader.bindBuffer("vertex",this.vertices),t.drawArrays(this.fill?GL.TRIANGLES:GL.LINE_LOOP,0,this.vertices.length/3))}};p(ot,"outlineVertices",new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5])),p(ot,"mesh");var Yt=ot,At=class At{constructor(t,r,i,n){this.position=t;this.size=r;this.color=i;this.fill=n;p(this,"modelMatrix",T.create());T.translate(this.modelMatrix,this.modelMatrix,this.position),T.scale(this.modelMatrix,this.modelMatrix,this.size)}static setup(t){return C(this,null,function*(){this.mesh=new St("quad",K.vertices,K.indices),yield this.mesh.setup(t)})}render(t,r,i){At.mesh.bind(t,this.color,this.modelMatrix,i,r),t.drawElements(this.fill?GL.TRIANGLES:GL.LINE_LOOP,At.mesh.indices.length,GL.UNSIGNED_SHORT,0)}};p(At,"mesh");var Xt=At,Qt=class Qt{constructor(t,r,i){this.color=r;this.fill=i;p(this,"modelMatrix",T.create());p(this,"vertices");p(this,"indices");let n=t.getViewMatrix(),s=t.getProjectionMatrix(),a=T.multiply(T.create(),s,n),o=T.invert(T.create(),a),h=[G.fromValues(-1,-1,-1,1),G.fromValues(1,-1,-1,1),G.fromValues(1,1,-1,1),G.fromValues(-1,1,-1,1),G.fromValues(-1,-1,1,1),G.fromValues(1,-1,1,1),G.fromValues(1,1,1,1),G.fromValues(-1,1,1,1)].map(l=>{let d=G.transformMat4(G.create(),l,o);return G.scale(d,d,1/d[3]),d});this.vertices=new Float32Array([...h[0],...h[1],...h[2],...h[3],...h[4],...h[5],...h[6],...h[7]]),this.indices=new Uint16Array([0,1,2,2,3,0,4,5,6,6,7,4,0,1,5,5,4,0,2,3,7,7,6,2,0,3,7,7,4,0,1,2,6,6,5,1])}static setup(t){return C(this,null,function*(){this.shader=new Q(t,"gizmo-"+this.name),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:Float32Array,attribute:"a_position"},index:{data:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}render(t,r,i){let n=Qt.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),n.bindBuffer("index",this.indices),t.drawElements(this.fill?GL.TRIANGLES:GL.LINE_LOOP,this.indices.length,GL.UNSIGNED_SHORT,0)}};p(Qt,"shader");var qt=Qt,Jt=class Jt{constructor(t,r,i){this.start=t;this.end=r;this.color=i;p(this,"modelMatrix",T.create());p(this,"vertices");this.vertices=new Float32Array([...this.start,...this.end])}static setup(t){return C(this,null,function*(){this.shader=new Q(t,"gizmo-line"),yield this.shader.setup({source:{vertex:"gizmo/vertex",fragment:"gizmo/fragment"},uniforms:["u_color","u_model","u_view","u_projection"],buffers:{vertex:{data:Float32Array,attribute:"a_position"}}})})}render(t,r,i){let n=Jt.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),t.drawArrays(GL.LINES,0,this.vertices.length/3)}};p(Jt,"shader");var Kt=Jt,te=class te{constructor(t,r,i,n,s){this.position=t;this.radius=r;this.color=i;this.fill=s;p(this,"modelMatrix",T.create());p(this,"vertices");T.translate(this.modelMatrix,this.modelMatrix,this.position);let a=[];for(let o=0;o<=n;o++){let c=o/n*Math.PI;for(let h=0;h<=n;h++){let l=h/n*2*Math.PI,d=this.radius*Math.sin(c)*Math.cos(l),u=this.radius*Math.sin(c)*Math.sin(l),f=this.radius*Math.cos(c);a.push(d,u,f)}}this.vertices=new Float32Array(a)}static setup(t){return C(this,null,function*(){this.mesh=new St("sphere"),yield this.mesh.setup(t)})}render(t,r,i){let n=te.mesh.shader;n.bind(),n.setUniform("u_color",this.color),n.setUniform("u_model",this.modelMatrix),n.setUniform("u_view",i),n.setUniform("u_projection",r),n.bindBuffer("vertex",this.vertices),t.drawArrays(this.fill?GL.TRIANGLES:GL.LINE_STRIP,0,this.vertices.length/3)}};p(te,"mesh");var Zt=te,tt=class{static setup(t){return C(this,null,function*(){})}static render(t,r,i){}static clear(){}static box(t,r,i,n,s=!1){}static quad(t,r,i,n=!1){}static frustum(t,r,i=!1){}static line(t,r,i){}static sphere(t,r,i,n=32,s=!1){}};p(tt,"list",[]);var ee=class{constructor(t){this.main=t;p(this,"canvas");p(this,"gl");p(this,"isDirty",!1);p(this,"frameBuffer")}invalidate(){this.isDirty=!0}setSize(t){var i;w.info("WebGLRenderer","Setting size...");let r=(i=window.devicePixelRatio)!=null?i:1;this.canvas.width=t.width*r,this.canvas.height=t.height*r,this.canvas.style.width="".concat(t.width,"px"),this.canvas.style.height="".concat(t.height,"px"),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.frameBuffer&&this.frameBuffer.resize()}setupCanvas(){var i,n;w.debug("WebGLRenderer","Creating canvas..."),this.canvas=document.createElement("canvas"),this.canvas.id="webgl-canvas";let t={antialias:!0,depth:!0},r=(n=(i=this.canvas.getContext("webgl2",t))!=null?i:this.canvas.getContext("webgl",t))!=null?n:this.canvas.getContext("experimental-webgl",t);if(!r)throw new Error("Could not get WebGL context");this.gl=r,document.body.appendChild(this.canvas),this.gl.enable(GL.DEPTH_TEST),this.gl.cullFace(GL.BACK),this.gl.enable(GL.CULL_FACE),this.gl.depthFunc(GL.LEQUAL),this.gl.clearDepth(1)}setupTextures(){return C(this,null,function*(){w.debug("WebGLRenderer","Setting up textures..."),this.gl.pixelStorei(GL.UNPACK_FLIP_Y_WEBGL,!0)})}setupMesh(){return C(this,null,function*(){yield ft.setup(this.gl)})}setup(){return C(this,null,function*(){w.info("WebGLRenderer","Setting up..."),this.setupCanvas(),this.frameBuffer=new jt(this.gl),yield this.setupMesh(),yield this.setupTextures(),yield tt.setup(this.gl),yield this.frameBuffer.addFilter("gamma")})}clear(t){this.gl.clearColor(t.r,t.g,t.b,1),this.gl.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT)}drawScene(){let t=it.decode(dt.background,!0);this.clear(t);let r=this.main.camera.getProjectionMatrix(),i=this.main.camera.getViewMatrix(),n=st.activeChunks.filter(s=>this.main.playerCamera.isChunkInsideFrustum(s));if(Y.SORT_CHUNKS_BY_DISTANCE){let s=n.map(a=>A.distance(a.globalCenterPosition,this.main.playerCamera.position));n=n.sort((a,o)=>{let c=s[n.indexOf(a)];return s[n.indexOf(o)]-c})}for(let s of n)this.main.analytics.notifyChunkVisible(s),Y.RENDER_CHUNKS&&s.render(this.gl,r,i);this.renderDebugOverlay(),Y.DISABLE_DEPTH_FOR_GIZMOS&&this.gl.disable(GL.DEPTH_TEST),tt.render(this.gl,r,i),tt.clear(),Y.DISABLE_DEPTH_FOR_GIZMOS&&this.gl.enable(GL.DEPTH_TEST)}renderDebugOverlay(){let t=T.create(),r=this.main.useDebugCamera?this.main.playerCamera:this.main.debugCamera,i=r.near,n=r.forward,s=r.up,a=r.position,o=r.getViewMatrix();T.invert(o,o),tt.box(a,A.fromValues(.5,.5,.5),A.fromValues(Math.toRadians(r.pitch),Math.toRadians(r.yaw),Math.toRadians(r.roll)),this.main.useDebugCamera?G.fromValues(1,0,0,1):G.fromValues(0,0,1,1),!0);let c=A.create();A.scaleAndAdd(c,a,n,i),A.scaleAndAdd(c,c,s,i/2),T.lookAt(t,a,c,s);let h=A.create();A.scaleAndAdd(h,a,n,100),tt.line(a,h,G.fromValues(1,1,1,1))}render(){this.isDirty&&(this.isDirty=!1,this.frameBuffer.bind(),this.drawScene(),this.frameBuffer.unbind(),this.frameBuffer.commit())}};var Lt=class{constructor(){p(this,"position",A.create());p(this,"currentPitch",0);p(this,"currentYaw",0);p(this,"currentRoll",0);p(this,"pitch",0);p(this,"yaw",0);p(this,"roll",0);p(this,"fov",Math.toRadians(45));p(this,"near",.1);p(this,"far",1e3)}get aspectRatio(){return window.innerWidth/window.innerHeight}get tiledPosition(){return new P(Math.floor((this.position[0]+$/2)/$),Math.floor((this.position[2]+$/2)/$))}get forward(){let t=A.create(),r=Math.toRadians(this.yaw),i=Math.toRadians(this.pitch),n=Math.cos(i);return t[0]=-Math.sin(r)*n,t[1]=Math.sin(i),t[2]=-Math.cos(r)*n,t}get right(){let t=A.fromValues(0,1,0),r=this.forward,i=A.create();return A.cross(i,t,r),A.normalize(i,i),i}get up(){let t=this.right,r=this.forward,i=A.create();return A.cross(i,r,t),A.normalize(i,i),i}lookAt(t){let r=A.create();A.subtract(r,t,this.position),A.normalize(r,r),this.pitch=Math.toDegrees(Math.asin(r[1])),this.yaw=Math.toDegrees(Math.atan2(-r[0],-r[2]))}normalizePlane(t){let r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return t[0]/=r,t[1]/=r,t[2]/=r,t}getFrustumPlanes(){let t=this.getViewMatrix(),r=this.getProjectionMatrix(),i=T.multiply(T.create(),r,t);return[G.fromValues(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),G.fromValues(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),G.fromValues(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),G.fromValues(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),G.fromValues(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),G.fromValues(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])].map(s=>G.normalize(G.create(),s))}isBoxInFrustum(t,r){let i=this.getFrustumPlanes(),n=A.scale(A.create(),r,.5),s=A.subtract(A.create(),t,n),a=A.add(A.create(),t,n);for(let o of i){let c=A.fromValues(o[0],o[1],o[2]),h=A.fromValues(c[0]>0?a[0]:s[0],c[1]>0?a[1]:s[1],c[2]>0?a[2]:s[2]);if(A.dot(c,h)+o[3]<0)return!1}return!0}isSphereInsideFrustum(t,r){let i=this.getFrustumPlanes();for(let n of i)if(A.dot(A.fromValues(n[0],n[1],n[2]),t)+n[3]<-r)return!1;return!0}isChunkInsideFrustum(t){let r=t.globalCenterPosition,i=0,n=A.fromValues($,ct,$);n[0]+=i,n[1]+=i,n[2]+=i,r[0]-=i/2,r[1]-=i/2,r[2]-=i/2;let s=this.isBoxInFrustum(r,n);return Y.RENDER_CHUNK_BOUNDS&&(tt.box(t.globalCenterPosition,n,A.fromValues(0,0,0),s?G.fromValues(0,1,0,1):G.fromValues(1,0,0,1),!1),tt.box(t.globalCenterPosition,A.fromValues(1,1,1),A.fromValues(0,0,0),G.fromValues(0,0,1,1),!0)),s}update(t){this.currentPitch=Math.lerp(this.currentPitch,this.pitch,t*20),this.currentYaw=Math.lerp(this.currentYaw,this.yaw,t*20),this.currentRoll=Math.lerp(this.currentRoll,this.roll,t*20)}getViewMatrix(){let t=T.create();return T.translate(t,t,this.position),T.rotate(t,t,Math.toRadians(this.currentYaw),[0,1,0]),T.rotate(t,t,Math.toRadians(this.currentPitch),[1,0,0]),T.rotate(t,t,Math.toRadians(this.currentRoll),[0,0,1]),T.invert(t,t),t}getProjectionMatrix(){let t=T.create();return T.perspective(t,this.fov,this.aspectRatio,this.near,this.far),t}};var mr=De(dr());var Tt=new Worker("".concat(window.location.href,"scripts/jobs/gif.worker.js"));Tt.onerror=e=>w.error("GIFUtils","Worker error",e.message);Tt.onmessageerror=e=>w.error("GIFUtils","Worker message error",e.data);Tt.onmessage=e=>{w.info("GIFUtils","Received message",e.data),mr.default.saveAs(e.data,"recording.zip")};var re=new OffscreenCanvas(1,1),Ae=re.getContext("2d");if(!Ae)throw new Error("Could not get context of canvas");var Ct=class{static addFrame(t,r){re.width=t.width,re.height=t.height,Ae.drawImage(t,0,0),Ae.drawImage(r,0,0);let i=re.transferToImageBitmap();Tt.postMessage({key:"add",value:i},[i])}static generate(t){return C(this,null,function*(){Tt.postMessage({key:"zip"})})}};var Dt=!1,Se=class{constructor(){p(this,"screen",{width:0,height:0});p(this,"gui",new Wt(this));p(this,"gl",new ee(this));p(this,"playerCamera",new Lt);p(this,"debugCamera",new Lt);p(this,"useDebugCamera",!1);p(this,"isRecording",!1);p(this,"handleAnimationFrameRequest",-1);p(this,"lastFrameTime",performance.now());p(this,"globalTimer",0);p(this,"analytics");p(this,"state");w.info("Main","Starting up..."),this.state=new _t(this),this.debugCamera.position=A.fromValues(0,0,-10),this.attachHooks()}get camera(){return this.useDebugCamera?this.debugCamera:this.playerCamera}attachHooks(){w.info("Main","Attaching hooks..."),window.addLoadEventListener(this.onLoad.bind(this)),window.addVisibilityChangeEventListener(this.onVisibilityChange.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}onLoad(){return C(this,null,function*(){try{w.debug("Main","Window loaded"),Dt||(yield this.gl.setup()),this.gui.setup(),this.onResize();let t=[dt.setup(),zt.setup(),F.setup()];yield Promise.all(t),yield this.state.setup(),this.requestNextFrame()}catch(t){w.error("Main","Failed to load modules",t),alert("Failed to load modules. Please refresh the page.".concat(t))}})}onVisibilityChange(t){w.info("Main","Window visibility changed to ".concat(t?"visible":"hidden")),t?(this.handleAnimationFrameRequest>=0&&(Ft?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest)),this.invalidate(),this.lastFrameTime=performance.now(),setTimeout(this.requestNextFrame.bind(this),0)):this.handleAnimationFrameRequest&&(Ft?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest),this.handleAnimationFrameRequest=-1)}onResize(){w.debug("Main","Window resized"),this.screen={width:window.innerWidth,height:window.innerHeight},this.gui.setSize(this.screen),Dt||this.gl.setSize(this.screen),this.invalidate()}setState(t){this.state=t,this.state.setup(),at.apply(this.gui.element),this.invalidate()}invalidate(){this.gui.invalidate(),Dt||this.gl.invalidate()}requestNextFrame(){Ft?this.handleAnimationFrameRequest=requestAnimationFrame(this.loop.bind(this)):this.handleAnimationFrameRequest===-1&&(this.handleAnimationFrameRequest=setInterval(()=>this.loop(performance.now()),1e3/Ne))}updateRecording(t){this.isRecording&&(j.circle(new P(this.screen.width-30,30),10,"red",!0),j.circle(new P(this.screen.width-30,30),15,"red",!1)),F.isRecording()&&(this.isRecording?this.onStopRecording():this.onStartRecording())}onStartRecording(){w.info("Main","Recording started"),this.isRecording=!0,this.screen=Ge,this.gui.setSize(this.screen),Dt||this.gl.setSize(this.screen),this.invalidate()}onStopRecording(){w.info("Main","Recording stopped"),this.isRecording=!1,Ct.generate("recording"),this.onResize()}update(t){let r=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t,this.updateRecording(r),this.isRecording&&(r=Ie);let i=r/ne;for(let n=0;n<ne;n++)this.state.update(i),F.update();this.globalTimer+=r}loop(t){this.update(t),at.apply(this.gui.element),this.gui.render(),this.state.render(this.gui.context),Dt||this.gl.render(),this.isRecording&&Ct.addFrame(this.gl.canvas,this.gui.canvas.element),j.render(this.gui.context),j.clear(),this.requestNextFrame()}};new Se;})();
