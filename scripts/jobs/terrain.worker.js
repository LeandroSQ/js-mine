(()=>{var Wr=Object.create;var hr=Object.defineProperty;var Yr=Object.getOwnPropertyDescriptor;var Zr=Object.getOwnPropertyNames;var Hr=Object.getPrototypeOf,jr=Object.prototype.hasOwnProperty;var H=Math.pow,qr=(r,e,t)=>e in r?hr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Kr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ur=(r,e)=>{for(var t in e)hr(r,t,{get:e[t],enumerable:!0})},Qr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Zr(e))!jr.call(r,i)&&i!==t&&hr(r,i,{get:()=>e[i],enumerable:!(n=Yr(e,i))||n.enumerable});return r};var Jr=(r,e,t)=>(t=r!=null?Wr(Hr(r)):{},Qr(e||!r||!r.__esModule?hr(t,"default",{value:r,enumerable:!0}):t,r));var E=(r,e,t)=>qr(r,typeof e!="symbol"?e+"":e,t);var k=(r,e,t)=>new Promise((n,i)=>{var a=h=>{try{o(t.next(h))}catch(c){i(c)}},s=h=>{try{o(t.throw(h))}catch(c){i(c)}},o=h=>h.done?n(h.value):Promise.resolve(h.value).then(a,s);o((t=t.apply(r,e)).next())});var Xr=Kr((xr,$r)=>{(function(r,e){typeof xr=="object"?$r.exports=e():typeof define=="function"&&define.amd?define(e):r.Alea=e()})(xr,function(){"use strict";return r.importState=function(t){var n=new r;return n.importState(t),n},r;function r(){return function(t){var n=0,i=0,a=0,s=1;t.length==0&&(t=[+new Date]);var o=e();n=o(" "),i=o(" "),a=o(" ");for(var h=0;h<t.length;h++)n-=o(t[h]),n<0&&(n+=1),i-=o(t[h]),i<0&&(i+=1),a-=o(t[h]),a<0&&(a+=1);o=null;var c=function(){var l=2091639*n+s*23283064365386963e-26;return n=i,i=a,a=l-(s=l|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=t,c.exportState=function(){return[n,i,a,s]},c.importState=function(l){n=+l[0]||0,i=+l[1]||0,a=+l[2]||0,s=+l[3]||0},c}(Array.prototype.slice.call(arguments))}function e(){var t=4022871197,n=function(i){i=i.toString();for(var a=0;a<i.length;a++){t+=i.charCodeAt(a);var s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=s*4294967296}return(t>>>0)*23283064365386963e-26};return n.version="Mash 0.9",n}})});Math.clamp=function(r,e,t){return Math.min(Math.max(r,e),t)};Math.average=function(...r){return r.reduce((e,t)=>e+t,0)/r.length};Math.distance=function(r,e,t,n){return Math.sqrt(Math.pow(t-r,2)+Math.pow(n-e,2))};Math.randomInt=function(r,e){return Math.floor(Math.random()*(e-r+1))+r};Math.lerp=function(r,e,t){return r+(e-r)*t};Math.oscilate=function(r,e,t=0,n=1){let i=2*Math.PI*e,a=n-t,o=(Math.sin(i*r)+1)/2;return t+o*a};Math.smoothstep=function(r,e=0,t=1){return r=Math.clamp((r-e)/(t-e),0,1),r*r*(3-2*r)};Math.prettifyElapsedTime=function(r){let e=(t,n)=>t%1===0?Math.floor(t):t.toFixed(n);return r<1?"".concat(Math.floor(r*1e3),"\u03BCs"):r<1e3?"".concat(e(r,2),"ms"):r<6e4?"".concat(e(r/1e3,2),"s"):r<36e5?"".concat(e(r/6e4,2),"m"):"".concat(e(r/36e5,2),"h")};Math.prettifyUnit=function(r,e=""){return r<1e3?"".concat(r).concat(e):r<1e6?"".concat((r/1e3).toFixed(2),"k").concat(e):r<1e9?"".concat((r/1e6).toFixed(2),"M").concat(e):"".concat((r/1e9).toFixed(2),"G").concat(e)};Math.toDegrees=function(r){return r*(180/Math.PI)};Math.toRadians=function(r){return r*(Math.PI/180)};var er=class r{constructor(e,t=void 0){E(this,"x");E(this,"y");this.x=e,t===void 0?this.y=e:this.y=t}dot(e){return this.x*e.x+this.y*e.y}add(e){return new r(this.x+e.x,this.y+e.y)}subtract(e){return new r(this.x-e.x,this.y-e.y)}multiply(e){return new r(this.x*e,this.y*e)}divide(e){return new r(this.x/e,this.y/e)}normalize(){let e=this.length;return new r(this.x/e,this.y/e)}clone(){return new r(this.x,this.y)}static distanceSquared(e,t){return H(e.x-t.x,2)+H(e.y-t.y,2)}static distance(e,t){return Math.sqrt(this.distanceSquared(e,t))}static random(e){return new r(Math.random()*2-1,Math.random()*2-1).normalize().multiply(e)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static get zero(){return new r(0,0)}toString(){return"{ ".concat(this.x,", ").concat(this.y," }")}};var _=16,sr=64;var R=1e-6,$=typeof Float32Array!="undefined"?Float32Array:Array,vr=Math.random;var Ot=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var X={};ur(X,{add:()=>Oe,adjoint:()=>oe,clone:()=>ee,copy:()=>te,create:()=>re,determinant:()=>ce,equals:()=>Ce,exactEquals:()=>ke,frob:()=>Ue,fromQuat:()=>we,fromQuat2:()=>ue,fromRotation:()=>xe,fromRotationTranslation:()=>Sr,fromRotationTranslationScale:()=>Ae,fromRotationTranslationScaleOrigin:()=>Se,fromScaling:()=>ve,fromTranslation:()=>ge,fromValues:()=>ne,fromXRotation:()=>Ee,fromYRotation:()=>be,fromZRotation:()=>ye,frustum:()=>Le,getRotation:()=>Te,getScaling:()=>wr,getTranslation:()=>Me,identity:()=>Tr,invert:()=>se,lookAt:()=>Pe,mul:()=>$e,multiply:()=>Ar,multiplyScalar:()=>Ve,multiplyScalarAndAdd:()=>ze,ortho:()=>Ne,orthoNO:()=>Ir,orthoZO:()=>Fe,perspective:()=>Ie,perspectiveFromFieldOfView:()=>Ge,perspectiveNO:()=>Lr,perspectiveZO:()=>Re,rotate:()=>fe,rotateX:()=>pe,rotateY:()=>me,rotateZ:()=>de,scale:()=>le,set:()=>ie,str:()=>_e,sub:()=>Xe,subtract:()=>Rr,targetTo:()=>De,translate:()=>he,transpose:()=>ae});function re(){var r=new $(16);return $!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function ee(r){var e=new $(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function te(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function ne(r,e,t,n,i,a,s,o,h,c,l,f,m,p,g,v){var d=new $(16);return d[0]=r,d[1]=e,d[2]=t,d[3]=n,d[4]=i,d[5]=a,d[6]=s,d[7]=o,d[8]=h,d[9]=c,d[10]=l,d[11]=f,d[12]=m,d[13]=p,d[14]=g,d[15]=v,d}function ie(r,e,t,n,i,a,s,o,h,c,l,f,m,p,g,v,d){return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r[4]=a,r[5]=s,r[6]=o,r[7]=h,r[8]=c,r[9]=l,r[10]=f,r[11]=m,r[12]=p,r[13]=g,r[14]=v,r[15]=d,r}function Tr(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ae(r,e){if(r===e){var t=e[1],n=e[2],i=e[3],a=e[6],s=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=a,r[11]=e[14],r[12]=i,r[13]=s,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function se(r,e){var t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],h=e[6],c=e[7],l=e[8],f=e[9],m=e[10],p=e[11],g=e[12],v=e[13],d=e[14],x=e[15],S=t*o-n*s,u=t*h-i*s,M=t*c-a*s,b=n*h-i*o,y=n*c-a*o,D=i*c-a*h,G=l*v-f*g,N=l*d-m*g,L=l*x-p*g,F=f*d-m*v,P=f*x-p*v,I=m*x-p*d,w=S*I-u*P+M*F+b*L-y*N+D*G;return w?(w=1/w,r[0]=(o*I-h*P+c*F)*w,r[1]=(i*P-n*I-a*F)*w,r[2]=(v*D-d*y+x*b)*w,r[3]=(m*y-f*D-p*b)*w,r[4]=(h*L-s*I-c*N)*w,r[5]=(t*I-i*L+a*N)*w,r[6]=(d*M-g*D-x*u)*w,r[7]=(l*D-m*M+p*u)*w,r[8]=(s*P-o*L+c*G)*w,r[9]=(n*L-t*P-a*G)*w,r[10]=(g*y-v*M+x*S)*w,r[11]=(f*M-l*y-p*S)*w,r[12]=(o*N-s*F-h*G)*w,r[13]=(t*F-n*N+i*G)*w,r[14]=(v*u-g*b-d*S)*w,r[15]=(l*b-f*u+m*S)*w,r):null}function oe(r,e){var t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],h=e[6],c=e[7],l=e[8],f=e[9],m=e[10],p=e[11],g=e[12],v=e[13],d=e[14],x=e[15];return r[0]=o*(m*x-p*d)-f*(h*x-c*d)+v*(h*p-c*m),r[1]=-(n*(m*x-p*d)-f*(i*x-a*d)+v*(i*p-a*m)),r[2]=n*(h*x-c*d)-o*(i*x-a*d)+v*(i*c-a*h),r[3]=-(n*(h*p-c*m)-o*(i*p-a*m)+f*(i*c-a*h)),r[4]=-(s*(m*x-p*d)-l*(h*x-c*d)+g*(h*p-c*m)),r[5]=t*(m*x-p*d)-l*(i*x-a*d)+g*(i*p-a*m),r[6]=-(t*(h*x-c*d)-s*(i*x-a*d)+g*(i*c-a*h)),r[7]=t*(h*p-c*m)-s*(i*p-a*m)+l*(i*c-a*h),r[8]=s*(f*x-p*v)-l*(o*x-c*v)+g*(o*p-c*f),r[9]=-(t*(f*x-p*v)-l*(n*x-a*v)+g*(n*p-a*f)),r[10]=t*(o*x-c*v)-s*(n*x-a*v)+g*(n*c-a*o),r[11]=-(t*(o*p-c*f)-s*(n*p-a*f)+l*(n*c-a*o)),r[12]=-(s*(f*d-m*v)-l*(o*d-h*v)+g*(o*m-h*f)),r[13]=t*(f*d-m*v)-l*(n*d-i*v)+g*(n*m-i*f),r[14]=-(t*(o*d-h*v)-s*(n*d-i*v)+g*(n*h-i*o)),r[15]=t*(o*m-h*f)-s*(n*m-i*f)+l*(n*h-i*o),r}function ce(r){var e=r[0],t=r[1],n=r[2],i=r[3],a=r[4],s=r[5],o=r[6],h=r[7],c=r[8],l=r[9],f=r[10],m=r[11],p=r[12],g=r[13],v=r[14],d=r[15],x=e*s-t*a,S=e*o-n*a,u=e*h-i*a,M=t*o-n*s,b=t*h-i*s,y=n*h-i*o,D=c*g-l*p,G=c*v-f*p,N=c*d-m*p,L=l*v-f*g,F=l*d-m*g,P=f*d-m*v;return x*P-S*F+u*L+M*N-b*G+y*D}function Ar(r,e,t){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],h=e[5],c=e[6],l=e[7],f=e[8],m=e[9],p=e[10],g=e[11],v=e[12],d=e[13],x=e[14],S=e[15],u=t[0],M=t[1],b=t[2],y=t[3];return r[0]=u*n+M*o+b*f+y*v,r[1]=u*i+M*h+b*m+y*d,r[2]=u*a+M*c+b*p+y*x,r[3]=u*s+M*l+b*g+y*S,u=t[4],M=t[5],b=t[6],y=t[7],r[4]=u*n+M*o+b*f+y*v,r[5]=u*i+M*h+b*m+y*d,r[6]=u*a+M*c+b*p+y*x,r[7]=u*s+M*l+b*g+y*S,u=t[8],M=t[9],b=t[10],y=t[11],r[8]=u*n+M*o+b*f+y*v,r[9]=u*i+M*h+b*m+y*d,r[10]=u*a+M*c+b*p+y*x,r[11]=u*s+M*l+b*g+y*S,u=t[12],M=t[13],b=t[14],y=t[15],r[12]=u*n+M*o+b*f+y*v,r[13]=u*i+M*h+b*m+y*d,r[14]=u*a+M*c+b*p+y*x,r[15]=u*s+M*l+b*g+y*S,r}function he(r,e,t){var n=t[0],i=t[1],a=t[2],s,o,h,c,l,f,m,p,g,v,d,x;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*a+e[12],r[13]=e[1]*n+e[5]*i+e[9]*a+e[13],r[14]=e[2]*n+e[6]*i+e[10]*a+e[14],r[15]=e[3]*n+e[7]*i+e[11]*a+e[15]):(s=e[0],o=e[1],h=e[2],c=e[3],l=e[4],f=e[5],m=e[6],p=e[7],g=e[8],v=e[9],d=e[10],x=e[11],r[0]=s,r[1]=o,r[2]=h,r[3]=c,r[4]=l,r[5]=f,r[6]=m,r[7]=p,r[8]=g,r[9]=v,r[10]=d,r[11]=x,r[12]=s*n+l*i+g*a+e[12],r[13]=o*n+f*i+v*a+e[13],r[14]=h*n+m*i+d*a+e[14],r[15]=c*n+p*i+x*a+e[15]),r}function le(r,e,t){var n=t[0],i=t[1],a=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function fe(r,e,t,n){var i=n[0],a=n[1],s=n[2],o=Math.hypot(i,a,s),h,c,l,f,m,p,g,v,d,x,S,u,M,b,y,D,G,N,L,F,P,I,w,U;return o<R?null:(o=1/o,i*=o,a*=o,s*=o,h=Math.sin(t),c=Math.cos(t),l=1-c,f=e[0],m=e[1],p=e[2],g=e[3],v=e[4],d=e[5],x=e[6],S=e[7],u=e[8],M=e[9],b=e[10],y=e[11],D=i*i*l+c,G=a*i*l+s*h,N=s*i*l-a*h,L=i*a*l-s*h,F=a*a*l+c,P=s*a*l+i*h,I=i*s*l+a*h,w=a*s*l-i*h,U=s*s*l+c,r[0]=f*D+v*G+u*N,r[1]=m*D+d*G+M*N,r[2]=p*D+x*G+b*N,r[3]=g*D+S*G+y*N,r[4]=f*L+v*F+u*P,r[5]=m*L+d*F+M*P,r[6]=p*L+x*F+b*P,r[7]=g*L+S*F+y*P,r[8]=f*I+v*w+u*U,r[9]=m*I+d*w+M*U,r[10]=p*I+x*w+b*U,r[11]=g*I+S*w+y*U,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function pe(r,e,t){var n=Math.sin(t),i=Math.cos(t),a=e[4],s=e[5],o=e[6],h=e[7],c=e[8],l=e[9],f=e[10],m=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=a*i+c*n,r[5]=s*i+l*n,r[6]=o*i+f*n,r[7]=h*i+m*n,r[8]=c*i-a*n,r[9]=l*i-s*n,r[10]=f*i-o*n,r[11]=m*i-h*n,r}function me(r,e,t){var n=Math.sin(t),i=Math.cos(t),a=e[0],s=e[1],o=e[2],h=e[3],c=e[8],l=e[9],f=e[10],m=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*i-c*n,r[1]=s*i-l*n,r[2]=o*i-f*n,r[3]=h*i-m*n,r[8]=a*n+c*i,r[9]=s*n+l*i,r[10]=o*n+f*i,r[11]=h*n+m*i,r}function de(r,e,t){var n=Math.sin(t),i=Math.cos(t),a=e[0],s=e[1],o=e[2],h=e[3],c=e[4],l=e[5],f=e[6],m=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*i+c*n,r[1]=s*i+l*n,r[2]=o*i+f*n,r[3]=h*i+m*n,r[4]=c*i-a*n,r[5]=l*i-s*n,r[6]=f*i-o*n,r[7]=m*i-h*n,r}function ge(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function ve(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function xe(r,e,t){var n=t[0],i=t[1],a=t[2],s=Math.hypot(n,i,a),o,h,c;return s<R?null:(s=1/s,n*=s,i*=s,a*=s,o=Math.sin(e),h=Math.cos(e),c=1-h,r[0]=n*n*c+h,r[1]=i*n*c+a*o,r[2]=a*n*c-i*o,r[3]=0,r[4]=n*i*c-a*o,r[5]=i*i*c+h,r[6]=a*i*c+n*o,r[7]=0,r[8]=n*a*c+i*o,r[9]=i*a*c-n*o,r[10]=a*a*c+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Ee(r,e){var t=Math.sin(e),n=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=t,r[7]=0,r[8]=0,r[9]=-t,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function be(r,e){var t=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=0,r[2]=-t,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=t,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ye(r,e){var t=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=t,r[2]=0,r[3]=0,r[4]=-t,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Sr(r,e,t){var n=e[0],i=e[1],a=e[2],s=e[3],o=n+n,h=i+i,c=a+a,l=n*o,f=n*h,m=n*c,p=i*h,g=i*c,v=a*c,d=s*o,x=s*h,S=s*c;return r[0]=1-(p+v),r[1]=f+S,r[2]=m-x,r[3]=0,r[4]=f-S,r[5]=1-(l+v),r[6]=g+d,r[7]=0,r[8]=m+x,r[9]=g-d,r[10]=1-(l+p),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function ue(r,e){var t=new $(3),n=-e[0],i=-e[1],a=-e[2],s=e[3],o=e[4],h=e[5],c=e[6],l=e[7],f=n*n+i*i+a*a+s*s;return f>0?(t[0]=(o*s+l*n+h*a-c*i)*2/f,t[1]=(h*s+l*i+c*n-o*a)*2/f,t[2]=(c*s+l*a+o*i-h*n)*2/f):(t[0]=(o*s+l*n+h*a-c*i)*2,t[1]=(h*s+l*i+c*n-o*a)*2,t[2]=(c*s+l*a+o*i-h*n)*2),Sr(r,e,t),r}function Me(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function wr(r,e){var t=e[0],n=e[1],i=e[2],a=e[4],s=e[5],o=e[6],h=e[8],c=e[9],l=e[10];return r[0]=Math.hypot(t,n,i),r[1]=Math.hypot(a,s,o),r[2]=Math.hypot(h,c,l),r}function Te(r,e){var t=new $(3);wr(t,e);var n=1/t[0],i=1/t[1],a=1/t[2],s=e[0]*n,o=e[1]*i,h=e[2]*a,c=e[4]*n,l=e[5]*i,f=e[6]*a,m=e[8]*n,p=e[9]*i,g=e[10]*a,v=s+l+g,d=0;return v>0?(d=Math.sqrt(v+1)*2,r[3]=.25*d,r[0]=(f-p)/d,r[1]=(m-h)/d,r[2]=(o-c)/d):s>l&&s>g?(d=Math.sqrt(1+s-l-g)*2,r[3]=(f-p)/d,r[0]=.25*d,r[1]=(o+c)/d,r[2]=(m+h)/d):l>g?(d=Math.sqrt(1+l-s-g)*2,r[3]=(m-h)/d,r[0]=(o+c)/d,r[1]=.25*d,r[2]=(f+p)/d):(d=Math.sqrt(1+g-s-l)*2,r[3]=(o-c)/d,r[0]=(m+h)/d,r[1]=(f+p)/d,r[2]=.25*d),r}function Ae(r,e,t,n){var i=e[0],a=e[1],s=e[2],o=e[3],h=i+i,c=a+a,l=s+s,f=i*h,m=i*c,p=i*l,g=a*c,v=a*l,d=s*l,x=o*h,S=o*c,u=o*l,M=n[0],b=n[1],y=n[2];return r[0]=(1-(g+d))*M,r[1]=(m+u)*M,r[2]=(p-S)*M,r[3]=0,r[4]=(m-u)*b,r[5]=(1-(f+d))*b,r[6]=(v+x)*b,r[7]=0,r[8]=(p+S)*y,r[9]=(v-x)*y,r[10]=(1-(f+g))*y,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function Se(r,e,t,n,i){var a=e[0],s=e[1],o=e[2],h=e[3],c=a+a,l=s+s,f=o+o,m=a*c,p=a*l,g=a*f,v=s*l,d=s*f,x=o*f,S=h*c,u=h*l,M=h*f,b=n[0],y=n[1],D=n[2],G=i[0],N=i[1],L=i[2],F=(1-(v+x))*b,P=(p+M)*b,I=(g-u)*b,w=(p-M)*y,U=(1-(m+x))*y,ir=(d+S)*y,ar=(g+u)*D,br=(d-S)*D,yr=(1-(m+v))*D;return r[0]=F,r[1]=P,r[2]=I,r[3]=0,r[4]=w,r[5]=U,r[6]=ir,r[7]=0,r[8]=ar,r[9]=br,r[10]=yr,r[11]=0,r[12]=t[0]+G-(F*G+w*N+ar*L),r[13]=t[1]+N-(P*G+U*N+br*L),r[14]=t[2]+L-(I*G+ir*N+yr*L),r[15]=1,r}function we(r,e){var t=e[0],n=e[1],i=e[2],a=e[3],s=t+t,o=n+n,h=i+i,c=t*s,l=n*s,f=n*o,m=i*s,p=i*o,g=i*h,v=a*s,d=a*o,x=a*h;return r[0]=1-f-g,r[1]=l+x,r[2]=m-d,r[3]=0,r[4]=l-x,r[5]=1-c-g,r[6]=p+v,r[7]=0,r[8]=m+d,r[9]=p-v,r[10]=1-c-f,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Le(r,e,t,n,i,a,s){var o=1/(t-e),h=1/(i-n),c=1/(a-s);return r[0]=a*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a*2*h,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*h,r[10]=(s+a)*c,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*a*2*c,r[15]=0,r}function Lr(r,e,t,n,i){var a=1/Math.tan(e/2),s;return r[0]=a/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(n-i),r[10]=(i+n)*s,r[14]=2*i*n*s):(r[10]=-1,r[14]=-2*n),r}var Ie=Lr;function Re(r,e,t,n,i){var a=1/Math.tan(e/2),s;return r[0]=a/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(s=1/(n-i),r[10]=i*s,r[14]=i*n*s):(r[10]=-1,r[14]=-n),r}function Ge(r,e,t,n){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+o),c=2/(i+a);return r[0]=h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=-((s-o)*h*.5),r[9]=(i-a)*c*.5,r[10]=n/(t-n),r[11]=-1,r[12]=0,r[13]=0,r[14]=n*t/(t-n),r[15]=0,r}function Ir(r,e,t,n,i,a,s){var o=1/(e-t),h=1/(n-i),c=1/(a-s);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*c,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*h,r[14]=(s+a)*c,r[15]=1,r}var Ne=Ir;function Fe(r,e,t,n,i,a,s){var o=1/(e-t),h=1/(n-i),c=1/(a-s);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=c,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*h,r[14]=a*c,r[15]=1,r}function Pe(r,e,t,n){var i,a,s,o,h,c,l,f,m,p,g=e[0],v=e[1],d=e[2],x=n[0],S=n[1],u=n[2],M=t[0],b=t[1],y=t[2];return Math.abs(g-M)<R&&Math.abs(v-b)<R&&Math.abs(d-y)<R?Tr(r):(l=g-M,f=v-b,m=d-y,p=1/Math.hypot(l,f,m),l*=p,f*=p,m*=p,i=S*m-u*f,a=u*l-x*m,s=x*f-S*l,p=Math.hypot(i,a,s),p?(p=1/p,i*=p,a*=p,s*=p):(i=0,a=0,s=0),o=f*s-m*a,h=m*i-l*s,c=l*a-f*i,p=Math.hypot(o,h,c),p?(p=1/p,o*=p,h*=p,c*=p):(o=0,h=0,c=0),r[0]=i,r[1]=o,r[2]=l,r[3]=0,r[4]=a,r[5]=h,r[6]=f,r[7]=0,r[8]=s,r[9]=c,r[10]=m,r[11]=0,r[12]=-(i*g+a*v+s*d),r[13]=-(o*g+h*v+c*d),r[14]=-(l*g+f*v+m*d),r[15]=1,r)}function De(r,e,t,n){var i=e[0],a=e[1],s=e[2],o=n[0],h=n[1],c=n[2],l=i-t[0],f=a-t[1],m=s-t[2],p=l*l+f*f+m*m;p>0&&(p=1/Math.sqrt(p),l*=p,f*=p,m*=p);var g=h*m-c*f,v=c*l-o*m,d=o*f-h*l;return p=g*g+v*v+d*d,p>0&&(p=1/Math.sqrt(p),g*=p,v*=p,d*=p),r[0]=g,r[1]=v,r[2]=d,r[3]=0,r[4]=f*d-m*v,r[5]=m*g-l*d,r[6]=l*v-f*g,r[7]=0,r[8]=l,r[9]=f,r[10]=m,r[11]=0,r[12]=i,r[13]=a,r[14]=s,r[15]=1,r}function _e(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function Ue(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function Oe(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r}function Rr(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r}function Ve(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r}function ze(r,e,t,n){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r[3]=e[3]+t[3]*n,r[4]=e[4]+t[4]*n,r[5]=e[5]+t[5]*n,r[6]=e[6]+t[6]*n,r[7]=e[7]+t[7]*n,r[8]=e[8]+t[8]*n,r[9]=e[9]+t[9]*n,r[10]=e[10]+t[10]*n,r[11]=e[11]+t[11]*n,r[12]=e[12]+t[12]*n,r[13]=e[13]+t[13]*n,r[14]=e[14]+t[14]*n,r[15]=e[15]+t[15]*n,r}function ke(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function Ce(r,e){var t=r[0],n=r[1],i=r[2],a=r[3],s=r[4],o=r[5],h=r[6],c=r[7],l=r[8],f=r[9],m=r[10],p=r[11],g=r[12],v=r[13],d=r[14],x=r[15],S=e[0],u=e[1],M=e[2],b=e[3],y=e[4],D=e[5],G=e[6],N=e[7],L=e[8],F=e[9],P=e[10],I=e[11],w=e[12],U=e[13],ir=e[14],ar=e[15];return Math.abs(t-S)<=R*Math.max(1,Math.abs(t),Math.abs(S))&&Math.abs(n-u)<=R*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-M)<=R*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(a-b)<=R*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-y)<=R*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-D)<=R*Math.max(1,Math.abs(o),Math.abs(D))&&Math.abs(h-G)<=R*Math.max(1,Math.abs(h),Math.abs(G))&&Math.abs(c-N)<=R*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(l-L)<=R*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(f-F)<=R*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(m-P)<=R*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(p-I)<=R*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(g-w)<=R*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(v-U)<=R*Math.max(1,Math.abs(v),Math.abs(U))&&Math.abs(d-ir)<=R*Math.max(1,Math.abs(d),Math.abs(ir))&&Math.abs(x-ar)<=R*Math.max(1,Math.abs(x),Math.abs(ar))}var $e=Ar,Xe=Rr;var j={};ur(j,{add:()=>He,angle:()=>vt,bezier:()=>ct,ceil:()=>je,clone:()=>Be,copy:()=>Ye,create:()=>Gr,cross:()=>at,dist:()=>At,distance:()=>_r,div:()=>Tt,divide:()=>Dr,dot:()=>Vr,equals:()=>yt,exactEquals:()=>bt,floor:()=>qe,forEach:()=>It,fromValues:()=>We,hermite:()=>ot,inverse:()=>nt,len:()=>wt,length:()=>Nr,lerp:()=>st,max:()=>Qe,min:()=>Ke,mul:()=>Mt,multiply:()=>Pr,negate:()=>tt,normalize:()=>it,random:()=>ht,rotateX:()=>mt,rotateY:()=>dt,rotateZ:()=>gt,round:()=>Je,scale:()=>rt,scaleAndAdd:()=>et,set:()=>Ze,sqrDist:()=>St,sqrLen:()=>Lt,squaredDistance:()=>Ur,squaredLength:()=>Or,str:()=>Et,sub:()=>ut,subtract:()=>Fr,transformMat3:()=>ft,transformMat4:()=>lt,transformQuat:()=>pt,zero:()=>xt});function Gr(){var r=new $(3);return $!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Be(r){var e=new $(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Nr(r){var e=r[0],t=r[1],n=r[2];return Math.hypot(e,t,n)}function We(r,e,t){var n=new $(3);return n[0]=r,n[1]=e,n[2]=t,n}function Ye(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function Ze(r,e,t,n){return r[0]=e,r[1]=t,r[2]=n,r}function He(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function Fr(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function Pr(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function Dr(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r}function je(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r}function qe(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r}function Ke(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function Qe(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function Je(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r}function rt(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function et(r,e,t,n){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r}function _r(r,e){var t=e[0]-r[0],n=e[1]-r[1],i=e[2]-r[2];return Math.hypot(t,n,i)}function Ur(r,e){var t=e[0]-r[0],n=e[1]-r[1],i=e[2]-r[2];return t*t+n*n+i*i}function Or(r){var e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function tt(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function nt(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function it(r,e){var t=e[0],n=e[1],i=e[2],a=t*t+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r}function Vr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function at(r,e,t){var n=e[0],i=e[1],a=e[2],s=t[0],o=t[1],h=t[2];return r[0]=i*h-a*o,r[1]=a*s-n*h,r[2]=n*o-i*s,r}function st(r,e,t,n){var i=e[0],a=e[1],s=e[2];return r[0]=i+n*(t[0]-i),r[1]=a+n*(t[1]-a),r[2]=s+n*(t[2]-s),r}function ot(r,e,t,n,i,a){var s=a*a,o=s*(2*a-3)+1,h=s*(a-2)+a,c=s*(a-1),l=s*(3-2*a);return r[0]=e[0]*o+t[0]*h+n[0]*c+i[0]*l,r[1]=e[1]*o+t[1]*h+n[1]*c+i[1]*l,r[2]=e[2]*o+t[2]*h+n[2]*c+i[2]*l,r}function ct(r,e,t,n,i,a){var s=1-a,o=s*s,h=a*a,c=o*s,l=3*a*o,f=3*h*s,m=h*a;return r[0]=e[0]*c+t[0]*l+n[0]*f+i[0]*m,r[1]=e[1]*c+t[1]*l+n[1]*f+i[1]*m,r[2]=e[2]*c+t[2]*l+n[2]*f+i[2]*m,r}function ht(r,e){e=e||1;var t=vr()*2*Math.PI,n=vr()*2-1,i=Math.sqrt(1-n*n)*e;return r[0]=Math.cos(t)*i,r[1]=Math.sin(t)*i,r[2]=n*e,r}function lt(r,e,t){var n=e[0],i=e[1],a=e[2],s=t[3]*n+t[7]*i+t[11]*a+t[15];return s=s||1,r[0]=(t[0]*n+t[4]*i+t[8]*a+t[12])/s,r[1]=(t[1]*n+t[5]*i+t[9]*a+t[13])/s,r[2]=(t[2]*n+t[6]*i+t[10]*a+t[14])/s,r}function ft(r,e,t){var n=e[0],i=e[1],a=e[2];return r[0]=n*t[0]+i*t[3]+a*t[6],r[1]=n*t[1]+i*t[4]+a*t[7],r[2]=n*t[2]+i*t[5]+a*t[8],r}function pt(r,e,t){var n=t[0],i=t[1],a=t[2],s=t[3],o=e[0],h=e[1],c=e[2],l=i*c-a*h,f=a*o-n*c,m=n*h-i*o,p=i*m-a*f,g=a*l-n*m,v=n*f-i*l,d=s*2;return l*=d,f*=d,m*=d,p*=2,g*=2,v*=2,r[0]=o+l+p,r[1]=h+f+g,r[2]=c+m+v,r}function mt(r,e,t,n){var i=[],a=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=a[0]+t[0],r[1]=a[1]+t[1],r[2]=a[2]+t[2],r}function dt(r,e,t,n){var i=[],a=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=a[0]+t[0],r[1]=a[1]+t[1],r[2]=a[2]+t[2],r}function gt(r,e,t,n){var i=[],a=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],r[0]=a[0]+t[0],r[1]=a[1]+t[1],r[2]=a[2]+t[2],r}function vt(r,e){var t=r[0],n=r[1],i=r[2],a=e[0],s=e[1],o=e[2],h=Math.sqrt(t*t+n*n+i*i),c=Math.sqrt(a*a+s*s+o*o),l=h*c,f=l&&Vr(r,e)/l;return Math.acos(Math.min(Math.max(f,-1),1))}function xt(r){return r[0]=0,r[1]=0,r[2]=0,r}function Et(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function bt(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function yt(r,e){var t=r[0],n=r[1],i=r[2],a=e[0],s=e[1],o=e[2];return Math.abs(t-a)<=R*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-s)<=R*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=R*Math.max(1,Math.abs(i),Math.abs(o))}var ut=Fr,Mt=Pr,Tt=Dr,At=_r,St=Ur,wt=Nr,Lt=Or,It=function(){var r=Gr();return function(e,t,n,i,a,s){var o,h;for(t||(t=3),n||(n=0),i?h=Math.min(i*t+n,e.length):h=e.length,o=n;o<h;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],a(r,r,s),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}}();var O=class r{constructor(e,t=void 0,n=void 0){E(this,"x");E(this,"y");E(this,"z");this.x=e,t===void 0?this.y=e:this.y=t,n===void 0?this.z=e:this.z=n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}add(e){return new r(this.x+e.x,this.y+e.y,this.z+e.z)}subtract(e){return new r(this.x-e.x,this.y-e.y,this.z-e.z)}multiply(e){return new r(this.x*e,this.y*e,this.z*e)}divide(e){if(e===0)throw new Error("Cannot divide by zero.");return new r(this.x/e,this.y/e,this.z/e)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let e=this.length;return new r(this.x/e,this.y/e,this.z/e)}clone(){return new r(this.x,this.y,this.z)}toArray(){return[this.x,this.y,this.z]}toMatrixVec3(){return j.fromValues(this.x,this.y,this.z)}static distance(e,t){return Math.sqrt(H(e.x-t.x,2)+H(e.y-t.y,2)+H(e.z-t.z,2))}static random(e){return new r(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize().multiply(e)}static get zero(){return new r(0,0,0)}static get up(){return new r(0,1,0)}static get down(){return new r(0,-1,0)}static get left(){return new r(-1,0,0)}static get right(){return new r(1,0,0)}static get forward(){return new r(0,0,1)}static get back(){return new r(0,0,-1)}toString(){return"{ ".concat(this.x,", ").concat(this.y,", ").concat(this.z," }")}};var q=(s=>(s[s.Up=0]="Up",s[s.Down=1]="Down",s[s.West=2]="West",s[s.East=3]="East",s[s.North=4]="North",s[s.South=5]="South",s))(q||{});(e=>{function r(t){switch(t){case 0:return O.up;case 1:return O.down;case 2:return O.left;case 3:return O.right;case 4:return O.forward;case 5:return O.back}}e.toVector=r})(q||(q={}));var A={RENDER_DISTANCE:256,RENDER_CHUNKS:!0,SORT_CHUNKS_BY_DISTANCE:!1,TEXTURE_ATLAS_SIZE:16,TEXTURE_ATLAS_SPRITE_SIZE:16,TEXTURE_PADDING:4,ANSIOTROPIC_FILTERING:0,MSAA_SAMPLES:0,TERRAIN_GENERATION_SEED:"myseed",TERRAIN_GENERATION_ON_MAIN_THREAD:!1,TERRAIN_GENERATION_WORKER_COUNT:1,RAYCASTING_STEP:1,RAYCASTING_MAX_DISTANCE:10,RAYCASTING_USE_DDA:!0,DISABLE_DEPTH_FOR_GIZMOS:!1,RENDER_CHUNK_BOUNDS:!1,RENDER_CHUNK_WIREFRAME:!1};function K(r,e){return(e+1)*16+r}var C=(o=>(o[o.Dirt=K(2,0)]="Dirt",o[o.Grass=K(0,0)]="Grass",o[o.GrassSide=K(3,0)]="GrassSide",o[o.DiamondOre=K(2,3)]="DiamondOre",o[o.Stone=K(1,0)]="Stone",o[o.Sand=K(2,1)]="Sand",o[o.Snow=K(2,4)]="Snow",o))(C||{});(e=>{function r(t){let n=A.TEXTURE_ATLAS_SIZE,i=A.TEXTURE_ATLAS_SPRITE_SIZE,a=A.TEXTURE_PADDING,s=Math.floor(t/n),o=t%n,h=0,c=0;a>0&&(h=a/(n*i),c=a/(n*i));let l=o/n+h,f=(n-s)/n+c,m=(o+1)/n-h,p=(n-s+1)/n-c;return[l,f,m,f,m,p,l,p].map(g=>Math.clamp(g,0,1))}e.toUV=r})(C||(C={}));var Q=(s=>(s[s.Air=0]="Air",s[s.Dirt=1]="Dirt",s[s.Grass=2]="Grass",s[s.Sand=3]="Sand",s[s.Stone=4]="Stone",s[s.Snow=5]="Snow",s))(Q||{});(e=>{function r(t,n){let i;switch(t){case 1:i=C.Dirt;break;case 2:switch(n){case 0:i=C.Grass;break;case 1:i=C.Dirt;break;default:i=C.GrassSide;break}break;case 3:i=C.Sand;break;case 4:i=C.Stone;break;case 5:i=C.Snow;break}return C.toUV(i)}e.toUV=r})(Q||(Q={}));var J=class{constructor(e,t,n=null){this.localPosition=e;this.voxels=t;this.mesh=n}get globalPosition(){return j.fromValues(this.localPosition.x*_,0,this.localPosition.y*_)}get globalCenterPosition(){return j.fromValues(this.localPosition.x*_+_/2,0,this.localPosition.y*_+_/2)}getVoxelAt(e,t,n){return this.voxels.get(e,t,n)}getVoxelAtGlobalPosition(e,t,n){if(e instanceof O)return this.getVoxelAtGlobalPosition(e.x,e.y,e.z);if(t===void 0||n===void 0)throw new Error("Invalid arguments");let i=this.globalPosition,a=e-i[0],s=n-i[2];return this.voxels.get(a,t,s)}render(e,t,n){var i;(i=this.mesh)==null||i.render(e,this.globalPosition,t,n)}};var Y=class r{constructor(e){E(this,"data");e?this.data=e:this.data=new Uint8Array(this.width*this.height*this.depth)}get width(){return _}get depth(){return _}get height(){return sr}get(e,t,n){return e instanceof O?this.get(e.x,e.y,e.z):e<0||e>=this.width||t<0||t>=this.height||n<0||n>=this.depth?null:this.data[e+t*this.width+n*this.width*this.height]}set(e,t,n,i){if(e instanceof O)return this.set(e.x,e.y,e.z,t);if(e<0||e>=this.width||t<0||t>=this.height||n<0||n>=this.depth)return null;this.data[e+t*this.width+n*this.width*this.height]=i}static pack(e){return e.data}static unpack(e){return new r(e)}};var Rt=.5*(Math.sqrt(3)-1),or=(3-Math.sqrt(3))/6,sn=1/3,on=1/6,cn=(Math.sqrt(5)-1)/4,hn=(5-Math.sqrt(5))/20,zr=r=>Math.floor(r)|0,kr=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Cr(r=Math.random){let e=Gt(r),t=new Float64Array(e).map(i=>kr[i%12*2]),n=new Float64Array(e).map(i=>kr[i%12*2+1]);return function(a,s){let o=0,h=0,c=0,l=(a+s)*Rt,f=zr(a+l),m=zr(s+l),p=(f+m)*or,g=f-p,v=m-p,d=a-g,x=s-v,S,u;d>x?(S=1,u=0):(S=0,u=1);let M=d-S+or,b=x-u+or,y=d-1+2*or,D=x-1+2*or,G=f&255,N=m&255,L=.5-d*d-x*x;if(L>=0){let I=G+e[N],w=t[I],U=n[I];L*=L,o=L*L*(w*d+U*x)}let F=.5-M*M-b*b;if(F>=0){let I=G+S+e[N+u],w=t[I],U=n[I];F*=F,h=F*F*(w*M+U*b)}let P=.5-y*y-D*D;if(P>=0){let I=G+1+e[N+1],w=t[I],U=n[I];P*=P,c=P*P*(w*y+U*D)}return 70*(o+h+c)}}function Gt(r){let t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){let i=n+~~(r()*(256-n)),a=t[n];t[n]=t[i],t[i]=a}for(let n=256;n<512;n++)t[n]=t[n-256];return t}var Br=Jr(Xr());var W=class{constructor(e,t,n,i,a){this.scale=n;this.min=i;this.max=a;E(this,"generators");this.generators=[];for(let s=0;s<t;s++)this.generators.push(Cr((0,Br.default)(A.TERRAIN_GENERATION_SEED+e+s)))}get(e,t){let n=0,i=1,a=1,s=0;for(let o of this.generators)n+=o(e/this.scale*a,t/this.scale*a)*i,s+=i,i/=2,a*=2;return n=(n/s+1)/2,n*(this.max-this.min)+this.min}};var lr;(h=>{let r={0:new W("altitude-plains",4,100,0,1),1:new W("altitude-desert",4,100,0,1),3:new W("altitude-mountains",4,100,0,1),2:new W("altitude-snow",4,100,0,1)},e=new W("moisture",1,500,0,100),t=new W("temperature",1,1e3,20,50);function n(c,l){let f=e.get(c,l),m=t.get(c,l);return m<25?2:f>80&&m>25?3:m>30&&f<40?1:0}function i(c,l,f){let m=r[f].get(c,l),p=0,g=0;switch(f){case 1:p=4,g=7;break;case 3:p=4,g=32;break;case 2:p=4,g=15;break;case 0:p=4,g=12;break;default:throw new Error("Unknown biome: ".concat(f))}return m*(g-p)+p}function a(c,l,f,m,p){let g=i(c,l,f),v=i(c,l,m);return p=Math.max(0,Math.min(1,p)),p=Math.floor(p*10)/10,g*p+v*(1-p)}function s(c,l,f,m,p){if(l===0||l<3&&Math.random()<=.9)return 4;if(l>m)return 0;switch(p){case 0:return l>=m-1?2:1;case 1:return 3;case 3:return l>m*.9?5:l<m/2?4:1;case 2:return 5}}function o(c){let l=new Y;for(let f=0;f<_;f++)for(let m=0;m<_;m++){let p=f+Math.ceil(c.x*_),g=m+Math.ceil(c.y*_),v=n(p,g),d=i(p,g,v);for(let x=0;x<=d;x++){let S=s(f,x,m,d,v);l.set(f,x,m,S)}}return new J(c,l)}h.generateChunkVoxels=o})(lr||(lr={}));var z=class{static logColoredText(e,t,n,...i){console[e].call(console,"%c".concat(e.toUpperCase()," %c[").concat(t,"]"),"font-weight: bold; color: ".concat(n,";"),"font-weight: bold; color: gray",...i)}static info(e,...t){this.logColoredText("info",e,"turquoise",...t)}static warn(e,...t){this.logColoredText("warn",e,"yellow",...t)}static error(e,...t){let n=t.find(i=>i instanceof Error);n&&console.trace(n),this.logColoredText("error",e,"red",...t)}static debug(e,...t){}};var cr=class{static load(e){return k(this,null,function*(){try{if(this.cache.has(e))return z.debug("FileUtils","Loading file from cache: ".concat(e)),this.cache.get(e);z.debug("FileUtils","Loading file: ".concat(e));let t=yield fetch("".concat(window.location.href).concat(e));if(!t.ok)throw new Error("Failed to load file: ".concat(e));let n=yield t.text();return this.cache.set(e,n),n}catch(t){throw z.error("FileUtils","Failed to load file: ".concat(e),t),t}})}};E(cr,"cache",new Map);var Z=class Z{constructor(e,t){this.gl=e;this.name=t;E(this,"program",null);E(this,"buffers",{});E(this,"attributes",{});E(this,"uniforms",{})}preprocessShader(e){let t=e.indexOf("#version");return t=e.indexOf("\n",t)+1,Z.SPLIT&&(e=e.insertAt(t,"\n#define SPLIT\n")),e}loadShader(e,t){return k(this,null,function*(){if(z.info("Shader-".concat(this.name),"Loading shader: ".concat(t,"...")),Z.cache.has(t))return z.debug("Shader-".concat(this.name),"Shader cached!"),Z.cache.get(t);let n=this.preprocessShader(yield cr.load("shaders/".concat(t,".glsl"))),i=this.gl.createShader(e);if(!i)throw new Error("Could not create shader");if(z.debug("Shader-".concat(this.name),"Compiling shader: ".concat(t,"...")),this.gl.shaderSource(i,n),this.gl.compileShader(i),!this.gl.getShaderParameter(i,GL.COMPILE_STATUS)){let a=this.gl.getShaderInfoLog(i);throw this.gl.deleteShader(i),new Error("Could not compile '".concat(t,"' for shader '").concat(this.name,"': ").concat(a))}return Z.cache.set(t,i),i})}setup(e){return k(this,null,function*(){yield this.setupProgram(e.source.vertex,e.source.fragment),this.setupAttributes(e),this.setupUniforms(e.uniforms),this.setupBuffers(e.buffers)})}setupProgram(e,t){return k(this,null,function*(){z.info("Shader-".concat(this.name),"Loading shader...");let n=yield this.loadShader(GL.VERTEX_SHADER,e),i=yield this.loadShader(GL.FRAGMENT_SHADER,t);z.debug("Shader-".concat(this.name),"Linking shader program...");let a=this.gl.createProgram();if(!a)throw new Error("Could not create shader program for shader '".concat(this.name,"'"));if(this.gl.attachShader(a,n),this.gl.attachShader(a,i),this.gl.linkProgram(a),!this.gl.getProgramParameter(a,GL.LINK_STATUS)){let s=this.gl.getProgramInfoLog(a);throw this.gl.deleteProgram(a),new Error("Could not link shader program for shader '".concat(this.name,"': ").concat(s))}this.program=a})}setupAttributes(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let t=[];e.attributes&&t.push(...e.attributes),Object.values(e.buffers).map(n=>typeof n=="object"?n.attribute:null).filter(n=>n).forEach(n=>t.push(n)),this.attributes={};for(let n of t){if(this.attributes.hasOwnProperty(n))continue;let i=this.gl.getAttribLocation(this.program,n);if(i===-1)throw new Error("Could not find attribute '".concat(n,"' on shader '").concat(this.name,"'"));this.attributes[n]=i}}setupUniforms(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let t=this.gl.getProgramParameter(this.program,GL.ACTIVE_UNIFORMS);if(!t)throw new Error("Could not get active uniforms for shader '".concat(this.name,"'"));this.uniforms={};for(let n=0;n<t;n++){let i=this.gl.getActiveUniform(this.program,n);if(!i)throw new Error("Could not get active uniform '".concat(n,"' on shader '").concat(this.name,"'"));let a=this.gl.getUniformLocation(this.program,i.name);if(!a)throw new Error("Could not get location of uniform '".concat(i.name,"' on shader '").concat(this.name,"'"));if(!e.includes(i.name))throw Error("Uniform '".concat(i.name,"' is not being used on shader '").concat(this.name,"'"));this.uniforms[i.name]={location:a,type:i.type}}for(let n of e)if(!this.uniforms.hasOwnProperty(n))throw new Error("Could not find uniform '".concat(n,"' on shader '").concat(this.name,"'"))}setupBuffers(e){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));this.buffers={};for(let t in e){if(!e.hasOwnProperty(t))continue;let n=e[t],i=this.gl.createBuffer();if(!i)throw new Error("Could not create buffer");let a=GL.ARRAY_BUFFER,s=GL.STATIC_DRAW,o=null,h=t,c=null;if(typeof n=="object"){let l=n;l.attribute&&(h=l.attribute),l.target&&(a=l.target),l.usage&&(s=l.usage),l.data&&(n=l.data)}if(n instanceof Float32Array||n instanceof Uint16Array||n instanceof Uint8Array||n instanceof Int16Array||n instanceof Int8Array||n instanceof Uint32Array||n instanceof Int32Array?c=n:typeof n=="function"&&(o=n),this.gl.bindBuffer(a,i),c&&(o||(o=c.constructor),this.gl.bufferData(a,c,s)),!o)throw new Error("Could not determine buffer data type for buffer '".concat(t,"' on shader '").concat(this.name,"'"));this.buffers[t]={buffer:i,type:o,attribute:h,target:a,usage:s}}}bindBuffer(e,t=null){let n=this.buffers[e];if(!n)throw new Error("Could not find buffer '".concat(e,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(n.target,n.buffer),t&&this.gl.bufferData(n.target,t,n.usage)}setUniform(e,t){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let n=this.uniforms[e];if(!n)throw new Error("Could not find uniform '".concat(e,"' on shader '").concat(this.name,"'"));switch(n.type){case GL.FLOAT:this.gl.uniform1f(n.location,t);break;case GL.FLOAT_VEC2:this.gl.uniform2fv(n.location,t);break;case GL.FLOAT_VEC3:this.gl.uniform3fv(n.location,t);break;case GL.FLOAT_VEC4:this.gl.uniform4fv(n.location,t);break;case GL.FLOAT_MAT4:this.gl.uniformMatrix4fv(n.location,!1,t);break;case GL.SAMPLER_2D:this.gl.uniform1i(n.location,t);break;default:throw new Error("Uniform type '".concat(n.type,"' not supported"))}}extractAttributeInfo(e,t){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));let n=this.gl.getActiveAttrib(this.program,t);if(!n)throw new Error("Could not get attribute info for '".concat(e,"' on shader '").concat(this.name,"'"));let i={[GL.FLOAT]:1,[GL.FLOAT_VEC2]:2,[GL.FLOAT_VEC3]:3,[GL.FLOAT_VEC4]:4}[n.type];return{type:{[GL.FLOAT]:GL.FLOAT,[GL.FLOAT_VEC2]:GL.FLOAT,[GL.FLOAT_VEC3]:GL.FLOAT,[GL.FLOAT_VEC4]:GL.FLOAT}[n.type],size:i}}bind(){if(!this.program)throw new Error("Shader '".concat(this.name,"' program not loaded"));for(let e in this.attributes){if(!this.attributes.hasOwnProperty(e))continue;let t=this.attributes[e],n=Object.values(this.buffers).find(s=>s.attribute===e);if(!n)throw new Error("Could not find buffer '".concat(e,"' on shader '").concat(this.name,"'"));this.gl.bindBuffer(n.target,n.buffer);let{type:i,size:a}=this.extractAttributeInfo(e,t);this.gl.vertexAttribPointer(t,a,i,!1,0,0),this.gl.enableVertexAttribArray(t)}this.gl.useProgram(this.program)}};E(Z,"SPLIT",!1),E(Z,"cache",new Map);var tr=Z;var nr=class{static applyPadding(e){let t=e.height/A.TEXTURE_ATLAS_SIZE,n=e.width/A.TEXTURE_ATLAS_SIZE,i=A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING*2,a=A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING*2,s=document.createElement("canvas");s.width=i*n,s.height=a*t;let o=s.getContext("2d");if(!o)throw new Error("Could not get 2D context");o.imageSmoothingEnabled=!1;for(let h=0;h<t;h++)for(let c=0;c<n;c++){let l=c*A.TEXTURE_ATLAS_SPRITE_SIZE,f=h*A.TEXTURE_ATLAS_SPRITE_SIZE;o.drawImage(e,l,f,A.TEXTURE_ATLAS_SPRITE_SIZE,1,c*i,h*a,A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING*2,A.TEXTURE_PADDING),o.drawImage(e,l,f+A.TEXTURE_ATLAS_SPRITE_SIZE-1,A.TEXTURE_ATLAS_SPRITE_SIZE,1,c*i,h*a+A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING,A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING*2,A.TEXTURE_PADDING),o.drawImage(e,l,f,1,A.TEXTURE_ATLAS_SPRITE_SIZE,c*i,h*a,A.TEXTURE_PADDING,A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING*2),o.drawImage(e,l+A.TEXTURE_ATLAS_SPRITE_SIZE-1,f,1,A.TEXTURE_ATLAS_SPRITE_SIZE,c*i+A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING,h*a,A.TEXTURE_PADDING,A.TEXTURE_ATLAS_SPRITE_SIZE+A.TEXTURE_PADDING*2),o.drawImage(e,l,f,A.TEXTURE_ATLAS_SPRITE_SIZE,A.TEXTURE_ATLAS_SPRITE_SIZE,c*i+A.TEXTURE_PADDING,h*a+A.TEXTURE_PADDING,A.TEXTURE_ATLAS_SPRITE_SIZE,A.TEXTURE_ATLAS_SPRITE_SIZE)}return s}static load(e,t=null){return new Promise((n,i)=>{if(this.cache.has(e)){let s=this.cache.get(e);if(s===void 0)throw new Error("Unexpected undefined value in cache");return n(s)}let a=new Image;a.src="".concat(window.location.href,"assets/images/").concat(e,".png"),a.crossOrigin="anonymous",a.style.display="none",a.id="image-".concat(e),t&&(a.width=t.width,a.height=t.height),a.onerror=s=>{z.error("ImageUtils","Failed to load image: ".concat(e),s.toString()),i(s)},a.onload=()=>{this.cache.set(e,a),n(a)}})}static get(e){if(!this.cache.has(e))return null;let t=this.cache.get(e);if(t===void 0)throw new Error("Unexpected undefined value in cache");return t}};E(nr,"cache",new Map);var rr=class rr{constructor(e){this.gl=e;E(this,"texture",null)}static loadTerrain(e){return k(this,null,function*(){rr.terrain||(rr.terrain=new rr(e),yield rr.terrain.load("terrain",!0,!0))})}load(e,t=!0,n=!1){return k(this,null,function*(){let i=yield nr.load(e);n&&(i=nr.applyPadding(i));let a=this.gl.createTexture();if(!a)throw new Error("Could not create texture for '".concat(e,"'"));this.texture=a,this.gl.bindTexture(GL.TEXTURE_2D,a),this.gl.texImage2D(GL.TEXTURE_2D,0,GL.RGBA,GL.RGBA,GL.UNSIGNED_BYTE,i),t?(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.NEAREST),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.NEAREST)):(this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MAG_FILTER,GL.LINEAR),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_MIN_FILTER,GL.LINEAR)),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_S,GL.CLAMP_TO_EDGE),this.gl.texParameteri(GL.TEXTURE_2D,GL.TEXTURE_WRAP_T,GL.CLAMP_TO_EDGE)})}bind(){this.gl.activeTexture(GL.TEXTURE0),this.gl.bindTexture(GL.TEXTURE_2D,this.texture)}};E(rr,"terrain");var B=rr;var fr=class{constructor(e,t,n,i,a,s){this.gl=e;this.position=t;this.vertices=n;this.uvs=i;this.normals=a;this.indices=s;E(this,"shader")}setup(){return k(this,null,function*(){this.shader=new tr(this.gl,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:this.vertices,attribute:"a_position"},uv:{data:this.uvs,attribute:"a_texcoord"},normal:{data:this.normals,attribute:"a_normal"},index:{data:this.indices,target:GL.ELEMENT_ARRAY_BUFFER}}})})}render(e,t){this.shader.bind(),B.terrain.bind();let n=X.create();X.translate(n,n,this.position.toMatrixVec3()),X.multiply(n,t,n),this.shader.setUniform("u_modelView",n),this.shader.setUniform("u_projection",e),this.shader.setUniform("u_texture",0),this.shader.bindBuffer("index",this.indices),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0)}};var T=class T extends fr{constructor(t,n,i,a){let s=[i,i,n,a,i,i].map(T.getUV).flat();super(t,T.vertices,new Float32Array(s),T.normals,T.indices);this.topFace=n;this.sideFace=i;this.bottomFace=a}};E(T,"frontFaceVertices",[-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]),E(T,"backFaceVertices",[.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5]),E(T,"topFaceVertices",[-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5]),E(T,"bottomFaceVertices",[-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5]),E(T,"rightFaceVertices",[.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5]),E(T,"leftFaceVertices",[-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5]),E(T,"vertices",new Float32Array([...T.frontFaceVertices,...T.backFaceVertices,...T.topFaceVertices,...T.bottomFaceVertices,...T.rightFaceVertices,...T.leftFaceVertices])),E(T,"frontFaceIndices",[0,1,2,0,2,3]),E(T,"backFaceIndices",[4,5,6,4,6,7]),E(T,"topFaceIndices",[8,9,10,8,10,11]),E(T,"bottomFaceIndices",[12,13,14,12,14,15]),E(T,"rightFaceIndices",[16,17,18,16,18,19]),E(T,"leftFaceIndices",[20,21,22,20,22,23]),E(T,"indices",new Uint16Array([...T.frontFaceIndices,...T.backFaceIndices,...T.topFaceIndices,...T.bottomFaceIndices,...T.rightFaceIndices,...T.leftFaceIndices])),E(T,"frontFaceNormals",[0,0,1,0,0,1,0,0,1,0,0,1]),E(T,"backFaceNormals",[0,0,-1,0,0,-1,0,0,-1,0,0,-1]),E(T,"topFaceNormals",[0,1,0,0,1,0,0,1,0,0,1,0]),E(T,"bottomFaceNormals",[0,-1,0,0,-1,0,0,-1,0,0,-1,0]),E(T,"rightFaceNormals",[1,0,0,1,0,0,1,0,0,1,0,0]),E(T,"leftFaceNormals",[-1,0,0,-1,0,0,-1,0,0,-1,0,0]),E(T,"normals",new Float32Array([...T.frontFaceNormals,...T.backFaceNormals,...T.topFaceNormals,...T.bottomFaceNormals,...T.rightFaceNormals,...T.leftFaceNormals]));var V=T;var mr=class mr{constructor(e,t,n,i){this.vertices=e;this.uvs=t;this.normals=n;this.indices=i}get vertexCount(){return this.vertices.length/3}get triangleCount(){return this.indices.length/3}get shader(){return mr.shader}render(e,t,n,i){this.shader.bind(),B.terrain.bind();let a=X.create();X.translate(a,a,t),X.multiply(a,i,a),this.shader.setUniform("u_modelView",a),this.shader.setUniform("u_projection",n),this.shader.setUniform("u_texture",0),this.shader.bindBuffer("vertex",this.vertices),this.shader.bindBuffer("uv",this.uvs),this.shader.bindBuffer("index",this.indices),this.shader.bindBuffer("normal",this.normals),e.drawElements(GL.TRIANGLES,this.indices.length,GL.UNSIGNED_SHORT,0)}static setup(e){return k(this,null,function*(){B.terrain||(B.terrain=new B(e),yield B.terrain.load("terrain")),this.shader=new tr(e,"geometry"),yield this.shader.setup({source:{vertex:"vertex",fragment:"fragment"},uniforms:["u_modelView","u_projection","u_texture"],buffers:{vertex:{data:Float32Array,attribute:"a_position"},uv:{data:Float32Array,attribute:"a_texcoord"},normal:{data:Float32Array,attribute:"a_normal"},index:{data:Uint16Array,target:GL.ELEMENT_ARRAY_BUFFER}}})})}};E(mr,"shader");var pr=mr;var Nt=[0,1,2,0,2,3],dr=class{constructor(){E(this,"vertices",[]);E(this,"normals",[]);E(this,"uvs",[]);E(this,"indices",[])}addQuad(e,t,n,i){this.normals.push(...n),this.uvs.push(...i);let a=this.vertices.length/3;this.indices.push(...Nt.map(s=>s+a)),this.vertices.push(...t.map((s,o)=>s+e[o%3]))}build(e){return new pr(new Float32Array(this.vertices),new Float32Array(this.uvs),new Float32Array(this.normals),new Uint16Array(this.indices))}};var gr=class{constructor(e,t,n,i,a,s){this.position=e;this.chunk=t;this.westNeighbor=n;this.eastNeighbor=i;this.northNeighbor=a;this.southNeighbor=s;E(this,"builder",new dr)}generateMesh(){for(let e=0;e<_;e++)for(let t=0;t<sr;t++)for(let n=0;n<_;n++){let i=this.chunk.getVoxelAt(e,t,n);if(!i)continue;let a=new O(e,t,n);t<sr&&this.addFace(a,0,i),t>0&&this.addFace(a,1,i),this.addFace(a,2,i),this.addFace(a,3,i),this.addFace(a,4,i),this.addFace(a,5,i)}this.chunk.mesh=this.builder.build(this.position)}decodeFace(e){switch(e){case 0:return{vertices:V.topFaceVertices,normals:V.topFaceNormals};case 1:return{vertices:V.bottomFaceVertices,normals:V.bottomFaceNormals};case 2:return{vertices:V.leftFaceVertices,normals:V.leftFaceNormals};case 3:return{vertices:V.rightFaceVertices,normals:V.rightFaceNormals};case 4:return{vertices:V.frontFaceVertices,normals:V.frontFaceNormals};case 5:return{vertices:V.backFaceVertices,normals:V.backFaceNormals};default:throw new Error("Invalid direction")}}addFace(e,t,n){if(this.isFaceObstructed(e,t))return;let{vertices:a,normals:s}=this.decodeFace(t),o=Q.toUV(n,t);this.builder.addQuad(e.toArray(),a,s,o)}getNeighbor(e){switch(e){case 3:return this.eastNeighbor;case 2:return this.westNeighbor;case 4:return this.northNeighbor;case 5:return this.southNeighbor;default:return null}}isFaceObstructed(e,t){let n=e.add(q.toVector(t));if(this.chunk.getVoxelAt(n))return!0;let a=this.getNeighbor(t);if(!a)return!1;let s=new O(this.position.x*_,0,this.position.y*_).add(n);return!!a.getVoxelAtGlobalPosition(s)}};var Er;(i=>{function r(){self.onmessage=n.bind(this)}i.setup=r;function e(a){let s=new er(a.data.x,a.data.z),o=lr.generateChunkVoxels(s),h=Y.pack(o.voxels);self.postMessage({type:"terrain",data:{voxels:h,x:a.data.x,z:a.data.z}})}function t(a){let s=new er(a.data.chunk.x,a.data.chunk.z),o=new J(s,Y.unpack(a.data.chunk.voxels),null),[h,c,l,f]=a.data.neighbors.map(p=>p?new J(new er(p.x,p.z),Y.unpack(p.voxels)):null);new gr(s,o,f,c,l,h).generateMesh(),self.postMessage({type:"mesh",data:{x:s.x,z:s.y,mesh:o.mesh,depth:a.data.depth}})}function n(a){switch(a.data.type){case"terrain":e(a.data);break;case"mesh":t(a.data);break;default:console.error("TerrainGeneratorWorker","Unknown message type",a.data.type);break}}})(Er||(Er={}));Er.setup();})();
